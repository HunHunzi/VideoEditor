!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var s in i)("object"==typeof exports?exports:t)[s]=i[s]}}(this,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=28)}([function(t,e,i){"use strict";var s=i(8),r=i(3),a=i(2);var o=99;function n(){return r.a.getDateTimeStr()+" "}var h=!1;let d={_data:[],_data2:[],_length:0,debug:function(){var t=n(),e=Array.apply(null,arguments);e[0]=t+e[0],o<=-1&&console.log.apply(console,e)},log:function(t){var e=n(),i=Array.apply(null,arguments);i[0]=e+i[0],o<=0&&console.log.apply(console,i),d.record(i,"log")},info:function(t){var e=n(),i=Array.apply(null,arguments);i[0]=e+i[0],o<=1&&console.info.apply(console,i),d.record(i,"info")},warn:function(t){var e=n(),i=Array.apply(null,arguments);i[0]=e+i[0],o<=2&&console.warn.apply(console,i),d.record(i,"warn")},error:function(t){var e=n(),i=Array.apply(null,arguments);i[0]=e+i[0],o<=3&&console.error.apply(console,i),d.record(i,"error")},group:function(t){var e=n(),i=Array.apply(null,arguments);if(i[0]=e+i[0],o<=1){var s=console.groupCollapsed||console.group||console.log;s.apply(console,i)}d.record(i,"group")},groupEnd:function(){console.groupEnd&&console.groupEnd.apply(console)},setLevel:function(t){t!=o&&(console.log(n()+" set log level from "+o+" to "+t),o=t)},getLevel:function(){return o},record:function(t,e){const i=a.a.logMaxLen||1e3;d._length===i+100&&(d._data.splice(0,100),d._data2.splice(0,100),d._length=i);var s=0,r=(t.shift()||"").toString();for(r=r.replace(/\%c/gi,(function(t,e){return s++,""}));s--&&t.length;)t.shift();for(var o=0,n=t.length;o<n;o++){"object"==typeof t[o]&&(t[o]="")}t.unshift(r);var h=t.join(" ");d._length++,d._data.push(`[${e}]${h}`),d._data2.push(`[${e}]${h}`)},getLog:function(){return h||(h=!0,d._data.unshift(s.a.platform+" "+s.a.name+" "+s.a.version.string)),d._data},getNewLog:function(){h||(h=!0,d._data2.unshift(s.a.platform+" "+s.a.name+" "+s.a.version.string));const t=[...d._data2];return d._data2.length=0,t},logcss:function(t,e,i){let s="font-weight:900";return t&&(s+=";color:"+t),e&&(s+=";background:"+e),i&&(s+=";border:3px solid "+i),s},padNum:function(t,e){let i=t.toString().length,s=Math.max(0,e-i);return"0".repeat(s)+t}};e.a=d},function(t,e,i){"use strict";e.a={KEY_VALUE:"value",KEY_STR:"str",KEY_DIM:"dim",K:"k",LIVE_TYPE:{FLV:0,P2P:1,HLS:2},HEART_TYPE:{START:0,CONTINUS:1,END:2},DIM_COM:{SDK_VER:"sdk_ver",P2P:"p2p",AD_BLOCK:"ad_block",OEXP:"oexp",STREAM_URL:"stream_url",STREAM_302_URL:"stream_302_url",CDNDOMAIN:"cdndomain",USER_UUID:"user_uuid",STREAM:"stream",CDNP_CONNECT_IP:"cdnp_connect_ip",CDNP_CONNECTED:"cdnp_connected",CDP_ID:"cdp_id",USER_WAN_IP:"user_wan_ip",VIDEO_LOGIN_FAIL:"video_login_fail",ORIGINAL_BITRATE:"original_bitrate",BROWSER_NAME:"browser_name",BROWSER_VERSION:"browser_version",BROWSER_KERNEL:"browser_kernel",BROWSER_KERNEL_VERSION:"browser_kernel_version",OS_NAME:"os_name",OS_VERSION:"os_version",RENDER_INFO:"render_info",SPHD_TYPE:"sphd_type",DPI:"dpi",CDNIP:"cdnip",AUTO_BITRATE:"auto_bitrate",P2P_COOL_FLAG:"p2p_cool_flag",MP_EXPERIMENT:"mp_experiment",ACT_LOAD_TYPE:"act_load_type",STREAM_INDEX:"stream_index",OBS_RENDER_MODE:"obs_render_mode",PLAYER_TYPE:"player_type",LIVE_TYPE:"live_type",STREAM_TYPE:"stream_type",HLS_TYPE:"hls_type",VR_ENABLE:"vr_enable",VR_MODE:"vr_mode",CODEC_TYPE:"codec_type",CDN_CIP:"cdn_cip",CDN_SIP:"cdn_sip",ALT_SVC:"alt_svc",QUIC:"quic",START_TYPE:"start_type",PCDN_ORIGIN:"pcdn_origin",EXPECT_PCDN_NAME:"expect_pcdn_name",CLI_ISP:"cli_isp",CLI_PROV:"cli_prov",SUB_PCDN_STATE:"sub_pcdn_state",STREAM_TOTAL_DURATION:"stream_total_duration",CODERATE_BPS:"coderatebps",LINE:"line",CODERATE:"coderate",VOD_CODERATE:"vod_coderate",PLAYBACK_RATE:"playbackrate",ANCHOR_UID:"anchoruid",FLV_PCDN_STATE:"flv_pcdn_state",H265:"h265",V_DECODEC:"v_decodec",V_RECV_FRAME:"v_recv_frames",V_TO_DECODE_FRAMES:"v_to_decode_frames",V_DECODE_FRAME:"v_decode_frames",V_PLAY_FRAME:"v_play_frame",V_TO_PLAY_FRAME:"v_to_play_frames",AV_DELTA:"av_delta",A_RENDER_SILENCE_TIME:"a_render_silence_time",SIGNAL_RTT:"signal_rtt",SIGNAL_RTT_MAX:"signal_rtt_max",CDNP_RTT:"cdnp_rtt",CDNP_RTT_MAX:"cdnp_rtt_max",SUB_CHANGE_STATE:"sub_change_state",FORCE_SUB_TYPE:"force_sub_type",USE_PCDN:"use_pcdn",MUTE_DATA:"mute_data",VISIBILITY_STATE:"visibility_state",SESSION_ID:"session_id",VIDEO_MIN_BUF:"video_min_buf",AUTO_VERSION:"auto_version",MSE_PLAYER:"mse_player",DECODE_HARDWARE_ACCELERATION:"decode_hardware_acceleration",HARDWARE_CONCURRENCY:"hardware_concurrency",START_CODERATEBPS:"start_coderatebps",DEFAULT_BITRATEBPS:"default_bitratebps",MEMORY_BITRATEBPS:"memory_bitratebps",RECOMMEND_BITRATEBPS:"recommend_bitratebps",AUTO_USER_TAGS:"auto_user_tags",AUTO_OPEN:"auto_open",V_RECV_FRAMES:"v_recv_frames",H265_SUPPORT_REASON:"h265_support_reason",PLACE:"place",PULLSTREAM_REASOM:"pullstream_reason",VIDEO_PAUSE_BUFFERS:"video_pause_buffers",VIDEO_PAUSE_CONTINUE_BUFFERS:"video_pause_continue_buffers",HARDDECODE:"harddecode",DECODE_SUPPORT:"deocode_support",IS_TIE_STREAM:"is_tie_stream",IS_REDIRECT:"is_redirect",CLOSE_EXTSTREAM:"close_extstream",MOSAIC_DATA:"mosaic_data",PCDN_IAAS:"pcdn_iaas",P2P_TO_FLV_DOMAIN:"p2p_to_flv_domain",DECODE_CAPABILITY:"decode_capability",WEBCODECS_BACK_REASON:"webcodecs_back_reason",STREAM_FORMAT:"stream_format",A_CFG:"a_cfg",IS_MUTE:"is_mute",IS_MOSAIC:"is_mosaic",I_GPU:"i_gpu",P_IAAS_INFO:"p_iaas_info",UA:"ua",IAAS_BW_INFO:"iaas_bw_info",IS_PAID_ROOM:"is_paid_room",SUB_STATA_INFO:"sub_state_info",PSUB_PROXY_INFO:"psub_proxy_info",I_AVC_CHANGE:"i_avc_change",FEATURE_STATUS:"features_status",V_ENHANCE_TYPE:"v_enhance_type",V_ENHANCE_ENTRY:"v_enhance_entry",ENHANCE_BACK_REASON:"enhance_back_reason",FRAMERATE:"framerate",GAMEID:"gameid",NAT:"nat",MPS_STATUS:"mps_status",IP_STACK_TYPE:"ip_stack_type",TEAM_PORT:"team_port"},DIM_CORE:{REPROT_TIME:"reprot_time",BATCH_ID:"batch_id",REPORT_TYPE:"report_type",CREATE_TIME:"create_time",VIDEO_BAD_QUALITY_OLD:"video_bad_quality_old",VIDEO_BAD_QUALITY:"video_bad_quality",VIDEO_BAD_REASON:"video_bad_reason",USER_PROPERTY:"user_property",HEART_TYPE:"heart_type",SIGNAL_USER_PROPERTY:"signal_user_property",F_BUF:"f_buf",VTDAVG:"vtdavg",VTDMAX:"vtdmax",ATDAVG:"atdavg",ATDMAX:"atdmax",VRTADE:"vrtade",VRTADEMAX:"vrtademax",VATRDE:"vatrde",VATRDEMAX:"vatrdemax",ARTADE:"artade",ARTADEMAX:"artademax",AATRDE:"aatrde",AATRDEMAX:"aatrdemax",VRDFPS:"vrdfps",VRCFPS:"vrcfps",VDF:"vdf",PFPS:"pfps",PFPSMAX:"pfpsmax",PFPSMIN:"pfpsmin",VRBQ:"vrbq",VRBQC:"vrbqc",VRBQD:"vrbqd",AVSDA:"avsda",AVSDM:"avsdm",AVEFS:"avefs",VIDEO_H265_BAD_QUALITY:"video_h265_bad_quality",AUTO_U_REASON:"auto_u_reason",AUTO_D_REASON:"auto_down_reason",AUTO_HEART_TYPE:"auto_heart_type",AUTO_CODEC_CHANGE_TYPE:"auto_codec_change_type",AUTO_BAD_REASON:"auto_bad_reason",AUTO_BAD_MIN_REASON:"auto_bad_min_reason",DISPATCH_ID:"dispatch_id",PCDN_SVR_ISP:"pcdn_svr_isp",PCDN_SVR_AREA:"pcdn_svr_area",UNOPEND_CPFLV_BW:"unopend_cpflv_bw",NORETURN_CPFLV_BW:"noreturn_cpflv_bw",UNSUPPORT_CPFLV_BW:"unsupport_cpflv_bw",LOAD_LIB_CPFLV_BW:"load_lib_cpflv_bw",GATHER_CPFLV_BW:"gather_cpflv_bw",GATHER_FAIL_CPFLV_BW:"gather_fail_cpflv_bw",LOAD_SUC_CPFLV_BW:"load_suc_cpflv_bw",ERROR_CPFLV_BW:"error_cpflv_bw",KICK_CPFLV_BW:"kick_cpflv_bw",WAIT_CDN_LOAD_CPFLV_BW:"wait_cdn_load_cpflv_bw",DTS_ERROR_CPFLV_BW:"dts_error_cpflv_bw",OTHER_CPFLV_BW:"other_cpflv_bw",ENHANCE_TOTAL:"enhance_total",ENHACNE_LESS_30:"enhance_less_30",ENHACNE_LESS_150:"enhance_less_150",ENHACNE_LESS_200:"enhance_less_200",ENHACNE_LARGE_200:"enhance_large_200"},PCDN_DATA:{GET_PCDN_URL_TOTAL_CNT:"get_pcdn_url_total_cnt",GET_PCDN_URL_SUCCESS:"get_pcdn_url_success",GET_PCDN_URL_SUC_FREETIME:"get_pcdn_url_suc_freetime",GET_PCDN_ERR_NOT_REACHED:"get_pcdn_err_not_reached",GET_PCDN_ERR_OVER_RUN:"get_pcdn_err_over_run",GET_PCDN_ERR_OVER_RUN_FREETIME:"get_pcdn_err_over_run_freetime",GET_PCDN_ERR_NOT_COVERD:"get_pcdn_err_not_coverd",GET_PCDN_ERR_OTHER:"get_pcdn_err_other",GET_PCDN_ERROR_REQ:"get_pcdn_err_req",GET_SUBS_URL_ERROR_CNT:"get_subs_url_error_cnt",GET_PCDN_DATA_TIME:"get_pcdn_data_time",GET_PCDN_DATA_TIME_CNT:"get_pcdn_data_time_cnt",GET_PCDN_SUBS_URL_TIME:"get_pcdn_subs_url_time",GET_PCDN_SUBS_URL_TIME_CNT:"get_pcdn_subs_url_time_cnt",GET_CDN_DATA_TIME:"get_cdn_data_time",GET_CDN_DATA_TIME_CNT:"get_cdn_data_time_cnt",PCDN_REPEAT_BW:"pcdn_repeat_bw",USE_PCDN:"use_pcdn"},DIM_LINK_STA:{name:"link_sta",CONNECT_SUC:"cns",HAS_DATA:"hd",DATA_ENOUGH:"de",AUDIO_CONFIG:"acf",VIDEO_CONFIG:"vcf",VIDEO_IFRAME:"vif",VIDEO_FRAME:"vf",AUDIO_FRAME:"af",NO_SLICE_DATA:"nsd",H265:"h265"},DIM_LINK_SAM:{name:"link_sam",AUDIO_DTS:"ad",VIDEO_DTS:"vd",AUDIO_RATE:"ar",VIDEO_RATE:"vr",AUDIO_WAIT_PUSH:"awp",VIDEO_WAIT_PUSH:"vwp",AUDIO_WAIT_REASON:"awr",VIDEO_WAIT_REASON:"vwr",AUDIO_WAIT_GAP:"awg",VIDEO_WAIT_GAP:"vwg",VIDEO_DROP_FRAMES:"vdf",VIDEO_AUDIO_GAP:"vag",VIDEO_BUFFER_EMPTY_TIME:"vbet",VIDEO_BUFFER_EMPTY_COUNT:"vbec",SPEED:"sp"},DIM_H265_SAM:{name:"h265_sam",decode_fps:"decode_fps",render_fps:"render_fps",frame_list_len:"frame_list_len"},DIM_EXT:{CDN_IP:"cdn_ip"},CORE:{name:"yspwl.web.live.user.heart20",PUNCHED_UUIDS:"punched_uuids",MPS_SUBS:"mps_subs",MPS_SRC:"mps_src",MPS_UP:"mps_up",MPS_SRC_BW:"mps_src_bw",MPS_UP_BW:"mps_up_bw",HTD:"htd",AUDIO_CNT:"audio_cnt",BIG_AUDIO_CNT:"big_audio_cnt",A_VOL:"a_vol",A_E_DUR:"a_e_dur",A_E_CNT:"a_e_cnt",V_CAPTURE_JITTERS:"v_capture_jitters",V_CAPTURE_JITTER_MAX:"v_capture_jitter_max",A_CAPTURE_JITTERS:"a_capture_jitters",A_CAPTURE_JITTER_MAX:"a_capture_jitter_max",STAT_BW:"stat_bw",CDN_TOTAL_BW:"cdn_total_bw",CDN_VALID_BW:"cdn_valid_bw",CDN_REPEAT_BW:"cdn_repeat_bw",P2P_TOTAL_BW:"p2p_total_bw",P2P_REPEAT_BW:"p2p_repeat_bw",P2P_VALID_BW:"p2p_valid_bw",RANGE_TOTAL_BW:"range_total_bw",RANGE_VALID_BW:"range_valid_bw",PEER_RANGE_TOTAL_BW:"peer_range_total_bw",PEER_RANGE_VALID_BW:"peer_range_valid_bw",PEER_RANGE_REPEAT_BW:"peer_range_repeat_bw",DEFAULT_BW:"default_bw",FAST_BW:"fast_bw",PATCH_BW:"patch_bw",COMPETE_BW:"compete_bw",FIXED_BW:"fixed_bw",FORCE_BW:"force_bw",SIGNAL_UP_BW:"signal_up_bw",SIGNAL_DOWN_BW:"signal_down_bw",ENC_FLOW:"enc_flow",DEC_FLOW:"dec_flow",DEC_OK_CNT:"dec_ok_cnt",DEC_FAIL_CNT:"dec_fail_cnt",BUFFER_LENGTH:"buffer_length",PLAY_DELAY:"play_delay",DELAY_ANCHOR:"delay_anchor",DELAY_SERVER:"delay_server",DELAY_NET:"delay_net",SVR_DELAY_INFOS:"svr_delay_infos",DELAY_NODE_INFO:"delay_node_info",SVR_LAST_P_DELAY:"svr_last_p_delay",UPLOADER_TYPE:"uploader_type",ENCODER_SOURCE:"encoder_source",OBS_FPS:"obs_fps",OBS_UPLOAD_TS:"obs_upload_ts",VIDEO_BLOCK_COUNT:"video_block_count",VIDEO_BLOCK_DURATION:"video_block_duration",VIDEO_BAD_BUFFER:"video_bad_buffer",VIDEO_CONTINUE_BUFFER:"video_continue_buffer",PRTTCNT:"prttcnt",PRSUCNT:"prsucnt",PRNNCnt:"prnncnt",PRTOCNT:"prtocnt",PRFTCNT:"prftcnt",PRFSCNT:"prfscnt",PRNPID:"prnpid",PRNSDK:"prnsdk",PRNPUB:"prnpub",PRNSUB:"prnsub",PRNPEER:"prnpeer",PRNSTREAM:"prnstream",PRNLATE:"prnlate",PRNRTT:"prnrtt",PRNNONE:"prnnone",AUTO_SWITCH_CNT:"auto_switch_cnt",AUTO_SWITCH_SAME_CNT:"auto_switch_same_cnt",AUTO_BAD_QUALITY:"auto_bad_quality",AUTO_BAD_QUALITY_UP:"auto_bad_quality_up",AUTO_BAD_DURATION:"auto_bad_duration",AUTO_BAD_DURATION_UP:"auto_bad_duration_up",AUTO_BAD_SWITCH:"auto_bad_switch",AUTO_BAD_SWITCH_SAME:"auto_bad_switch_same",AUTO_BAD_SWITCH_UP:"auto_bad_switch_up",AUTO_BAD_DONE:"auto_bad_done",AUTO_BAD_BUFFER:"auto_bad_buffer",AUTO_CONTINUE_BUFFER:"auto_continue_buffer",PCDN_TOTAL_BW:"pcdn_total_bw",PCDN_FREETIME_BW:"pcdn_freetime_bw",PCDN_REALTIME_BW:"pcdn_realtime_bw",SWITCH_CDN_CNT:"switch_cdn_cnt",GET_STREAM_CNT:"get_stream_cnt",GET_STREAM_ERROR_CNT:"get_stream_error_cnt",GET_STREAM_LINK_ERROR_CNT:"get_stream_link_error_cnt",GET_STREAM_LINK_TIMEOUT_CNT:"get_stream_link_timeout_cnt",GET_STREAM_LOW_DATA_CNT:"get_stream_low_data_cnt",REAL_KBPS_SAMPLE:"real_kbps_sample",REAL_FLAC_KBPS_SAMPLE:"real_flac_kbps_sample",RECV_TOTAL_SAMPLE:"recv_total_sample",RECV_LAN_SAMPLE:"recv_lan_sample",HAS_PUNCH_NODES:"has_punch_nodes",HAS_PUNCH_NODES_SDKV2:"has_punch_nodes_sdkv2",HAS_PUNCH_NODES_WEBV2:"has_punch_nodes_webv2",HAS_PUNCH_NODES_MEDIA:"has_punch_nodes_media",HAS_PUNCH_NODES_SIGNAL:"has_punch_nodes_signal",FORWARD_REJECT_CNT:"forward_reject_cnt",FRAME_BUFFER_DELAY:"frame_buffer_delay",STREAM_BUFFERED:"stream_buffered",RANGE_SIP_SUC_CNT:"range_sip_suc_cnt",RANGE_SIP_DIF_CNT:"range_sip_dif_cnt",RANGE_REQ_CNT:"range_req_cnt",RANGE_RSP_CNT:"range_rsp_cnt",RANGE_CONNECT_TIME:"range_connect_time",RANGE_RSP_TIME:"range_rsp_time",VISIBILITY_HIDDEN_TIME:"visibility_hidden_time",VIDEO_PERFPAUSE_CONTINUE_CNT:"video_perfpause_continue_cnt",VIDEO_PERFPAUSE_CNT:"video_perfpause_cnt",FULL_CDN_CNT:"full_cdn_cnt",SUB_CDN_CNT:"sub_cdn_cnt",PATCH_CDN_CNT:"patch_cdn_cnt",MOSAIC_DURATION:"mosaic_duration",MOSAIC_COUNT:"mosaic_count",MUTE_DURATION:"mute_duration",MUTE_COUNT:"mute_count",USED_XP2P:"used_xp2p"},VIDEO_LINK:{PVSSC:"pvssc",PVFSC:"pvfsc",PVLSC:"pvlsc",PVLFC:"pvlfc",PVPFC:"pvpfc",PVPTC:"pvptc",PVPAFC:"pvpafc",PVRFC:"pvrfc"},UPDOWN_INFO:{name:"updown_info",UPLINK_BW:"uplink_bw",DOWNLINK_BW:"downlink_bw",UPLINK_CNT:"uplink_cnt",UPLINK_LIMIT_CNT:"uplink_limit_cnt"},SIGNAL_HEART20:{name:"yspwl.web.live.signal.heart20",STREAM_NAME:"stream_name",STREAM_DELAY:"stream_delay",FULL_FRAME_NUM:"full_frame_num",LOST_FRAME_NUM:"lost_frame_num",P2P_FLOW_DANMU:"p2p_flow_danmu",P2P_FLOW_EMPTY:"p2p_flow_empty",RESEND_TOTAL_CNT:"resend_total_cnt",RESEND_TIMEOUT_CNT:"resend_timeout_cnt",RESEND_ERROR_CNT:"resend_error_cnt",MIN_DELAY:"min_delay",MAX_DELAY:"max_delay",AVE_DELAY:"ave_delay",SER_2_REC_DELAY:"ser_2_rec_delay",REC_2_MERGE_DELAY:"rec_2_merge_delay",MERGE_2_NOTIFY_DELAY:"merge_2_notify_delay",CDN_FLOW_DANMU_VALID:"cdn_flow_danmu_valid",CDN_FLOW_DANMU_TOTAL:"cdn_flow_danmu_total",CDN_FLOW_EMPTY_VALID:"cdn_flow_empty_valid",CDN_FLOW_EMPTY_TOTAL:"cdn_flow_empty_total"},HLS_INFO:{name:"hls_info",M3U8_CNT:"m3u8_cnt",M3U8_SUC_CNT:"m3u8_suc_cnt",M3U8_FAIL_CNT:"m3u8_fail_cnt",M3U8_EMPTY_CNT:"m3u8_empty_cnt",M3U8_WRONG_CNT:"m3u8_wrong_cnt",M3U8_TIMEOUT_CNT:"m3u8_timeout_cnt",TS_CNT:"ts_cnt",TS_SUC_CNT:"ts_suc_cnt",TS_FAIL_CNT:"ts_fail_cnt",TS_TIMEOUT_CNT:"ts_timeout_cnt",TS_OPEN_AVG:"ts_open_avg",TS_LOADED_AVG:"ts_loaded_avg",TS_SPEED_AVG:"ts_speed_avg",TS_SIZE_AVG:"ts_size_avg"},FRAME_INFO:{name:"frame_info",LATE_SEQS:"late_seqs",LOSS_FRAMES:"loss_frames",PLAY_FRAMES:"play_frames",DTS_JUMPPAUSE_CNT:"dts_jumppause_cnt",SKIP_PAUSE_CNT:"skip_pause_cnt",EMPTY_FRAMES:"empty_frames",FULL_RATIO:"full_ratio"},SUB_INFO:{name:"sub_info",TOTAL_CNT:"total_cnt",SUCC_CNT:"succ_cnt",FAIL_CNT:"fail_cnt",TIMEOUT_CNT:"timeout_cnt",KICK_CNT:"kick_cnt",TRY_CNT:"try_cnt",CMP_TOTAL_CNT:"cmp_total_cnt",CMP_SUCC_CNT:"cmp_succ_cnt",CMP_FAIL_CNT:"cmp_fail_cnt",CMP_TIMEOUT_CNT:"cmp_timeout_cnt",FORCE_CNT:"force_cnt"},PUNCH_INFO:{name:"punch_info",TOTAL_CNT:"total_cnt",VALID_CNT:"valid_cnt",TRY_CNT:"try_cnt",SUCC_CNT:"succ_cnt",BACK_CNT:"back_cnt",BACK_SUCC_CNT:"back_succ_cnt",BACK_TRY_CNT:"back_try_cnt"},PUNCH_BACK_RET:{name:"punch_back_ret"},RESEND_INFO:{name:"resend_info",RESEND_CNT:"resend_cnt",TIMEOUT_CNT:"timeout_cnt",ERROR_CNT:"error_cnt",SLICE_CNT:"slice_cnt",RESPOND_CNT:"respond_cnt",LATE_CNT:"late_cnt",MISS_CNT:"miss_cnt",REPEAT_CNT:"repeat_cnt",REPEAT_SUCC_CNT:"repeat_succ_cnt",REPEAT_FAIL_CNT:"repeat_fail_cnt",LIMIT_CNT:"limit_cnt"},SUBSTREAM_INFO:{name:"substream_info",FIXED_CNT:"fixed_cnt",FORCE_CNT:"force_cnt",COMPETE_CNT:"compete_cnt"},FORCESUB_REASON:{name:"forcesub_reason",NOPEER_CNT:"nopeer_cnt",SUBEND_CNT:"subend_cnt",TIMEOUT_CNT:"timeout_cnt"},SUB_RETURN:{sub_name:"sub_return",switch_name:"switch_return",last_name:"last_return"},NONODE_RETURN:{name:"nonode_return",PRESENTER_CNT:"presenter_cnt",UPLINK_LESS_CNT:"uplink_less_cnt",PULL_SAME_CNT:"pull_same_cnt",SUBED_CNT:"subed_cnt",COOL_CNT:"cool_cnt",DELAY_CNT:"delay_cnt",RTT_CNT:"rtt_cnt",LATE_CNT:"late_cnt",FAST_CNT:"fast_cnt",NONE_CNT:"none_cnt"},AUTO_INFO:{name:"auto_info",UP_CNT:"up_cnt",DOWN_CNT:"down_cnt",BACK_CNT:"back_cnt"},P2P_TCP_TYPE:{name:"p2p_tcp_type"},P2P_TCP_STATE:{name:"p2p_tcp_state"},PCDN_BW_DATA:{name:"pcdn_bw_data"},AI_CONTROL_DATA:{name:"ai_control_data",AI_P2P_CNT:"ai_p2p_cnt",AI_FLV_CNT:"ai_flv_cnt",AI_P2P_TIMEOUT_CNT:"ai_p2p_timeout_cnt",AI_FLV_TIMEOUT_CNT:"ai_flv_timeout_cnt",AI_P2P_ERROR_CNT:"ai_p2p_error_cnt",AI_FLV_ERROR_CNT:"ai_flv_error_cnt",AI_P2P_SWITCH_CNT:"ai_p2p_switch_cnt",AI_FLV_SWITCH_CNT:"ai_flv_switch_cnt",AI_P2P_NOT_SWITCH_CNT:"ai_p2p_not_switch_cnt",AI_FLV_NOT_SWITCH_CNT:"ai_flv_not_switch_cnt",AI_FLV_ERROR_SWITCH_CNT:"ai_flv_error_switch_cnt",AI_FLV_ERROR_NOT_SWITCH_CNT:"ai_flv_error_not_switch_cnt：flv",AI_START_P2P_CNT:"ai_start_p2p_cnt",AI_START_FLV_CNT:"ai_start_flv_cnt"},ACT:{name:"yspwl.web.live.user.act",field:"act_type",SWITCH_BITRATE:"switch_bitrate",SWITCH_AUTO:"switch_auto",SWITCH_LINE:"switch_line",SWITCH_PTS:"switch_pts",FAST_SAMPLE:"fast_sample",NO_PICTURE:"no_picture",NO_PICTURE_ALL:"no_picture_all",NO_PICTURE_P2P:"no_picture_p2p",LINK_STA:"link_sta",HLS_PLAY_SUCC:"hls_play_succ",HLS_LOAD_SUCC:"hls_load_succ",P2P_PLAY_FAIL:"p2p_play_fail",P2P_LOAD_VIDEO:"p2p_load_video",P2P_RESTART:"p2p_restart",TCP_NO_SLICE:"tcp_no_slice",TCP_OPEN_TIME:"tcp_open_time",HTTP_CODE_:"http_code_",HTTP_CLOSE:"http_close",TCP_TIMEOUT:"tcp_timeout",P2P_COOLING:"p2p_cooling",CONNECT_VIDEO_TS:"connect_video_ts",RECV_VIDEO_TS:"recv_video_ts",FIRST_VIDEO_PKG_TS:"first_video_pkg_ts",FIRST_VIDEO_IFRAME_TS:"first_video_iframe_ts",VIDEO_IFRAME_TS:"video_iframe_ts",FIRST_VIDEO_RENDER_TS:"first_video_render_ts",VIDEO_PLAYED_TS:"video_played_ts",VIDEO_LOAD_TS:"video_load_ts",VIDEO_LOAD_SEG:"video_load_seg",VIDEO_LOAD_TS_ALL:"video_load_ts_all",VIDEO_LOAD_TS_V2:"video_load_ts_v2",AUTO_TEST_RESULT:"auto_test_result",VIDEO_GET_VP_TS:"video_get_vp_ts",VIDEO_LOGIN_TS:"video_login_ts",LOAD_M3U8_TS:"load_m3u8_ts",FIRST_FRAG_LOAD_TS:"first_frag_load_ts",FIRST_FRAG_LOADED_TS:"first_frag_loaded_ts",FIRST_FRAG_SIZE:"first_frag_size",SIGNAL_TURN_BACK:"signal_turn_back",SWITCH_COST:"switch_cost",OB_BG_DURATION:"ob_bg_duration",LOAD_P2PLIB_ERROR:"load_p2plib_error",LOAD_PCDNLIB_ERROR:"load_pcdnlib_error",PCDN_TO_CDN:"pcdn_to_cdn",MUTE_STATUS:"mute_status",NO_PICTURE2:"no_picture2",H265_WORKER_LOAD_TS:"h265_worker_load_ts",H265_STATUS:"h265_status",MOSAIC_STATUS:"mosaic_status",AI_P2P_FLV_SWITCH:"ai_p2p_flv_switch",BLOCK_BAD:"block_bad",SWITCH_AUDIO_RES:"switch_audio_res"},VOD_ACT:{name:"yspwl.web.vod.user.act"},VOD_CORE:{name:"yspwl.web.vod.user.heart20",AV1_SVR:"av1_svr",AV1_SPT:"av1_spt",AV1_USE:"av1_use",VOD_BAD_QUALITY:"vod_bad_quality",VOD_BAD_REASON:"vod_bad_reason",VOD_NO_PICTURE:"vod_no_picture",VOD_NO_PICTURE_REASON:"vod_no_picture_reason",VOD_DTS_JUMP:"vod_dts_jump",VOD_BLOCK_COUNT:"vod_block_count",VOD_BLOCK_DURATION:"vod_block_duration",M3U8_FILE_BW:"m3u8_file_bw",TS_PLAY_TIME:"ts_play_time",TS_SIZE:"ts_size",VOD_PCDN_STATE:"vod_pcdn_state",VIDEO_H265_BAD_QUALITY:"video_h265_bad_quality"},VOD_DIM_CORE:{TS_START_TIME:"ts_start_time",TS_END_TIME:"ts_end_time",ENHANCE_TOTAL:"enhance_total",ENHACNE_LESS_30:"enhance_less_30",ENHACNE_LESS_150:"enhance_less_150",ENHACNE_LESS_200:"enhance_less_200",ENHACNE_LARGE_200:"enhance_large_200"},VOD_DIM_COM:{VOD_VIDEOSOURCEID:"vod_videosourceid",VOD_CODERATE:"vod_coderate",VODANCHORID:"vodanchorid",STREAMTYPE:"streamtype",RESOURCE_TYPE:"resource_type",HAS_302:"has_302",VOD_FIRST_TS:"vod_first_ts",SGUID:"sguid",M3U8_FILE_BW:"m3u8_file_bw",VOD_AB_SWITCH:"vod_ab_switch",CREATE_TIME:"create_time",VOD_PLACE:"vod_place",VOD_MP4_SIZE:"vod_mp4_size",VOD_DURATION:"vod_duration",VOD_NO_PICTURE_REASON:"vod_no_picture_reason",LINE:"line",BACKUP_FIELD1:"backup_field1",BACKUP_FIELD2:"backup_field2",BACKUP_FIELD3:"backup_field3",BACKUP_FIELD4:"backup_field4",BACKUP_FIELD5:"backup_field5",BACKUP_FIELD6:"backup_field6",RENDER_INFO:"render_info",HARDWARE_CONCURRENCY:"hardware_concurrency",MSE_PLAYER:"mse_player",DECODE_HARDWARE_ACCELERATION:"decode_hard_acc",HARDDECODE:"harddecode",DECODE_SUPPORT:"deocode_support",DECODE_CAPABILITY:"decode_capability",WEBCODECS_BACK_REASON:"webcodecs_back_reason",I_GPU:"i_gpu",FEATURE_STATUS:"features_status",V_ENHANCE_TYPE:"v_enhance_type",V_ENHANCE_ENTRY:"v_enhance_entry",ENHANCE_BACK_REASON:"enhance_back_reason",FRAMERATE:"framerate",GAMEID:"gameid",PULLSTREAM_REASOM:"pullstream_reason",IS_MEMORY_GEAR:"is_memory_gear"},VOD_EXT_COM:{VID:"vid",CLIENT:"client",PID:"pid",BITRATE:"bitrate",DEFINITION:"definition",SCENE:"scene"},ROOM_HEART60:{name:"yspwl.sdk.liveroom.user.heart",DURATION:"duration",SESSION_ID:"session_id",ANCHORUID:"anchoruid",LINE:"line",CODERATE:"coderate",H265:"h265",P2P:"p2p",BLIVE:"blive",BUSI_PLAY:"busi_play",BUSI_STOP:"busi_stop",RNR_CNT:"rnr_cnt",RNR_DUR:"rnr_dur",RNR_DUR_MAX:"rnr_dur_max",SNR_INFOS:"snr_infos"}}},function(t,e,i){"use strict";var s=i(6),r=i(0),a=2,o=i(7),n=i(8);let h=new class{constructor(){this.pushGop=!1,this.jitBufLen=3e3,this.jitMaxBufLen=4e3,this.jitMinBufLen=2e3,this.resendPlayThreshold=1500,this.mutilLinkConfig=[[0,4e3],[8,4]],this.resendModeConfig=[[0,2e3],[1,2]],this.resendMode=1,this.resendWaitLimitList={500:2500,2e3:2500,4e3:2500,8e3:2500,1e4:2500,12e3:2500,2e4:2500},this.sliceListLengthMaxList={500:1e3,2e3:25e3,8e3:1e4,1e4:12500,2e4:25e3},this.noUrgentResentBuffer=2e3,this.latency=[[3e3,2e3,4e3,2e3],[1e3,500,1500,1e3]],this.jitTest=[2e3,5e3,1500],this.jitPid=[],this.hlsJitCfg=[6e3,4e3,8e3],this.hlsUseFetch=100,this.obsUseFull=0,this.obsFullRatio=1,this.obsBgRatio=0,this.obsFaceRatio=0,this.obsSrAudio=1,this.obsFrame=0,this.obsSyncTs=50,this.obsSeekTs=200,this.obsSeekJumpTs=0,this.obsRateTs=10,this.p2pQuicktime=5e3,this.baseSubs=10,this.urgentResend=1,this.urgentResendAudio=1,this.crossPunchPloy=1,this.crossClientPer="all|all:100",this.crossClientUpBwMod=1,this.syncMob=1,this.noSignalNode=1,this.crossCdn=1,this.crossLineSub="all",this.punchWan="",this.p2pWssLines="all",this.connectTotalTime=6e3,this.connectTimeout=2e3,this.connectPcdnTimeout=4e3,this.flowTimeout=2e3,this.flowRetryTimes=3,this.renderTimeout=3e3,this.noDataTimeout=4e3,this.noSliceTimeout=1e4,this.noPcdnDataTimeout=2e3,this.testResender=0,this.maxResendTimes=3,this.resendDelayTs=400,this.patchSubTs=500,this.http2Channel="",this.rangeNums=256,this.deleteH264Aud=[],this.useChangeRate=[],this.audioEmptyDur=100,this.p2pMediaLogCfg="all|all:0",this.p2pSignalLogCfg="all|all:0",this.p2pPunchMode=2,this.freeBufferBitrate=15e3,this.needCooling=1,this.needQueue=0,this.queueTime=500,this.punchedCoolingTime=1e4,this.delayCloseNum=200,this.punchTimeout=7e3,this.maxPunchedCnt=50,this.maxPunchedCntMore=60,this.maxNodeCnt=50,this.maxPunchedCntSdk=10,this.punchBackCooling=2e4,this.punchIgnoreTime=3e4,this.coefficient=8,this.trySubNum=5,this.trySubTime=7e3,this.fastTime=5e3,this.lostSeqTime=6,this.sliceLate=1e3,this.sliceFast=1500,this.sliceConstraints=6e3,this.sliceConstraintBad=8e3,this.pubSelectorConstraint=0,this.badDelay=1e3,this.emuteDelay=2200,this.switchDelay=500,this.aliveTimeout=1e3,this.resubTime=3e4,this.sliceTimeout=1e3,this.maxPeerStreamNum=7,this.maxPeerStreamNum20M=4,this.maxUplinkBw=6e3,this.closeUids=[],this.closeSub=0,this.closeSubRooms=[],this.closeAllUids=[],this.p2pMediaCfg="all|all:100",this.p2pSignalCfg="all|all:100",this.ignoreUids=[1259515661837,1354740567,2368274334,1706479145,2367547387,1099531787526,1827824615,1531433300,1680925919,2227875499,2272316519,367138632,1677942333,157525e4,1610145122,1199534013894,813535483,1259553301717,570184355,679257140,1067459140,2222971974,1279514601966,1199577571975,294636272,518969542,745373351,1199515480194,1199568157971,1199517808234,1430972471,1356299405,1724691,10748220,1199525977184,2176998321,1099531752788,1487476672,1199536349047,1259525634703,17363578,1191588902,1629021815,124902116,1705516953,1199536199401,1120785052,1852594244,2285403183,1199526826004,2250967121,2208606321],this.flvEmptyAudioFrame=1,this.sendHeartBeatAlone=0,this.signalNoCdnp=[],this.switchSeamLessLine=0,this.isProduce=!0,this.coderates=[[15e3,0,8e3,5,5,230,1,20],[8e3,0,4e3,5,5,230,5,10],[6e3,0,4e3,5,5,170,5,10],[4e3,0,4e3,5,5,120,5,10],[3e3,0,4e3,5,5,80,5,10],[0,0,4e3,5,5,50,5,10]],this.seaSubNums=[],this.swapdomain={},this.iP2PType=2,this.danmuZipPids=[],this.randomPercent=1e4,this.frameBufLen=[2500,1500,1500,3500],this.bufferMode=2,this.bufferConfig=[],this.urgentResendTime=1500,this.forceSkipFrameTime=3900,this.frameTimeout=3e3,this.p2pBuffer=[3500,2500,4500],this.p2pOpenBrowsers=["opera"],this.jitCfg=[[15e3,4e3,3e3,5e3],[0,3e3,2e3,4e3]],this.jitCfgPid=[],this.jitJump=[2e4,8e3],this.jitLowLatency=2e3,this.jitLow=[1500,1e3,2e3],this.safariPlayDelay=500,this.safariFirstLoad=!0,this.jitAB=[],this.waitAudio=1,this._isFrameBuffer=-1,this.isSubUseHttps=1,this.usePcdn=1,this.pcdnSubsConfig=[1,1,1],this.vipUsers=[1199640152004,1199629649413,1199637548568,2221926148,50014085,1279513106277,1504206970,961143155,1279546440890,1199626834332,50016090,1319533242210,1199633418849,1199628818935,1199522152648],this.autoViewUsers=[1259515288802,1199577719291],this.notUsePcdnUids=[],this.notUsePcdnUsers=[],this.notUseFlvPcdnUsers=[],this.notUseFlvPcdnPids=[],this.notUseP2PPcdnUsers=[],this.notUseP2PPcdnPids=[],this.isPcdnReportErr=0,this.pcdnNoDataMod=2,this.pcdnSlowTime=2,this.pcdnSlowCoolTime=6e4,this.pcdnSowCnt=5,this.pcdnSwitchUrls=["xd"],this.pcdnPubIceCfg="all|all:100",this.pcdnPubIceOpen=!1,this.isMute=1,this.muteCfg=[1e4],this.isAutoNoPicture=0,this.playbackrateMin=.95,this.playbackrateMax=1.05,this.pcdnFlv=1,this.pcdnMseFlv=1,this.pcdnFlvSyncMob=1,this.pcdnFlvIgnore=0,this.flvToPcdnBuf=2400,this.flvToCdnBuf=1e3,this.isAiP2PToFlv=1,this.randomAIP2PFlvPercent=Math.floor(1e4*Math.random()),this.aiRandomPercent=5e3,this.aiABRandomPercent=2e3,this.aiUids=[],this.aiBlackUids=[],this.aiBlackLines=[],this.aiBlack2Uids=[],this.isAutoH265=0,this.renderDelta=300,this.autoReportTime=1e3,this.autoReportUsers=[],this.h265Config=[[[2e3,4e3],[4e4,4e4]],[4e3,2e3,1300,1e3,500],75,[[500,1e3,1300,2e3,4e3],[3,3,3,3,4]],30,3,[!0,!0]],this.h265MseConfig=[1,[86],[500,1e3,1300,2e3,4e3],[],[[500,1e3,1300,2e3,4e3],[5,5,5,5,5],[],[]],1],this.h265MseChromeConfig=[107,3e4,4,0,1],this.vodH265Config=[1,0,1],this.wcs265BlackUids=[],this.mse265BlackUids=[1225100385,1199560999561,1199636047603,1647046597,1199627582352,1609064756,1807493940,1624909255,1624909255,2364972864,1259514251347,1782184421,1564616639,1259524774186,1199518148059,1579681436,1866277950820,1488231977,1346502221,124968931,1465100418,1199538749015,1700394847,1199554450502],this.wcsGBlackIds=[],this.hardH265UidList=[],this.h265MseWhiteBlackUids=[[],[]],this.h265BlackUids=[],this.replayH265BlackUids=[],this.whiteH265Uids=[[],1],this.h265NoPushVideoDis=1e4,this.randomH265Percent=Math.floor(1e4*Math.random()),this.h265PercentConfig=1e5,this.enableAiMosaic=1,this.limitMosaicAreas=40,this.aiMosaicUis=[],this.aiRequestInterval=5e3,this.aiBathRequestInterval=3e4,this.aiBufferEmptyRequestInterval=3e5,this.playerdata={profileP2POpt:""},this.isCommonAb=1,this.aiP2PFlvConfig=[5e3,5],this.closePcdnBitrate=8e4,this.closePcdn500=0,this.setVideoCTCfg=[-100,1500,1e4],this.jumpBufferCfg=[30,1e3,1e4,5e3,30,25],this.jumpBufferCfg2=[0,500],this.jumpBufferCfgAids=[],this.jumpBufferVer=80,this.sliceQuantityPerSecond=1,this.useNewPloy=1,this.minPlayout=170,this.maxPlayout=500,this.playoutUids=[],this.isMuteAct=0,this.useAV1=!1,this.useAV1PidList=[],this.useAV1LinesAndBitRates=[[],0],this.isClosePlayBackRate=1,this.pcdnAbConnectData=[0,[1e3,2e3,3e3,4e3]],this.isForceUseWorker=1,this.platform=o.a.PLATFORM_TYPE_NAME.web,this.av1PercentConfig=5e3,this.isConfigSupportH265=1,this.isVodSupportH265=0,this.isVodTurnTo264=1,this.abUseAv1=1,this.platform=o.a.PLATFORM_TYPE_NAME.web,this.h265GameIds=[!0,[]],this.isNoVideoReport=0,this.simdAbPercentConfig=5e3,this.vodAbSwitch=0,this.dropFrameAb=0,this.useNewParser=1,this.maxGop=3e3,this.autoCfg={close:0,closeLines:[],closePids:[],upGap:0,downGap:15e3,backGap:15e3,upPer:.8,downPer:.3,downNowPer:.2,waitPer:.8,downBitrate:2e3,slow:.85,bufCnt:10,sucPer:.9,sampleTime:200,minTime:1e4,maxTime:3e5,sysTime:1e4,evalTime:300,highRate:4e3,badBuf:2e3,badCnt:3,badS:[1e4,3],badL:[6e4,5],noRederTime:12e4,monitorTime:15e3},this.continueBufferDeltaStart=6e3,this.continueBufferDeltaEnd=3e3,this.autoBufferScore=1e3,this.autoConnectScore=500,this.autoFirstScore=500,this.autoPtsScore=500,this.force_auto_count=9999,this.force_auto_effective_time=2592e5,this.autoReportCfg=[1,3,0,1],this.autoReportSea=0,this.isWebAutoAB=0,this.maxBitRate=500,this.recSysExpiredTime=6e4,this.autoDownTimer=0,this.autoDownMaxBitrate=1,this.minFps=24,this.dropTime=0,this.perfBitrate=2e3,this.perfCnt=1,this.perfBuf=2e3,this.p2p302Config=[[[6,1,0,1]],1],this.sdkCloseAutoAi=0,this.closeP2PPids=[],this.closeP2PConfig=[1,1],this.enableAutoCloseP2P=1,this.isCloseVodPcdn=0,this.is265VideoLoadTs=1,this.isSendPlaybackLoadTime=0,this.vodPcdnOpenBuffer=1e4,this.vodPcdnCloseBuffer=7e3,this.vodPcdnCoolTime=6e4,this.vodPcdnBufferCfg=[[1e4,7e3,6e4],[],[]],this.perfBlockCfg=[2e3,3e3,6e3],this.vodPcdnStatCfg=[0],this.vodAv1Cfg="all|all:100",this.vodAv1Cd=6e4,this.vodAv1CdCnt=5,this.vodAv1CloseCfg=[[[4e3,8],[1300,2]],[4e3,4]],this.vodAv1UseFirst=1,this.vodUseBackupField=[1,1,1,1,1,1,0],this.vodDtsFixCfg=[0,0],this.vodRetryTime=5e3,this.vodBs2Delay=3e3,this.blockBadCfg=[800,1],this.perfWin7kaCfg=[2e3,3],this.openWebcodec=1,this.vodOpenWebcodecs=0,this.av1Webcodecs=0,this.webCodecBlackUids=[],this.webCodecsAnchoruids=[],this.vodWebcodecsGameIds=[],this.replayWebcodecsGameIds=[1],this.vodWebcodecsVids=[],this.vodWcsBroCfg=[0],this.wcsBlackAids=[],this.webCodecCfg=[4,8e3,2e3,1,1500,[2e3,1e4,2e4]],this.webCodecAVDeltaCfg=[5e3,2e3],this.noNextWcsTimeUids=[],this.useNextWcsTime=1,this.hardHevcConfig=[0,0,0],this.repairSameDtsCfg="",this.repairSameDts=0,this.useNewCdnp=1,this.shieldAudioCfg=[1,3e3,6e3,15e3,15e3,3e3],this.useCdnpFixed="all|all:100",this.signalClose="",this.signalExperiment=0,this.signalRangeGap="all|all:1000",this.signalSubGap="all|all:1000",this.signalBaseIndexExp=0,this.signalBaseIndexExpCfg="",this.signalBaseIndexMode=3,this.signalBaseIndexCfg="all|all:3",this.fakeHdrBlackPids=[],this.fakeHdrBitrateMap=[{4100:17200,4200:17100,20100:19200,4300:17300,14100:14200}],this.fakeHdrBlackPids=[],this.fakeHdrCfg=[{auid:[],bitrateMap:{4100:17200,4200:17100,20100:19200,4300:17300,14100:14200}}],this.fpsBitrateCfg=[100,[],{4200:17300},120],this.signalSliceCache="all|all:750",this.signalSliceDispatch="all|all:750",this.signalOpenExp="",this.signalOpen=-1,this.statLv=[1,1,0,1,0,2,0,0,1,0,2,1,1,1,1,1,0],this.statCfg="all|all:100",this.mediaRangeGap="all|all:90",this.mediaSubGap="all|all:500",this.mediaBaseIndexExp=0,this.mediaBaseIndexExpCfg="",this.mediaBaseIndexMode=1,this.mediaBaseIndexCfg="all|all:3",this.mediaSliceCache="all|all:750",this.mediaSliceDispatch="all|all:750",this.dropFrameUids=[1],this.dropFrameDts=[1e4,2e4],this.usePullPunch="all|all:100",this.closeLowBufResend="",this.renderStat=[1],this.signalRttPids="all|all:0",this.signalRttUids=[],this.pause500Cfg=[300,[]],this.closePause500=0,this.recvProcesser=-1,this.recvCfg="all|all:100",this.isQQSoft=1,this.isWin7WcsSoft=1,this.isLimitNaluType=1,this.isCloseMseDrop=0,this.isAutoWcsReport=1,this.avHeaderChangeCfg=[[],0,300,1e4],this.avHeaderChangeStatCfg=[[],3e3,1],this.enableHvcc=1,this.videoMaxGap=2e4,this.iaasCfg=[1,1,3,.3,4e3,600,200,5e3,5,.4],this.iaasCfgWhiteAuids=[0,[]],this.iaasCfgBlackAuids=[],this.iaasCloseGather=1,this.p2pSubSdkV2=0,this.p2pSubSdkCfg="all|all:0",this.h265BlackBrows=[],this.wcsSoftBrows=[],this.wcsBlackBrowVers=[],this.p2pBlackBrowVers=[],this.pcdnBlackBrowVers=[],this.pcdnFlvBlackBrowVers=[],this.pcdnFlvBlackBrowVerMax=49,this.wasm265BlackBrowVers=[],this.mse265BlackBrowVers=[],this.wcs265BlackBrowVers=[],this.wcs264BlackBrowVers=[],this.bitrateBrowHard265Cfg=[0,4e3,[]],this.wcsSoft264Uids=[],this.popSize0Brows=[],this.payRoomCfg=[0,5],this.mobVBlockCfg=1,this.wasmCloseCfg=[0,[]],this.wcs265BlackBrowNames=[],this.enhanceVCfg=[1,4e3,6,1080],this.enhanceGameIds=[1,2336,5699,1663,2168,2633,7185,5485,7,6203,393,9521,2793,3203,5937,862,4,2413,100032,1964,1997,6219,7579,2,4921,9961,802,7601,1732],this.enhanceGameIdRatioMap={2793:[720,1080],3203:[720,1080],5937:[720,1080],862:[720,1080],4:[720,1080],2413:[720,1080],100032:[720,1080],1964:[720,1080],1997:[720,1080],6219:[720,1080],7579:[720,1080],2:[720,1080],4921:[720,1080],9961:[720,1080],802:[720,1080],7601:[720,1080],1732:[720,1080]},this.eHBlackUids=[],this.eHBlackAnchoruids=[],this.eHBlackBrowVers=[],this.eHBlackBrowVerList=[],this.eHBlackRenderList=[],this.ehWhiteAnchoruids=[0,[]],this.enhanceSupportMode=1,this.enhanceVodVCfg=[0,4e3,6,1080],this.enhanceVodGameIds=[1,2336],this.eHVodBlackUids=[],this.eHVodBlackAnchoruids=[],this.eHVodBlackVids=[],this.eHVodBlackBrowVers=[],this.eHVodBlackRenderList=[],this.ehVodWhiteAnchoruids=[0,[]],this.ehVodWhiteVids=[0,[]],this.vodEnhanceChannelMap=[{vhuyalol:1},{9521:9521},{vhuyawzry:2336}],this.popDuration=200,this.decodeDelay=100,this.p2pRangePeerMode=1,this.rtPeerMax=1,this.rtPeerPer=0,this.rtPeerCfg=[[0,3,0]],this.rtPeerTimeout=300,this.rtPeerPRN=1,this.rtPeerSelectorCfg="all|all:100",this.rtPeerSelector=!1,this.resendUrgentCfg=[[1,[[0,700]]]],this.resendUrgentMse=[[1,[[0,700]]]],this.resendUrgentWcs=[[1,[[0,400]]]],this.rtPeerAsk=0,this.rtPeerSrc=1,this.rtPeerTopN=5,this.rtPeerUrgent=1,this.rtPeerUrgentOpt=0,this.rtPeerRTONum=2,this.rtPeerBeforeHand=0,this.rtPeerRandom=1,this.rtPeerUgMin=300,this.fastTimeCfg="all|all:0",this.urgentBuffer=201,this.resendAudioCfg="all|all:500",this.resendAudioBufCfg="all|all:1500",this.useFastTime=!1,this.logMaxLen=4e3,this.hisLogMaxLen=2e3,this.isHisLog=1,this.pcdnProTimoutTs=3e3,this.heartMode="all|all:1",this.heartQpsPids="all|all:100",this.heartQps="all|all:3",this.pcdn302FlvCfg=[1,15],this.pcdn302FlvBakCfg=[1,1],this.pcdn302BlackAids=[],this.flvPcdn302Ab=10001,this.enableBroMseCfg=[117],this.audioDtsOpen=!1,this.audioDtsCfg="all|all:100",this.dtsJumpOpen=!1,this.dtsJumpCfg="all|all:100",this.dtsJumpThreshold=2e4,this.enableEdgeBroMseCfg=[117],this.audioDropTime=1e4,this.audioDropOpen=!1,this.audioDropCfg="all|all:100",this.isAudioEmptyLimit=1,this.isFilterMsePause=1,this.isMseCheckRcRd=1,this.testRenderCfg=[5,2e4,500,[120]],this.testRenderSwitchCfg=[1,1],this.noRenderMetricTime=6e4,this.noRenderValidTime=1e3,this.noRenderDur=500,this.forbidWapShare=1,this.closePcdnOrigins=[],this.isPause5SecRetry=1,this.isFlvUrlRetry=1,this.wapPcdnWhiteAids=[],this.wapP2pWhiteAids=[],this.isWapSupportPcdnP2p=0,this.isCloseXiaomiPcdnP2p=1,this.mosaicGlassHardCfg=[0,["nvidia","amd"],6],this.mp4ErrorReportRandom=100,this.mosaicGlassUseFps=1,this.mosaicGrassExpired=1,this.grassModeAllowFPS=45,this.voiceTimer=50,this.wupFailCnt=20,this.wupFailPer=90,this.hlsLiveMaxFragNum=10,this.h5FirstPlay=0,this.h5WaitTime=1e4,this.mpsCfg="all|all:0",this.mpsWhiteUids=[],this.mpsBlackUids=[1279546440890,1199629649413,1199626834332],this.mpsSub=-1,this.mpsSubCfg="all|all:0",this.mpsUseCfg=[0,1,1],this.mpsSubBlackUids=[],this.mpsSubWhiteUids=[],this.mpsLibName="Mps.js",this.mpsFailMax=1e5,this.mpsFailTime=5,this.mpsPolicy=1,this.mpsMergeReq=0,this.mpsSrcStartMode=1,this.mpsSrcWaitStopTime=2e4,this.mpsBufferMode=0,this.mpsBufferBlock=8,this.mpsBufferBlockSenders=2,this.mpsBufferBlockPer=50,this.mpsBufferBlockDelTime=3e4,this.mpsCloseV6=1,this.useSvrNat=100,this.pcdnUseSvrReqGap=1,this.pcdnReqGap=15e3,this.pcdnResCfg="all:https_4|wss_4,xd|huya:webrtc_8",this.autoReportNoAnwser=0,this.useMuteBiAudio=!0,this.closePunchUsers=[],this.mmsOpen=!0}isClosePunch(t){return this._isContainsUser(this.closePunchUsers,t)||this._isContainsUser(this.vipUsers,t)}isAutoReport(t){return this._isContainsUser(this.autoReportUsers,t)||this._isContainsUser(this.vipUsers,t)||this._isContainsUser(this.autoViewUsers,t)}isSignalRttOpen(t){return this._isContainsUser(this.signalRttUids,t)||this._isContainsUser(this.vipUsers,t)||this._isContainsUser(this.autoViewUsers,t)}initRTPeerCfg(t){let e=this.rtPeerCfg;for(let i=0;i<e.length;i++)if(t>=e[i][0]){this.rtPeerMax=e[i][1],this.rtPeerPer=e[i][2],r.a.log(`Config.initRTPeerCfg bitrate=${t} rtPeerMax=${this.rtPeerMax} rtPeerPer=${this.rtPeerPer}`);break}}getAvHeaderChangeStat(t){let e=this.avHeaderChangeStatCfg[0],i=!1;for(let s=0;s<e.length;s++)e[s]==t&&(i=!0);return 1==this.avHeaderChangeStatCfg[2]&&(i=!0),i}initOpen(t,e,i,r){-1===this[r]&&(s.b.isOpen(this[i],t,e,!1)?this[r]=1:this[r]=0)}get isFrameBuffer(){return a}initByBitrate(t){if(this.initRTPeerCfg(t),this.maxPeerStreamNum=t>=1e4?this.maxPeerStreamNum20M:7,this.resendMode=1,this.resendModeConfig&&this.resendModeConfig[0].length===this.resendModeConfig[1].length){for(let e=this.resendModeConfig[0].length-1;e>=0;e--)if(t>=this.resendModeConfig[0][e]){this.resendMode=this.resendModeConfig[1][e];break}}}isAutoClose(t,e){if(1===this.autoCfg.close||-1!==this.autoCfg.closeLines.indexOf(Number(t)))return!0;let i=this.autoCfg.closePids.length;for(let s=0;s<i;s++){let i=this.autoCfg.closePids[s];if(Number(i.pid)===Number(e))return!i.hasOwnProperty("lines")||-1!==i.lines.indexOf(t)}return!1}initRepaireSameDtsCfg(t){"all"===this.repairSameDtsCfg||-1!==this.repairSameDtsCfg.indexOf(t)?this.repairSameDts=1:this.repairSameDts=0,r.a.log("Config.initRepaireSameDtsCfg="+this.repairSameDts)}setLowLatency(t){t&&t.setJitter(this.jitLow[0],this.jitLow[1],this.jitLow[2])}setJitterCfg(t,e,i){this.setJitterAB(t,e,i)||this.setJitterByPid(t,e,i)||this.setJitterByRate(t,i,this.jitCfg)}setJitterAB(t,e,i){if(this.jitAB.length>0){let s=this.jitAB[0],a=this.jitAB[1],o=this.jitAB[2];if("all"===s||-1!==s.indexOf(e+"")){let e=this.getGroupNum(o.length);return r.a.log(`setJitterAB name=${a} group=${e}`),this.setJitterByRate(t,i,o[e]),!0}}return!1}getGroupNum(t){let e=1e4*Math.random();for(let i=t-1;i<t;i--)if(e>1e4/t*i)return i;return 0}setJitterByPid(t,e,i){for(let s=0;s<this.jitCfgPid.length;s++){let a=this.jitCfgPid[s];if(-1!==a[0].indexOf(e+""))return r.a.log("setJitterByPid"),this.setJitterByRate(t,i,a[1]),!0}return!1}setJitterByRate(t,e,i){for(let s=0;s<i.length;s++){let r=i[s];if(e>=r[0])return t&&t.setJitter(r[1],r[2],r[3]),!0}return!1}init(t){if(!t)return;Object.assign(this,t);let e=["p2pWssLines","http2Channel","crossLineSub","punchWan","repairSameDtsCfg","signalClose","signalRangeGap","signalSubGap","signalBaseIndexCfg","signalBaseIndexExpCfg","useCdnpFixed","signalSliceCache","signalSliceDispatch","mediaRangeGap","mediaSubGap","mediaBaseIndexCfg","mediaBaseIndexExpCfg","mediaSliceCache","mediaSliceDispatch","usePullPunch","closeLowBufResend","statCfg","signalOpenExp","recvCfg","vodAv1Cfg","platform","crossClientPer","p2pSubSdkCfg","p2pMediaCfg","p2pSignalCfg","fastTimeCfg","rtPeerTimeCfg","rtPeerSelectorCfg","heartMode","heartQpsPids","heartQps","audioDtsCfg","dtsJumpCfg","resendAudioCfg","resendAudioBufCfg","pcdnPubIceCfg","p2pMediaLogCfg","p2pSignalLogCfg","signalRttPids","mpsCfg","mpsSubCfg","mpsLibName","pcdnResCfg"];r.a.group("Configs");let i=["Configs:"];for(let t in this){let r=this[t];"string"==typeof r&&("pushGop"==t?r=!!Number(r):"coderates"==t||"testCoderates"==t||"swapdomain"==t?(r=r.replace(/[↵\s+\n]/gm,""),r=JSON.parse(r)):-1===e.indexOf(t)&&(r=Number(r))),this[t]=r,"object"==typeof r&&(r=JSON.stringify(r)),t=s.b.padStrLen(t,18,!1),i.push("\t"+t+" => "+r)}r.a.log(i.join("\n")),r.a.groupEnd(),r.a.log("Config",this)}setAiP2PToFlv(t){this.isAiP2PToFlv=t}setUseAV1(t){let e=this.useAV1PidList,i=t.presenterUid,s=!1,r=this.useAV1LinesAndBitRates[0],a=this.useAV1LinesAndBitRates[1];e.forEach(t=>{i&&t.toString()==i.toString()&&(s=!0)}),s&&(r.forEach(e=>{e==t.lineType&&(s=!1)}),t.curBitrate<Number(a)&&(s=!1)),this.useAV1=s,s&&(this.autoCfg.close=1)}isCloseP2P(t){return t&&this.closeUids&&-1!==this.closeUids.indexOf(t)}isClosePidMediaP2P(t,e){return!s.b.isOpen(this.p2pMediaCfg,t,e,!1)}isClosePidSignalP2P(t,e){return!s.b.isOpen(this.p2pSignalCfg,t,e,!1)}isCloseP2PBroVer(){const t=n.a.version.major;return t&&this.p2pBlackBrowVers&&-1!==this.p2pBlackBrowVers.indexOf(t)}isClosePcdnBroVer(){const t=n.a.version.major;return t&&this.pcdnBlackBrowVers&&-1!==this.pcdnBlackBrowVers.indexOf(t)}isCloseP2PAid(t){return this.platform===o.a.PLATFORM_TYPE_NAME.wap&&(0==this.isWapSupportPcdnP2p&&-1==this.wapP2pWhiteAids.indexOf(t))}getEnableAiMosaic(t){return!!this.enableAiMosaic}setMute(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.isMute=t}setUseAuto(t){t&&(this.isConfigSupportH265=0)}getEnableJumpBuffer(){let t=n.a.version.major>=this.jumpBufferVer;return n.a.chrome&&t||"firefox"===n.a.name}isCloseAllFuncs(t){return-1!==this.ignoreUids.indexOf(Number(t))||this.closeAllUids&&-1!==this.closeAllUids.indexOf(Number(t))}isCloseMps(t){return this._isContainsUser(this.vipUsers,t)||this._isContainsUser(this.mpsBlackUids,t)||this._isContainsUser(this.ignoreUids,t)||this._isContainsUser(this.autoViewUsers,t)}isCloseFlvPcdnUser(t){return this._isContainsUser(this.notUseFlvPcdnUsers,t)||this._isContainsUser(this.vipUsers,t)||this._isContainsUser(this.autoViewUsers,t)}isCloseFlvPcdnPid(t){return this._isClosePid(this.notUseFlvPcdnPids,t)}isCloseFlvPcdnBroVer(){const t=n.a.version.major;return t<=this.pcdnFlvBlackBrowVerMax||-1!==this.pcdnFlvBlackBrowVers.indexOf(t)}isCloseP2PPcdnUser(t){return this._isContainsUser(this.notUseP2PPcdnUsers,t)||this._isContainsUser(this.vipUsers,t)||this._isContainsUser(this.autoViewUsers,t)}isCloseP2PPcdnPid(t){return this._isClosePid(this.notUseP2PPcdnPids,t)}_isContainsUser(t,e){return t&&-1!==t.indexOf(Number(e))}_isClosePid(t,e){return!!t&&("all"===t[0]||-1!==t.indexOf(Number(e)))}isNotUsePcdn(t,e){let i=!1;return this.notUsePcdnUids.forEach(e=>{Number(e)===Number(t)&&(i=!0)}),this._isContainsUser(this.notUsePcdnUsers,e)&&(i=!0),this._isContainsUser(this.vipUsers,e)&&(i=!0),this._isContainsUser(this.autoViewUsers,e)&&(i=!0),i}setVodPcdnConfig(t){let{vid:e,anchoruid:i,useVodPcdnAbCfg:s=!1}=t;if(!e&&!i)return;if(s&&this.vodPcdnBufferCfg[0].length>=3)return this.vodPcdnOpenBuffer=this.vodPcdnBufferCfg[0][0],this.vodPcdnCloseBuffer=this.vodPcdnBufferCfg[0][1],void(this.vodPcdnCoolTime=this.vodPcdnBufferCfg[0][2]);const r=(t,e)=>{t.some(t=>!(t.length<4&&t[3].length<=0)&&(t[3].indexOf(e)>=0?(this.vodPcdnOpenBuffer=t[0],this.vodPcdnCloseBuffer=t[1],this.vodPcdnCoolTime=t[2],!0):void 0))};this.vodPcdnBufferCfg[1].length>0&&4===this.vodPcdnBufferCfg[1][0].length&&r(this.vodPcdnBufferCfg[1],Number(i)),this.vodPcdnBufferCfg[2].length>0&&4===this.vodPcdnBufferCfg[2][0].length&&r(this.vodPcdnBufferCfg[2],String(e))}enableWebCodec(){this.openWebcodec=1}enableVodWebCodecs(){this.vodOpenWebcodecs=1}getFakeHdrBitrate(t,e,i){let s=e;if(-1===this.fakeHdrBlackPids.indexOf(Number(t))){const t=this.fakeHdrBitrateMap[0][e];s=t||s}const r=this.fpsBitrateCfg[1],a=this.fpsBitrateCfg[3]||120;if(-1!=r.indexOf(t)&&i==a){const t=this.fpsBitrateCfg[2];for(let i in t)t.hasOwnProperty(i)&&i==e&&(s=t[i])}return s}getFpsBitrate(t,e){let i=!1;const s=this.fpsBitrateCfg[1],r=this.fpsBitrateCfg[0];return s.indexOf(Number(t))>=0&&e>=r&&(i=!0),i}setClosePause500(t){let e=this.pause500Cfg[1];e.length>0&&-1!=e.indexOf(Number(t))&&(r.a.log("Config.closePause500Report"),this.closePause500=1)}setEnableIaas(t,e,i){1==this.iaasCfgWhiteAuids[0]&&(this.iaasCfg[0]=0,-1!=this.iaasCfgWhiteAuids[1].indexOf(Number(e.presenterUid))&&(this.iaasCfg[0]=1)),-1!=this.iaasCfgBlackAuids.indexOf(Number(e.presenterUid))&&(this.iaasCfg[0]=0)}setJumpCfg(t){this.jumpBufferCfgAids.length>0&&-1!=this.jumpBufferCfgAids.indexOf(Number(t.presenterUid))&&(this.jumpBufferCfg[1]=this.jumpBufferCfg2[1])}};e.a=h},function(t,e,i){"use strict";var s=i(14);e.a=s.TimeUtilImpl},function(t,e,i){"use strict";function s(t,e){let i=t.toString().length,s=Math.max(0,e-i),r="";if(s>0)for(let t=0;t<s;t++)r+="0";return r+t}i.r(e);let r=new class{constructor(){this.logArr=[]}getNow(){let t=0;return t=null!=typeof performance?performance.now():Date.now(),t}log(){for(var t,e=`[${(t=new Date).getFullYear()}-${s(t.getMonth()+1,2)}-${s(t.getDate(),2)} ${s(t.getHours(),2)}:${s(t.getMinutes(),2)}:${s(t.getSeconds(),2)}.`+s(t.getMilliseconds(),3)+"][w-webcodecs]",i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];r[0]=e+r[0],this.logArr.push(r)}postMessage(t,e){let i={type:t};null!=e&&(i.data=e),self.postMessage(i)}};e.default=r},function(t,e,i){"use strict";i.d(e,"c",(function(){return s})),i.d(e,"b",(function(){return r})),i.d(e,"d",(function(){return a})),i.d(e,"e",(function(){return o})),i.d(e,"a",(function(){return n}));const s={START:1,POSTFRAME:2,RESIZE:3,CLOSE:4,VISIBILITYCHANGE:5,AUDIOSAMPLES:6,VIDEOSAMPLES:7,AVCCONFIG:8,AVCPPS:9,AVCSPS:10,AACCONFIG:11,UPDATE_VIDEOFPS:12,SET_PLAY_MINBUFFER:13,SET_JITTER:14,SET_USE_SOFTACCELERATION:15,LOCAL_CONFIG:16,PAUSE_VIDEO_DECODE:17,PAUSE_AUDIO_DECODE:18,ENABLE_DISCARD_VIDEO:19,SET_AUDIO_WRITER:20,UPDATE_CURBITRATE:21,INIT_CONFIG:22,AVCVPS:23,RECV_FPS:24,FAST_OVER:25,LOG_CFG:26,UPDATE_SOFTACCELERATION:27,SET_ENHANCE:28,SET_SEGMENTTION:29,RECV_FAST_OVER:30,AV1_INIT_SEG:31,SEEK_TIME:32,SET_PLAYBACKRATE:33,SET_VOD_AV1:34},r={WEBGLPLAY:1,STAT:2,PAUSE:3,WORKERSHAREBUFFER:4,RENDERERROR:5,LOG:6,AUDIODECODEDFRAME:7,VIDEODECODEERROR:8,AUDIODECODEERROR:9,INTERVAL:10,WOREKR_READY:11,TURN_TO_WEBCODECS_SOFT:12,AUDIO_PLAY:13,AUDIORENDERERROR:14,SOFT_TURN_TO_MSE:15,AUDIO_FRAME_DECODED:16,DECODE_COST:17,DECODE_DTS:18,WAIT_KEY_FRAME:19,SET_FRAME_PAUSE:20,SET_FRMAE_RESUME:21,RENDER_FPS_PAUSE:22,AUDIO_FORMAT_ERROR:23,VIDEO_ENHANCE_ERROR:24,VIDEO_ENHANCE_SUCCESS:25,ON_WCS_VIDEO_SEEK:26},a={VIDEODECODEERROR:1,AUDIODECODEERROR:2,VIDEORENDEERROR:3,VIDEOFAST:4,AUDIOFAST:5,WORKERERROR:6,AUDIORENDERERROR:7,NOT_SUPPORT_MEDIASRTREAMTRACK:8,DISABLE_HARDWARE_ACCELERATION:9,SOFT_TURN_TO_MSE:10,WIN_PERF_INSUFFICIENT:11,RETRY_MAX_TIMES:12,DECODE_COST:13,DECODE_DTS:14,BROWSER_NOT_SUPPORTED:15,IS_PUREAUDIO:16,ANGLE_NULL:17,DECODE_ERROR_COOL:18,CHROME_H265_RENDER_INFO_EMPTY:19,IS_NOT_SUPPORT_CONFIGURE:20,IS_NOT_SUPPORT_OS:21,AUDIO_DATA_NAN:22,AUDIO_FORMAT_ERROR:23,AUDIO_DATA_MUTE:24,IS_NOT_SUPPORT_CATEGORY:25,BROWSER_VERSION_NOT_SUPPORTED_WCS:26,BROWSER_VERSION_NOT_SUPPORTED_WCS_H265:27,BROWSER_VERSION_NOT_SUPPORTED_WCS_H264:28,VOD_AV1_CLOSE_CFg:29,NOT_SUPPORT_AUDIO_SAMPLERATE:30},o={VIDEO_PTS:0,VIDEO_RENDER_NUMS:1,VIDEO_NOT_RENDERD_BUFFER:2,AUDIO_TODECODE_NUMS:3,VIDEO_TODECODE_NUMS:4,AUDIO_DECODE_NUMS:5,VIDEO_DECODE_NUMS:6,VIDEO_DECODED_DELAY:7,VIDEO_READY_TO_RENDER_LIST_LEN:8,VIDEO_BUFFER_LEN:9,VIDEO_THROW_FRAME_FPS:11,AUDIO_DTS:12,AUDIO_RENDER_NUMS:13,VIDEO_DECODE_DISCARD_NUMS:14,VIDEO_DECODED_DELAY_SMOOTH:21,VIDEO_ENHANCE_NUMS:22,VIDEO_ENAHNCE_COST:23,VIDEO_ENHANCE_LESS30_NUMS:24,VIDEO_ENHANCE_LESS150_NUMS:25,VIDEO_ENHANCE_LESS200_NUMS:26,VIDEO_ENHANCE_LARGE200_NUMS:27,VIDEO_ENHANCE_TOTAL:28,AUDIO_WORKER_UN_RENDER_AUDIO_FRAMES:31,VIDEO_FIRST_FRAME_DECODEC_COST:32,AUDIO_FIRST_FRAME_DECODEC_COST:33},n={AUDIO_DECODED_BUFFER:15,PAUSE_STATUS:16,AUDIO_DECODED_BUFFER_LEN:17,VIDEO_REAL_FPS:18,IS_SHIELD_AUDIO:19,FRAME_BUFFER_LEN:20,LAST_VIDEO_RCV_TS:29,BROWSER_PAUSE_STATUS:30}},function(t,e,i){"use strict";i.d(e,"a",(function(){return p}));var s=i(22),r=i(2),a=i(11),o=i(0),n=i(8),h=i(16),d=i(13),l=i(1),u=i(12);class c{static turnStr(t,e,i){let s=t.toString(e);for(let t=s.length;t<i;t++)s="0"+s;return s}static rotl64(t,e){let i=c.turnStr(t,2,64),s=i.substring(0,32),r=i.substring(32),a=r.substr(e,32-e)+r.substr(0,e);return parseInt(s+a,2)}static rotr64(t,e){let i=c.turnStr(t,2,64),s=i.substring(0,32),r=i.substring(32),a=r.substr(32-e,e)+r.substr(0,32-e);return parseInt(s+a,2)}static rotUid(t,e){return 0===t&&(t="1234"+c.turnStr(parseInt(9999*Math.random()),10,4)),isNaN(e)&&(e=0),t=parseInt(t),e=parseInt(e),c.rotl64(t,8)}static revertUid(t,e){return t=parseInt(t),c.rotr64(t,8)}static inet_ntoa(t){let e,i,s,r,a="",o=new Uint8Array(4),n=new DataView(o.buffer);return n.setUint32(0,t),e=n.getUint8(0),i=n.getUint8(1),s=n.getUint8(2),r=n.getUint8(3),a=r+"."+s+"."+i+"."+e,a}static ip2uint(t){for(var e=0,i=t.split("."),s=0;s<i.length;s++){e|=Number(i[s])<<8*s}return e<0&&(e+=4294967296),e}static isBiggerUint(t,e){if(t===e)return!1;if(t>e){return t-e<2147483647}return!(e-t<2147483647)}static isEqualOrBiggerUint(t,e){if(t===e)return!0;if(t>e){return t-e<2147483647}return!(e-t<2147483647)}static isUintMax(t){return 4294967295===t}static isUint64Max(t){return 0x10000000000000000===t}static getQueryString(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),s=(e||window.location.search.substr(1)).match(i);return null!=s?unescape(s[2]):null}static printHexBytes(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(var i=new DataView(t.buffer),s=e?10:0,r=[];s<i.byteLength;){var a=i.getUint8(s++);(a=a.toString(16).toUpperCase()).length<2&&(a="0"+a),r.push(a,"\t"),s%10==0&&r.push("\n")}console.log(r.join("")+"\tsize:",i.byteLength)}static getCookie(t){for(var e=t+"=",i=document.cookie.split(";"),s=0,r=i.length;s<r;s++){var a=i[s].trim();if(0==a.indexOf(e))return a.substr(e.length)}return""}static formatByteSize(t){let e=t/1024;return e>1024?(e/=1024,e=e.toFixed(1)+"MB"):e=e.toFixed(1)+"KB",e}static padStrLen(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.length>=e)return t;let s=" ".repeat(e-t.length);return i?s+t:t+s}static xhr(t,e,i,s,r){var a=new XMLHttpRequest;a.overrideMimeType("text/plain; charset=x-user-defined");var o=function(){4===a.readyState&&(200===a.status||304===a.status?s(a.response):r(a.status),a.removeEventListener("readystatechange",o),a=void 0)};a.addEventListener("readystatechange",o),a.open(e,t,!0),a.send(i)}static getAv1Random(t,e){if(!t)return!1;let i=localStorage.av1PresentUid,s=t.presenterUid;localStorage.randomAv1Percent&&i==s||(localStorage.randomAv1Percent=Math.floor(1e4*Math.random()));let r=Number(localStorage.randomAv1Percent);return localStorage.av1PresentUid=t.presenterUid,r<e}static is64bitSoftware(){return-1!=navigator.userAgent.indexOf("Macintosh")||-1!=navigator.userAgent.indexOf("x64")}static isGameIdSupport265(t,e){if(t[0])return!0;let i=!1;return t[1].map(t=>{e&&e.toString()==t.toString()&&(i=!0)}),i}static unescapeHTML(t){return(t=""+t).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace("↵","")}static getSdkAbRandom(t,e){let i=localStorage.abPresentUid;localStorage.randomAbPercent&&i==t.presenterUid||(localStorage.randomAbPercent=Math.floor(1e4*Math.random()));let s=Number(localStorage.randomAbPercent);return localStorage.abPresentUid=t.presenterUid,s<e}static removeUrlParam(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!t)return t;const i=t.split("?"),s=i[0],r=i.length>1?i[1]:"";if(!r)return t;let a=t;const o={},n=r.split("&");for(var h=0;h<n.length;h++)n[h]=n[h].split("="),o[n[h][0]]=n[h][1];return e.forEach(t=>{r.indexOf(t)>-1&&delete o[t]}),a=s+JSON.stringify(o).replace(/[\"\{\}]/g,"").replace(/\:/g,"=").replace(/\,/g,"&"),a}static removeUrlAllParam(t){if(!t)return t;return t.split("?")[0]}static getBrowserHidden(){return document.hidden||document.webkitHidden||document.mozHidden||document.msHidden}static isWebCodecsSupported(){return!("undefined"==typeof VideoDecoder||"undefined"==typeof SharedArrayBuffer||"undefined"==typeof Atomics)&&navigator.hardwareConcurrency>=r.a.webCodecCfg[0]}static isManagerMediaSourceSupported(){return!!window.ManagedMediaSource||!!window.MediaSource}static isWebcodecsBrowserSupported(){const t=navigator.userAgent.toLowerCase(),e=-1!=t.indexOf("yabrowser")||-1!=t.indexOf("yowser");return"opera"!=n.a.name&&!e}static checkWebCodec(t,e,i){if(i&&!h.a.isMseSupportedHevc())return!1;if(i&&0==r.a.vodH265Config[0]&&t.liveType!=u.a.LIVE)return!1;const s=t.presenterUid,p=(t.uid,t.curBitrate);r.a.webCodecsAnchoruids.indexOf(Number(s))>=0&&r.a.enableWebCodec(),t.liveType!=u.a.LIVE&&(t.liveType==u.a.REPLAY?-1!==r.a.replayWebcodecsGameIds.indexOf(t.gameId)&&r.a.enableVodWebCodecs():-1!==r.a.vodWebcodecsGameIds.indexOf(t.gameId)&&r.a.enableVodWebCodecs(),-1!==r.a.vodWebcodecsVids.indexOf(t.vid)&&r.a.enableVodWebCodecs());const m=p<=r.a.webCodecCfg[1];let f=r.a.openWebcodec&&m;t.liveType!=u.a.LIVE&&(f=r.a.vodOpenWebcodecs&&m,n.a.version.major<r.a.vodWcsBroCfg[0]&&(f=!1));let _=a.a.os||"",g=a.a.osVersion||"",S=!0;if("windows"==_.toLocaleLowerCase()&&Number(g)>=10&&-1!==n.a.name.indexOf("edg")&&n.a.version.major>=r.a.h265MseChromeConfig[0]&&i||"windows"==_.toLocaleLowerCase()&&Number(g)>=10&&-1!==n.a.name.indexOf("chrome")&&n.a.version.major>=r.a.h265MseChromeConfig[0]&&i?S=!0:i&&(S=!1),i&&(f=f&&S),-1!==r.a.wcs265BlackUids.indexOf(Number(t.uid))&&(f=!1),r.a.webCodecBlackUids.indexOf(Number(s))>=0&&(f=!1),r.a.wcsBlackAids.indexOf(Number(s))>=0&&(f=!1),-1!=r.a.wcsBlackBrowVers.indexOf(n.a.version.major)&&(f=!1,e.setComDim(l.a.DIM_COM.WEBCODECS_BACK_REASON,d.a.BROWSER_VERSION_NOT_SUPPORTED_WCS)),-1!==r.a.wcs265BlackBrowVers.indexOf(n.a.version.major)&&i){f=!1;const i=r.a.bitrateBrowHard265Cfg[0],s=r.a.bitrateBrowHard265Cfg[1],a=r.a.bitrateBrowHard265Cfg[2];1==i&&t.curBitrate<=s&&-1!==a.indexOf(n.a.version.major)&&(f=!0),f||e.setComDim(l.a.DIM_COM.WEBCODECS_BACK_REASON,d.a.BROWSER_VERSION_NOT_SUPPORTED_WCS_H265)}return-1===r.a.wcs264BlackBrowVers.indexOf(n.a.version.major)||i||(f=!1,e.setComDim(l.a.DIM_COM.WEBCODECS_BACK_REASON,d.a.BROWSER_VERSION_NOT_SUPPORTED_WCS_H264)),o.a.log("Utils.checkWebCodec",r.a.wcs265BlackBrowNames,n.a.name),r.a.wcs265BlackBrowNames.map(t=>{-1!==n.a.name.indexOf(t)&&i&&(f=!1,e.setComDim(l.a.DIM_COM.WEBCODECS_BACK_REASON,d.a.BROWSER_NAME_NOT_SUPPORTED_WCS_H265),o.a.log("Utils.checkWebCodec, Browser name close webcodecs!"))}),f=f&&c.isWebCodecsSupported(),1==Number(localStorage._forceWebcodecs)&&(f=!0),1==Number(localStorage._forceMse)&&(f=!1),f}static getDecodeMod(t,e,i){let s="mseh";return t?s="wcs":e?s="wasm":i&&(s=n.a.chrome&&n.a.version.major>104||"safari"==n.a.name?"mseh":"mses"),s}static getDMod(t,e){return"mseh"!==t&&"wcs"!==t&&"wasm"!==t&&"mses"!==t&&(t="unknow"),e=Number(e),isNaN(e)&&(e=0),`${t}-${e}`}static checkDMod(t,e,i){return-1===t.indexOf("&dMod=")&&(t+=-1===t.indexOf("?")?"?":"&",t+="dMod="+c.getDMod(e,i)),t}static getAv1Support(t,e,i,s){let r=5;return t&&(r=e?i?2:s?3:4:1),r}static getSupportMod(t,e,i,s){let a=h.a.isMseSupportedHevc(),o=a&&n.a.chrome&&n.a.version.major>=r.a.h265MseChromeConfig[0],d=0;if(i&&(d|=64),3!==s&&4!==s||(d|=128),c.isWebCodecsSupported()&&(d|=1),t&&(d|=2),o&&(d|=8,c.isWebCodecsSupported()&&(d|=16)),a){const t=r.a.h265MseConfig[1];if(t.length>0){const e=n.a.version.major;n.a.chrome&&t.indexOf(e)>=0&&(d|=4)}}return e&&(d|=32),d}static isOpen(t,e,i){let s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=c.getCfgValue(t,e,i);return-1===r?s:100*Math.random()<r}static getCfgValue(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;e+="|",i="line"+i+":";let r=(t+="").split(","),a="",o="",n=r.length;for(let t=0;t<n;t++){let i=r[t];-1!==i.indexOf(e)?a=i.replace(e,""):-1!==i.indexOf("all|")&&(o=i.replace("all|",""))}let h=s,d=s;return""!==a&&(h=c.getLineValue(a,i,s)),""!==o&&(d=c.getLineValue(o,i,s)),h!==s?h:d!==s?d:s}static getLineValue(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,s=t.split("_"),r=s.length,a=i,o=i;for(let t=0;t<r;t++){let r=s[t];-1!==r.indexOf("all")?a=c.getValue(r,i):-1!==r.indexOf(e)&&(o=c.getValue(r,i))}return o!==i?o:a!==i?a:i}static getValue(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=e,s=t.split(":");return s.length>1&&(i=parseInt(s[1]),isNaN(i)&&(i=e)),i}static getBrowserHidden(){return document.hidden||document.webkitHidden||document.mozHidden||document.msHidden}static isMseSupportedHevc(){return h.a.isMseSupportedHevc()}static isXiaomi(t){var e="mi "==(t=t.toLowerCase()).match(/mi\s/i)||"xiaomi"==t.match(/xiaomi/i)||"xiaomi"==t.match(/miuibrowser/i),i="mix "==t.match(/mix\s/i),s="redmi"==t.match(/redmi/i);return e||i||s}static urlInfoParams(t,e){return t+=`&sv=2412111629&sdk_sid=${e._sessionId}&a_block=${1===Number(e.adBlock)?1:0}`,c.isWupFail()&&(t+="&sf=1"),t}static isWupFail(){if(localStorage.hasOwnProperty("statInfo")){let t=null;try{t=JSON.parse(localStorage.statInfo)}catch(e){t=null}if(t&&t.hasOwnProperty("totalCnt")&&t.hasOwnProperty("failCnt")){const e=Number(t.totalCnt),i=Number(t.failCnt);if(e>=r.a.wupFailCnt){return i/e*100>r.a.wupFailPer}}}return!1}static getBufferedLog(t){if(t){let e=t.buffered,i=[];for(let t=0;t<e.length;t++)i.push(`[${e.start(t)}, ${e.end(t)}]`);return`video.buffered=${i.join(" ")}, video.currentTime=${t.currentTime}`}return"video.buffered=null"}}function p(t){return atob(t)}Object(s.a)(c,"indateLocalStorage",{set(t,e,i){const s={value:e,expirse:new Date(i).getTime()};localStorage[t]=JSON.stringify(s)},get(t){const e=JSON.parse(localStorage[t]);if(null!==e){if(!(null!=e.expirse&&e.expirse<(new Date).getTime()))return e.value;delete localStorage[t]}return null},update(t,e){const i=JSON.parse(localStorage[t]);i&&(i.value=e,localStorage[t]=JSON.stringify(i))}}),c.IntMax=2147483647,c.IntMin=-2147483647,c.UintMax=4294967295,e.b=c},function(t,e,i){"use strict";var s=i(10);let r={SLICE_SPEED:12.5,MAX_PACKET_CNT:1e4,SWITCH_INTERVAL:10,MAX_DELAY:66e4,DEFAULT_DELAY:65535,SUBSCRIBE_TIMEOUT:1e4,PUNCH_BACK_COOLING:2e4,PUNCH_IGNORE_TIME:3e5,SUB_TIMEOUT:5e3,RESUB_TIMEOUT:3e4,STREAM_DELAY:2e3,EMULATE_DELAY:1800,MAX_DEPTH:1,PROXY_NUM:3,MAX_PEER_STREAM_NUM:8,MAX_PUSH_NUM:3,MAX_PULL_NUM:3,SLICE_DELAY:100,SLICE_LATE:50,SLICE_FAST:50,SLICE_TIMEOUT:2e3,SWITCH_DELAY:500,StreamType:{NONE:0,FORCE:1,FIXED:2,COMPETE:3,PEER:4},LeaveReason:{PING_DIF:1,RESET:2},DEL_REASON:{CHANNEL_CLOSE:1,CHANNEL_ERROR:2,NODE_LEAVE:3,SERVER_REJECT:5,PEER_ERROR:6,PEER_TIMEOUT:7,PING_TIMEOUT:8,OTHER_SID:9,EMPTY_SLICE:10,SUB_TIMEOUT:11,SUB_FAIL_TIMES:12,NODE_REJECT:13,DIF_CDNP:14,PEER_HANDLER_ERR:15},PERIOD:{UPLINK_CALC:10,CHECK_SEED:20,GET_NODE:5},SubType:{SUBSCRIBE_FORCE:0,SUBSCRIBE_NORMAL:1},LoadVideoTimeoutReason:{FLV_DISCONNECTED:0,FLV_CONNECTED:1,FLV_CONNECT_ERROR:2,FLV_RECV_DATA:3,FLV_DATA_INVALID:4,FLV_STARTPLAY:5,FLV_PLAYERROR:6,HLS_DISCONNECTED:7,HLS_LOADMANIFEST_ERROR:8,HLS_LOADMANIFEST_SUCCESS:9,HLS_LOADFRAMENT:10,HLS_LOADFRAMENT_ERROR:11,HLS_LOADFRAMENT_SUCCESS:12,HLS_PLAY_ERROR:13},SubResCode:{ACCEPT_SUBSCRIBE:0,EMPTY_UPLOAD_NUM:1,DETECT_SUBSCRIBE_CYCLE:2,EMPTY_PEER_INFO:3,SUBSCRIBE_UPLINK_NOT_ENOUGH:4,PUBLISHER_KICK_OFF:5,NOT_SUBSCRIBER:6,INVALID_SUB_STREAM:7,ACCEPT_BY_SUBSCRIBER_UPLINK:9,INVALID_STREAMID:10,SERVER_EMPTY_BW:11,PUBLISHER_LEAVE:12,DIFFERENT_VIDEO_PROXY:13,OLD_VERSION_REQ:14,INVALID_TREE_DEPTH:15,INVALID_MAX_SUBSTREAM_NUM:16,STREAM_LATE:17,DEPTH_LARGE:18,STREAM_LIMIT:19,SLICE_LARGE:20,NOT_FOUND_PKG:21,KICK_OUT:22,SELF_WORST:23,SLICE_LATE:24,SLICE_FAST:25,RESTART:26,RESET:27,DIF_BASE_SUBS:28},VIDEO_COMPETE_UID:4294967295,VIDEO_FORCE_UID:0,VIDEO_FIXED_UID:-1,VIDEO_DEFAULT_UID:-2,isProxyUid:function(t){return t===r.VIDEO_COMPETE_UID||t===r.VIDEO_FORCE_UID||t===r.VIDEO_FIXED_UID||t===r.VIDEO_DEFAULT_UID},isCompete:function(t){return t===r.VIDEO_COMPETE_UID},isForce:function(t){return t===r.VIDEO_FORCE_UID},isFixed:function(t){return t===r.VIDEO_FIXED_UID},isDefault:function(t){return t===r.VIDEO_DEFAULT_UID},isSliceJumpFromPeer:function(t,e){return e.isFromPeer&&t>0&&e.seq-t>10*r.LOST_SEQ_NUM},offerReject:{REASON_NOTSTART:1,REASON_PUNCHFAILED_CD:2,REASON_PUNCHED_FULL:3,REASON_QUOTA_EXHAUST:4,REASON_VERSION:5,REASON_DIF_LINE:6,REASON_FAIL:7,REASON_IGNORE:8,REASON_HAS_NODE:9,REASON_WAITING:10,REASON_OTHER:100},offerRejectTime:12e4,punchBackRet:{SUC:0,DIF_STREAM:1,CLOSING:2,COOLING:3,REQUEST:4,REJECT:5},restartReason:{RANGE_SEQ_MAX:1,RANGE_SEQ_LARGE:2,CDN_JUMP:3,PLAYER_NO_DATA:4,LOST_SEQ:5,CONNECT:6,WORKER_ERROR:7,MULTI_CDN:8,FLV_TO_P2P:9,PLAYER_ERROR:10,PLAYER_DISPOSE:11,LOST_SEQ_JUMP:12},turnToFlvReason:{FULL_PLAY_FAIL:1,FULL_CONNECT_TIMEOUT:2,SUB_CONNECT_TIMEOUT:3,FULL_NO_DATA:4,SUB_NO_DATA:5,P2P_ARGS_ERROR:6,P2P_COOLING:7,FLV_TO_P2P_FAIL:8,FLV_TO_P2P_FULL_STREAM_COMPLETE:9,FULL_ERROR:10,FULL_CLOSE:11,SUB_ERROR:12,SUB_CLOSE:13,RESTART_TIMES:14,SIGNAL_TIMEOUT:15,PROBE_TIMEOUT:16,PROBE_ERROR:17,NO_DATA_TIMEOUT:18,IS_NOT_FIRST_FETCH:19,VIDEO_BUFFER_EMPTY:20,PLAY_TIMEOUT:21,NOT_SUPPORT_P2P:22},userProperty:{SERVER_CLOSE:1,CLIENT_CLOSE:2,BROWSER_UN_SUPPORT:3,FLASH:4,UNKNOW:5,P2P:6,FIRST_FULL_CONNECT_TIMEOUT:7,FIRST_FULL_PLAY_FAIL:8,FIRST_FULL_NO_DATA:17,RESTART_RANGE_MAX:9,RESTART_RANGE_LARGE:10,RESTART_CONNECT:11,RESTART_MUTI_CDN:12,RESTART_PLAYER_NO_DATA:13,RESTART_PLAYER_ERROR:14,SUB_NO_DATA:15,SUB_CONNECT_TIMEOUT:16,P2P_ARGS_ERROR:18,FLV_TO_P2P:19,LOST_SEQ:20,P2P_COOLING:21,IS_NOT_FIRST_FETCH:22,VIDEO_BUFFER_EMPTY:23},h265TurnToH264Reason:{DECODE_ERROR:1,RENDER_ERROR:2},pauseReason:{FLV_NO_BUFF:1,FLV_UNKNOW_PAUSE:2,FLV_NET_SLOW:3,P2P_NO_BUFF:4,P2P_UNKNOW_PAUSE:5,P2P_FULL_LOADER_NO_DATA:10,P2P_FULL_LOADER_CONNECT_FAIL:11,P2P_SUB_LOADER_NO_DATA:12,P2P_SUB_LOADER_CONNECT_FAIL:13,FLV_NO_DATA:14,P2P_NO_SLICE:15,P2P_RESEND_SKIP_FRAME:20,P2P_RESEND_TOOLATE:21,P2P_RESEND_TIMEOUT:22,P2P_RESEND_ERROR:23,P2P_RESEND_MISSING:24,P2P_DTS_JUMP:25,P2P_NET_SLOW:26},DataType:{SIGNALLING:0,PING:1,SLICE:2},LOST_SEQ_NUM:4e3,BAD_REASONS:{UNKNOW:100,SUB_LINK:1,DOWN_LINK:2,RANGE_MISS:3,RANGE_RECV_TIMEOUT:4,FRAME_SEQ_LOST:5,BUFFER_JUMP:6,TIMESTAMP_JUMP:7,FRAME_VIDEO_JUMP:8,FRAME_AUDIO_JUMP:9,FRAME_DROP:10,PERFORMANCE:11},initConfig:function(t,e){let i=e.coderates,a=null;for(let e=0;e<i.length;e++)if(a=i[e],t>Number(a[0])){r.PROXY_NUM=Number(a[1]),r.SLICE_DELAY=Number(a[2]),r.MAX_PUSH_NUM=Number(a[3]),r.MAX_PULL_NUM=Number(a[4]),r.SLICE_LARGE=Number(a[5]);break}r.MAX_PEER_STREAM_NUM=Number(e.maxPeerStreamNum)||8;let o=r.SLICE_SPEED*s.a.baseSubs*(t/1e3);r.SLICE_LATE=parseInt(o*((Number(e.sliceLate)||1e3)/1e3)),r.SLICE_FAST=parseInt(o*((Number(e.sliceFast)||2e3)/1e3)),r.STREAM_DELAY=Number(e.badDelay)||2e3,r.EMULATE_DELAY=Number(e.emuteDelay)||1800,r.RESUB_TIMEOUT=Number(e.resubTime)||3e4,r.SLICE_TIMEOUT=Number(e.sliceTimeout)||2e3,r.SWITCH_DELAY=Number(e.switchDelay)||500},HLS_LOAD_TYPE:{FETCH:1,XHR:2},LATENCY_MODEL_TYPE:{NONE:0,CONTROL_MODEL:2,RTC_MODEL:4,TOPSPEED_MODEL:99},PLATFORM_TYPE:{web:100,mini_app:102,wap:103,huya_liveshareh5:104,adr:2,ios:3},PLATFORM_TYPE_NAME:{web:"web",wap:"wap"},H5_ERROR_CODE:{VIDEO_ERROR:-1e3,PLAY_TIMEOUT:-1001},VISIBILITY_STATE:{VISIBLE:"visible",HIDDEN:"hidden",PRERENDER:"prerender"},PCDN_OPEN_BUFFER:1e4,PCDN_CLOSE_BUFFER:7e3,PCDN_COOL_TIME:6e4,PLAYER_CORE_TYPE:{MSE:1,WEBCODECS:2,MMS:3}};e.a=r},function(t,e,i){"use strict";var s=i(14);e.a=s.BrowserImpl},function(t,e,i){"use strict";i.r(e),i.d(e,"WebCodecsErrType",(function(){return s})),i.d(e,"ReceiveMessageType",(function(){return r})),i.d(e,"ToMainMessageType",(function(){return a})),i.d(e,"StoreWorkerType",(function(){return o})),i.d(e,"MainSharedBufferType",(function(){return n}));const s={VIDEODECODEERROR:1,AUDIODECODEERROR:2,VIDEORENDEERROR:3,VIDEOFAST:4,AUDIOFAST:5,WORKERERROR:6},r={START:1,POSTFRAME:2,RESIZE:3,CLOSE:4,VISIBILITYCHANGE:5,AUDIOSAMPLES:6,VIDEOSAMPLES:7,AVCCONFIG:8,AVCPPS:9,AVCSPS:10,AACCONFIG:11,UPDATE_VIDEOFPS:12,SET_PLAY_MINBUFFER:13,SET_JITTER:14,SET_USE_SOFTACCELERATION:15,LOCAL_CONFIG:16,PAUSE_VIDEO_DECODE:17,PAUSE_AUDIO_DECODE:18,ENABLE_DISCARD_VIDEO:19,SET_AUDIO_WRITER:20,UPDATE_CURBITRATE:21,INIT_CONFIG:22,AVCVPS:23,RECV_FPS:24,FAST_OVER:25,LOG_CFG:26,UPDATE_SOFTACCELERATION:27,SET_ENHANCE:28,SET_SEGMENTTION:29,RECV_FAST_OVER:30,AV1_INIT_SEG:31,SEEK_TIME:32,SET_PLAYBACKRATE:33,SET_VOD_AV1:34},a={WebGLPLAY:1,STAT:2,PAUSE:3,WORKERSHAREBUFFER:4,VIDEORENDERERROR:5,LOG:6,AUDIODECODEDFRAME:7,VIDEODECODEERROR:8,AUDIODECODEERROR:9,INTERVAL:10,WOREKR_READY:11,TURN_TO_WEBCODECS_SOFT:12,AUDIO_PLAY:13,AUDIORENDERERROR:14,SOFT_TURN_TO_MSE:15,AUDIO_FRAME_DECODED:16,DECODE_COST:17,DECODE_DTS:18,WAIT_KEY_FRAME:19,SET_FRAME_PAUSE:20,SET_FRMAE_RESUME:21,RENDER_FPS_PAUSE:22,AUDIO_FORMAT_ERROR:23,VIDEO_ENHANCE_ERROR:24,VIDEO_ENHANCE_SUCCESS:25,ON_WCS_VIDEO_SEEK:26},o={VIDEO_PTS:0,VIDEO_RENDER_NUMS:1,VIDEO_NOT_RENDERD_BUFFER:2,AUDIO_TODECODE_NUMS:3,VIDEO_TODECODE_NUMS:4,AUDIO_DECODE_NUMS:5,VIDEO_DECODE_NUMS:6,VIDEO_DECODED_DELAY:7,VIDEO_READY_TO_RENDER_LIST_LEN:8,VIDEO_BUFFER_LEN:9,VIDEO_THROW_FRAME_FPS:11,AUDIO_DTS:12,AUDIO_RENDER_NUMS:13,VIDEO_DECODE_DISCARD_NUMS:14,VIDEO_DECODED_DELAY_SMOOTH:21,VIDEO_ENHANCE_NUMS:22,VIDEO_ENAHNCE_COST:23,VIDEO_ENHANCE_LESS30_NUMS:24,VIDEO_ENHANCE_LESS150_NUMS:25,VIDEO_ENHANCE_LESS200_NUMS:26,VIDEO_ENHANCE_LARGE200_NUMS:27,VIDEO_ENHANCE_TOTAL:28,AUDIO_WORKER_UN_RENDER_AUDIO_FRAMES:31,VIDEO_FIRST_FRAME_DECODEC_COST:32,AUDIO_FIRST_FRAME_DECODEC_COST:33},n={AUDIO_DECODED_BUFFER:15,PAUSE_STATUS:16,AUDIO_DECODED_BUFFER_LEN:17,VIDEO_REAL_FPS:18,IS_SHIELD_AUDIO:19,FRAME_BUFFER_LEN:20,LAST_VIDEO_RCV_TS:29,BROWSER_PAUSE_STATUS:30}},function(t,e,i){"use strict";var s=i(0);let r=new class{constructor(){this.sdkVersion=2412111629,this.version=1100,this.baseSubs=10,this.uid=0,this.sGuid="",this.roomId=0,this.uuid=0,this.convertUid=0,this.appId=66,this.appid=66,this.p2pCooling=!1,this.flvTryToP2P=0}initUUId(){0===this.uuid&&(this.uuid=Number((Date.now()%1e10*1e3+(1e3*Math.random()|0))%4294967295));let t=Number(localStorage.appid);t&&(this.appid=t,s.a.warn("--- test appid "+t+" ---",this))}getAnonymouUid(){let t=Number(localStorage.sdk_anonymousuid);return t||(t=Number((Date.now()%1e10*1e3+(1e3*Math.random()|0))%4294967295),localStorage.sdk_anonymousuid=t),t}};e.a=r},function(t,e,i){"use strict";const s=navigator.userAgent;e.a=new class{constructor(){this.matches=null,this.versionFuncs=null,this.device="",this.language="",this.browser="",this.version={major:0,full:""},this.kernel="",this.kernelVersion=0,this.os="",this.osVersion="",this.genBrowserInfo(),this.amendOSVersionCallback=null}getMatches(){const t=s;this.matches={Trident:t.indexOf("Trident")>-1||t.indexOf("NET CLR")>-1,Presto:t.indexOf("Presto")>-1,WebKit:t.indexOf("AppleWebKit")>-1,Gecko:t.indexOf("Gecko/")>-1,KHTML:t.indexOf("KHTML/")>-1,Safari:t.indexOf("Safari")>-1,Chrome:t.indexOf("Chrome")>-1||t.indexOf("CriOS")>-1,IE:t.indexOf("MSIE")>-1||t.indexOf("Trident")>-1,Edge:t.indexOf("Edge")>-1||t.indexOf("Edg/")>-1,Firefox:t.indexOf("Firefox")>-1||t.indexOf("FxiOS")>-1,"Firefox Focus":t.indexOf("Focus")>-1,Chromium:t.indexOf("Chromium")>-1,Opera:t.indexOf("Opera")>-1||t.indexOf("OPR")>-1,Vivaldi:t.indexOf("Vivaldi")>-1,Yandex:t.indexOf("YaBrowser")>-1,Arora:t.indexOf("Arora")>-1,Lunascape:t.indexOf("Lunascape")>-1,QupZilla:t.indexOf("QupZilla")>-1,"Coc Coc":t.indexOf("coc_coc_browser")>-1,Kindle:t.indexOf("Kindle")>-1||t.indexOf("Silk/")>-1,Iceweasel:t.indexOf("Iceweasel")>-1,Konqueror:t.indexOf("Konqueror")>-1,Iceape:t.indexOf("Iceape")>-1,SeaMonkey:t.indexOf("SeaMonkey")>-1,Epiphany:t.indexOf("Epiphany")>-1,360:t.indexOf("QihooBrowser")>-1||t.indexOf("QHBrowser")>-1,"360EE":t.indexOf("360EE")>-1,"360SE":t.indexOf("360SE")>-1,UC:t.indexOf("UCBrowser")>-1||t.indexOf(" UBrowser")>-1||t.indexOf("UCWEB")>-1,QQBrowser:t.indexOf("QQBrowser")>-1,QQ:t.indexOf("QQ/")>-1,Baidu:t.indexOf("Baidu")>-1||t.indexOf("BIDUBrowser")>-1||t.indexOf("baidubrowser")>-1||t.indexOf("baiduboxapp")>-1||t.indexOf("BaiduHD")>-1,Maxthon:t.indexOf("Maxthon")>-1,Sogou:t.indexOf("MetaSr")>-1||t.indexOf("Sogou")>-1,Liebao:t.indexOf("LBBROWSER")>-1||t.indexOf("LieBaoFast")>-1,"2345Explorer":t.indexOf("2345Explorer")>-1||t.indexOf("Mb2345Browser")>-1||t.indexOf("2345chrome")>-1,"115Browser":t.indexOf("115Browser")>-1,TheWorld:t.indexOf("TheWorld")>-1,XiaoMi:t.indexOf("MiuiBrowser")>-1,Quark:t.indexOf("Quark")>-1,Qiyu:t.indexOf("Qiyu")>-1,Wechat:t.indexOf("MicroMessenger")>-1,WechatWork:t.indexOf("wxwork/")>-1,Taobao:t.indexOf("AliApp(TB")>-1,Alipay:t.indexOf("AliApp(AP")>-1,Weibo:t.indexOf("Weibo")>-1,Douban:t.indexOf("com.douban.frodo")>-1,Suning:t.indexOf("SNEBUY-APP")>-1,iQiYi:t.indexOf("IqiyiApp")>-1,DingTalk:t.indexOf("DingTalk")>-1,Huawei:t.indexOf("HuaweiBrowser")>-1||t.indexOf("HUAWEI/")>-1||t.indexOf("HONOR")>-1,Vivo:t.indexOf("VivoBrowser")>-1,Windows:t.indexOf("Windows")>-1,Linux:t.indexOf("Linux")>-1||t.indexOf("X11")>-1,"Mac OS":t.indexOf("Macintosh")>-1,Android:t.indexOf("Android")>-1||t.indexOf("Adr")>-1,HarmonyOS:t.indexOf("HarmonyOS")>-1,Ubuntu:t.indexOf("Ubuntu")>-1,FreeBSD:t.indexOf("FreeBSD")>-1,Debian:t.indexOf("Debian")>-1,"Windows Phone":t.indexOf("IEMobile")>-1||t.indexOf("Windows Phone")>-1,BlackBerry:t.indexOf("BlackBerry")>-1||t.indexOf("RIM")>-1,MeeGo:t.indexOf("MeeGo")>-1,Symbian:t.indexOf("Symbian")>-1,iOS:t.indexOf("like Mac OS X")>-1,"Chrome OS":t.indexOf("CrOS")>-1,WebOS:t.indexOf("hpwOS")>-1,Mobile:t.indexOf("Mobi")>-1||t.indexOf("iPh")>-1||t.indexOf("480")>-1,Tablet:t.indexOf("Tablet")>-1||t.indexOf("Pad")>-1||t.indexOf("Nexus 7")>-1},this.matches.Mobile?this.matches.Mobile=!(t.indexOf("iPad")>-1):this.is360()&&(this.mime("type","application/gameplugin")||navigator&&void 0!==navigator.connection&&void 0===navigator.connection.saveData?this.matches["360SE"]=!0:this.matches["360EE"]=!0),this.matches.Baidu&&this.matches.Opera?this.matches.Baidu=!1:this.matches.iOS&&(this.matches.Safari=!0),window.chrome&&(window.chrome.adblock2345||window.chrome.common2345)&&(this.matches["2345Explorer"]=!0)}genBrowserInfo(){this.getMatches();const t={kernel:["WebKit","Trident","Gecko","Presto","KHTML"],browser:["Safari","Chrome","Edge","IE","Firefox","Firefox Focus","Chromium","Opera","Vivaldi","Yandex","Arora","Lunascape","QupZilla","Coc Coc","Kindle","Iceweasel","Konqueror","Iceape","SeaMonkey","Epiphany","XiaoMi","Vivo","360","360SE","360EE","UC","QQBrowser","QQ","Huawei","Baidu","Maxthon","Sogou","Liebao","2345Explorer","115Browser","TheWorld","Quark","Qiyu","Wechat","WechatWork","Taobao","Alipay","Weibo","Douban","Suning","iQiYi","DingTalk"],os:["Windows","Linux","Mac OS","Android","HarmonyOS","Ubuntu","FreeBSD","Debian","iOS","Windows Phone","BlackBerry","MeeGo","Symbian","Chrome OS","WebOS"],device:["Mobile","Tablet"]};var e;this.device="PC",this.language=((e=(navigator.browserLanguage||navigator.language).split("-"))[1]&&(e[1]=e[1].toUpperCase()),e.join("_"));for(let e in t)for(let i=0;i<t[e].length;i++){const s=t[e][i];this.matches[s]&&(this[e]=s)}this.getOSVersion(),this.getBrowserVersion(),this.amendSpecialCase(),this.amendOSVersion()}getOSVersion(){const t=s,e={Windows:function(){const e=t.replace(/^Mozilla\/\d.0 \(Windows NT ([\d.]+)[;)].*$/,"$1");return{10:"10",6.4:"10",6.3:"8.1",6.2:"8",6.1:"7","6.0":"Vista",5.2:"XP",5.1:"XP","5.0":"2000"}[e]||e},Android:function(){return t.replace(/^.*Android ([\d.]+);.*$/,"$1")},HarmonyOS:function(){return{10:"2"}[t.replace(/^Mozilla.*Android ([\d.]+)[;)].*$/,"$1")]||""},iOS:function(){return t.replace(/^.*OS ([\d_]+) like.*$/,"$1").replace(/_/g,".")},Debian:function(){return t.replace(/^.*Debian\/([\d.]+).*$/,"$1")},"Windows Phone":function(){return t.replace(/^.*Windows Phone( OS)? ([\d.]+);.*$/,"$2")},"Mac OS":function(){return t.replace(/^.*Mac OS X ([\d_]+).*$/,"$1").replace(/_/g,".")},WebOS:function(){return t.replace(/^.*hpwOS\/([\d.]+);.*$/,"$1")}};this.osVersion="",e[this.os]&&(this.osVersion=e[this.os](),this.osVersion==t&&(this.osVersion=""))}amendOSVersion(){"Windows"===this.os&&navigator.userAgentData&&navigator.userAgentData.getHighEntropyValues&&navigator.userAgentData.getHighEntropyValues(["platformVersion"]).then(t=>{if(t.platformVersion){parseInt(t.platformVersion.split(".")[0])>=13&&(this.osVersion="11",this.amendOSVersionCallback&&this.amendOSVersionCallback())}})}getBrowserVersion(){const t=s;if(this.versionFuncs={Safari:function(){return t.replace(/^.*Version\/([\d.]+).*$/,"$1")},Chrome:function(){return t.replace(/^.*Chrome\/([\d.]+).*$/,"$1").replace(/^.*CriOS\/([\d.]+).*$/,"$1")},IE:function(){return t.replace(/^.*MSIE ([\d.]+).*$/,"$1").replace(/^.*rv:([\d.]+).*$/,"$1")},Edge:function(){return t.replace(/^.*Edge\/([\d.]+).*$/,"$1").replace(/^.*Edg\/([\d.]+).*$/,"$1")},Firefox:function(){return t.replace(/^.*Firefox\/([\d.]+).*$/,"$1").replace(/^.*FxiOS\/([\d.]+).*$/,"$1")},"Firefox Focus":function(){return t.replace(/^.*Focus\/([\d.]+).*$/,"$1")},Chromium:function(){return t.replace(/^.*Chromium\/([\d.]+).*$/,"$1")},Opera:function(){return t.replace(/^.*Opera\/([\d.]+).*$/,"$1").replace(/^.*OPR\/([\d.]+).*$/,"$1")},Vivaldi:function(){return t.replace(/^.*Vivaldi\/([\d.]+).*$/,"$1")},Yandex:function(){return t.replace(/^.*YaBrowser\/([\d.]+).*$/,"$1")},Arora:function(){return t.replace(/^.*Arora\/([\d.]+).*$/,"$1")},Lunascape:function(){return t.replace(/^.*Lunascape[\/\s]([\d.]+).*$/,"$1")},QupZilla:function(){return t.replace(/^.*QupZilla[\/\s]([\d.]+).*$/,"$1")},"Coc Coc":function(){return t.replace(/^.*coc_coc_browser\/([\d.]+).*$/,"$1")},Kindle:function(){return t.replace(/^.*Version\/([\d.]+).*$/,"$1")},Iceweasel:function(){return t.replace(/^.*Iceweasel\/([\d.]+).*$/,"$1")},Konqueror:function(){return t.replace(/^.*Konqueror\/([\d.]+).*$/,"$1")},Iceape:function(){return t.replace(/^.*Iceape\/([\d.]+).*$/,"$1")},SeaMonkey:function(){return t.replace(/^.*SeaMonkey\/([\d.]+).*$/,"$1")},Epiphany:function(){return t.replace(/^.*Epiphany\/([\d.]+).*$/,"$1")},360:function(){return t.replace(/^.*QihooBrowser\/([\d.]+).*$/,"$1")},"360SE":function(){return{86:"13.0",78:"12.0",69:"11.0",63:"10.0",55:"9.1",45:"8.1",42:"8.0",31:"7.0",21:"6.3"}[t.replace(/^.*Chrome\/([\d]+).*$/,"$1")]||""},"360EE":function(){return{86:"13.0",78:"12.0",69:"11.0",63:"9.5",55:"9.0",50:"8.7",30:"7.5"}[t.replace(/^.*Chrome\/([\d]+).*$/,"$1")]||""},Maxthon:function(){return t.replace(/^.*Maxthon\/([\d.]+).*$/,"$1")},QQBrowser:function(){return t.replace(/^.*QQBrowser\/([\d.]+).*$/,"$1")},QQ:function(){return t.replace(/^.*QQ\/([\d.]+).*$/,"$1")},Baidu:function(){return t.replace(/^.*BIDUBrowser[\s\/]([\d.]+).*$/,"$1").replace(/^.*baiduboxapp\/([\d.]+).*$/,"$1")},UC:function(){return t.replace(/^.*UC?Browser\/([\d.]+).*$/,"$1")},Sogou:function(){return t.replace(/^.*SE ([\d.X]+).*$/,"$1").replace(/^.*SogouMobileBrowser\/([\d.]+).*$/,"$1")},Liebao:function(){let e="";t.indexOf("LieBaoFast")>-1&&(e=t.replace(/^.*LieBaoFast\/([\d.]+).*$/,"$1"));const i=t.replace(/^.*Chrome\/([\d]+).*$/,"$1");return e||{57:"6.5",49:"6.0",46:"5.9",42:"5.3",39:"5.2",34:"5.0",29:"4.5",21:"4.0"}[i]||""},"2345Explorer":function(){return{69:"10.0",55:"9.9"}[navigator.userAgent.replace(/^.*Chrome\/([\d]+).*$/,"$1")]||t.replace(/^.*2345Explorer\/([\d.]+).*$/,"$1").replace(/^.*Mb2345Browser\/([\d.]+).*$/,"$1")},"115Browser":function(){return t.replace(/^.*115Browser\/([\d.]+).*$/,"$1")},TheWorld:function(){return t.replace(/^.*TheWorld ([\d.]+).*$/,"$1")},XiaoMi:function(){return t.replace(/^.*MiuiBrowser\/([\d.]+).*$/,"$1")},Vivo:function(){return t.replace(/^.*VivoBrowser\/([\d.]+).*$/,"$1")},Quark:function(){return t.replace(/^.*Quark\/([\d.]+).*$/,"$1")},Qiyu:function(){return t.replace(/^.*Qiyu\/([\d.]+).*$/,"$1")},Wechat:function(){return t.replace(/^.*MicroMessenger\/([\d.]+).*$/,"$1")},WechatWork:function(){return t.replace(/^.*wxwork\/([\d.]+).*$/,"$1")},Taobao:function(){return t.replace(/^.*AliApp\(TB\/([\d.]+).*$/,"$1")},Alipay:function(){return t.replace(/^.*AliApp\(AP\/([\d.]+).*$/,"$1")},Weibo:function(){return t.replace(/^.*weibo__([\d.]+).*$/,"$1")},Douban:function(){return t.replace(/^.*com.douban.frodo\/([\d.]+).*$/,"$1")},Suning:function(){return t.replace(/^.*SNEBUY-APP([\d.]+).*$/,"$1")},iQiYi:function(){return t.replace(/^.*IqiyiVersion\/([\d.]+).*$/,"$1")},DingTalk:function(){return t.replace(/^.*DingTalk\/([\d.]+).*$/,"$1")},Huawei:function(){return t.replace(/^.*Version\/([\d.]+).*$/,"$1").replace(/^.*HuaweiBrowser\/([\d.]+).*$/,"$1")}},this.versionFuncs[this.browser]){const e=this.versionFuncs[this.browser]();e!==t&&(this.version.major=parseInt(e),this.version.full=e)}}amendSpecialCase(){const t=s;if("Chrome"==this.browser&&t.match(/\S+Browser/)){this.browser=t.match(/\S+Browser/)[0];const e=t.replace(/^.*Browser\/([\d.]+).*$/,"$1");this.version.major=parseInt(e),this.version.full=e}if("Firefox"!=this.browser||!window.clientInformation&&window.u2f||(this.kernel=this.browser,this.kernelVersion=this.version.major,this.browser+=" Nightly"),"Edge"==this.browser)this.version.major>75?(this.kernel="Chrome",this.kernelVersion=parseInt(this.versionFuncs.Chrome())):(this.kernel="EdgeHTML",this.kernelVersion=0);else if(this.matches.Chrome&&"WebKit"===this.kernel&&parseInt(this.versionFuncs.Chrome())>27)this.kernel="Chrome",this.kernelVersion=parseInt(this.versionFuncs.Chrome());else if("Opera"==this.browser&&this.version.major>12)this.kernel="Chrome",this.kernelVersion=parseInt(this.versionFuncs.Chrome());else if("Yandex"==this.browser)this.kernel="Chrome",this.kernelVersion=parseInt(this.versionFuncs.Chrome());else if(this.matches.Safari&&"WebKit"===this.kernel){let e=t.replace(/^.*Version\/([\d.]+).*$/,"$1");e===t&&(e=t.replace(/^.*AppleWebKit\/([\d.]+).*$/,"$1")),this.kernelVersion=parseInt(e)||0}}is360(){const t=s;let e=!1;if(window.chrome){const i=Number(t.replace(/^.*Chrome\/([\d]+).*$/,"$1"));this.mime("type","application/360softmgrplugin")||this.mime("type","application/mozilla-npqihooquicklogin")||i>36&&window.showModalDialog?e=!0:i>45&&(e=this.mime("type","application/vnd.chromium.remoting-viewer"),!e&&i>=69&&(e=this.mime("type","application/hwepass2001.installepass2001")||this.mime("type","application/asx")))}return e}mime(t,e){var i=navigator.mimeTypes;for(var s in i)if(i[s][t]==e)return!0;return!1}}},function(t,e,i){"use strict";e.a={NONE:0,LIVE:1,REPLAY:2,VOD:3}},function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));const s={VIDEODECODEERROR:1,AUDIODECODEERROR:2,VIDEORENDEERROR:3,VIDEOFAST:4,AUDIOFAST:5,WORKERERROR:6,AUDIORENDERERROR:7,NOT_SUPPORT_MEDIASRTREAMTRACK:8,DISABLE_HARDWARE_ACCELERATION:9,SOFT_TURN_TO_MSE:10,WIN_PERF_INSUFFICIENT:11,RETRY_MAX_TIMES:12,DECODE_COST:13,DECODE_DTS:14,BROWSER_NOT_SUPPORTED:15,IS_PUREAUDIO:16,ANGLE_NULL:17,DECODE_ERROR_COOL:18,CHROME_H265_RENDER_INFO_EMPTY:19,IS_NOT_SUPPORT_CONFIGURE:20,IS_NOT_SUPPORT_OS:21,AUDIO_DATA_NAN:22,AUDIO_FORMAT_ERROR:23,AUDIO_DATA_MUTE:24,IS_NOT_SUPPORT_CATEGORY:25,BROWSER_VERSION_NOT_SUPPORTED_WCS:26,BROWSER_VERSION_NOT_SUPPORTED_WCS_H265:27,BROWSER_VERSION_NOT_SUPPORTED_WCS_H264:28,VOD_AV1_CLOSE_CFg:29,NOT_SUPPORT_AUDIO_SAMPLERATE:30,SCREEN_COLOR:31,BROWSER_NAME_NOT_SUPPORTED_WCS_H265:32}},function(t,e,i){t.exports=function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=108)}([function(t,e,i){"use strict";e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e,i){"use strict";e.__esModule=!0;var s,r=(s=i(115))&&s.__esModule?s:{default:s};e.default=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),(0,r.default)(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(0)),r=a(i(1));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,s.default)(this,t),this.hasHeader=e,this.segments=[],this.data=null,this.totalLen=0,this.uri=0,this.hasHeader&&(this.pushUInt32(10),this.pushUInt32(this.uri),this.pushUInt16(200))}return(0,r.default)(t,[{key:"marshall",value:function(){if(0===this.segments.length)return null;this.data=new Uint8Array(this.totalLen);for(var t=0,e=0;e<this.segments.length;++e){var i=this.segments[e];this.data.set(i,t),t+=i.length}return this.hasHeader&&(this.replaceUInt32(0,this.totalLen),this.replaceUInt32(4,this.uri)),this.data}},{key:"setUri",value:function(t){this.uri=t}},{key:"replaceUInt32",value:function(t,e){new DataView(this.data.buffer).setUint32(t,e,!0)}},{key:"pushBool",value:function(t){this.pushUInt8(t?1:0)}},{key:"pushUInt8",value:function(t){var e=new Uint8Array(1);new DataView(e.buffer).setUint8(0,t),this.segments.push(e),this.totalLen++}},{key:"pushUInt16",value:function(t){var e=new Uint8Array(2);new DataView(e.buffer).setUint16(0,t,!0),this.segments.push(e),this.totalLen+=2}},{key:"pushUInt32",value:function(t){var e=new Uint8Array(4);new DataView(e.buffer).setUint32(0,t,!0),this.segments.push(e),this.totalLen+=4}},{key:"pushUInt64",value:function(t){var e=new Uint8Array(8),i=new DataView(e.buffer),s=t%4294967296,r=t/4294967296>>0;i.setUint32(0,s,!0),i.setUint32(4,r,!0),this.segments.push(e),this.totalLen+=8}},{key:"pushUint8Array",value:function(t){this.pushUInt16(t.length),this.segments.push(t),this.totalLen+=t.length}},{key:"pushUint8ArrayWithoutLen",value:function(t){this.segments.push(t),this.totalLen+=t.length}},{key:"pushUint8Array32",value:function(t){this.pushUInt32(t.length),this.segments.push(t),this.totalLen+=t.length}},{key:"pushUInt32Vector",value:function(t){this.pushUInt32(t.length);for(var e=0;e<t.length;e++)this.pushUInt32(t[e])}},{key:"pushUInt64Vector",value:function(t){this.pushUInt32(t.length);for(var e=0;e<t.length;e++)this.pushUInt64(t[e])}},{key:"pushUInt16Vector",value:function(t){this.pushUInt32(t.length);for(var e=0;e<t.length;e++)this.pushUInt16(t[e])}},{key:"popObjVector",value:function(t){for(var e=this.popUInt32(),i=[],s=0;s<e;s++){var r=new t;i.push(r.unmarshall(this))}return i}},{key:"pushString",value:function(t){this.pushUInt16(t.length);for(var e=new Uint8Array(t.length),i=new DataView(e.buffer),s=0;s<t.length;++s)i.setUint8(s,t.charCodeAt(s));this.segments.push(e),this.totalLen+=t.length}},{key:"pushString32",value:function(t){this.pushUInt32(t.length);for(var e=new Uint8Array(t.length),i=new DataView(e.buffer),s=0;s<t.length;++s)i.setUint8(s,t.charCodeAt(s));this.segments.push(e),this.totalLen+=t.length}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={PAudienceGetProxyListReq:530178,PAudienceGetProxyListRsp:530434,PNotifyStreamSwitch:268034,PLoginVideoProxyUniformly:5650690,PLoginVideoProxyUniformlyRes:5650434,PNotifyCurrentCdnStream:2739202,PNotifyCurrentStream4:2675714,PSubscribeStream3:2667266,PSubscribeStreamRes3:2667522,PStreamData3:2666754,PStopStream3:2666498,PStopStream:2560514,PPullStreamData:2694146,PResendStreamData4:2689026,PResendStreamDataFailAck:2694402,PVideoSyncSpeakerTime3:2674690,PForceConnectVideoProxy3:2685442,PVideoProxyPing3:2669570,PVideoProxyPingRes4:2683650,PNotifyMultiVideo:2746370,PLoginAndSubscribe:4097282,PLoginAndSubscribeRes:4097538,PNotifyUplinkRecvCount3:2672642,PVideoBroadcast4:2754050,PUpdateVideoConfig2:2569474,PVideoQualityStatistics:2591746,PP2pPing2:40706,PP2pPing3:41218,PP2pVideoPing3:2671874,VIDEOP2P_PFlashP2PKeepAlive:3072514,VIDEOP2P_PFlashP2PKeepAliveRes:3072770,P2PGetNodesProxy3:2673410,P2PGetNodesProxyRes3:2673666,P2PSubscribeStream3:2673922,P2PRemoveSubscribe3:2674178,P2PKeepAlive:3074562,P2PKeepAliveRes:3074818,P2PNotifyNodeLeave:3075074,P2PSyncDepth:3075330,P2PKeepAliveWebrtc:3075842,P2PKeepAliveWebrtcRes:3076098,PP2PWSForward:2757378,PP2PWSForwardReject:5653506,P2PSubStream:3073026,P2PSubStreamRes:3073282,P2PSyncSubTree:3073538,P2PTest:3073794,P2PRemoveSub:3074306,P2PRemoveSubRes:3075586,P2PStreamAlive:3076354,P2POffer:12316162,P2PAnswer:12316418,P2PCandidate:12316674,P2POfferReject:12316930,P2PRequestOffer:12317186,P2PVersionFailed:12317442,P2PPingOverProxy:12317698,P2PPunchBackReq:12317954,P2PPunchBackRsp:12318210,PCDNNotifyUrl:20740866,PCDNStatusReport:20741122,PCDNGetUrl:20741378,PCDNSwitchUrl:20741634,PCdnP2PWSForward:53283,PCdnP2PWSForwardReject:53539,PCdnProxyPing:26147,PCdnProxyPingRes:26403,PCdnP2PStatics:26659,PCdnP2PErrStatics:26915,PCdnP2pGetNode:51235,PCdnP2pGetNodeRes:51491,PCdnP2PNodePingThroughProxy:52259,PCdnP2PNodePunchThroughProxy:52515,PCdnP2PUserRegister:52771,PCdnP2PUserRegisterRes:53027,PCdnP2pReportLog:54051,PCdnForceConnectVideoProxy:54563,PCDNGetProxyListReq:153635,PCDNGetProxyListRsp:153891,PCDNGetSliceStreamInfoReq:154147,PCDNGetSliceStreamInfoRsp:154403,PCDNSubscribeReq:768547,PCDNSubscribeRes:768803,PCDNCompeteSubscribeReq:769059,PCDNCompeteSubscribeRes:769315,PCDNForceSubscribeNotify:769571,PCdnP2pUserUnRegister:770083,PP2pSliceData:511779,PP2pSliceAudioData:512035,PP2pSliceVideoData:512291,PP2pSliceCommonData:514083,PP2pSliceSignalData:514595,PP2pSliceAudioDataV2:517411,PP2pSliceAudioDataV3:517667,PP2pSliceControlData:1024547,PForceConnectCdnVideoProxy3:2711042,HuyaDelaySeiData:17920770};!function t(){if(!t.done){t.done=!0;var e=[];for(var i in s){var r=s[i];e.push({uri:r,name:i})}e.forEach((function(t){s[t.uri]=t.name}))}}(),e.default=s},function(t,e){var i=t.exports={version:"2.6.12"};"number"==typeof __e&&(__e=i)},function(t,e,i){var s=i(8),r=i(4),a=i(17),o=i(12),n=i(14),h=function(t,e,i){var d,l,u,c=t&h.F,p=t&h.G,m=t&h.S,f=t&h.P,_=t&h.B,g=t&h.W,S=p?r:r[e]||(r[e]={}),T=S.prototype,y=p?s:m?s[e]:(s[e]||{}).prototype;for(d in p&&(i=e),i)(l=!c&&y&&void 0!==y[d])&&n(S,d)||(u=l?y[d]:i[d],S[d]=p&&"function"!=typeof y[d]?i[d]:_&&l?a(u,s):g&&y[d]==u?function(t){var e=function(e,i,s){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,i)}return new t(e,i,s)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(u):f&&"function"==typeof u?a(Function.call,u):u,f&&((S.virtual||(S.virtual={}))[d]=u,t&h.R&&T&&!T[d]&&o(T,d,u)))};h.F=1,h.G=2,h.S=4,h.P=8,h.B=16,h.W=32,h.U=64,h.R=128,t.exports=h},function(t,e,i){t.exports=!i(15)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(t,e,i){var s=i(43)("wks"),r=i(28),a=i(8).Symbol,o="function"==typeof a;(t.exports=function(t){return s[t]||(s[t]=o&&a[t]||(o?a:r)("Symbol."+t))}).store=s},function(t,e){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(t,e,i){var s=i(13),r=i(75),a=i(44),o=Object.defineProperty;e.f=i(6)?Object.defineProperty:function(t,e,i){if(s(t),e=a(e,!0),s(i),r)try{return o(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},function(t,e,i){t.exports={default:i(142),__esModule:!0}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,i){var s=i(9),r=i(29);t.exports=i(6)?function(t,e,i){return s.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},function(t,e,i){var s=i(11);t.exports=function(t){if(!s(t))throw TypeError(t+" is not an object!");return t}},function(t,e){var i={}.hasOwnProperty;t.exports=function(t,e){return i.call(t,e)}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={logger:null}},function(t,e,i){var s=i(74);t.exports=function(t,e,i){if(s(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,s){return t.call(e,i,s)};case 3:return function(i,s,r){return t.call(e,i,s,r)}}return function(){return t.apply(e,arguments)}}},function(t,e,i){var s=i(48),r=i(41);t.exports=function(t){return s(r(t))}},function(t,e,i){"use strict";function s(t,e){var i=t.toString().length,s=Math.max(0,e-i),r="";if(s>0)for(var a=0;a<s;a++)r+="0";return r+t}Object.defineProperty(e,"__esModule",{value:!0});var r=0,a={now:function(){if(void 0!==window.performance){var t=window.performance;if(void 0!==t.now)return~~t.now();if(void 0!==t.webkitNow)return~~t.webkitNow();if(void 0!==t.mozNow)return~~t.mozNow();if(void 0!==t.msNow)return~~t.msNow()}0===r&&(r=Date.now()-1);var e=Date.now()-r;return e>4294967295?(r+=4294967295,e-4294967295):e},utc:function(){return Math.round(Date.now()/1e3)},getDateStr:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,e=null,i=(e=t?new Date(t):new Date).getFullYear(),r=s(e.getMonth()+1,2),a=s(e.getDate(),2);return i+"-"+r+"-"+a},getTimeStr:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null,r=s((i=t?new Date(t):new Date).getHours(),2),a=s(i.getMinutes(),2),o=s(i.getSeconds(),2),n=r+":"+a+":"+o;if(e){var h=s(i.getMilliseconds(),3);n+="."+h}return n},getDateTimeStr:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null,r=(i=t?new Date(t):new Date).getFullYear(),a=s(i.getMonth()+1,2),o=s(i.getDate(),2),n=s(i.getHours(),2),h=s(i.getMinutes(),2),d=s(i.getSeconds(),2),l=r+"-"+a+"-"+o+" "+n+":"+h+":"+d;if(e){var u=s(i.getMilliseconds(),3);l+="."+u}return l}};e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(58)),o=n(i(2));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.streamName="",this.codecType=0,this.cdnBrand=0}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new o.default(!1);return t.pushString(this.streamName),t.pushUInt16(this.codecType),t.pushUInt16(this.cdnBrand),t.marshall()}},{key:"unmarshall",value:function(t){return this.streamName=t.popString(),this.codecType=t.popUInt16(),this.cdnBrand=t.popUInt16(),this}},{key:"getDefCodecRate",value:function(){return this.codecType>=a.default.VIDEO_264_START&&this.codecType<=a.default.VIDEO_H264_END?100*(this.codecType-a.default.VIDEO_264_START):this.codecType>=a.default.VIDEO_265_START&&this.codecType<=a.default.VIDEO_H265_END?100*(this.codecType-a.default.VIDEO_265_START):128}},{key:"text",value:function(){return this.streamName+"_"+this.codecType+"_"+this.cdnBrand}},{key:"equal",value:function(t){return!!t&&this.streamName==t.streamName&&this.codecType==t.codecType&&this.cdnBrand==t.cdnBrand}},{key:"isValidID",get:function(){return this.codecType>0}},{key:"isH264",get:function(){return this.codecType>=a.default.VIDEO_264_START&&this.codecType<=a.default.VIDEO_H264_END}},{key:"isH265",get:function(){return this.codecType>=a.default.VIDEO_265_START&&this.codecType<=a.default.VIDEO_H265_END}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={},r={setTaf:function(t){return s=t}};e.default=r,r.UserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sHuYaUA="",this.sCookie="",this.iTokenType=0},r.UserId.prototype._clone=function(){return new r.UserId},r.UserId.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.UserId.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.UserId.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sGuid),t.writeString(2,this.sToken),t.writeString(3,this.sHuYaUA),t.writeString(4,this.sCookie),t.writeInt32(5,this.iTokenType)},r.UserId.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sGuid=t.readString(1,!1,this.sGuid),this.sToken=t.readString(2,!1,this.sToken),this.sHuYaUA=t.readString(3,!1,this.sHuYaUA),this.sCookie=t.readString(4,!1,this.sCookie),this.iTokenType=t.readInt32(5,!1,this.iTokenType)},r.VideoGatewayProxy2VGPingReq=function(){this.lLocalTime=0},r.VideoGatewayProxy2VGPingReq.prototype._clone=function(){return new r.VideoGatewayProxy2VGPingReq},r.VideoGatewayProxy2VGPingReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.VideoGatewayProxy2VGPingReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.VideoGatewayProxy2VGPingReq.prototype.writeTo=function(t){t.writeInt64(0,this.lLocalTime)},r.VideoGatewayProxy2VGPingReq.prototype.readFrom=function(t){this.lLocalTime=t.readInt64(0,!1,this.lLocalTime)},r.VideoGatewayProxy2VGPingRsp=function(){this.lLocalTime=0},r.VideoGatewayProxy2VGPingRsp.prototype._clone=function(){return new r.VideoGatewayProxy2VGPingRsp},r.VideoGatewayProxy2VGPingRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.VideoGatewayProxy2VGPingRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.VideoGatewayProxy2VGPingRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lLocalTime)},r.VideoGatewayProxy2VGPingRsp.prototype.readFrom=function(t){this.lLocalTime=t.readInt64(0,!1,this.lLocalTime)},r.GetInfoFromVGReq=function(){this.lUid=0,this.iServiceType=0,this.iClientType=0,this.iClientIp=0,this.iTerminalType=0,this.iRequestVPType=0,this.sMsg=new s.BinBuffer,this.iUri=0,this.sProtoName="",this.lSid=0,this.vStreamName=new s.Vector(new s.STRING),this.tId=new r.UserId},r.GetInfoFromVGReq.prototype._clone=function(){return new r.GetInfoFromVGReq},r.GetInfoFromVGReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetInfoFromVGReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetInfoFromVGReq.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeInt32(1,this.iServiceType),t.writeInt32(2,this.iClientType),t.writeInt64(3,this.iClientIp),t.writeInt32(4,this.iTerminalType),t.writeInt32(5,this.iRequestVPType),t.writeBytes(6,this.sMsg),t.writeInt64(7,this.iUri),t.writeString(8,this.sProtoName),t.writeInt64(9,this.lSid),t.writeVector(10,this.vStreamName),t.writeStruct(11,this.tId)},r.GetInfoFromVGReq.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.iServiceType=t.readInt32(1,!1,this.iServiceType),this.iClientType=t.readInt32(2,!1,this.iClientType),this.iClientIp=t.readInt64(3,!1,this.iClientIp),this.iTerminalType=t.readInt32(4,!1,this.iTerminalType),this.iRequestVPType=t.readInt32(5,!1,this.iRequestVPType),this.sMsg=t.readBytes(6,!1,this.sMsg),this.iUri=t.readInt64(7,!1,this.iUri),this.sProtoName=t.readString(8,!1,this.sProtoName),this.lSid=t.readInt64(9,!1,this.lSid),this.vStreamName=t.readVector(10,!1,this.vStreamName),this.tId=t.readStruct(11,!1,this.tId)},r.GetInfoFromVGRsp=function(){this.lUid=0,this.ServerId=0,this.sMsg=new s.BinBuffer,this.iUri=0,this.sProtoName=""},r.GetInfoFromVGRsp.prototype._clone=function(){return new r.GetInfoFromVGRsp},r.GetInfoFromVGRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetInfoFromVGRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetInfoFromVGRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeInt64(1,this.ServerId),t.writeBytes(2,this.sMsg),t.writeInt64(3,this.iUri),t.writeString(4,this.sProtoName)},r.GetInfoFromVGRsp.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.ServerId=t.readInt64(1,!1,this.ServerId),this.sMsg=t.readBytes(2,!1,this.sMsg),this.iUri=t.readInt64(3,!1,this.iUri),this.sProtoName=t.readString(4,!1,this.sProtoName)},r.GetCdnTokenExReq=function(){this.sFlvUrl="",this.sStreamName="",this.iLoopTime=0,this.tId=new r.UserId,this.iAppId=66},r.GetCdnTokenExReq.prototype._clone=function(){return new r.GetCdnTokenExReq},r.GetCdnTokenExReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetCdnTokenExReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetCdnTokenExReq.prototype.writeTo=function(t){t.writeString(0,this.sFlvUrl),t.writeString(1,this.sStreamName),t.writeInt32(2,this.iLoopTime),t.writeStruct(3,this.tId),t.writeInt32(4,this.iAppId)},r.GetCdnTokenExReq.prototype.readFrom=function(t){this.sFlvUrl=t.readString(0,!1,this.sFlvUrl),this.sStreamName=t.readString(1,!1,this.sStreamName),this.iLoopTime=t.readInt32(2,!1,this.iLoopTime),this.tId=t.readStruct(3,!1,this.tId),this.iAppId=t.readInt32(4,!1,this.iAppId)},r.GetCdnTokenExRsp=function(){this.sFlvToken="",this.iExpireTime=0},r.GetCdnTokenExRsp.prototype._clone=function(){return new r.GetCdnTokenExRsp},r.GetCdnTokenExRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetCdnTokenExRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetCdnTokenExRsp.prototype.writeTo=function(t){t.writeString(0,this.sFlvToken),t.writeInt32(1,this.iExpireTime)},r.GetCdnTokenExRsp.prototype.readFrom=function(t){this.sFlvToken=t.readString(0,!1,this.sFlvToken),this.iExpireTime=t.readInt32(1,!1,this.iExpireTime)},r.LiveScenarioType={ECommon_Live:0,EAudio_Only:1,EVideo_Only:2,ELink_Live:3},r.LimitedStreamInfo=function(){this.iVerMin=0,this.iVerMax=0,this.sCdnType="",this.iIsMaster=0,this.lChannelId=0,this.lSubChannelId=0,this.lPresenterUid=0,this.sStreamName="",this.sFlvUrl="",this.sFlvUrlSuffix="",this.sFlvAntiCode="",this.sHlsUrl="",this.sHlsUrlSuffix="",this.sHlsAntiCode="",this.iLineIndex=0,this.iIsMultiStream=0,this.iPCPriorityRate=0,this.iWebPriorityRate=0,this.iMobilePriorityRate=0,this.vFlvIPList=new s.Vector(new s.STRING),this.iIsP2PSupport=0,this.sP2pUrl="",this.sP2pUrlSuffix="",this.sP2pAntiCode="",this.lFreeFlag=0},r.LimitedStreamInfo.prototype._clone=function(){return new r.LimitedStreamInfo},r.LimitedStreamInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LimitedStreamInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LimitedStreamInfo.prototype.writeTo=function(t){t.writeInt32(0,this.iVerMin),t.writeInt32(1,this.iVerMax),t.writeString(2,this.sCdnType),t.writeInt32(3,this.iIsMaster),t.writeInt64(4,this.lChannelId),t.writeInt64(5,this.lSubChannelId),t.writeInt64(6,this.lPresenterUid),t.writeString(7,this.sStreamName),t.writeString(8,this.sFlvUrl),t.writeString(9,this.sFlvUrlSuffix),t.writeString(10,this.sFlvAntiCode),t.writeString(11,this.sHlsUrl),t.writeString(12,this.sHlsUrlSuffix),t.writeString(13,this.sHlsAntiCode),t.writeInt32(14,this.iLineIndex),t.writeInt32(15,this.iIsMultiStream),t.writeInt32(16,this.iPCPriorityRate),t.writeInt32(17,this.iWebPriorityRate),t.writeInt32(18,this.iMobilePriorityRate),t.writeVector(19,this.vFlvIPList),t.writeInt32(20,this.iIsP2PSupport),t.writeString(21,this.sP2pUrl),t.writeString(22,this.sP2pUrlSuffix),t.writeString(23,this.sP2pAntiCode),t.writeInt64(24,this.lFreeFlag)},r.LimitedStreamInfo.prototype.readFrom=function(t){this.iVerMin=t.readInt32(0,!1,this.iVerMin),this.iVerMax=t.readInt32(1,!1,this.iVerMax),this.sCdnType=t.readString(2,!1,this.sCdnType),this.iIsMaster=t.readInt32(3,!1,this.iIsMaster),this.lChannelId=t.readInt64(4,!1,this.lChannelId),this.lSubChannelId=t.readInt64(5,!1,this.lSubChannelId),this.lPresenterUid=t.readInt64(6,!1,this.lPresenterUid),this.sStreamName=t.readString(7,!1,this.sStreamName),this.sFlvUrl=t.readString(8,!1,this.sFlvUrl),this.sFlvUrlSuffix=t.readString(9,!1,this.sFlvUrlSuffix),this.sFlvAntiCode=t.readString(10,!1,this.sFlvAntiCode),this.sHlsUrl=t.readString(11,!1,this.sHlsUrl),this.sHlsUrlSuffix=t.readString(12,!1,this.sHlsUrlSuffix),this.sHlsAntiCode=t.readString(13,!1,this.sHlsAntiCode),this.iLineIndex=t.readInt32(14,!1,this.iLineIndex),this.iIsMultiStream=t.readInt32(15,!1,this.iIsMultiStream),this.iPCPriorityRate=t.readInt32(16,!1,this.iPCPriorityRate),this.iWebPriorityRate=t.readInt32(17,!1,this.iWebPriorityRate),this.iMobilePriorityRate=t.readInt32(18,!1,this.iMobilePriorityRate),this.vFlvIPList=t.readVector(19,!1,this.vFlvIPList),this.iIsP2PSupport=t.readInt32(20,!1,this.iIsP2PSupport),this.sP2pUrl=t.readString(21,!1,this.sP2pUrl),this.sP2pUrlSuffix=t.readString(22,!1,this.sP2pUrlSuffix),this.sP2pAntiCode=t.readString(23,!1,this.sP2pAntiCode),this.lFreeFlag=t.readInt64(24,!1,this.lFreeFlag)},r.ClassifiedStreamInfoPack=function(){this.iLiveScenarioType=0,this.vStreamInfo=new s.Vector(new r.LimitedStreamInfo),this.vCdnList=new s.Vector(new s.STRING),this.lLiveId=0,this.sLinkGroupId="",this.mStreamRatioWeb=new s.Map(new s.STRING,new s.INT32),this.mStreamRatioPC=new s.Map(new s.STRING,new s.INT32),this.mStreamRatioMobile=new s.Map(new s.STRING,new s.INT32)},r.ClassifiedStreamInfoPack.prototype._clone=function(){return new r.ClassifiedStreamInfoPack},r.ClassifiedStreamInfoPack.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClassifiedStreamInfoPack.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClassifiedStreamInfoPack.prototype.writeTo=function(t){t.writeInt32(0,this.iLiveScenarioType),t.writeVector(1,this.vStreamInfo),t.writeVector(2,this.vCdnList),t.writeInt64(3,this.lLiveId),t.writeString(4,this.sLinkGroupId),t.writeMap(5,this.mStreamRatioWeb),t.writeMap(6,this.mStreamRatioPC),t.writeMap(7,this.mStreamRatioMobile)},r.ClassifiedStreamInfoPack.prototype.readFrom=function(t){this.iLiveScenarioType=t.readInt32(0,!1,this.iLiveScenarioType),this.vStreamInfo=t.readVector(1,!1,this.vStreamInfo),this.vCdnList=t.readVector(2,!1,this.vCdnList),this.lLiveId=t.readInt64(3,!1,this.lLiveId),this.sLinkGroupId=t.readString(4,!1,this.sLinkGroupId),this.mStreamRatioWeb=t.readMap(5,!1,this.mStreamRatioWeb),this.mStreamRatioPC=t.readMap(6,!1,this.mStreamRatioPC),this.mStreamRatioMobile=t.readMap(7,!1,this.mStreamRatioMobile)},r.LivingStreamInfoNotice=function(){this.lPresenterUid=0,this.lLiveId=0,this.mStreamInfo=new s.Map(new s.INT32,new r.ClassifiedStreamInfoPack)},r.LivingStreamInfoNotice.prototype._clone=function(){return new r.LivingStreamInfoNotice},r.LivingStreamInfoNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LivingStreamInfoNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LivingStreamInfoNotice.prototype.writeTo=function(t){t.writeInt64(0,this.lPresenterUid),t.writeInt64(1,this.lLiveId),t.writeMap(2,this.mStreamInfo)},r.LivingStreamInfoNotice.prototype.readFrom=function(t){this.lPresenterUid=t.readInt64(0,!1,this.lPresenterUid),this.lLiveId=t.readInt64(1,!1,this.lLiveId),this.mStreamInfo=t.readMap(2,!1,this.mStreamInfo)},r.LivingStreamEndNotice=function(){this.sStreamName="",this.sCdnType="",this.iLineIndex=0,this.lLiveId=0,this.iLiveScenarioType=0},r.LivingStreamEndNotice.prototype._clone=function(){return new r.LivingStreamEndNotice},r.LivingStreamEndNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LivingStreamEndNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LivingStreamEndNotice.prototype.writeTo=function(t){t.writeString(0,this.sStreamName),t.writeString(1,this.sCdnType),t.writeInt32(2,this.iLineIndex),t.writeInt64(3,this.lLiveId),t.writeInt32(4,this.iLiveScenarioType)},r.LivingStreamEndNotice.prototype.readFrom=function(t){this.sStreamName=t.readString(0,!1,this.sStreamName),this.sCdnType=t.readString(1,!1,this.sCdnType),this.iLineIndex=t.readInt32(2,!1,this.iLineIndex),this.lLiveId=t.readInt64(3,!1,this.lLiveId),this.iLiveScenarioType=t.readInt32(4,!1,this.iLiveScenarioType)},r.GetLivingStreamInfoReq=function(){this.tId=new r.UserId,this.lTopSid=0,this.lSubSid=0,this.lPresenterUid=0,this.sTraceSource=""},r.GetLivingStreamInfoReq.prototype._clone=function(){return new r.GetLivingStreamInfoReq},r.GetLivingStreamInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetLivingStreamInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetLivingStreamInfoReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeInt64(1,this.lTopSid),t.writeInt64(2,this.lSubSid),t.writeInt64(3,this.lPresenterUid),t.writeString(4,this.sTraceSource)},r.GetLivingStreamInfoReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.lTopSid=t.readInt64(1,!1,this.lTopSid),this.lSubSid=t.readInt64(2,!1,this.lSubSid),this.lPresenterUid=t.readInt64(3,!1,this.lPresenterUid),this.sTraceSource=t.readString(4,!1,this.sTraceSource)},r.GetLivingStreamInfoRsp=function(){this.bIsLiving=0,this.tNotice=new r.LivingStreamInfoNotice,this.bIsSelfLiving=0},r.GetLivingStreamInfoRsp.prototype._clone=function(){return new r.GetLivingStreamInfoRsp},r.GetLivingStreamInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetLivingStreamInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetLivingStreamInfoRsp.prototype.writeTo=function(t){t.writeInt32(0,this.bIsLiving),t.writeStruct(1,this.tNotice),t.writeInt32(2,this.bIsSelfLiving)},r.GetLivingStreamInfoRsp.prototype.readFrom=function(t){this.bIsLiving=t.readInt32(0,!1,this.bIsLiving),this.tNotice=t.readStruct(1,!1,this.tNotice),this.bIsSelfLiving=t.readInt32(2,!1,this.bIsSelfLiving)},r.VideoClientReportReq=function(){this.iReportType=0,this.sReportString="",this.sMsg=new s.BinBuffer,this.lUid=0},r.VideoClientReportReq.prototype._clone=function(){return new r.VideoClientReportReq},r.VideoClientReportReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.VideoClientReportReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.VideoClientReportReq.prototype.writeTo=function(t){t.writeInt32(0,this.iReportType),t.writeString(1,this.sReportString),t.writeBytes(2,this.sMsg),t.writeInt64(3,this.lUid)},r.VideoClientReportReq.prototype.readFrom=function(t){this.iReportType=t.readInt32(0,!1,this.iReportType),this.sReportString=t.readString(1,!1,this.sReportString),this.sMsg=t.readBytes(2,!1,this.sMsg),this.lUid=t.readInt64(3,!1,this.lUid)},r.LiveMeetingSyncNotice=function(){this.tStat=new r.MeetingStat,this.vSeats=new s.Vector(new r.MeetingSeat),this.iVersion=0,this.sMessage=""},r.LiveMeetingSyncNotice.prototype._clone=function(){return new r.LiveMeetingSyncNotice},r.LiveMeetingSyncNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LiveMeetingSyncNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LiveMeetingSyncNotice.prototype.writeTo=function(t){t.writeStruct(0,this.tStat),t.writeVector(1,this.vSeats),t.writeInt32(2,this.iVersion),t.writeString(3,this.sMessage)},r.LiveMeetingSyncNotice.prototype.readFrom=function(t){this.tStat=t.readStruct(0,!1,this.tStat),this.vSeats=t.readVector(1,!1,this.vSeats),this.iVersion=t.readInt32(2,!1,this.iVersion),this.sMessage=t.readString(3,!1,this.sMessage)},r.MeetingStat=function(){this.lPresenterUid=0,this.sPresenterNick="",this.sPresenterAvatarUrl="",this.mpContext=new s.Map(new s.STRING,new s.STRING),this.iVersion=0,this.iCurAction=0,this.sPassword="",this.lSessionId=0,this.vApplyList=new s.Vector(new r.ApplyUser),this.iState=0,this.iSilence=0,this.iActiveTime=0,this.iLastSyncTime=0,this.mpUserSession=new s.Map(new s.INT64,new s.STRING),this.iBeginTime=0,this.iPresenterGender=0,this.tTransferRoom=new r.TransferLiveRoomState,this.iMode=0,this.iModeV2=0,this.iOfficialType=0},r.MeetingStat.prototype._clone=function(){return new r.MeetingStat},r.MeetingStat.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MeetingStat.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MeetingStat.prototype.writeTo=function(t){t.writeInt64(0,this.lPresenterUid),t.writeString(1,this.sPresenterNick),t.writeString(2,this.sPresenterAvatarUrl),t.writeMap(4,this.mpContext),t.writeInt32(5,this.iVersion),t.writeInt32(6,this.iCurAction),t.writeString(7,this.sPassword),t.writeInt64(8,this.lSessionId),t.writeVector(9,this.vApplyList),t.writeInt32(10,this.iState),t.writeInt32(11,this.iSilence),t.writeInt32(12,this.iActiveTime),t.writeInt32(13,this.iLastSyncTime),t.writeMap(14,this.mpUserSession),t.writeInt32(15,this.iBeginTime),t.writeInt32(16,this.iPresenterGender),t.writeStruct(17,this.tTransferRoom),t.writeInt32(18,this.iMode),t.writeInt32(19,this.iModeV2),t.writeInt32(20,this.iOfficialType)},r.MeetingStat.prototype.readFrom=function(t){this.lPresenterUid=t.readInt64(0,!1,this.lPresenterUid),this.sPresenterNick=t.readString(1,!1,this.sPresenterNick),this.sPresenterAvatarUrl=t.readString(2,!1,this.sPresenterAvatarUrl),this.mpContext=t.readMap(4,!1,this.mpContext),this.iVersion=t.readInt32(5,!1,this.iVersion),this.iCurAction=t.readInt32(6,!1,this.iCurAction),this.sPassword=t.readString(7,!1,this.sPassword),this.lSessionId=t.readInt64(8,!1,this.lSessionId),this.vApplyList=t.readVector(9,!1,this.vApplyList),this.iState=t.readInt32(10,!1,this.iState),this.iSilence=t.readInt32(11,!1,this.iSilence),this.iActiveTime=t.readInt32(12,!1,this.iActiveTime),this.iLastSyncTime=t.readInt32(13,!1,this.iLastSyncTime),this.mpUserSession=t.readMap(14,!1,this.mpUserSession),this.iBeginTime=t.readInt32(15,!1,this.iBeginTime),this.iPresenterGender=t.readInt32(16,!1,this.iPresenterGender),this.tTransferRoom=t.readStruct(17,!1,this.tTransferRoom),this.iMode=t.readInt32(18,!1,this.iMode),this.iModeV2=t.readInt32(19,!1,this.iModeV2),this.iOfficialType=t.readInt32(20,!1,this.iOfficialType)},r.MeetingSeat=function(){this.mpContext=new s.Map(new s.STRING,new s.STRING),this.iPos=0,this.iLocked=0,this.lUid=0,this.sNick="",this.sAvatarUrl="",this.iMute=0,this.iVersion=0,this.iCurAction=0,this.iActiveTime=0,this.iSilence=0,this.iGender=0,this.lOfferSeatTimeStamp=0,this.iSilenceTime=0,this.iMuteTime=0,this.iSeatType=0,this.iSeatTypeV2=0,this.sSeatUrl="",this.sCharm="",this.sName="",this.sSourceUrl="",this.sRippleUrl=""},r.MeetingSeat.prototype._clone=function(){return new r.MeetingSeat},r.MeetingSeat.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MeetingSeat.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MeetingSeat.prototype.writeTo=function(t){t.writeMap(0,this.mpContext),t.writeInt32(1,this.iPos),t.writeInt32(2,this.iLocked),t.writeInt64(3,this.lUid),t.writeString(4,this.sNick),t.writeString(5,this.sAvatarUrl),t.writeInt32(7,this.iMute),t.writeInt32(8,this.iVersion),t.writeInt32(9,this.iCurAction),t.writeInt32(10,this.iActiveTime),t.writeInt32(11,this.iSilence),t.writeInt32(12,this.iGender),t.writeInt64(13,this.lOfferSeatTimeStamp),t.writeInt32(14,this.iSilenceTime),t.writeInt32(15,this.iMuteTime),t.writeInt32(16,this.iSeatType),t.writeInt32(17,this.iSeatTypeV2),t.writeString(18,this.sSeatUrl),t.writeString(19,this.sCharm),t.writeString(20,this.sName),t.writeString(21,this.sSourceUrl),t.writeString(22,this.sRippleUrl)},r.MeetingSeat.prototype.readFrom=function(t){this.mpContext=t.readMap(0,!1,this.mpContext),this.iPos=t.readInt32(1,!1,this.iPos),this.iLocked=t.readInt32(2,!1,this.iLocked),this.lUid=t.readInt64(3,!1,this.lUid),this.sNick=t.readString(4,!1,this.sNick),this.sAvatarUrl=t.readString(5,!1,this.sAvatarUrl),this.iMute=t.readInt32(7,!1,this.iMute),this.iVersion=t.readInt32(8,!1,this.iVersion),this.iCurAction=t.readInt32(9,!1,this.iCurAction),this.iActiveTime=t.readInt32(10,!1,this.iActiveTime),this.iSilence=t.readInt32(11,!1,this.iSilence),this.iGender=t.readInt32(12,!1,this.iGender),this.lOfferSeatTimeStamp=t.readInt64(13,!1,this.lOfferSeatTimeStamp),this.iSilenceTime=t.readInt32(14,!1,this.iSilenceTime),this.iMuteTime=t.readInt32(15,!1,this.iMuteTime),this.iSeatType=t.readInt32(16,!1,this.iSeatType),this.iSeatTypeV2=t.readInt32(17,!1,this.iSeatTypeV2),this.sSeatUrl=t.readString(18,!1,this.sSeatUrl),this.sCharm=t.readString(19,!1,this.sCharm),this.sName=t.readString(20,!1,this.sName),this.sSourceUrl=t.readString(21,!1,this.sSourceUrl),this.sRippleUrl=t.readString(22,!1,this.sRippleUrl)},r.ApplyUser=function(){this.lUid=0,this.sNick="",this.sAvatarUrl="",this.lActiveTime=0,this.mpContext=new s.Map(new s.STRING,new s.STRING),this.iGender=0,this.sStreamName="",this.iSeatType=0},r.ApplyUser.prototype._clone=function(){return new r.ApplyUser},r.ApplyUser.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ApplyUser.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ApplyUser.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sNick),t.writeString(2,this.sAvatarUrl),t.writeInt64(3,this.lActiveTime),t.writeMap(4,this.mpContext),t.writeInt32(5,this.iGender),t.writeString(6,this.sStreamName),t.writeInt32(7,this.iSeatType)},r.ApplyUser.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sNick=t.readString(1,!1,this.sNick),this.sAvatarUrl=t.readString(2,!1,this.sAvatarUrl),this.lActiveTime=t.readInt64(3,!1,this.lActiveTime),this.mpContext=t.readMap(4,!1,this.mpContext),this.iGender=t.readInt32(5,!1,this.iGender),this.sStreamName=t.readString(6,!1,this.sStreamName),this.iSeatType=t.readInt32(7,!1,this.iSeatType)},r.TransferLiveRoomState=function(){this.lTargetUid=0,this.iInviteTime=0,this.iTokeOverTime=0,this.iBeginLiveTime=0,this.lNewLiveId=0,this.iInviteExpire=0,this.iState=0,this.iResult=0,this.iSuccessTime=0,this.sTargetNick=""},r.TransferLiveRoomState.prototype._clone=function(){return new r.TransferLiveRoomState},r.TransferLiveRoomState.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.TransferLiveRoomState.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.TransferLiveRoomState.prototype.writeTo=function(t){t.writeInt64(0,this.lTargetUid),t.writeInt32(1,this.iInviteTime),t.writeInt32(2,this.iTokeOverTime),t.writeInt32(3,this.iBeginLiveTime),t.writeInt64(4,this.lNewLiveId),t.writeInt32(5,this.iInviteExpire),t.writeInt32(6,this.iState),t.writeInt32(7,this.iResult),t.writeInt32(8,this.iSuccessTime),t.writeString(9,this.sTargetNick)},r.TransferLiveRoomState.prototype.readFrom=function(t){this.lTargetUid=t.readInt64(0,!1,this.lTargetUid),this.iInviteTime=t.readInt32(1,!1,this.iInviteTime),this.iTokeOverTime=t.readInt32(2,!1,this.iTokeOverTime),this.iBeginLiveTime=t.readInt32(3,!1,this.iBeginLiveTime),this.lNewLiveId=t.readInt64(4,!1,this.lNewLiveId),this.iInviteExpire=t.readInt32(5,!1,this.iInviteExpire),this.iState=t.readInt32(6,!1,this.iState),this.iResult=t.readInt32(7,!1,this.iResult),this.iSuccessTime=t.readInt32(8,!1,this.iSuccessTime),this.sTargetNick=t.readString(9,!1,this.sTargetNick)},r.GetP2PStreamInfoReq=function(){this.lUid=0,this.sStreamName="",this.iP2PType=0,this.sClientUA=""},r.GetP2PStreamInfoReq.prototype._clone=function(){return new r.GetP2PStreamInfoReq},r.GetP2PStreamInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetP2PStreamInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetP2PStreamInfoReq.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sStreamName),t.writeInt32(2,this.iP2PType),t.writeString(3,this.sClientUA)},r.GetP2PStreamInfoReq.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sStreamName=t.readString(1,!1,this.sStreamName),this.iP2PType=t.readInt32(2,!1,this.iP2PType),this.sClientUA=t.readString(3,!1,this.sClientUA)},r.GetP2PStreamInfoRsp=function(){this.lUid=0,this.sStreamName="",this.iP2PType=0,this.sP2PToken="",this.iP2PExpireTime=0,this.sP2PUrl="",this.sCodecType="",this.sCdnBrand="",this.mpOption=new s.Map(new s.INT16,new s.INT64),this.line=0},r.GetP2PStreamInfoRsp.prototype._clone=function(){return new r.GetP2PStreamInfoRsp},r.GetP2PStreamInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetP2PStreamInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetP2PStreamInfoRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sStreamName),t.writeInt32(2,this.iP2PType),t.writeString(3,this.sP2PToken),t.writeInt32(4,this.iP2PExpireTime),t.writeString(5,this.sP2PUrl),t.writeString(6,this.sCodecType),t.writeString(7,this.sCdnBrand),t.writeMap(8,this.mpOption),t.writeUInt8(9,this.line)},r.GetP2PStreamInfoRsp.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sStreamName=t.readString(1,!1,this.sStreamName),this.iP2PType=t.readInt32(2,!1,this.iP2PType),this.sP2PToken=t.readString(3,!1,this.sP2PToken),this.iP2PExpireTime=t.readInt32(4,!1,this.iP2PExpireTime),this.sP2PUrl=t.readString(5,!1,this.sP2PUrl),this.sCodecType=t.readString(6,!1,this.sCodecType),this.sCdnBrand=t.readString(7,!1,this.sCdnBrand),this.mpOption=t.readMap(8,!1,this.mpOption),this.line=t.readUInt8(9,!1,this.line)},r.GetP2PStreamTokenExReq=function(){this.sStreamName="",this.iLoopTime=0},r.GetP2PStreamTokenExReq.prototype._clone=function(){return new r.GetP2PStreamTokenExReq},r.GetP2PStreamTokenExReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetP2PStreamTokenExReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetP2PStreamTokenExReq.prototype.writeTo=function(t){t.writeString(0,this.sStreamName),t.writeInt32(1,this.iLoopTime)},r.GetP2PStreamTokenExReq.prototype.readFrom=function(t){this.sStreamName=t.readString(0,!1,this.sStreamName),this.iLoopTime=t.readInt32(1,!1,this.iLoopTime)},r.GetP2PStreamTokenExRsp=function(){this.sP2PToken="",this.iExpireTime=0},r.GetP2PStreamTokenExRsp.prototype._clone=function(){return new r.GetP2PStreamTokenExRsp},r.GetP2PStreamTokenExRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetP2PStreamTokenExRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetP2PStreamTokenExRsp.prototype.writeTo=function(t){t.writeString(0,this.sP2PToken),t.writeInt32(1,this.iExpireTime)},r.GetP2PStreamTokenExRsp.prototype.readFrom=function(t){this.sP2PToken=t.readString(0,!1,this.sP2PToken),this.iExpireTime=t.readInt32(1,!1,this.iExpireTime)},r.HttpDnsItem=function(){this.vIp=new s.Vector(new s.STRING),this.iExpireTime=0,this.vIpv6=new s.Vector(new s.STRING)},r.HttpDnsItem.prototype._clone=function(){return new r.HttpDnsItem},r.HttpDnsItem.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.HttpDnsItem.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.HttpDnsItem.prototype.writeTo=function(t){t.writeVector(0,this.vIp),t.writeInt64(1,this.iExpireTime),t.writeVector(2,this.vIpv6)},r.HttpDnsItem.prototype.readFrom=function(t){this.vIp=t.readVector(0,!1,this.vIp),this.iExpireTime=t.readInt64(1,!1,this.iExpireTime),this.vIpv6=t.readVector(2,!1,this.vIpv6)},r.QueryHttpDnsReq=function(){this.lUid=0,this.sUA="",this.vDomain=new s.Vector(new s.STRING),this.sAppSrc=""},r.QueryHttpDnsReq.prototype._clone=function(){return new r.QueryHttpDnsReq},r.QueryHttpDnsReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.QueryHttpDnsReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.QueryHttpDnsReq.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sUA),t.writeVector(2,this.vDomain),t.writeString(3,this.sAppSrc)},r.QueryHttpDnsReq.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sUA=t.readString(1,!1,this.sUA),this.vDomain=t.readVector(2,!1,this.vDomain),this.sAppSrc=t.readString(3,!1,this.sAppSrc)},r.QueryHttpDnsRsp=function(){this.mDomain2Ip=new s.Map(new s.STRING,new r.HttpDnsItem)},r.QueryHttpDnsRsp.prototype._clone=function(){return new r.QueryHttpDnsRsp},r.QueryHttpDnsRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.QueryHttpDnsRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.QueryHttpDnsRsp.prototype.writeTo=function(t){t.writeMap(0,this.mDomain2Ip)},r.QueryHttpDnsRsp.prototype.readFrom=function(t){this.mDomain2Ip=t.readMap(0,!1,this.mDomain2Ip)},r.WSTimeSyncReq=function(){this.sGuid="",this.lClientTime=0},r.WSTimeSyncReq.prototype._clone=function(){return new r.WSTimeSyncReq},r.WSTimeSyncReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.WSTimeSyncReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.WSTimeSyncReq.prototype.writeTo=function(t){t.writeString(0,this.sGuid),t.writeInt64(1,this.lClientTime)},r.WSTimeSyncReq.prototype.readFrom=function(t){this.sGuid=t.readString(0,!1,this.sGuid),this.lClientTime=t.readInt64(1,!1,this.lClientTime)},r.WSTimeSyncRsp=function(){this.lServerTime=0},r.WSTimeSyncRsp.prototype._clone=function(){return new r.WSTimeSyncRsp},r.WSTimeSyncRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.WSTimeSyncRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.WSTimeSyncRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lServerTime)},r.WSTimeSyncRsp.prototype.readFrom=function(t){this.lServerTime=t.readInt64(0,!1,this.lServerTime)},r.MediaUserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sUA="",this.sCookie="",this.iTokenType=0,this.iAppid=0,this.bAnonymous=0,this.sStrUid=""},r.MediaUserId.prototype._clone=function(){return new r.MediaUserId},r.MediaUserId.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MediaUserId.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MediaUserId.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sGuid),t.writeString(2,this.sToken),t.writeString(3,this.sUA),t.writeString(4,this.sCookie),t.writeInt32(5,this.iTokenType),t.writeInt32(6,this.iAppid),t.writeInt32(7,this.bAnonymous),t.writeString(8,this.sStrUid)},r.MediaUserId.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sGuid=t.readString(1,!1,this.sGuid),this.sToken=t.readString(2,!1,this.sToken),this.sUA=t.readString(3,!1,this.sUA),this.sCookie=t.readString(4,!1,this.sCookie),this.iTokenType=t.readInt32(5,!1,this.iTokenType),this.iAppid=t.readInt32(6,!1,this.iAppid),this.bAnonymous=t.readInt32(7,!1,this.bAnonymous),this.sStrUid=t.readString(8,!1,this.sStrUid)},r.LoginVerifyReq=function(){this.tId=new r.MediaUserId,this.iCookieDeadTime=0},r.LoginVerifyReq.prototype._clone=function(){return new r.LoginVerifyReq},r.LoginVerifyReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LoginVerifyReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LoginVerifyReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeInt32(1,this.iCookieDeadTime)},r.LoginVerifyReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.iCookieDeadTime=t.readInt32(1,!1,this.iCookieDeadTime)},r.LoginVerifyRsp=function(){this.iResCode=0,this.lUid=0,this.sCookie="",this.sUid="",this.iAppId=0},r.LoginVerifyRsp.prototype._clone=function(){return new r.LoginVerifyRsp},r.LoginVerifyRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.LoginVerifyRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.LoginVerifyRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iResCode),t.writeInt64(1,this.lUid),t.writeString(2,this.sCookie),t.writeString(3,this.sUid),t.writeInt32(4,this.iAppId)},r.LoginVerifyRsp.prototype.readFrom=function(t){this.iResCode=t.readInt32(0,!1,this.iResCode),this.lUid=t.readInt64(1,!1,this.lUid),this.sCookie=t.readString(2,!1,this.sCookie),this.sUid=t.readString(3,!1,this.sUid),this.iAppId=t.readInt32(4,!1,this.iAppId)},r.JoinMediaGroupReq=function(){this.tId=new r.MediaUserId,this.vGroupId=new s.Vector(new s.STRING)},r.JoinMediaGroupReq.prototype._clone=function(){return new r.JoinMediaGroupReq},r.JoinMediaGroupReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.JoinMediaGroupReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.JoinMediaGroupReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeVector(1,this.vGroupId)},r.JoinMediaGroupReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.vGroupId=t.readVector(1,!1,this.vGroupId)},r.JoinMediaGroupRsp=function(){this.iCode=0,this.sMsg="",this.vGroupId=new s.Vector(new s.STRING)},r.JoinMediaGroupRsp.prototype._clone=function(){return new r.JoinMediaGroupRsp},r.JoinMediaGroupRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.JoinMediaGroupRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.JoinMediaGroupRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iCode),t.writeString(1,this.sMsg),t.writeVector(2,this.vGroupId)},r.JoinMediaGroupRsp.prototype.readFrom=function(t){this.iCode=t.readInt32(0,!1,this.iCode),this.sMsg=t.readString(1,!1,this.sMsg),this.vGroupId=t.readVector(2,!1,this.vGroupId)},r.QuitMediaGroupReq=function(){this.tId=new r.MediaUserId,this.vGroupId=new s.Vector(new s.STRING)},r.QuitMediaGroupReq.prototype._clone=function(){return new r.QuitMediaGroupReq},r.QuitMediaGroupReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.QuitMediaGroupReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.QuitMediaGroupReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeVector(1,this.vGroupId)},r.QuitMediaGroupReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.vGroupId=t.readVector(1,!1,this.vGroupId)},r.QuitMediaGroupRsp=function(){this.iCode=0,this.sMsg="",this.vGroupId=new s.Vector(new s.STRING)},r.QuitMediaGroupRsp.prototype._clone=function(){return new r.QuitMediaGroupRsp},r.QuitMediaGroupRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.QuitMediaGroupRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.QuitMediaGroupRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iCode),t.writeString(1,this.sMsg),t.writeVector(2,this.vGroupId)},r.QuitMediaGroupRsp.prototype.readFrom=function(t){this.iCode=t.readInt32(0,!1,this.iCode),this.sMsg=t.readString(1,!1,this.sMsg),this.vGroupId=t.readVector(2,!1,this.vGroupId)},r.ikk=1,r.skk="123",r.eIType={k4AM:10001,k6AM:10002},r.EM_PCDN_MODE={E_PcdnMode_Min:0,E_PcdnMode_P2pHttpSubstream:1,E_PcdnMode_P2pOutsideSdkSubstream:2,E_PcdnMode_FlvHttpFullstream:3,E_PcdnMode_FlvOutsideSdkFullstream:4,E_PcdnMode_Max:255,E_PcdnVodMode_Http302:21},r.EM_BUSI_TYPE={E_BusiType_Min:0,E_BusiType_Live:1,E_BusiType_Max:255,E_BusiType_Vod:2},r.EM_CLINET_TYPE={E_CLIENT_MIN:0,E_CLIENT_PC:1,E_CLIENT_ADR:2,E_CLIENT_IOS:3,E_CLIENT_WEB:4,E_CLIENT_MAX:255,E_CLIENT_NFTV:5},r.ERR_CODE_FOR_HY_PCDNGW_CLIENT_RSP={E_SUCCESS:0,E_HYGW_ERR:1,E_PCDNGW_40X:2,E_PCDNGW_50X:3,E_PCDNGW_TIO:4,E_PCDNGW_RSPERR:5,E_CLIREQ_ERR:6,E_PCDN_OFF:7,E_LIMIT_FLOWS:8},r.MyReq=function(){this.name="",this.opt="",this.mMap=new s.Map(new s.STRING,new s.STRING)},r.MyReq.prototype._clone=function(){return new r.MyReq},r.MyReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MyReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MyReq.prototype.writeTo=function(t){t.writeString(0,this.name),t.writeString(1,this.opt),t.writeMap(2,this.mMap)},r.MyReq.prototype.readFrom=function(t){this.name=t.readString(0,!1,this.name),this.opt=t.readString(1,!1,this.opt),this.mMap=t.readMap(2,!1,this.mMap)},r.MyRsp=function(){this.value=0,this.origin=new r.MyReq,this.types=new s.Vector(new s.INT32),this.eType=0},r.MyRsp.prototype._clone=function(){return new r.MyRsp},r.MyRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MyRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MyRsp.prototype.writeTo=function(t){t.writeInt32(0,this.value),t.writeStruct(1,this.origin),t.writeVector(2,this.types),t.writeInt32(3,this.eType)},r.MyRsp.prototype.readFrom=function(t){this.value=t.readInt32(0,!1,this.value),this.origin=t.readStruct(1,!1,this.origin),this.types=t.readVector(2,!1,this.types),this.eType=t.readInt32(3,!1,this.eType)},r.ClientQueryPcdnScheduleReq=function(){this.lReqTs=0,this.lUid=0,this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.iCliType=0,this.lBucketPara=0,this.vPcdnMode=new s.Vector(new s.INT32),this.iBusiType=0,this.sStreamName="",this.mPcdnModeCliSupportPcdns=new s.Map(new s.INT32,new s.Vector(new s.STRING)),this.vSupportMode=new s.Vector(new s.INT32),this.sUserAgent="",this.iRatio=0,this.sCodec=""},r.ClientQueryPcdnScheduleReq.prototype._clone=function(){return new r.ClientQueryPcdnScheduleReq},r.ClientQueryPcdnScheduleReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientQueryPcdnScheduleReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientQueryPcdnScheduleReq.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lUid),t.writeString(2,this.sGuid),t.writeInt64(3,this.lAnchorUid),t.writeInt32(4,this.iCdnLine),t.writeInt32(5,this.iCliType),t.writeInt64(6,this.lBucketPara),t.writeVector(30,this.vPcdnMode),t.writeInt32(31,this.iBusiType),t.writeString(32,this.sStreamName),t.writeMap(100,this.mPcdnModeCliSupportPcdns),t.writeVector(101,this.vSupportMode),t.writeString(102,this.sUserAgent),t.writeInt32(103,this.iRatio),t.writeString(104,this.sCodec)},r.ClientQueryPcdnScheduleReq.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lUid=t.readInt64(1,!1,this.lUid),this.sGuid=t.readString(2,!1,this.sGuid),this.lAnchorUid=t.readInt64(3,!1,this.lAnchorUid),this.iCdnLine=t.readInt32(4,!1,this.iCdnLine),this.iCliType=t.readInt32(5,!1,this.iCliType),this.lBucketPara=t.readInt64(6,!1,this.lBucketPara),this.vPcdnMode=t.readVector(30,!1,this.vPcdnMode),this.iBusiType=t.readInt32(31,!1,this.iBusiType),this.sStreamName=t.readString(32,!1,this.sStreamName),this.mPcdnModeCliSupportPcdns=t.readMap(100,!1,this.mPcdnModeCliSupportPcdns),this.vSupportMode=t.readVector(101,!1,this.vSupportMode),this.sUserAgent=t.readString(102,!1,this.sUserAgent),this.iRatio=t.readInt32(103,!1,this.iRatio),this.sCodec=t.readString(104,!1,this.sCodec)},r.ClientQueryPcdnScheduleRsp=function(){this.lReqTs=0,this.lRspTs=0,this.iErrCode=0,this.mPcdnModeSwitch=new s.Map(new s.INT32,new s.INT32),this.cliProv="",this.cliIsp="",this.lUid=0,this.iCdnLine=0,this.sStreamName="",this.mPcdnModePcdnName=new s.Map(new s.INT32,new s.STRING)},r.ClientQueryPcdnScheduleRsp.prototype._clone=function(){return new r.ClientQueryPcdnScheduleRsp},r.ClientQueryPcdnScheduleRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientQueryPcdnScheduleRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientQueryPcdnScheduleRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lRspTs),t.writeInt32(2,this.iErrCode),t.writeMap(10,this.mPcdnModeSwitch),t.writeString(30,this.cliProv),t.writeString(31,this.cliIsp),t.writeInt64(100,this.lUid),t.writeInt32(101,this.iCdnLine),t.writeString(102,this.sStreamName),t.writeMap(200,this.mPcdnModePcdnName)},r.ClientQueryPcdnScheduleRsp.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lRspTs=t.readInt64(1,!1,this.lRspTs),this.iErrCode=t.readInt32(2,!1,this.iErrCode),this.mPcdnModeSwitch=t.readMap(10,!1,this.mPcdnModeSwitch),this.cliProv=t.readString(30,!1,this.cliProv),this.cliIsp=t.readString(31,!1,this.cliIsp),this.lUid=t.readInt64(100,!1,this.lUid),this.iCdnLine=t.readInt32(101,!1,this.iCdnLine),this.sStreamName=t.readString(102,!1,this.sStreamName),this.mPcdnModePcdnName=t.readMap(200,!1,this.mPcdnModePcdnName)},r.ClientGetStunAndPcdnProxyReq=function(){this.lReqTs=0,this.lUid=0,this.sStreamname="",this.iBaseSubs=0,this.vSub=new s.Vector(new s.INT32),this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.iCliType=0,this.lBucketPara=0,this.iBusiType=0,this.curPcdnName="",this.supportV6=0,this.retryCnt=0,this.sUserAgent="",this.iRatio=0,this.sCodec="",this.natType=9,this.recentMinutes=0,this.recentMiniPcdnFailedTimes=new s.Map(new s.INT32,new s.INT32),this.hotReqFlag=0,this.isSupportMiniPcdn=0,this.extMap=new s.Map(new s.STRING,new s.STRING)},r.ClientGetStunAndPcdnProxyReq.prototype._clone=function(){return new r.ClientGetStunAndPcdnProxyReq},r.ClientGetStunAndPcdnProxyReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetStunAndPcdnProxyReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetStunAndPcdnProxyReq.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lUid),t.writeString(2,this.sStreamname),t.writeInt32(3,this.iBaseSubs),t.writeVector(4,this.vSub),t.writeString(5,this.sGuid),t.writeInt64(6,this.lAnchorUid),t.writeInt32(7,this.iCdnLine),t.writeInt32(8,this.iCliType),t.writeInt64(9,this.lBucketPara),t.writeInt32(10,this.iBusiType),t.writeString(11,this.curPcdnName),t.writeInt32(12,this.supportV6),t.writeInt32(13,this.retryCnt),t.writeString(14,this.sUserAgent),t.writeInt32(15,this.iRatio),t.writeString(16,this.sCodec),t.writeInt32(17,this.natType),t.writeInt32(18,this.recentMinutes),t.writeMap(19,this.recentMiniPcdnFailedTimes),t.writeInt32(20,this.hotReqFlag),t.writeInt32(21,this.isSupportMiniPcdn),t.writeMap(22,this.extMap)},r.ClientGetStunAndPcdnProxyReq.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lUid=t.readInt64(1,!1,this.lUid),this.sStreamname=t.readString(2,!1,this.sStreamname),this.iBaseSubs=t.readInt32(3,!1,this.iBaseSubs),this.vSub=t.readVector(4,!1,this.vSub),this.sGuid=t.readString(5,!1,this.sGuid),this.lAnchorUid=t.readInt64(6,!1,this.lAnchorUid),this.iCdnLine=t.readInt32(7,!1,this.iCdnLine),this.iCliType=t.readInt32(8,!1,this.iCliType),this.lBucketPara=t.readInt64(9,!1,this.lBucketPara),this.iBusiType=t.readInt32(10,!1,this.iBusiType),this.curPcdnName=t.readString(11,!1,this.curPcdnName),this.supportV6=t.readInt32(12,!1,this.supportV6),this.retryCnt=t.readInt32(13,!1,this.retryCnt),this.sUserAgent=t.readString(14,!1,this.sUserAgent),this.iRatio=t.readInt32(15,!1,this.iRatio),this.sCodec=t.readString(16,!1,this.sCodec),this.natType=t.readInt32(17,!1,this.natType),this.recentMinutes=t.readInt32(18,!1,this.recentMinutes),this.recentMiniPcdnFailedTimes=t.readMap(19,!1,this.recentMiniPcdnFailedTimes),this.hotReqFlag=t.readInt32(20,!1,this.hotReqFlag),this.isSupportMiniPcdn=t.readInt32(21,!1,this.isSupportMiniPcdn),this.extMap=t.readMap(22,!1,this.extMap)},r.PCdnProxyUrl=function(){this.sProtocol="",this.vUrl=new s.Vector(new s.STRING),this.iStatusPcdn=0,this.iPcdnThresholdHotDegreeIn=-1,this.iPcdnThresholdHotDegreeKick=-1,this.iPcdnNowHotDegree=-1,this.iPcdnNowPullstreamUcnt=-1,this.iPcdnNowGetpcdnUcnt=-1},r.PCdnProxyUrl.prototype._clone=function(){return new r.PCdnProxyUrl},r.PCdnProxyUrl.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.PCdnProxyUrl.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.PCdnProxyUrl.prototype.writeTo=function(t){t.writeString(0,this.sProtocol),t.writeVector(2,this.vUrl),t.writeInt32(3,this.iStatusPcdn),t.writeInt32(10,this.iPcdnThresholdHotDegreeIn),t.writeInt32(11,this.iPcdnThresholdHotDegreeKick),t.writeInt32(12,this.iPcdnNowHotDegree),t.writeInt32(13,this.iPcdnNowPullstreamUcnt),t.writeInt32(14,this.iPcdnNowGetpcdnUcnt)},r.PCdnProxyUrl.prototype.readFrom=function(t){this.sProtocol=t.readString(0,!1,this.sProtocol),this.vUrl=t.readVector(2,!1,this.vUrl),this.iStatusPcdn=t.readInt32(3,!1,this.iStatusPcdn),this.iPcdnThresholdHotDegreeIn=t.readInt32(10,!1,this.iPcdnThresholdHotDegreeIn),this.iPcdnThresholdHotDegreeKick=t.readInt32(11,!1,this.iPcdnThresholdHotDegreeKick),this.iPcdnNowHotDegree=t.readInt32(12,!1,this.iPcdnNowHotDegree),this.iPcdnNowPullstreamUcnt=t.readInt32(13,!1,this.iPcdnNowPullstreamUcnt),this.iPcdnNowGetpcdnUcnt=t.readInt32(14,!1,this.iPcdnNowGetpcdnUcnt)},r.ClientGetStunAndPcdnProxyRsp=function(){this.lReqTs=0,this.lRspTs=0,this.lUid=0,this.sStreamname="",this.iErrCode=0,this.iBaseSubs=0,this.mSubToPullStreamUrl=new s.Map(new s.INT32,new s.Map(new s.STRING,new r.PCdnProxyUrl)),this.cliProv="",this.cliIsp="",this.pcdnName="",this.iCdnLine=0,this.sPcdnIsp="",this.sPcdnArea="",this.requestGap=0,this.subIndexPcdnName=new s.Map(new s.INT32,new s.STRING),this.minipcdnFailedTimesLimit=3,this.expectPcdnNane="",this.extMap=new s.Map(new s.STRING,new s.STRING)},r.ClientGetStunAndPcdnProxyRsp.prototype._clone=function(){return new r.ClientGetStunAndPcdnProxyRsp},r.ClientGetStunAndPcdnProxyRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetStunAndPcdnProxyRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetStunAndPcdnProxyRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lRspTs),t.writeInt64(2,this.lUid),t.writeString(3,this.sStreamname),t.writeInt32(4,this.iErrCode),t.writeInt32(5,this.iBaseSubs),t.writeMap(12,this.mSubToPullStreamUrl),t.writeString(13,this.cliProv),t.writeString(14,this.cliIsp),t.writeString(15,this.pcdnName),t.writeInt32(100,this.iCdnLine),t.writeString(200,this.sPcdnIsp),t.writeString(201,this.sPcdnArea),t.writeInt32(210,this.requestGap),t.writeMap(211,this.subIndexPcdnName),t.writeInt32(212,this.minipcdnFailedTimesLimit),t.writeString(213,this.expectPcdnNane),t.writeMap(214,this.extMap)},r.ClientGetStunAndPcdnProxyRsp.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lRspTs=t.readInt64(1,!1,this.lRspTs),this.lUid=t.readInt64(2,!1,this.lUid),this.sStreamname=t.readString(3,!1,this.sStreamname),this.iErrCode=t.readInt32(4,!1,this.iErrCode),this.iBaseSubs=t.readInt32(5,!1,this.iBaseSubs),this.mSubToPullStreamUrl=t.readMap(12,!1,this.mSubToPullStreamUrl),this.cliProv=t.readString(13,!1,this.cliProv),this.cliIsp=t.readString(14,!1,this.cliIsp),this.pcdnName=t.readString(15,!1,this.pcdnName),this.iCdnLine=t.readInt32(100,!1,this.iCdnLine),this.sPcdnIsp=t.readString(200,!1,this.sPcdnIsp),this.sPcdnArea=t.readString(201,!1,this.sPcdnArea),this.requestGap=t.readInt32(210,!1,this.requestGap),this.subIndexPcdnName=t.readMap(211,!1,this.subIndexPcdnName),this.minipcdnFailedTimesLimit=t.readInt32(212,!1,this.minipcdnFailedTimesLimit),this.expectPcdnNane=t.readString(213,!1,this.expectPcdnNane),this.extMap=t.readMap(214,!1,this.extMap)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq=function(){this.lReqTs=0,this.lUid=0,this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.sStreamname="",this.iBaseSubs=0,this.vSub=new s.Vector(new s.INT32),this.iCliType=0,this.lBucketPara=0,this.iBusiType=0,this.vCliSupportPcdns=new s.Vector(new s.STRING),this.curPcdnName=""},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype._clone=function(){return new r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lUid),t.writeString(2,this.sGuid),t.writeInt64(3,this.lAnchorUid),t.writeInt32(4,this.iCdnLine),t.writeString(5,this.sStreamname),t.writeInt32(6,this.iBaseSubs),t.writeVector(7,this.vSub),t.writeInt32(8,this.iCliType),t.writeInt64(9,this.lBucketPara),t.writeInt32(10,this.iBusiType),t.writeVector(11,this.vCliSupportPcdns),t.writeString(12,this.curPcdnName)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lUid=t.readInt64(1,!1,this.lUid),this.sGuid=t.readString(2,!1,this.sGuid),this.lAnchorUid=t.readInt64(3,!1,this.lAnchorUid),this.iCdnLine=t.readInt32(4,!1,this.iCdnLine),this.sStreamname=t.readString(5,!1,this.sStreamname),this.iBaseSubs=t.readInt32(6,!1,this.iBaseSubs),this.vSub=t.readVector(7,!1,this.vSub),this.iCliType=t.readInt32(8,!1,this.iCliType),this.lBucketPara=t.readInt64(9,!1,this.lBucketPara),this.iBusiType=t.readInt32(10,!1,this.iBusiType),this.vCliSupportPcdns=t.readVector(11,!1,this.vCliSupportPcdns),this.curPcdnName=t.readString(12,!1,this.curPcdnName)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp=function(){this.lReqTs=0,this.lRspTs=0,this.iErrCode=0,this.sPcdnName="",this.mP2pSubstreamUrl=new s.Map(new s.INT32,new s.STRING),this.cliProv="",this.cliIsp="",this.lUid=0,this.iCdnLine=0,this.sStreamname=""},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype._clone=function(){return new r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lRspTs),t.writeInt32(2,this.iErrCode),t.writeString(10,this.sPcdnName),t.writeMap(11,this.mP2pSubstreamUrl),t.writeString(30,this.cliProv),t.writeString(31,this.cliIsp),t.writeInt64(100,this.lUid),t.writeInt32(101,this.iCdnLine),t.writeString(102,this.sStreamname)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lRspTs=t.readInt64(1,!1,this.lRspTs),this.iErrCode=t.readInt32(2,!1,this.iErrCode),this.sPcdnName=t.readString(10,!1,this.sPcdnName),this.mP2pSubstreamUrl=t.readMap(11,!1,this.mP2pSubstreamUrl),this.cliProv=t.readString(30,!1,this.cliProv),this.cliIsp=t.readString(31,!1,this.cliIsp),this.lUid=t.readInt64(100,!1,this.lUid),this.iCdnLine=t.readInt32(101,!1,this.iCdnLine),this.sStreamname=t.readString(102,!1,this.sStreamname)},r.ClientGetPcdnFlvHttpFullstreamInfoReq=function(){this.lReqTs=0,this.lUid=0,this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.iCliType=0,this.sStreamName="",this.iRatio=0,this.sCodec="",this.lBucketPara=0,this.iBusiType=0,this.curPcdnName="",this.supportV6=0,this.sUserAgent=""},r.ClientGetPcdnFlvHttpFullstreamInfoReq.prototype._clone=function(){return new r.ClientGetPcdnFlvHttpFullstreamInfoReq},r.ClientGetPcdnFlvHttpFullstreamInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnFlvHttpFullstreamInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnFlvHttpFullstreamInfoReq.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lUid),t.writeString(2,this.sGuid),t.writeInt64(3,this.lAnchorUid),t.writeInt32(4,this.iCdnLine),t.writeInt32(5,this.iCliType),t.writeString(6,this.sStreamName),t.writeInt32(7,this.iRatio),t.writeString(8,this.sCodec),t.writeInt64(9,this.lBucketPara),t.writeInt32(10,this.iBusiType),t.writeString(11,this.curPcdnName),t.writeInt32(12,this.supportV6),t.writeString(13,this.sUserAgent)},r.ClientGetPcdnFlvHttpFullstreamInfoReq.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lUid=t.readInt64(1,!1,this.lUid),this.sGuid=t.readString(2,!1,this.sGuid),this.lAnchorUid=t.readInt64(3,!1,this.lAnchorUid),this.iCdnLine=t.readInt32(4,!1,this.iCdnLine),this.iCliType=t.readInt32(5,!1,this.iCliType),this.sStreamName=t.readString(6,!1,this.sStreamName),this.iRatio=t.readInt32(7,!1,this.iRatio),this.sCodec=t.readString(8,!1,this.sCodec),this.lBucketPara=t.readInt64(9,!1,this.lBucketPara),this.iBusiType=t.readInt32(10,!1,this.iBusiType),this.curPcdnName=t.readString(11,!1,this.curPcdnName),this.supportV6=t.readInt32(12,!1,this.supportV6),this.sUserAgent=t.readString(13,!1,this.sUserAgent)},r.ClientGetPcdnFlvHttpFullstreamInfoRsp=function(){this.lReqTs=0,this.lRspTs=0,this.lUid=0,this.sStreamName="",this.iErrCode=0,this.sPcdnName="",this.pullStreamUrl=new r.PCdnProxyUrl,this.cliProv="",this.cliIsp="",this.iCdnLine=0,this.iRatio=0,this.sCodec="",this.mAllPullStreamUrl=new s.Map(new s.STRING,new r.PCdnProxyUrl)},r.ClientGetPcdnFlvHttpFullstreamInfoRsp.prototype._clone=function(){return new r.ClientGetPcdnFlvHttpFullstreamInfoRsp},r.ClientGetPcdnFlvHttpFullstreamInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnFlvHttpFullstreamInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnFlvHttpFullstreamInfoRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lRspTs),t.writeInt64(2,this.lUid),t.writeString(3,this.sStreamName),t.writeInt32(4,this.iErrCode),t.writeString(5,this.sPcdnName),t.writeStruct(6,this.pullStreamUrl),t.writeString(7,this.cliProv),t.writeString(8,this.cliIsp),t.writeInt32(9,this.iCdnLine),t.writeInt32(10,this.iRatio),t.writeString(11,this.sCodec),t.writeMap(12,this.mAllPullStreamUrl)},r.ClientGetPcdnFlvHttpFullstreamInfoRsp.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lRspTs=t.readInt64(1,!1,this.lRspTs),this.lUid=t.readInt64(2,!1,this.lUid),this.sStreamName=t.readString(3,!1,this.sStreamName),this.iErrCode=t.readInt32(4,!1,this.iErrCode),this.sPcdnName=t.readString(5,!1,this.sPcdnName),this.pullStreamUrl=t.readStruct(6,!1,this.pullStreamUrl),this.cliProv=t.readString(7,!1,this.cliProv),this.cliIsp=t.readString(8,!1,this.cliIsp),this.iCdnLine=t.readInt32(9,!1,this.iCdnLine),this.iRatio=t.readInt32(10,!1,this.iRatio),this.sCodec=t.readString(11,!1,this.sCodec),this.mAllPullStreamUrl=t.readMap(12,!1,this.mAllPullStreamUrl)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq=function(){this.lReqTs=0,this.lUid=0,this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.sStreamName="",this.iRatio=0,this.sCodec="",this.iCliType=0,this.lBucketPara=0,this.iBusiType=0,this.vCliSupportPcdns=new s.Vector(new s.STRING),this.curPcdnName=""},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype._clone=function(){return new r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lUid),t.writeString(2,this.sGuid),t.writeInt64(3,this.lAnchorUid),t.writeInt32(4,this.iCdnLine),t.writeString(5,this.sStreamName),t.writeInt32(6,this.iRatio),t.writeString(7,this.sCodec),t.writeInt32(8,this.iCliType),t.writeInt64(9,this.lBucketPara),t.writeInt32(10,this.iBusiType),t.writeVector(11,this.vCliSupportPcdns),t.writeString(12,this.curPcdnName)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lUid=t.readInt64(1,!1,this.lUid),this.sGuid=t.readString(2,!1,this.sGuid),this.lAnchorUid=t.readInt64(3,!1,this.lAnchorUid),this.iCdnLine=t.readInt32(4,!1,this.iCdnLine),this.sStreamName=t.readString(5,!1,this.sStreamName),this.iRatio=t.readInt32(6,!1,this.iRatio),this.sCodec=t.readString(7,!1,this.sCodec),this.iCliType=t.readInt32(8,!1,this.iCliType),this.lBucketPara=t.readInt64(9,!1,this.lBucketPara),this.iBusiType=t.readInt32(10,!1,this.iBusiType),this.vCliSupportPcdns=t.readVector(11,!1,this.vCliSupportPcdns),this.curPcdnName=t.readString(12,!1,this.curPcdnName)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp=function(){this.lReqTs=0,this.lRspTs=0,this.iErrCode=0,this.sPcdnName="",this.sFlvFullstreamUrl="",this.cliProv="",this.cliIsp="",this.lUid=0,this.iCdnLine=0,this.sStreamName="",this.iRatio=0,this.sTransUid=""},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype._clone=function(){return new r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lReqTs),t.writeInt64(1,this.lRspTs),t.writeInt32(2,this.iErrCode),t.writeString(10,this.sPcdnName),t.writeString(11,this.sFlvFullstreamUrl),t.writeString(30,this.cliProv),t.writeString(31,this.cliIsp),t.writeInt64(100,this.lUid),t.writeInt32(101,this.iCdnLine),t.writeString(102,this.sStreamName),t.writeInt32(103,this.iRatio),t.writeString(104,this.sTransUid)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype.readFrom=function(t){this.lReqTs=t.readInt64(0,!1,this.lReqTs),this.lRspTs=t.readInt64(1,!1,this.lRspTs),this.iErrCode=t.readInt32(2,!1,this.iErrCode),this.sPcdnName=t.readString(10,!1,this.sPcdnName),this.sFlvFullstreamUrl=t.readString(11,!1,this.sFlvFullstreamUrl),this.cliProv=t.readString(30,!1,this.cliProv),this.cliIsp=t.readString(31,!1,this.cliIsp),this.lUid=t.readInt64(100,!1,this.lUid),this.iCdnLine=t.readInt32(101,!1,this.iCdnLine),this.sStreamName=t.readString(102,!1,this.sStreamName),this.iRatio=t.readInt32(103,!1,this.iRatio),this.sTransUid=t.readString(104,!1,this.sTransUid)},r.RecSysInfo=function(){this.sAnchorUid="",this.sRoomId="",this.sDispatchId="",this.iScene=0,this.sStrategy="",this.lServerTs=0,this.lAction=0,this.sActionReason="",this.sActValue=""},r.RecSysInfo.prototype._clone=function(){return new r.RecSysInfo},r.RecSysInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.RecSysInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.RecSysInfo.prototype.writeTo=function(t){t.writeString(0,this.sAnchorUid),t.writeString(1,this.sRoomId),t.writeString(2,this.sDispatchId),t.writeInt32(3,this.iScene),t.writeString(4,this.sStrategy),t.writeInt64(5,this.lServerTs),t.writeInt64(6,this.lAction),t.writeString(7,this.sActionReason),t.writeString(8,this.sActValue)},r.RecSysInfo.prototype.readFrom=function(t){this.sAnchorUid=t.readString(0,!1,this.sAnchorUid),this.sRoomId=t.readString(1,!1,this.sRoomId),this.sDispatchId=t.readString(2,!1,this.sDispatchId),this.iScene=t.readInt32(3,!1,this.iScene),this.sStrategy=t.readString(4,!1,this.sStrategy),this.lServerTs=t.readInt64(5,!1,this.lServerTs),this.lAction=t.readInt64(6,!1,this.lAction),this.sActionReason=t.readString(7,!1,this.sActionReason),this.sActValue=t.readString(8,!1,this.sActValue)},r.RecSysReq=function(){this.tId=new r.MediaUserId,this.sAnchorUid="",this.sRoomId="",this.sDispatchId="",this.iScene=0,this.bDebug=0,this.sNet="",this.sSdkVer="",this.mAppendInfo=new s.Map(new s.STRING,new s.STRING)},r.RecSysReq.prototype._clone=function(){return new r.RecSysReq},r.RecSysReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.RecSysReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.RecSysReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeString(1,this.sAnchorUid),t.writeString(2,this.sRoomId),t.writeString(3,this.sDispatchId),t.writeInt32(4,this.iScene),t.writeInt32(5,this.bDebug),t.writeString(6,this.sNet),t.writeString(7,this.sSdkVer),t.writeMap(8,this.mAppendInfo)},r.RecSysReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.sAnchorUid=t.readString(1,!1,this.sAnchorUid),this.sRoomId=t.readString(2,!1,this.sRoomId),this.sDispatchId=t.readString(3,!1,this.sDispatchId),this.iScene=t.readInt32(4,!1,this.iScene),this.bDebug=t.readInt32(5,!1,this.bDebug),this.sNet=t.readString(6,!1,this.sNet),this.sSdkVer=t.readString(7,!1,this.sSdkVer),this.mAppendInfo=t.readMap(8,!1,this.mAppendInfo)},r.RecSysRsp=function(){this.iStatus=0,this.sError="",this.tRecSysInfo=new r.RecSysInfo},r.RecSysRsp.prototype._clone=function(){return new r.RecSysRsp},r.RecSysRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.RecSysRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.RecSysRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iStatus),t.writeString(1,this.sError),t.writeStruct(2,this.tRecSysInfo)},r.RecSysRsp.prototype.readFrom=function(t){this.iStatus=t.readInt32(0,!1,this.iStatus),this.sError=t.readString(1,!1,this.sError),this.tRecSysInfo=t.readStruct(2,!1,this.tRecSysInfo)},r.RecSysNotice=function(){this.tRecSysInfo=new r.RecSysInfo},r.RecSysNotice.prototype._clone=function(){return new r.RecSysNotice},r.RecSysNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.RecSysNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.RecSysNotice.prototype.writeTo=function(t){t.writeStruct(0,this.tRecSysInfo)},r.RecSysNotice.prototype.readFrom=function(t){this.tRecSysInfo=t.readStruct(0,!1,this.tRecSysInfo)},r.VodUrlRange=function(){this.sUrl="",this.sRange="",this.index=0},r.VodUrlRange.prototype._clone=function(){return new r.VodUrlRange},r.VodUrlRange.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.VodUrlRange.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.VodUrlRange.prototype.writeTo=function(t){t.writeString(0,this.sUrl),t.writeString(1,this.sRange),t.writeInt64(2,this.index)},r.VodUrlRange.prototype.readFrom=function(t){this.sUrl=t.readString(0,!1,this.sUrl),this.sRange=t.readString(1,!1,this.sRange),this.index=t.readInt64(2,!1,this.index)},r.VodPcdnProxyUrl=function(){this.reqKey=new r.VodUrlRange,this.iStatusPcdn=0,this.iVodPcdnHotDegreeIn=-1,this.iVodPcdnHotDegreeNow=-1,this.vUrls=new s.Vector(new s.STRING)},r.VodPcdnProxyUrl.prototype._clone=function(){return new r.VodPcdnProxyUrl},r.VodPcdnProxyUrl.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.VodPcdnProxyUrl.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.VodPcdnProxyUrl.prototype.writeTo=function(t){t.writeStruct(0,this.reqKey),t.writeInt32(1,this.iStatusPcdn),t.writeInt32(2,this.iVodPcdnHotDegreeIn),t.writeInt32(3,this.iVodPcdnHotDegreeNow),t.writeVector(4,this.vUrls)},r.VodPcdnProxyUrl.prototype.readFrom=function(t){this.reqKey=t.readStruct(0,!1,this.reqKey),this.iStatusPcdn=t.readInt32(1,!1,this.iStatusPcdn),this.iVodPcdnHotDegreeIn=t.readInt32(2,!1,this.iVodPcdnHotDegreeIn),this.iVodPcdnHotDegreeNow=t.readInt32(3,!1,this.iVodPcdnHotDegreeNow),this.vUrls=t.readVector(4,!1,this.vUrls)},r.ClientGetVodPcdnProxyReq=function(){this.appid=0,this.lReqTs=0,this.lUid=0,this.sGuid="",this.iCliType=0,this.lBucketPara=0,this.sOrigUrl="",this.vKeys=new s.Vector(new r.VodUrlRange)},r.ClientGetVodPcdnProxyReq.prototype._clone=function(){return new r.ClientGetVodPcdnProxyReq},r.ClientGetVodPcdnProxyReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetVodPcdnProxyReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetVodPcdnProxyReq.prototype.writeTo=function(t){t.writeInt32(0,this.appid),t.writeInt64(1,this.lReqTs),t.writeInt64(2,this.lUid),t.writeString(3,this.sGuid),t.writeInt32(4,this.iCliType),t.writeInt64(5,this.lBucketPara),t.writeString(6,this.sOrigUrl),t.writeVector(7,this.vKeys)},r.ClientGetVodPcdnProxyReq.prototype.readFrom=function(t){this.appid=t.readInt32(0,!1,this.appid),this.lReqTs=t.readInt64(1,!1,this.lReqTs),this.lUid=t.readInt64(2,!1,this.lUid),this.sGuid=t.readString(3,!1,this.sGuid),this.iCliType=t.readInt32(4,!1,this.iCliType),this.lBucketPara=t.readInt64(5,!1,this.lBucketPara),this.sOrigUrl=t.readString(6,!1,this.sOrigUrl),this.vKeys=t.readVector(7,!1,this.vKeys)},r.ClientGetVodPcdnProxyReqRsp=function(){this.appid=0,this.lReqTs=0,this.lRspTs=0,this.lUid=0,this.sOrigUrl="",this.iErrCode=0,this.vPcdnUrls=new s.Vector(new r.VodPcdnProxyUrl),this.cliProv="",this.cliIsp="",this.pcdnName="",this.sPcdnIsp="",this.sPcdnArea=""},r.ClientGetVodPcdnProxyReqRsp.prototype._clone=function(){return new r.ClientGetVodPcdnProxyReqRsp},r.ClientGetVodPcdnProxyReqRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ClientGetVodPcdnProxyReqRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ClientGetVodPcdnProxyReqRsp.prototype.writeTo=function(t){t.writeInt32(0,this.appid),t.writeInt64(1,this.lReqTs),t.writeInt64(2,this.lRspTs),t.writeInt64(3,this.lUid),t.writeString(4,this.sOrigUrl),t.writeInt32(5,this.iErrCode),t.writeVector(6,this.vPcdnUrls),t.writeString(7,this.cliProv),t.writeString(8,this.cliIsp),t.writeString(9,this.pcdnName),t.writeString(10,this.sPcdnIsp),t.writeString(11,this.sPcdnArea)},r.ClientGetVodPcdnProxyReqRsp.prototype.readFrom=function(t){this.appid=t.readInt32(0,!1,this.appid),this.lReqTs=t.readInt64(1,!1,this.lReqTs),this.lRspTs=t.readInt64(2,!1,this.lRspTs),this.lUid=t.readInt64(3,!1,this.lUid),this.sOrigUrl=t.readString(4,!1,this.sOrigUrl),this.iErrCode=t.readInt32(5,!1,this.iErrCode),this.vPcdnUrls=t.readVector(6,!1,this.vPcdnUrls),this.cliProv=t.readString(7,!1,this.cliProv),this.cliIsp=t.readString(8,!1,this.cliIsp),this.pcdnName=t.readString(9,!1,this.pcdnName),this.sPcdnIsp=t.readString(10,!1,this.sPcdnIsp),this.sPcdnArea=t.readString(11,!1,this.sPcdnArea)},r.GetVideoHisUponReq=function(){this.lUid=0,this.lLiveId=0,this.tId=new r.UserId},r.GetVideoHisUponReq.prototype._clone=function(){return new r.GetVideoHisUponReq},r.GetVideoHisUponReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetVideoHisUponReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetVideoHisUponReq.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeInt64(1,this.lLiveId),t.writeStruct(2,this.tId)},r.GetVideoHisUponReq.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.lLiveId=t.readInt64(1,!1,this.lLiveId),this.tId=t.readStruct(2,!1,this.tId)},r.GetVideoHisUponRsp=function(){this.lUid=0,this.vHistoryList=new s.Vector(new r.GameLiveHlsInfo)},r.GetVideoHisUponRsp.prototype._clone=function(){return new r.GetVideoHisUponRsp},r.GetVideoHisUponRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetVideoHisUponRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetVideoHisUponRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeVector(1,this.vHistoryList)},r.GetVideoHisUponRsp.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.vHistoryList=t.readVector(1,!1,this.vHistoryList)},r.ImgplusABTestNotice=function(){this.lPid=0,this.iAppid=0,this.iSwitch=0},r.ImgplusABTestNotice.prototype._clone=function(){return new r.ImgplusABTestNotice},r.ImgplusABTestNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.ImgplusABTestNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.ImgplusABTestNotice.prototype.writeTo=function(t){t.writeInt64(0,this.lPid),t.writeInt32(1,this.iAppid),t.writeInt32(2,this.iSwitch)},r.ImgplusABTestNotice.prototype.readFrom=function(t){this.lPid=t.readInt64(0,!1,this.lPid),this.iAppid=t.readInt32(1,!1,this.iAppid),this.iSwitch=t.readInt32(2,!1,this.iSwitch)},r.MediaUserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sUA="",this.sCookie="",this.iAppid=0,this.sStrUid="",this.sUAppId="",this.iNetType=127},r.MediaUserId.prototype._clone=function(){return new r.MediaUserId},r.MediaUserId.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MediaUserId.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MediaUserId.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sGuid),t.writeString(2,this.sToken),t.writeString(3,this.sUA),t.writeString(4,this.sCookie),t.writeInt32(6,this.iAppid),t.writeString(8,this.sStrUid),t.writeString(9,this.sUAppId),t.writeInt32(10,this.iNetType)},r.MediaUserId.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sGuid=t.readString(1,!1,this.sGuid),this.sToken=t.readString(2,!1,this.sToken),this.sUA=t.readString(3,!1,this.sUA),this.sCookie=t.readString(4,!1,this.sCookie),this.iAppid=t.readInt32(6,!1,this.iAppid),this.sStrUid=t.readString(8,!1,this.sStrUid),this.sUAppId=t.readString(9,!1,this.sUAppId),this.iNetType=t.readInt32(10,!1,this.iNetType)},r.MediaResolution=function(){this.iWidth=0,this.iHeight=0},r.MediaResolution.prototype._clone=function(){return new r.MediaResolution},r.MediaResolution.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MediaResolution.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MediaResolution.prototype.writeTo=function(t){t.writeInt32(0,this.iWidth),t.writeInt32(1,this.iHeight)},r.MediaResolution.prototype.readFrom=function(t){this.iWidth=t.readInt32(0,!1,this.iWidth),this.iHeight=t.readInt32(1,!1,this.iHeight)},r.MediaStreamFormatInfo=function(){this.sFormatName="",this.sUrl="",this.sSuffix="",this.vIPList=new s.Vector(new s.STRING),this.iIsSupport=0,this.iRate=0,this.sAdditionalParam="",this.lFormatPropertyFlag=0},r.MediaStreamFormatInfo.prototype._clone=function(){return new r.MediaStreamFormatInfo},r.MediaStreamFormatInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MediaStreamFormatInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MediaStreamFormatInfo.prototype.writeTo=function(t){t.writeString(0,this.sFormatName),t.writeString(1,this.sUrl),t.writeString(2,this.sSuffix),t.writeVector(3,this.vIPList),t.writeInt32(4,this.iIsSupport),t.writeInt32(5,this.iRate),t.writeString(6,this.sAdditionalParam),t.writeInt64(7,this.lFormatPropertyFlag)},r.MediaStreamFormatInfo.prototype.readFrom=function(t){this.sFormatName=t.readString(0,!1,this.sFormatName),this.sUrl=t.readString(1,!1,this.sUrl),this.sSuffix=t.readString(2,!1,this.sSuffix),this.vIPList=t.readVector(3,!1,this.vIPList),this.iIsSupport=t.readInt32(4,!1,this.iIsSupport),this.iRate=t.readInt32(5,!1,this.iRate),this.sAdditionalParam=t.readString(6,!1,this.sAdditionalParam),this.lFormatPropertyFlag=t.readInt64(7,!1,this.lFormatPropertyFlag)},r.MediaStreamInfo=function(){this.sCdnName="",this.sStreamName="",this.sFlvUrl="",this.sFlvSuffix="",this.sHlsUrl="",this.sHlsSuffix="",this.iLineIndex=0,this.vFlvIPList=new s.Vector(new s.STRING),this.iIsP2PSupport=0,this.sP2pUrl="",this.sP2pSuffix="",this.lFreeFlag=0,this.iIsHEVCSupport=0,this.vP2pIPList=new s.Vector(new s.STRING),this.iPCPriorityRate=0,this.iWebPriorityRate=0,this.iMobilePriorityRate=0,this.sAdditionalParam="",this.mMediaStreamFormatInfo=new s.Map(new s.STRING,new r.MediaStreamFormatInfo)},r.MediaStreamInfo.prototype._clone=function(){return new r.MediaStreamInfo},r.MediaStreamInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MediaStreamInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MediaStreamInfo.prototype.writeTo=function(t){t.writeString(0,this.sCdnName),t.writeString(1,this.sStreamName),t.writeString(2,this.sFlvUrl),t.writeString(3,this.sFlvSuffix),t.writeString(4,this.sHlsUrl),t.writeString(5,this.sHlsSuffix),t.writeInt32(6,this.iLineIndex),t.writeVector(7,this.vFlvIPList),t.writeInt32(8,this.iIsP2PSupport),t.writeString(9,this.sP2pUrl),t.writeString(10,this.sP2pSuffix),t.writeInt64(11,this.lFreeFlag),t.writeInt32(12,this.iIsHEVCSupport),t.writeVector(13,this.vP2pIPList),t.writeInt32(14,this.iPCPriorityRate),t.writeInt32(15,this.iWebPriorityRate),t.writeInt32(16,this.iMobilePriorityRate),t.writeString(17,this.sAdditionalParam),t.writeMap(18,this.mMediaStreamFormatInfo)},r.MediaStreamInfo.prototype.readFrom=function(t){this.sCdnName=t.readString(0,!1,this.sCdnName),this.sStreamName=t.readString(1,!1,this.sStreamName),this.sFlvUrl=t.readString(2,!1,this.sFlvUrl),this.sFlvSuffix=t.readString(3,!1,this.sFlvSuffix),this.sHlsUrl=t.readString(4,!1,this.sHlsUrl),this.sHlsSuffix=t.readString(5,!1,this.sHlsSuffix),this.iLineIndex=t.readInt32(6,!1,this.iLineIndex),this.vFlvIPList=t.readVector(7,!1,this.vFlvIPList),this.iIsP2PSupport=t.readInt32(8,!1,this.iIsP2PSupport),this.sP2pUrl=t.readString(9,!1,this.sP2pUrl),this.sP2pSuffix=t.readString(10,!1,this.sP2pSuffix),this.lFreeFlag=t.readInt64(11,!1,this.lFreeFlag),this.iIsHEVCSupport=t.readInt32(12,!1,this.iIsHEVCSupport),this.vP2pIPList=t.readVector(13,!1,this.vP2pIPList),this.iPCPriorityRate=t.readInt32(14,!1,this.iPCPriorityRate),this.iWebPriorityRate=t.readInt32(15,!1,this.iWebPriorityRate),this.iMobilePriorityRate=t.readInt32(16,!1,this.iMobilePriorityRate),this.sAdditionalParam=t.readString(17,!1,this.sAdditionalParam),this.mMediaStreamFormatInfo=t.readMap(18,!1,this.mMediaStreamFormatInfo)},r.StreamGearInfo=function(){this.sDisplayName="",this.iBitRate=0,this.iCodecType=0,this.iHEVCBitRate=-1,this.tResolution=new r.MediaResolution,this.sAdditionalParam="",this.mSupportFormat=new s.Map(new s.STRING,new s.INT64),this.sBusiGearIndex=""},r.StreamGearInfo.prototype._clone=function(){return new r.StreamGearInfo},r.StreamGearInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.StreamGearInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.StreamGearInfo.prototype.writeTo=function(t){t.writeString(0,this.sDisplayName),t.writeInt32(1,this.iBitRate),t.writeInt32(2,this.iCodecType),t.writeInt32(3,this.iHEVCBitRate),t.writeStruct(4,this.tResolution),t.writeString(5,this.sAdditionalParam),t.writeMap(6,this.mSupportFormat),t.writeString(7,this.sBusiGearIndex)},r.StreamGearInfo.prototype.readFrom=function(t){this.sDisplayName=t.readString(0,!1,this.sDisplayName),this.iBitRate=t.readInt32(1,!1,this.iBitRate),this.iCodecType=t.readInt32(2,!1,this.iCodecType),this.iHEVCBitRate=t.readInt32(3,!1,this.iHEVCBitRate),this.tResolution=t.readStruct(4,!1,this.tResolution),this.sAdditionalParam=t.readString(5,!1,this.sAdditionalParam),this.mSupportFormat=t.readMap(6,!1,this.mSupportFormat),this.sBusiGearIndex=t.readString(7,!1,this.sBusiGearIndex)},r.MediaStreamNameInfoPack=function(){this.vMediaStreamInfo=new s.Vector(new r.MediaStreamInfo),this.vStreamGearInfo=new s.Vector(new r.StreamGearInfo),this.sStreamGroupId="",this.lLiveCompatibleFlag=0,this.sAntiCode="",this.lStreamId=0,this.lUid=0,this.iStreamProperty=0,this.iBitRate=0,this.iStreamType=0,this.iPcDefaultBitRate=0,this.iWebDefaultBitRate=0,this.iMobileDefaultBitRate=0,this.sStreamBusiProperty="",this.sAdditionalParam="",this.iStreamCategory=0},r.MediaStreamNameInfoPack.prototype._clone=function(){return new r.MediaStreamNameInfoPack},r.MediaStreamNameInfoPack.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MediaStreamNameInfoPack.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MediaStreamNameInfoPack.prototype.writeTo=function(t){t.writeVector(0,this.vMediaStreamInfo),t.writeVector(1,this.vStreamGearInfo),t.writeString(2,this.sStreamGroupId),t.writeInt64(3,this.lLiveCompatibleFlag),t.writeString(4,this.sAntiCode),t.writeInt64(5,this.lStreamId),t.writeInt64(6,this.lUid),t.writeInt32(7,this.iStreamProperty),t.writeInt32(8,this.iBitRate),t.writeInt32(9,this.iStreamType),t.writeInt32(10,this.iPcDefaultBitRate),t.writeInt32(11,this.iWebDefaultBitRate),t.writeInt32(12,this.iMobileDefaultBitRate),t.writeString(13,this.sStreamBusiProperty),t.writeString(14,this.sAdditionalParam),t.writeInt32(15,this.iStreamCategory)},r.MediaStreamNameInfoPack.prototype.readFrom=function(t){this.vMediaStreamInfo=t.readVector(0,!1,this.vMediaStreamInfo),this.vStreamGearInfo=t.readVector(1,!1,this.vStreamGearInfo),this.sStreamGroupId=t.readString(2,!1,this.sStreamGroupId),this.lLiveCompatibleFlag=t.readInt64(3,!1,this.lLiveCompatibleFlag),this.sAntiCode=t.readString(4,!1,this.sAntiCode),this.lStreamId=t.readInt64(5,!1,this.lStreamId),this.lUid=t.readInt64(6,!1,this.lUid),this.iStreamProperty=t.readInt32(7,!1,this.iStreamProperty),this.iBitRate=t.readInt32(8,!1,this.iBitRate),this.iStreamType=t.readInt32(9,!1,this.iStreamType),this.iPcDefaultBitRate=t.readInt32(10,!1,this.iPcDefaultBitRate),this.iWebDefaultBitRate=t.readInt32(11,!1,this.iWebDefaultBitRate),this.iMobileDefaultBitRate=t.readInt32(12,!1,this.iMobileDefaultBitRate),this.sStreamBusiProperty=t.readString(13,!1,this.sStreamBusiProperty),this.sAdditionalParam=t.readString(14,!1,this.sAdditionalParam),this.iStreamCategory=t.readInt32(15,!1,this.iStreamCategory)},r.MediaStreamInfoPack=function(){this.mMediaStreamInfoPack=new s.Map(new s.STRING,new r.MediaStreamNameInfoPack)},r.MediaStreamInfoPack.prototype._clone=function(){return new r.MediaStreamInfoPack},r.MediaStreamInfoPack.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.MediaStreamInfoPack.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.MediaStreamInfoPack.prototype.writeTo=function(t){t.writeMap(0,this.mMediaStreamInfoPack)},r.MediaStreamInfoPack.prototype.readFrom=function(t){this.mMediaStreamInfoPack=t.readMap(0,!1,this.mMediaStreamInfoPack)},r.GetStreamInfoByRoomFakeReq=function(){this.tId=new r.MediaUserId,this.sRoomId="",this.mpVariable=new s.Map(new s.STRING,new s.STRING),this.iMediaPackType=-1,this.mBusiParams=new s.Map(new s.STRING,new s.STRING)},r.GetStreamInfoByRoomFakeReq.prototype._clone=function(){return new r.GetStreamInfoByRoomFakeReq},r.GetStreamInfoByRoomFakeReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetStreamInfoByRoomFakeReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetStreamInfoByRoomFakeReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeString(1,this.sRoomId),t.writeMap(2,this.mpVariable),t.writeInt32(3,this.iMediaPackType),t.writeMap(4,this.mBusiParams)},r.GetStreamInfoByRoomFakeReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.sRoomId=t.readString(1,!1,this.sRoomId),this.mpVariable=t.readMap(2,!1,this.mpVariable),this.iMediaPackType=t.readInt32(3,!1,this.iMediaPackType),this.mBusiParams=t.readMap(4,!1,this.mBusiParams)},r.GetStreamInfoByRoomFakeRsp=function(){this.tStreamInfoPack=new r.MediaStreamInfoPack,this.mpConfig=new s.Map(new s.STRING,new s.STRING),this.sRoomId=""},r.GetStreamInfoByRoomFakeRsp.prototype._clone=function(){return new r.GetStreamInfoByRoomFakeRsp},r.GetStreamInfoByRoomFakeRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.GetStreamInfoByRoomFakeRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.GetStreamInfoByRoomFakeRsp.prototype.writeTo=function(t){t.writeStruct(0,this.tStreamInfoPack),t.writeMap(1,this.mpConfig),t.writeString(2,this.sRoomId)},r.GetStreamInfoByRoomFakeRsp.prototype.readFrom=function(t){this.tStreamInfoPack=t.readStruct(0,!1,this.tStreamInfoPack),this.mpConfig=t.readMap(1,!1,this.mpConfig),this.sRoomId=t.readString(2,!1,this.sRoomId)},r.PingSignalContext=function(){this.sWupServant="launch",this.sFuncName="pingSignal",this.mTracePoint=new s.Map(new s.STRING,new s.INT64)},r.PingSignalContext.prototype._clone=function(){return new r.PingSignalContext},r.PingSignalContext.prototype._write=function(t,e,i){t.writeStruct(e,i)},r.PingSignalContext.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},r.PingSignalContext.prototype.writeTo=function(t){t.writeString(0,this.sWupServant),t.writeString(1,this.sFuncName),t.writeMap(2,this.mTracePoint)},r.PingSignalContext.prototype.readFrom=function(t){this.sWupServant=t.readString(0,!1,this.sWupServant),this.sFuncName=t.readString(1,!1,this.sFuncName),this.mTracePoint=t.readMap(2,!1,this.mTracePoint)}},function(t,e,i){t.exports={default:i(112),__esModule:!0}},function(t,e,i){var s=i(41);t.exports=function(t){return Object(s(t))}},function(t,e,i){"use strict";e.__esModule=!0;var s,r=(s=i(77))&&s.__esModule?s:{default:s};e.default=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,r.default)(e))&&"function"!=typeof e?t:e}},function(t,e){t.exports={}},function(t,e,i){"use strict";e.__esModule=!0;var s=o(i(135)),r=o(i(139)),a=o(i(77));function o(t){return t&&t.__esModule?t:{default:t}}e.default=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,a.default)(e)));t.prototype=(0,r.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(s.default?(0,s.default)(t,e):t.__proto__=e)}},function(t,e){t.exports=!0},function(t,e){var i=0,s=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++i+s).toString(36))}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,i){var s=i(13),r=i(122),a=i(51),o=i(42)("IE_PROTO"),n=function(){},h=function(){var t,e=i(76)("iframe"),s=a.length;for(e.style.display="none",i(125).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),h=t.F;s--;)delete h.prototype[a[s]];return h()};t.exports=Object.create||function(t,e){var i;return null!==t?(n.prototype=s(t),i=new n,n.prototype=null,i[o]=t):i=h(),void 0===e?i:r(i,e)}},function(t,e,i){var s=i(79),r=i(51);t.exports=Object.keys||function(t){return s(t,r)}},function(t,e,i){var s=i(9).f,r=i(14),a=i(7)("toStringTag");t.exports=function(t,e,i){t&&!r(t=i?t:t.prototype,a)&&s(t,a,{configurable:!0,value:e})}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o(i(10)),r=o(i(0)),a=o(i(1));function o(t){return t&&t.__esModule?t:{default:t}}var n=function(){function t(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,r.default)(this,t),this.view=e,this.pos=0,this.len=0,this.uri=0,this.resCode=0,!0===i&&(this.len=this.popUInt32(),this.uri=this.popUInt32(),this.resCode=this.popUInt16())}return(0,a.default)(t,[{key:"bytesAvailable",value:function(){return this.view.byteLength-this.pos}},{key:"popBool",value:function(){return 1==this.popUInt8()}},{key:"popUInt8",value:function(){if(this.pos+1>this.view.byteLength)return 0;var t=this.view.getUint8(this.pos);return this.pos++,t}},{key:"popUInt16",value:function(){if(this.pos+2>this.view.byteLength)return 0;var t=this.view.getUint16(this.pos,!0);return this.pos+=2,t}},{key:"popUInt32",value:function(){if(this.pos+4>this.view.byteLength)return 0;var t=this.view.getUint32(this.pos,!0);return this.pos+=4,t}},{key:"popUInt64",value:function(){if(this.pos+8>this.view.byteLength)return 0;var t=this.view.getUint32(this.pos,!0);this.pos+=4;var e=this.view.getUint32(this.pos,!0);return this.pos+=4,4294967296*e+t}},{key:"popInt64",value:function(){for(var t=0,e=(128&this.view.getUint8(this.pos+7))>0,i=!0,s=0;s<8;s++){var r=this.view.getUint8(this.pos+s);e&&(i?0!=r&&(r=255&~(r-1),i=!1):r=255&~r),t+=r*Math.pow(2,8*s)}return e&&(t=-t),this.pos+=8,t}},{key:"popUint8Array",value:function(){var t=this.popUInt16();if(this.pos+t>this.view.byteLength)return null;var e=new Uint8Array(this.view.buffer,this.pos,t);return this.pos+=t,e.slice()}},{key:"popUint8Array32",value:function(){var t=this.popUInt32();if(this.pos+t>this.view.byteLength)return null;var e=new Uint8Array(this.view.buffer,this.pos,t);return this.pos+=t,e.slice()}},{key:"popUInt64Vector",value:function(){var t=this.popUInt32();if(this.pos+8*t>this.view.byteLength)return null;for(var e=[],i=0;i<t;i++)e.push(this.popUInt64());return e}},{key:"popUInt32Vector",value:function(){var t=this.popUInt32();if(this.pos+4*t>this.view.byteLength)return null;for(var e=[],i=0;i<t;i++)e.push(this.popUInt32());return e}},{key:"popUInt16Vector",value:function(){var t=this.popUInt32();if(this.pos+2*t>this.view.byteLength)return null;for(var e=[],i=0;i<t;i++)e.push(this.popUInt16());return e}},{key:"popString",value:function(){var t=this.popUInt16();if(this.pos+t>this.view.byteLength)return null;for(var e=[],i=0;i<t;++i)e[i]=String.fromCharCode(this.popUInt8());return e.join("")}},{key:"popMapKey8Val32",value:function(){for(var t=this.popUInt32(),e=new s.default,i=0;i<t;i++){var r=this.popUInt8(),a=this.popUInt32();e.set(r,a)}return e}},{key:"popMapKey64Val64",value:function(){for(var t=this.popUInt32(),e=new s.default,i=0;i<t;i++){var r=this.popUInt64(),a=this.popUInt64();e.set(r,a)}return e}}]),t}();e.default=n},function(t,e,i){var s=i(17),r=i(145),a=i(146),o=i(13),n=i(50),h=i(88),d={},l={};(e=t.exports=function(t,e,i,u,c){var p,m,f,_,g=c?function(){return t}:h(t),S=s(i,u,e?2:1),T=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(a(g)){for(p=n(t.length);p>T;T++)if((_=e?S(o(m=t[T])[0],m[1]):S(t[T]))===d||_===l)return _}else for(f=g.call(t);!(m=f.next()).done;)if((_=r(f,S,m.value,e))===d||_===l)return _}).BREAK=d,e.RETURN=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(10)),r=n(i(0)),a=n(i(1)),o=n(i(2));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,r.default)(this,t),this.ip=0,this.tcpPorts=[],this.udpPorts=[],this.videoProxyInfo=new s.default}return(0,a.default)(t,[{key:"marshall",value:function(){var t=new o.default(!1);return"number"==typeof this.ip?t.pushUInt32(this.ip):t.pushUInt32(this.ip2uint(this.ip)),t.pushUInt16Vector(this.tcpPorts),t.pushUInt16Vector(this.udpPorts),t.pushUInt32(this.videoProxyInfo.size),this.videoProxyInfo.forEach((function(e,i){t.pushUInt8(i),t.pushUInt32(e)})),t.marshall()}},{key:"unmarshall",value:function(t){this.ip=this.uint2ip(t.popUInt32()),this.tcpPorts=t.popUInt16Vector(),this.udpPorts=t.popUInt16Vector(),this.videoProxyInfo.clear();for(var e=t.popUInt32(),i=0;i<e;i++){var s=t.popUInt8(),r=t.popUInt32();this.videoProxyInfo.set(s,r)}return this}},{key:"ip2uint",value:function(t){for(var e=0,i=t.split("."),s=0;s<i.length;s++)e|=Number(i[s])<<8*s;return e<0&&(e+=4294967296),e}},{key:"uint2ip",value:function(t){return(255&t)+"."+(t>>8&255)+"."+(t>>16&255)+"."+(t>>24&255)}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=h(i(0)),r=h(i(1)),a=h(i(62)),o=h(i(63)),n=h(i(2));function h(t){return t&&t.__esModule?t:{default:t}}var d=function(){function t(){(0,s.default)(this,t),this.appid=0,this.streamType=0,this.codecType=0,this.sid=0,this.startTs=0,this.serverGenSeq=0}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new n.default(!1);return t.pushUInt8(this.appid),t.pushUInt8(this.streamType),t.pushUInt16(this.codecType),t.pushUInt64(this.sid),t.pushUInt32(this.startTs),t.pushUInt16(this.serverGenSeq),t.marshall()}},{key:"unmarshall",value:function(t){return this.appid=t.popUInt8(),this.streamType=t.popUInt8(),this.codecType=t.popUInt16(),this.sid=t.popUInt64(),this.startTs=t.popUInt32(),this.serverGenSeq=t.popUInt16(),this}},{key:"text",value:function(){return this.appid+"-"+this.streamType+"-"+this.codecType+"-"+this.sid+"-"+this.startTs+"-"+this.serverGenSeq}},{key:"equal",value:function(t){return null!==t&&this.appid===t.appid&&this.streamType===t.streamType&&this.codecType===t.codecType&&this.sid===t.sid&&this.startTs===t.startTs&&this.serverGenSeq===t.serverGenSeq}},{key:"isValidID",get:function(){return this.appid>0}},{key:"isTransStream",get:function(){return 1==(1&this.streamType)}},{key:"isAudioStream",get:function(){return this.streamType>=a.default.STRAEM_TYPE_AUDIO_START}},{key:"isVideoStream",get:function(){return this.streamType<a.default.STRAEM_TYPE_AUDIO_START}},{key:"isH264VideoStream",get:function(){return this.isVideoStream&&this.codecType>=o.default.VIDEO_264_START&&this.codecType<=o.default.VIDEO_H264_END}},{key:"isH265VideoStream",get:function(){return this.isVideoStream&&this.codecType>=o.default.VIDEO_265_START&&this.codecType<=o.default.VIDEO_H265_END}},{key:"videoTypeId",get:function(){return this.appid<<24|this.streamType<<16|this.codecType}},{key:"hashKey",get:function(){return 4294967296*this.sid+(this.codecType<<16|this.appid<<8|this.streamType)}},{key:"streamId",get:function(){return 281474976710656*this.streamType+4294967296*this.codecType+this.startTs}}]),t}();e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(10)),r=n(i(0)),a=n(i(1)),o=n(i(2));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,r.default)(this,t),this.ip=0,this.tcpPorts=[],this.udpPorts=[],this.videoProxyInfo=new s.default}return(0,a.default)(t,[{key:"marshall",value:function(){var t=new o.default(!1);return"number"==typeof this.ip?t.pushUInt32(this.ip):t.pushUInt32(this.ip2uint(this.ip)),t.pushUInt16Vector(this.tcpPorts),t.pushUInt16Vector(this.udpPorts),t.pushUInt32(this.videoProxyInfo.size),this.videoProxyInfo.forEach((function(e,i){t.pushUInt8(i),t.pushUInt32(e)})),t.marshall()}},{key:"unmarshall",value:function(t){this.ip=this.uint2ip(t.popUInt32()),this.tcpPorts=t.popUInt16Vector(),this.udpPorts=t.popUInt16Vector(),this.videoProxyInfo.clear();for(var e=t.popUInt32(),i=0;i<e;i++){var s=t.popUInt8(),r=t.popUInt32();this.videoProxyInfo.set(s,r)}return this}},{key:"ip2uint",value:function(t){for(var e=0,i=t.split("."),s=0;s<i.length;s++)e|=Number(i[s])<<8*s;return e<0&&(e+=4294967296),e}},{key:"uint2ip",value:function(t){return(255&t)+"."+(t>>8&255)+"."+(t>>16&255)+"."+(t>>24&255)}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(2)),o=n(i(64));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.sid=0,this.fuzzyParam=new o.default}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new a.default(!1);return t.pushUInt64(this.sid),t.pushUint8ArrayWithoutLen(this.fuzzyParam.marshall()),t.marshall()}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(21).default;e.default=s},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,i){var s=i(43)("keys"),r=i(28);t.exports=function(t){return s[t]||(s[t]=r(t))}},function(t,e,i){var s=i(4),r=i(8),a=r["__core-js_shared__"]||(r["__core-js_shared__"]={});(t.exports=function(t,e){return a[t]||(a[t]=void 0!==e?e:{})})("versions",[]).push({version:s.version,mode:i(27)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(t,e,i){var s=i(11);t.exports=function(t,e){if(!s(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!s(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!s(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!s(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e,i){"use strict";var s=i(120)(!0);i(47)(String,"String",(function(t){this._t=String(t),this._i=0}),(function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=s(e,i),this._i+=t.length,{value:t,done:!1})}))},function(t,e){var i=Math.ceil,s=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?s:i)(t)}},function(t,e,i){"use strict";var s=i(27),r=i(5),a=i(78),o=i(12),n=i(25),h=i(121),d=i(32),l=i(73),u=i(7)("iterator"),c=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(t,e,i,m,f,_,g){h(i,e,m);var S,T,y,E=function(t){if(!c&&t in D)return D[t];switch(t){case"keys":case"values":return function(){return new i(this,t)}}return function(){return new i(this,t)}},v=e+" Iterator",C="values"==f,P=!1,D=t.prototype,I=D[u]||D["@@iterator"]||f&&D[f],A=I||E(f),R=f?C?E("entries"):A:void 0,O="Array"==e&&D.entries||I;if(O&&(y=l(O.call(new t)))!==Object.prototype&&y.next&&(d(y,v,!0),s||"function"==typeof y[u]||o(y,u,p)),C&&I&&"values"!==I.name&&(P=!0,A=function(){return I.call(this)}),s&&!g||!c&&!P&&D[u]||o(D,u,A),n[e]=A,n[v]=p,f)if(S={values:C?A:E("values"),keys:_?A:E("keys"),entries:R},g)for(T in S)T in D||a(D,T,S[T]);else r(r.P+r.F*(c||P),e,S);return S}},function(t,e,i){var s=i(49);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==s(t)?t.split(""):Object(t)}},function(t,e){var i={}.toString;t.exports=function(t){return i.call(t).slice(8,-1)}},function(t,e,i){var s=i(46),r=Math.min;t.exports=function(t){return t>0?r(s(t),9007199254740991):0}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,i){i(126);for(var s=i(8),r=i(12),a=i(25),o=i(7)("toStringTag"),n="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),h=0;h<n.length;h++){var d=n[h],l=s[d],u=l&&l.prototype;u&&!u[o]&&r(u,o,d),a[d]=a.Array}},function(t,e,i){e.f=i(7)},function(t,e,i){var s=i(28)("meta"),r=i(11),a=i(14),o=i(9).f,n=0,h=Object.isExtensible||function(){return!0},d=!i(15)((function(){return h(Object.preventExtensions({}))})),l=function(t){o(t,s,{value:{i:"O"+ ++n,w:{}}})},u=t.exports={KEY:s,NEED:!1,fastKey:function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!a(t,s)){if(!h(t))return"F";if(!e)return"E";l(t)}return t[s].i},getWeak:function(t,e){if(!a(t,s)){if(!h(t))return!0;if(!e)return!1;l(t)}return t[s].w},onFreeze:function(t){return d&&u.NEED&&h(t)&&!a(t,s)&&l(t),t}}},function(t,e,i){var s=i(8),r=i(4),a=i(27),o=i(53),n=i(9).f;t.exports=function(t){var e=r.Symbol||(r.Symbol=a?{}:s.Symbol||{});"_"==t.charAt(0)||t in e||n(e,t,{value:o.f(t)})}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(20)),o=n(i(36));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.streamId=new a.default,this.videoProxyInfos=[],this.token="",this.streamSeqSN=0,this.quickAccessBeginIndex=0,this.quickAccessEndIndex=0,this.ip=0,this.urlTokenTime=0,this.urlToken=""}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.streamId.unmarshall(t),this.videoProxyInfos=[];for(var e=t.popUInt32(),i=0;i<e;i++){var s=new o.default;this.videoProxyInfos.push(s.unmarshall(t))}return this.token=t.popString(),this.streamSeqSN=t.popUInt64(),this.quickAccessBeginIndex=t.popUInt64(),this.quickAccessEndIndex=t.popUInt64(),this.ip=t.popUInt32(),this.urlTokenTime=t.popUInt32(),this.urlToken=t.popString(),this}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={STREAM_UNKNOWN:0,AUDIO_SPEEX:0,AUDIO_AACPLUS:1,AUDIO_SILK:2,AUDIO_AAC_44100HZ_STEREO_128KBPS:35,AUDIO_AAC_44100HZ_STEREO_160KBPS:36,AUDIO_AAC_44100HZ_STEREO_192KBPS:37,AUDIO_ELD_AAC_44100HZ_STEREO:38,AUDIO_ELD_AAC_SBR_44100HZ_STEREO:39,SIGNAL_STREAM_DATA:47,SIGNAL_STREAM_COMPRESS_DATA:48,AUDIO_MP3:50,AUDIO_NELLYMOSER:54,VIDEO_264_START:401,VIDEO_H264_100K:401,VIDEO_H264_500K:405,VIDEO_H264_800K:408,VIDEO_H264_1200K:412,VIDEO_H264_1500K:415,VIDEO_H264_2000K:420,VIDEO_H264_3000K:430,VIDEO_H264_4000K:440,VIDEO_H264_6000K:460,VIDEO_H264_8000K:480,VIDEO_H264_END:480,VIDEO_265_START:503,VIDEO_H265_300K:503,VIDEO_H265_500K:505,VIDEO_H265_800K:508,VIDEO_H265_1200K:512,VIDEO_H265_1500K:515,VIDEO_H265_2000K:520,VIDEO_H265_3000K:530,VIDEO_H265_4000K:540,VIDEO_H265_6000K:560,VIDEO_H265_8000K:580,VIDEO_H265_END:580,VIDEO_H264_EX_BASE:1e3,VIDEO_H264_EX_START:1005,VIDEO_H264_EX_500K:1005,VIDEO_H264_EX_1M:1010,VIDEO_H264_EX_5M:1050,VIDEO_H264_EX_8M:1080,VIDEO_H264_EX_10M:1100,VIDEO_H264_EX_12M:1120,VIDEO_H264_EX_15M:1150,VIDEO_H264_EX_20M:1200,VIDEO_H264_EX_END:1200,VIDEO_H265_EX_BASE:4e3,VIDEO_H265_EX_START:4005,VIDEO_H265_EX_500K:4005,VIDEO_H265_EX_1M:4010,VIDEO_H265_EX_5M:4050,VIDEO_H265_EX_8M:4080,VIDEO_H265_EX_10M:4100,VIDEO_H265_EX_12M:4120,VIDEO_H265_EX_15M:4150,VIDEO_H265_EX_20M:4200,VIDEO_H265_EX_END:4200}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=d(i(10)),r=d(i(0)),a=d(i(1)),o=d(i(2)),n=d(i(20)),h=d(i(36));function d(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(){(0,r.default)(this,t),this.currentProxyInfos=new s.default}return(0,a.default)(t,[{key:"marshall",value:function(){var t=new o.default(!1);return t.pushUInt32(this.currentProxyInfos.size),this.currentProxyInfos.forEach((function(e,i){t.pushUint8ArrayWithoutLen(i.marshall()),t.pushUInt32(e.length),e.forEach((function(e){t.pushUint8ArrayWithoutLen(e.marshall())}))})),t.marshall()}},{key:"unmarshall",value:function(t){this.currentProxyInfos.clear();for(var e=t.popUInt32(),i=0;i<e;i++){var s=new n.default;s.unmarshall(t);for(var r=[],a=t.popUInt32(),o=0;o<a;o++){var d=new h.default;r.push(d.unmarshall(t))}this.currentProxyInfos.set(s,r)}return this}}]),t}();e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(3)),o=n(i(2));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.seq=0,this.uri=0,this.from=0,this.uid=0,this.streamSeqSN=0,this.payload=null}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new o.default;return t.setUri(a.default.PP2pSliceData),t.pushUInt64(this.seq),t.pushUInt32(this.uri),t.pushUInt8(this.from),t.pushUInt64(this.uid),t.pushUInt64(this.streamSeqSN),t.pushUint8Array(this.payload),t.marshall()}},{key:"unmarshall",value:function(t){return this.seq=t.popUInt64(),this.uri=t.popUInt32(),this.from=t.popUInt8(),this.uid=t.popUInt64(),this.streamSeqSN=t.popUInt64(),this.payload=t.popUint8Array(),this}},{key:"isAudio",get:function(){return this.uri==a.default.PP2pSliceAudioData}},{key:"isVideo",get:function(){return this.uri==a.default.PP2pSliceVideoData}},{key:"isCtrlSlice",get:function(){return this.uri==a.default.PP2pSliceControlData}},{key:"isFullSlice",get:function(){return 1==this.from}},{key:"isSubSlice",get:function(){return 2==this.from}},{key:"isResend",get:function(){return 3==this.from&&0==this.uid}},{key:"isPatchSlice",get:function(){return 4==this.from}},{key:"isFromPeer",get:function(){return 0!==this.uid}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=d(i(10)),r=d(i(0)),a=d(i(1)),o=d(i(2)),n=d(i(37)),h=d(i(38));function d(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(){(0,r.default)(this,t),this.currentProxyInfos=new s.default}return(0,a.default)(t,[{key:"marshall",value:function(){var t=new o.default(!1);return t.pushUInt32(this.currentProxyInfos.size),this.currentProxyInfos.forEach((function(e,i){t.pushUint8ArrayWithoutLen(i.marshall()),t.pushUInt32(e.length),e.forEach((function(e){t.pushUint8ArrayWithoutLen(e.marshall())}))})),t.marshall()}},{key:"unmarshall",value:function(t){this.currentProxyInfos.clear();for(var e=t.popUInt32(),i=0;i<e;i++){var s=new n.default;s.unmarshall(t);for(var r=[],a=t.popUInt32(),o=0;o<a;o++){var d=new h.default;r.push(d.unmarshall(t))}this.currentProxyInfos.set(s,r)}return this}}]),t}();e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={STREAM_VIDEO_RAW:0,STREAM_VIDEO_TRANSCODE:1,STREAM_VIDEO_RTMP_RAW:2,STREAM_VIDEO_RTMP_TRANSCODE:3,STRAEM_TYPE_AUDIO_START:32,STREAM_AUDIO_RAW:32,STREAM_AUDIO_TRANSCODE:33,STREAM_AUDIO_FLV_RAW:34,STREAM_AUDIO_FLV_TRANSCODE:35,STREAM_AUDIO_RTMP_RAW:36,STREAM_AUDIO_RTMP_TRANSCODE:37,STREAM_AUDIO_ALL_SID:39,STREAM_TYPE_UNKNOWN:255}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={STREAM_UNKNOWN:0,AUDIO_SPEEX:0,AUDIO_AACPLUS:1,AUDIO_SILK:2,AUDIO_AAC_44100HZ_STEREO_128KBPS:35,AUDIO_AAC_44100HZ_STEREO_160KBPS:36,AUDIO_AAC_44100HZ_STEREO_192KBPS:37,AUDIO_ELD_AAC_44100HZ_STEREO:38,AUDIO_ELD_AAC_SBR_44100HZ_STEREO:39,AUDIO_MP3:50,AUDIO_NELLYMOSER:54,VIDEO_264_START:401,VIDEO_H264_100K:401,VIDEO_H264_500K:405,VIDEO_H264_800K:408,VIDEO_H264_1200K:412,VIDEO_H264_1500K:415,VIDEO_H264_2000K:420,VIDEO_H264_3000K:430,VIDEO_H264_4000K:440,VIDEO_H264_6000K:460,VIDEO_H264_8000K:480,VIDEO_H264_END:480,VIDEO_265_START:503,VIDEO_H265_300K:503,VIDEO_H265_500K:505,VIDEO_H265_800K:508,VIDEO_H265_1200K:512,VIDEO_H265_1500K:515,VIDEO_H265_2000K:520,VIDEO_H265_3000K:530,VIDEO_H265_4000K:540,VIDEO_H265_6000K:560,VIDEO_H265_8000K:580,VIDEO_H265_END:580}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o(i(0)),r=o(i(1)),a=o(i(2));function o(t){return t&&t.__esModule?t:{default:t}}var n=function(){function t(){(0,s.default)(this,t),this.h264Only=!1,this.maxCodeRateH264=0,this.maxCodeRateH265=0,this.reserve=0}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new a.default(!1);return t.pushBool(this.h264Only),t.pushUInt16(this.maxCodeRateH264),t.pushUInt16(this.maxCodeRateH265),t.pushUInt32(this.reserve),t.marshall()}},{key:"unmarshall",value:function(t){return this.h264Only=t.popBool(),this.maxCodeRateH264=t.popUInt16(),this.maxCodeRateH265=t.popUInt16(),this.reserve=t.popUInt32(),this}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=d(i(10)),r=d(i(0)),a=d(i(1)),o=d(i(3)),n=d(i(2)),h=(d(i(39)),d(i(61)));function d(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(){(0,r.default)(this,t),this.uid=0,this.version=0,this.streamNames=[],this.fuzzyQueryKeys=[],this.currentInfo=new h.default,this.appid=0,this.clientAppid=0,this.clientType=0,this.ip=0,this.sendTime=0,this.sdkVersion=0,this.imsi=0,this.useCase=0,this.appSysName="",this.appUA="",this.retryFailCount=0,this.extInfo=new s.default,this.latencyModel=0}return(0,a.default)(t,[{key:"marshall",value:function(){var t=new n.default;return t.setUri(o.default.PAudienceGetProxyListReq),t.pushUInt64(this.uid),t.pushUInt8(this.version),t.pushUInt32(this.streamNames.length),this.streamNames.forEach((function(e){t.pushString(e)})),t.pushUInt32(this.fuzzyQueryKeys.length),this.fuzzyQueryKeys.forEach((function(e){t.pushUint8ArrayWithoutLen(e.marshall())})),t.pushUint8ArrayWithoutLen(this.currentInfo.marshall()),t.pushUInt8(this.appid),t.pushUInt32(this.clientAppid),t.pushUInt32(this.clientType),t.pushUInt32(this.ip),t.pushUInt32(this.sendTime),t.pushUInt32(this.sdkVersion),t.pushUInt64(this.imsi),t.pushUInt8(this.useCase),t.pushString(this.appSysName),t.pushString(this.appUA),t.pushUInt8(this.retryFailCount),t.pushUInt32(this.extInfo.size),this.extInfo.forEach((function(e,i){t.pushString(i),t.pushString(e)})),t.pushUInt16(this.latencyModel),t.marshall()}}]),t}();e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(10)),r=n(i(0)),a=n(i(1)),o=(n(i(3)),n(i(67)));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,r.default)(this,t),this.uid=0,this.allocatedStreams=new s.default,this.clientAppid=0,this.clientType=0,this.sendTime=0,this.userArea=0,this.videoGroupId=0,this.retryType=0,this.retryFreq=0,this.result=0,this.proxyType=0,this.tokenVersion=0,this.sslUrl=""}return(0,a.default)(t,[{key:"unmarshall",value:function(t){this.uid=t.popUInt64(),this.allocatedStreams.clear();for(var e=t.popUInt32(),i=0;i<e;i++){for(var s=t.popString(),r=[],a=t.popUInt32(),n=0;n<a;n++){var h=new o.default;r.push(h.unmarshall(t))}this.allocatedStreams.set(s,r)}return this.clientAppid=t.popUInt32(),this.clientType=t.popUInt32(),this.sendTime=t.popUInt32(),this.userArea=t.popUInt32(),this.videoGroupId=t.popUInt32(),this.retryType=t.popUInt8(),this.retryFreq=t.popUInt16(),this.result=t.popUInt32(),this.proxyType=t.popUInt32(),this.tokenVersion=t.popUInt32(),this.sslUrl=t.popString(),this}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(37)),o=n(i(38));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.streamId=new a.default,this.videoProxyInfos=[],this.token=""}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.streamId.unmarshall(t),this.videoProxyInfos=[];for(var e=t.popUInt32(),i=0;i<e;i++){var s=new o.default;this.videoProxyInfos.push(s.unmarshall(t))}return this.token=t.popString(),this}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=c(i(22)),r=c(i(0)),a=c(i(1)),o=c(i(24)),n=c(i(26)),h=c(i(105)),d=c(i(3)),l=c(i(34)),u=c(i(16));function c(t){return t&&t.__esModule?t:{default:t}}var p=function(t){function e(){(0,r.default)(this,e);var t=(0,o.default)(this,(e.__proto__||(0,s.default)(e)).call(this));return t.printProtocol=!!Number(localStorage._printProtocol),t}return(0,n.default)(e,t),(0,a.default)(e,[{key:"onData",value:function(t,e){var i=this.unmarshall(t,e);this.trigger(t,i)}},{key:"unmarshall",value:function(t,e){var i=new l.default(e),s=d.default[t],r=i,a=null;try{a=this.getClass(s)}catch(e){u.default.logger.warn("%c[x] Unmatched protocol "+(t>>8)+" "+s,"color:red;background:#FFF0F0")}return a&&(void 0===(r=new a).unmarshall?u.default.logger.error("[x]"+s+".unmarshall undefined!"):r.unmarshall(i)),this.printProtocol&&!m[s]&&u.default.logger.debug("%c<<<<< "+s,function(t,e,i){var s="font-weight:900";return s+=";color:"+t}("#0000E3"),r),r}},{key:"getClass",value:function(t){return null}}]),e}(h.default),m={PCdnProxyPing:1,PCdnProxyPingRes:1,PP2pSliceAudioData:1,PP2pSliceVideoData:1,PP2pSliceControlData:1,PCdnP2pGetNode:1,PCdnP2pGetNodeRes:1,P2POffer:1,P2PAnswer:1,P2PCandidate:1,P2POfferReject:1,P2PRequestOffer:1,PCdnP2PWSForward:1,PCdnP2PWSForwardReject:1,PCdnP2pReportLog:1,PCDNSubscribeReq:1,PCDNSubscribeRes:1,PCDNCompeteSubscribeReq:1,PCDNCompeteSubscribeRes:1,P2PPunchBackReq:1,P2PPunchBackRsp:1,HuyaDelaySeiData:1};e.default=p},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(0)),r=a(i(1));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(){(0,s.default)(this,t),this.uid=0,this.encoderSource=0,this.uploadType=0,this.frameDts=0,this.caputureTime=0,this.encodeEndTime=0,this.sendFrameTime=0}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.uid=t.popUInt64(),this.encoderSource=t.popUInt8(),this.uploadType=t.popUInt8(),this.frameDts=t.popUInt64(),this.caputureTime=t.popUInt64(),this.encodeEndTime=t.popUInt64(),this.sendFrameTime=t.popUInt64()}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o(i(0)),r=o(i(1)),a=o(i(71));function o(t){return t&&t.__esModule?t:{default:t}}var n=function(){function t(){(0,s.default)(this,t),this.dtsGapSum=0,this.delaySum=0,this.serverInfos=[]}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.dtsGapSum=t.popInt64(),this.delaySum=t.popUInt64();for(var e=t.popUInt32();e>0;){e--;var i=new a.default;i.unmarshall(t),this.serverInfos.push(i)}}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(0)),r=a(i(1));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(){(0,s.default)(this,t),this.enable=0,
//!=0时表示有效数据
this.proxyIdLow=0,this.proxyIdHigh=0,this.proxyType=0,this.serverDelay=0,this.lastPeriodDelay=0}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.enable=t.popUInt8(),this.proxyIdLow=t.popUInt32(),this.proxyIdHigh=t.popUInt32(),this.proxyType=t.popUInt16(),this.serverDelay=t.popUInt32(),this.lastPeriodDelay=t.popUInt32()}},{key:"getProxyIdStr",value:function(){return this.proxyIdHigh.toString(16)+this.proxyIdLow.toString(16)}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={};e.default=s,s.INT8=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt8(e,i)},this._read=function(t,e,i){return t.readInt8(e,!0,i)},this._className=function(){return s.CHAR}},s.INT16=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt16(e,i)},this._read=function(t,e,i){return t.readInt16(e,!0,i)},this._className=function(){return s.SHORT}},s.INT32=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt32(e,i)},this._read=function(t,e,i){return t.readInt32(e,!0,i)},this._className=function(){return s.INT32}},s.INT64=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt64(e,i)},this._read=function(t,e,i){return t.readInt64(e,!0,i)},this._className=function(){return s.INT64}},s.UINT8=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt16(e,i)},this._read=function(t,e,i){return t.readInt16(e,!0,i)},this._className=function(){return s.SHORT}},s.UInt16=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt32(e,i)},this._read=function(t,e,i){return t.readInt32(e,!0,i)},this._className=function(){return s.INT32}},s.UInt32=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt64(e,i)},this._read=function(t,e,i){return t.readInt64(e,!0,i)},this._className=function(){return s.INT64}},s.Float=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeFloat(e,i)},this._read=function(t,e,i){return t.readFloat(e,!0,i)},this._className=function(){return s.FLOAT}},s.Double=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeDouble(e,i)},this._read=function(t,e,i){return t.readDouble(e,!0,i)},this._className=function(){return s.DOUBLE}},s.STRING=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeString(e,i)},this._read=function(t,e,i){return t.readString(e,!0,i)},this._className=function(){return s.STRING}},s.BOOLEAN=function(){this._clone=function(){return!1},this._write=function(t,e,i){return t.writeBoolean(e,i)},this._read=function(t,e,i){return t.readBoolean(e,!0,i)},this._className=function(){return s.BOOLEAN}},s.ENUM=function(){this._clone=function(){return 0},this._write=function(t,e,i){return t.writeInt32(e,i)},this._read=function(t,e,i){return t.readInt32(e,!0,i)}},s.Vector=function(t){this.proto=t,this.value=new Array},s.Vector.prototype._clone=function(){return new s.Vector(this.proto)},s.Vector.prototype._write=function(t,e,i){return t.writeVector(e,i)},s.Vector.prototype._read=function(t,e,i){return t.readVector(e,!0,i)},s.Vector.prototype._className=function(){return s.TypeHelp.VECTOR.replace("$t",this.proto._className())},s.Map=function(t,e){this.kproto=t,this.vproto=e,this.value=new Object},s.Map.prototype._clone=function(){return new s.Map(this.kproto,this.vproto)},s.Map.prototype._write=function(t,e,i){return t.writeMap(e,i)},s.Map.prototype._read=function(t,e,i){return t.readMap(e,!0,i)},s.Map.prototype.put=function(t,e){this.value[t]=e},s.Map.prototype.get=function(t){return this.value[t]},s.Map.prototype.getKeys=function(){var t=[];for(var e in this.value)""!=e&&t.push(e);return t},s.Map.prototype.hasKey=function(t){return this.value.hasOwnProperty(t)},s.Map.prototype.remove=function(t){delete this.value[t]},s.Map.prototype.clear=function(){this.value=new Object},s.Map.prototype.size=function(){var t=0;for(var e in this.value)t++;return t},s.Vector.prototype._className=function(){return s.TypeHelp.Map.replace("$k",this.kproto._className()).replace("$v",this.vproto._className())},s.DataHelp={EN_INT8:0,EN_INT16:1,EN_INT32:2,EN_INT64:3,EN_FLOAT:4,EN_DOUBLE:5,EN_STRING1:6,EN_STRING4:7,EN_MAP:8,EN_LIST:9,EN_STRUCTBEGIN:10,EN_STRUCTEND:11,EN_ZERO:12,EN_SIMPLELIST:13},s.TypeHelp={BOOLEAN:"bool",CHAR:"char",SHORT:"short",INT32:"int32",INT64:"int64",FLOAT:"float",DOUBLE:"double",STRING:"string",VECTOR:"list<$t>",MAP:"map<$k, $v>"},s.BinBuffer=function(t){this.buf=null,this.vew=null,this.len=0,this.position=0,null!=t&&null!=t&&(t instanceof ArrayBuffer?(this.buf=t,this.vew=new DataView(this.buf),this.len=this.vew.byteLength,this.position=0):(this.buf=t.buf,this.vew=new DataView(this.buf),this.len=t.length,this.position=t.position)),this.__defineGetter__("length",(function(){return this.len})),this.__defineGetter__("buffer",(function(){return this.buf}))},s.BinBuffer.prototype._write=function(t,e,i){return t.writeBytes(e,i)},s.BinBuffer.prototype._read=function(t,e,i){return t.readBytes(e,!0,i)},s.BinBuffer.prototype._clone=function(){return new s.BinBuffer},s.BinBuffer.prototype.allocate=function(t){if(t=this.position+t,!(null!=this.buf&&this.buf.length>t)){var e=new ArrayBuffer(Math.max(256,2*t));null!=this.buf&&(new Uint8Array(e).set(new Uint8Array(this.buf)),this.buf=void 0),this.buf=e,this.vew=void 0,this.vew=new DataView(this.buf)}},s.BinBuffer.prototype.getBuffer=function(){var t=new ArrayBuffer(this.len);return new Uint8Array(t).set(new Uint8Array(this.buf,0,this.len)),t},s.BinBuffer.prototype.memset=function(t,e,i){this.allocate(i),new Uint8Array(this.buf).set(new Uint8Array(t,e,i),this.position)},s.BinBuffer.prototype.writeInt8=function(t){this.allocate(1),this.vew.setInt8(this.position,t),this.position+=1,this.len=this.position},s.BinBuffer.prototype.writeUInt8=function(t){this.allocate(1),this.vew.setUint8(this.position++,t),this.len=this.position},s.BinBuffer.prototype.writeInt16=function(t){this.allocate(2),this.vew.setInt16(this.position,t),this.position+=2,this.len=this.position},s.BinBuffer.prototype.writeUInt16=function(t){this.allocate(2),this.vew.setUint16(this.position,t),this.position+=2,this.len=this.position},s.BinBuffer.prototype.writeInt32=function(t){this.allocate(4),this.vew.setInt32(this.position,t),this.position+=4,this.len=this.position},s.BinBuffer.prototype.writeUInt32=function(t){this.allocate(4),this.vew.setUint32(this.position,t),this.position+=4,this.len=this.position},s.BinBuffer.prototype.writeInt64=function(t){this.allocate(8),this.vew.setUint32(this.position,parseInt(t/4294967296)),this.vew.setUint32(this.position+4,t%4294967296),this.position+=8,this.len=this.position},s.BinBuffer.prototype.writeFloat=function(t){this.allocate(4),this.vew.setFloat32(this.position,t),this.position+=4,this.len=this.position},s.BinBuffer.prototype.writeDouble=function(t){this.allocate(8),this.vew.setFloat64(this.position,t),this.position+=8,this.len=this.position},s.BinBuffer.prototype.writeString=function(t){for(var e=[],i=0;i<t.length;i++)e.push(255&t.charCodeAt(i));this.allocate(e.length),new Uint8Array(this.buf).set(new Uint8Array(e),this.position),this.position+=e.length,this.len=this.position},s.BinBuffer.prototype.writeBytes=function(t){0!=t.length&&null!=t.buf&&(this.allocate(t.length),new Uint8Array(this.buf).set(new Uint8Array(t.buf,0,t.length),this.position),this.position+=t.length,this.len=this.position)},s.BinBuffer.prototype.readInt8=function(){return this.vew.getInt8(this.position++)},s.BinBuffer.prototype.readInt16=function(){return this.position+=2,this.vew.getInt16(this.position-2)},s.BinBuffer.prototype.readInt32=function(){return this.position+=4,this.vew.getInt32(this.position-4)},s.BinBuffer.prototype.readUInt8=function(){return this.position+=1,this.vew.getUint8(this.position-1)},s.BinBuffer.prototype.readUInt16=function(){return this.position+=2,this.vew.getUint16(this.position-2)},s.BinBuffer.prototype.readUInt32=function(){return this.position+=4,this.vew.getUint32(this.position-4)},s.BinBuffer.prototype.readInt64=function(){var t=this.vew.getUint32(this.position),e=this.vew.getUint32(this.position+4);return this.position+=8,4294967296*t+e},s.BinBuffer.prototype.readFloat=function(){var t=this.vew.getFloat32(this.position);return this.position+=4,t},s.BinBuffer.prototype.readDouble=function(){var t=this.vew.getFloat64(this.position);return this.position+=8,t},s.BinBuffer.prototype.readString=function(t){for(var e=[],i=0;i<t;i++)e.push(String.fromCharCode(this.vew.getUint8(this.position++)));var s=e.join("");try{s=decodeURIComponent(escape(s))}catch(t){}return s},s.BinBuffer.prototype.readBytes=function(t){var e=new s.BinBuffer;return e.allocate(t),e.memset(this.buf,this.position,t),e.position=0,e.len=t,this.position=this.position+t,e},s.JceOutputStream=function(){this.buf=new s.BinBuffer,this.getBinBuffer=function(){return this.buf},this.getBuffer=function(){return this.buf.getBuffer()}},s.JceOutputStream.prototype.clear=function(){return this.buf=new s.BinBuffer,this},s.JceOutputStream.prototype.writeTo=function(t,e){t<15?this.buf.writeUInt8(t<<4&240|e):this.buf.writeUInt16((240|e)<<8|t)},s.JceOutputStream.prototype.writeBoolean=function(t,e){this.writeInt8(t,1==e?1:0)},s.JceOutputStream.prototype.writeInt8=function(t,e){0==e?this.writeTo(t,s.DataHelp.EN_ZERO):(this.writeTo(t,s.DataHelp.EN_INT8),this.buf.writeInt8(e))},s.JceOutputStream.prototype.writeInt16=function(t,e){e>=-128&&e<=127?this.writeInt8(t,e):(this.writeTo(t,s.DataHelp.EN_INT16),this.buf.writeInt16(e))},s.JceOutputStream.prototype.writeInt32=function(t,e){e>=-32768&&e<=32767?this.writeInt16(t,e):(this.writeTo(t,s.DataHelp.EN_INT32),this.buf.writeInt32(e))},s.JceOutputStream.prototype.writeInt64=function(t,e){e>=-2147483648&&e<=2147483647?this.writeInt32(t,e):(this.writeTo(t,s.DataHelp.EN_INT64),this.buf.writeInt64(e))},s.JceOutputStream.prototype.writeUInt8=function(t,e){this.writeInt16(t,e)},s.JceOutputStream.prototype.writeUInt16=function(t,e){this.writeInt32(t,e)},s.JceOutputStream.prototype.writeUInt32=function(t,e){this.writeInt64(t,e)},s.JceOutputStream.prototype.writeFloat=function(t,e){0==e?this.writeTo(t,s.DataHelp.EN_ZERO):(this.writeTo(t,s.DataHelp.EN_FLOAT),this.buf.writeFloat(e))},s.JceOutputStream.prototype.writeDouble=function(t,e){0==e?this.writeTo(t,s.DataHelp.EN_ZERO):(this.writeTo(t,s.DataHelp.EN_DOUBLE),this.buf.writeDouble(e))},s.JceOutputStream.prototype.writeStruct=function(t,e){if(null==e.writeTo)throw Error("not defined writeTo Function");this.writeTo(t,s.DataHelp.EN_STRUCTBEGIN),e.writeTo(this),this.writeTo(0,s.DataHelp.EN_STRUCTEND)},s.JceOutputStream.prototype.writeString=function(t,e){var i=e;try{i=unescape(encodeURIComponent(i))}catch(t){}i.length>255?(this.writeTo(t,s.DataHelp.EN_STRING4),this.buf.writeUInt32(i.length)):(this.writeTo(t,s.DataHelp.EN_STRING1),this.buf.writeUInt8(i.length)),this.buf.writeString(i)},s.JceOutputStream.prototype.writeBytes=function(t,e){this.writeTo(t,s.DataHelp.EN_SIMPLELIST),this.writeTo(0,s.DataHelp.EN_INT8),this.writeInt32(0,e.length),this.buf.writeBytes(e)},s.JceOutputStream.prototype.writeVector=function(t,e){this.writeTo(t,s.DataHelp.EN_LIST),this.writeInt32(0,e.value.length);for(var i=0;i<e.value.length;i++)e.proto._write(this,0,e.value[i])},s.JceOutputStream.prototype.writeMap=function(t,e){for(var i in this.writeTo(t,s.DataHelp.EN_MAP),this.writeInt32(0,e.size()),e.value)e.kproto._write(this,0,i),e.vproto._write(this,1,e.value[i])},s.JceInputStream=function(t){this.buf=new s.BinBuffer(t)},s.JceInputStream.prototype.setBuffer=function(t){return this.buf=new s.BinBuffer(t),this},s.JceInputStream.prototype.readFrom=function(){var t=this.buf.readUInt8(),e=(240&t)>>4,i=15&t;return e>=15&&(e=this.buf.readUInt8()),{tag:e,type:i}},s.JceInputStream.prototype.peekFrom=function(){var t=this.buf.position,e=this.readFrom();return this.buf.position=t,{tag:e.tag,type:e.type,size:e.tag>=15?2:1}},s.JceInputStream.prototype.skipField=function(t){switch(t){case s.DataHelp.EN_INT8:this.buf.position+=1;break;case s.DataHelp.EN_INT16:this.buf.position+=2;break;case s.DataHelp.EN_INT32:this.buf.position+=4;break;case s.DataHelp.EN_INT64:this.buf.position+=8;break;case s.DataHelp.EN_STRING1:var e=this.buf.readUInt8();this.buf.position+=e;break;case s.DataHelp.EN_STRING4:var i=this.buf.readInt32();this.buf.position+=i;break;case s.DataHelp.EN_STRUCTBEGIN:this.skipToStructEnd();break;case s.DataHelp.EN_STRUCTEND:case s.DataHelp.EN_ZERO:break;case s.DataHelp.EN_MAP:for(var r=this.readInt32(0,!0),a=0;a<2*r;++a){var o=this.readFrom();this.skipField(o.type)}break;case s.DataHelp.EN_SIMPLELIST:if((o=this.readFrom()).type!=s.DataHelp.EN_INT8)throw Error("skipField with invalid type, type value: "+t+","+o.type);e=this.readInt32(0,!0),this.buf.position+=e;break;case s.DataHelp.EN_LIST:for(r=this.readInt32(0,!0),a=0;a<r;++a)o=this.readFrom(),this.skipField(o.type);break;default:throw new Error("skipField with invalid type, type value: "+t)}},s.JceInputStream.prototype.skipToStructEnd=function(){for(;;){var t=this.readFrom();if(this.skipField(t.type),t.type==s.DataHelp.EN_STRUCTEND)return}},s.JceInputStream.prototype.skipToTag=function(t,e){for(;this.buf.position<this.buf.length;){var i=this.peekFrom();if(t<=i.tag||i.type==s.DataHelp.EN_STRUCTEND)return i.type!=s.DataHelp.EN_STRUCTEND&&t==i.tag;this.buf.position+=i.size,this.skipField(i.type)}if(e)throw Error("require field not exist, tag:"+t);return!1},s.JceInputStream.prototype.readBoolean=function(t,e,i){return 1==this.readInt8(t,e,i)},s.JceInputStream.prototype.readInt8=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();switch(r.type){case s.DataHelp.EN_ZERO:return 0;case s.DataHelp.EN_INT8:return this.buf.readInt8()}throw Error("read int8 type mismatch, tag:"+t+", get type:"+r.type)},s.JceInputStream.prototype.readInt16=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();switch(r.type){case s.DataHelp.EN_ZERO:return 0;case s.DataHelp.EN_INT8:return this.buf.readInt8();case s.DataHelp.EN_INT16:return this.buf.readInt16()}throw Error("read int8 type mismatch, tag:"+t+", get type:"+r.type)},s.JceInputStream.prototype.readInt32=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();switch(r.type){case s.DataHelp.EN_ZERO:return 0;case s.DataHelp.EN_INT8:return this.buf.readInt8();case s.DataHelp.EN_INT16:return this.buf.readInt16();case s.DataHelp.EN_INT32:return this.buf.readInt32()}throw Error("read int8 type mismatch, tag:"+t+", get type:"+r.type)},s.JceInputStream.prototype.readInt64=function(t,e,i){if(0==this.skipToTag(t,e))return i;switch(this.readFrom().type){case s.DataHelp.EN_ZERO:return 0;case s.DataHelp.EN_INT8:return this.buf.readInt8();case s.DataHelp.EN_INT16:return this.buf.readInt16();case s.DataHelp.EN_INT32:return this.buf.readInt32();case s.DataHelp.EN_INT64:return this.buf.readInt64()}throw Error("read int64 type mismatch, tag:"+t+", get type:"+h.type)},s.JceInputStream.prototype.readFloat=function(t,e,i){if(0==this.skipToTag(t,e))return i;switch(this.readFrom().type){case s.DataHelp.EN_ZERO:return 0;case s.DataHelp.EN_FLOAT:return this.buf.readFloat()}throw Error("read float type mismatch, tag:"+t+", get type:"+h.type)},s.JceInputStream.prototype.readDouble=function(t,e,i){if(0==this.skipToTag(t,e))return i;switch(this.readFrom().type){case s.DataHelp.EN_ZERO:return 0;case s.DataHelp.EN_DOUBLE:return this.buf.readDouble()}throw Error("read double type mismatch, tag:"+t+", get type:"+h.type)},s.JceInputStream.prototype.readUInt8=function(t,e,i){return this.readInt16(t,e,i)},s.JceInputStream.prototype.readUInt16=function(t,e,i){return this.readInt32(t,e,i)},s.JceInputStream.prototype.readUInt32=function(t,e,i){return this.readInt64(t,e,i)},s.JceInputStream.prototype.readStruct=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();if(r.type!=s.DataHelp.EN_STRUCTBEGIN)throw Error("read struct type mismatch, tag: "+t+", get type:"+r.type);return i.readFrom(this),this.skipToStructEnd(),i},s.JceInputStream.prototype.readString=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();if(r.type==s.DataHelp.EN_STRING1)return this.buf.readString(this.buf.readUInt8());if(r.type==s.DataHelp.EN_STRING4)return this.buf.readString(this.buf.readUInt32());throw Error("read 'string' type mismatch, tag: "+t+", get type: "+r.type+".")},s.JceInputStream.prototype.readString2=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();if(r.type==s.DataHelp.EN_STRING1)return this.buf.readBytes(this.buf.readUInt8());if(r.type==s.DataHelp.EN_STRING4)return this.buf.readBytes(this.buf.readUInt32());throw Error("read 'string' type mismatch, tag: "+t+", get type: "+r.type+".")},s.JceInputStream.prototype.readBytes=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();if(r.type==s.DataHelp.EN_SIMPLELIST){var a=this.readFrom();if(a.type!=s.DataHelp.EN_INT8)throw Error("type mismatch, tag:"+t+",type:"+r.type+","+a.type);if((o=this.readInt32(0,!0))<0)throw Error("invalid size, tag:"+t+",type:"+r.type+","+a.type);return this.buf.readBytes(o)}if(r.type==s.DataHelp.EN_LIST){var o=this.readInt32(0,!0);return this.buf.readBytes(o)}throw Error("type mismatch, tag:"+t+",type:"+r.type)},s.JceInputStream.prototype.readVector=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();if(r.type!=s.DataHelp.EN_LIST)throw Error("read 'vector' type mismatch, tag: "+t+", get type: "+r.type);var a=this.readInt32(0,!0);if(a<0)throw Error("invalid size, tag: "+t+", type: "+r.type+", size: "+a);for(var o=0;o<a;++o)i.value.push(i.proto._read(this,0,i.proto._clone()));return i},s.JceInputStream.prototype.readMap=function(t,e,i){if(0==this.skipToTag(t,e))return i;var r=this.readFrom();if(r.type!=s.DataHelp.EN_MAP)throw Error("read 'map' type mismatch, tag: "+t+", get type: "+r.type);var a=this.readInt32(0,!0);if(a<0)throw Error("invalid map, tag: "+t+", size: "+a);for(var o=0;o<a;o++){var n=i.kproto._read(this,0,i.kproto._clone()),h=i.vproto._read(this,1,i.vproto._clone());i.put(n,h)}return i},s.Wup=function(){this.iVersion=3,this.cPacketType=0,this.iMessageType=0,this.iRequestId=0,this.sServantName="",this.sFuncName="",this.sBuffer=new s.BinBuffer,this.iTimeout=0,this.context=new s.Map(new s.STRING,new s.STRING),this.status=new s.Map(new s.STRING,new s.STRING),this.data=new s.Map(new s.STRING,new s.Map(new s.STRING,new s.BinBuffer)),this.newdata=new s.Map(new s.STRING,new s.BinBuffer),this.iStream=new s.JceInputStream,this.oStream=new s.JceOutputStream},s.Wup.prototype.hasKey=function(t){return this.newdata.hasKey(t)},s.Wup.prototype.setVersion=function(t){this.iVersion=t},s.Wup.prototype.getVersion=function(t){return this.iVersion},s.Wup.prototype.setServant=function(t){this.sServantName=t},s.Wup.prototype.setFunc=function(t){this.sFuncName=t},s.Wup.prototype.setRequestId=function(t){this.iRequestId=t||++this.iRequestId},s.Wup.prototype.getRequestId=function(){return this.iRequestId},s.Wup.prototype.setTimeOut=function(t){this.iTimeout=t},s.Wup.prototype.getTimeOut=function(){return this.iTimeout},s.Wup.prototype.writeTo=function(){var t=this.oStream.clear();return t.writeInt16(1,this.iVersion),t.writeInt8(2,this.cPacketType),t.writeInt32(3,this.iMessageType),t.writeInt32(4,this.iRequestId),t.writeString(5,this.sServantName),t.writeString(6,this.sFuncName),t.writeBytes(7,this.sBuffer),t.writeInt32(8,this.iTimeout),t.writeMap(9,this.context),t.writeMap(10,this.status),new s.BinBuffer(t.getBuffer())},s.Wup.prototype.encode=function(){var t=this.oStream.clear();3==this.iVersion?t.writeMap(0,this.newdata):t.writeMap(0,this.data),this.sBuffer=t.getBinBuffer();var e=this.writeTo(),i=new s.BinBuffer;return i.writeInt32(4+e.len),i.writeBytes(e),i},s.Wup.prototype.writeBoolean=function(t,e){var i=this.oStream.clear();if(i.writeBoolean(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=TAF.TypeHelp.BOOLEAN;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new s.BinBuffer(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeInt8=function(t,e){var i=this.oStream.clear();if(i.writeInt8(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=TAF.TypeHelp.CHAR;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new s.BinBuffer(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeInt16=function(t,e){var i=this.oStream.clear();if(i.writeInt16(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=TAF.TypeHelp.SHORT;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeInt32=function(t,e){var i=this.oStream.clear();if(i.writeInt32(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=TAF.TypeHelp.INT32;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeInt64=function(t,e){var i=this.oStream.clear();if(i.writeInt64(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=TAF.TypeHelp.INT64;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeFloat=function(t,e){var i=this.oStream.clear();if(i.writeFloat(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=TAF.TypeHelp.FLOAT;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeDouble=function(t,e){var i=this.oStream.clear();if(i.writeDouble(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=TAF.TypeHelp.DOUBLE;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeString=function(t,e){var i=this.oStream.clear();if(i.writeString(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=s.TypeHelp.STRING;null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeVector=function(t,e){var i=this.oStream.clear();if(i.writeVector(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBinBuffer()));else{var r=this.data.get(t),a=e._className();null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeStruct=function(t,e){var i=this.oStream.clear();if(i.writeStruct(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t);null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(" ",new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeBytes=function(t,e){var i=this.oStream.clear();if(i.writeBytes(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t);null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put("vec",new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.writeMap=function(t,e){var i=this.oStream.clear();if(i.writeMap(0,e),3==this.iVersion)this.newdata.put(t,new s.BinBuffer(i.getBuffer()));else{var r=this.data.get(t),a=s.Util.getClassType(e);null==r&&(r=new s.Map(s.STRING,s.STRING)),r.put(a,new Uint8Array(i.getBuffer())),this.data.put(t,r)}},s.Wup.prototype.readFrom=function(t){this.iVersion=t.readInt16(1,!0),this.cPacketType=t.readInt8(2,!0),this.iMessageType=t.readInt32(3,!0),this.iRequestId=t.readInt32(4,!0),this.sServantName=t.readString(5,!0),this.sFuncName=t.readString(6,!0),localStorage.__wup&&console.info("%c@@@ "+this.sServantName+"."+this.sFuncName,"color:white;background:black;",this),this.sBuffer=t.readBytes(7,!0),this.iTimeout=t.readInt32(8,!0),this.context=t.readMap(9,!0,this.context),this.status=t.readMap(10,!0,this.status)},s.Wup.prototype.decode=function(t){var e=this.iStream.setBuffer(t);if(e.buf.vew.getInt32(e.buf.position)<4)throw Error("packet length too short");e.buf.position+=4,this.readFrom(e),e=this.iStream.setBuffer(this.sBuffer.getBuffer()),3==this.iVersion?(this.newdata.clear(),e.readMap(0,!0,this.newdata)):(this.data.clear(),e.readMap(0,!0,this.data))},s.Wup.prototype.readBoolean=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=this.iStream.setBuffer(e.buffer).readBoolean(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.TypeHelp.BOOLEAN,a=e.get(r);if(null==a)throw Error("UniAttribute not found type:"+r);i=this.iStream.setBuffer(a).readBoolean(0,!0,i)}return i},s.Wup.prototype.readInt8=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=this.iStream.setBuffer(e.buffer).readInt8(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.TypeHelp.CHAR,a=e.get(r);if(null==a)throw Error("UniAttribute not found type:"+r);i=this.iStream.setBuffer(a).readInt8(0,!0,i)}return i},s.Wup.prototype.readInt16=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=(o=this.iStream.setBuffer(e.buffer)).readInt16(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.TypeHelp.SHORT,a=e.get(r),o=this.iStream.setBuffer(a);if(null==a)throw Error("UniAttribute not found type:"+r);i=o.readInt16(0,!0,i)}return i},s.Wup.prototype.readInt32=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=this.iStream.setBuffer(e.buffer).readInt32(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.TypeHelp.INT32,a=e.get(r);if(null==a)throw Error("UniAttribute not found type:"+r);i=this.iStream.setBuffer(a).readInt32(0,!0,i)}return i},s.Wup.prototype.readInt64=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=this.iStream.setBuffer(e.buffer).readInt64(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.TypeHelp.INT64,a=e.get(r);if(null==a)throw Error("UniAttribute not found type:"+r);i=this.iStream.setBuffer(a).readInt64(0,!0,i)}return i},s.Wup.prototype.readFloat=function(t){var e,i;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);i=this.iStream.setBuffer(e.buffer).readFloat(0,!0,i)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.TypeHelp.FLOAT,a=e.get(r);if(null==a)throw Error("UniAttribute not found type:"+r);i=this.iStream.setBuffer(a).readFloat(0,!0,i)}return i},s.Wup.prototype.readDouble=function(t){var e;if(3==this.iVersion){if(null==(e=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);var i=this.iStream.setBuffer(e.buffer);def=i.readDouble(0,!0,def)}else{if(null==(e=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.TypeHelp.DOUBLE,a=e.get(r);if(null==a)throw Error("UniAttribute not found type:"+r);i=this.iStream.setBuffer(a),def=i.readDouble(0,!0,def)}return def},s.Wup.prototype.readVector=function(t,e,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);e=this.iStream.setBuffer(s.buffer).readVector(0,!0,e)}else{if(null==(s=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);e=this.iStream.setBuffer(r).readVector(0,!0,e)}return e},s.Wup.prototype.readStruct=function(t,e,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);e=this.iStream.setBuffer(s.buffer).readStruct(0,!0,e)}else{if(null==(s=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);e=this.iStream.setBuffer(r).readStruct(0,!0,e)}return e},s.Wup.prototype.readMap=function(t,e,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);e=this.iStream.setBuffer(s.buffer).readMap(0,!0,e)}else{if(null==(s=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);e=this.iStream.setBuffer(r).readMap(0,!0,e)}return e},s.Wup.prototype.readBytes=function(t,e,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(t)))throw Error("UniAttribute not found key:"+t);e=this.iStream.setBuffer(s.buffer).readBytes(0,!0,e)}else{if(null==(s=this.data.get(t)))throw Error("UniAttribute not found key:"+t);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);e=this.iStream.setBuffer(r).readBytes(0,!0,e)}return e},s.Util=s.Util||{},s.Util.jcestream=function(t,e){if(null!=t&&null!=t)if(t instanceof ArrayBuffer){e=e||16;for(var i=new Uint8Array(t),s="",r=0;r<i.length;r++)0!=r&&r%e==0?s+="\n":0!=r&&(s+=" "),s+=(i[r]>15?"":"0")+i[r].toString(16);console.log(s.toUpperCase())}else console.log("Taf.Util.jcestream::value is not ArrayBuffer");else console.log("Taf.Util.jcestream::value is null or undefined")},s.Util.str2ab=function(t){var e,i=t.length,s=new Array(i);for(e=0;e<i;++e)s[e]=t.charCodeAt(e);return new Uint8Array(s).buffer},s.Util.ajax=function(t,e,i,r){var a=new XMLHttpRequest;a.overrideMimeType("text/plain; charset=x-user-defined"),a.addEventListener("readystatechange",(function t(){4===a.readyState&&(200===a.status||304===a.status?i(s.Util.str2ab(a.response)):r(a.status),a.removeEventListener("readystatechange",t),a=void 0)})),a.open("post",t),a.send(e)}},function(t,e,i){var s=i(14),r=i(23),a=i(42)("IE_PROTO"),o=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),s(t,a)?t[a]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?o:null}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,i){t.exports=!i(6)&&!i(15)((function(){return 7!=Object.defineProperty(i(76)("div"),"a",{get:function(){return 7}}).a}))},function(t,e,i){var s=i(11),r=i(8).document,a=s(r)&&s(r.createElement);t.exports=function(t){return a?r.createElement(t):{}}},function(t,e,i){"use strict";e.__esModule=!0;var s=o(i(118)),r=o(i(128)),a="function"==typeof r.default&&"symbol"==typeof s.default?function(t){return typeof t}:function(t){return t&&"function"==typeof r.default&&t.constructor===r.default&&t!==r.default.prototype?"symbol":typeof t};function o(t){return t&&t.__esModule?t:{default:t}}e.default="function"==typeof r.default&&"symbol"===a(s.default)?function(t){return void 0===t?"undefined":a(t)}:function(t){return t&&"function"==typeof r.default&&t.constructor===r.default&&t!==r.default.prototype?"symbol":void 0===t?"undefined":a(t)}},function(t,e,i){t.exports=i(12)},function(t,e,i){var s=i(14),r=i(18),a=i(123)(!1),o=i(42)("IE_PROTO");t.exports=function(t,e){var i,n=r(t),h=0,d=[];for(i in n)i!=o&&s(n,i)&&d.push(i);for(;e.length>h;)s(n,i=e[h++])&&(~a(d,i)||d.push(i));return d}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,i){var s=i(49);t.exports=Array.isArray||function(t){return"Array"==s(t)}},function(t,e,i){var s=i(79),r=i(51).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return s(t,r)}},function(t,e,i){var s=i(33),r=i(29),a=i(18),o=i(44),n=i(14),h=i(75),d=Object.getOwnPropertyDescriptor;e.f=i(6)?d:function(t,e){if(t=a(t),e=o(e,!0),h)try{return d(t,e)}catch(t){}if(n(t,e))return r(!s.f.call(t,e),t[e])}},function(t,e){},function(t,e,i){"use strict";var s,r="object"==typeof Reflect?Reflect:null,a=r&&"function"==typeof r.apply?r.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};s=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var o=Number.isNaN||function(t){return t!=t};function n(){n.init.call(this)}t.exports=n,t.exports.once=function(t,e){return new Promise((function(i,s){function r(i){t.removeListener(e,a),s(i)}function a(){"function"==typeof t.removeListener&&t.removeListener("error",r),i([].slice.call(arguments))}g(t,e,a,{once:!0}),"error"!==e&&function(t,e,i){"function"==typeof t.on&&g(t,"error",e,{once:!0})}(t,r)}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var h=10;function d(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function l(t){return void 0===t._maxListeners?n.defaultMaxListeners:t._maxListeners}function u(t,e,i,s){var r,a,o,n;if(d(i),void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),a=t._events),o=a[e]),void 0===o)o=a[e]=i,++t._eventsCount;else if("function"==typeof o?o=a[e]=s?[i,o]:[o,i]:s?o.unshift(i):o.push(i),(r=l(t))>0&&o.length>r&&!o.warned){o.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=o.length,n=h,console&&console.warn&&console.warn(n)}return t}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(t,e,i){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},r=c.bind(s);return r.listener=i,s.wrapFn=r,r}function m(t,e,i){var s=t._events;if(void 0===s)return[];var r=s[e];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(r):_(r,r.length)}function f(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function _(t,e){for(var i=new Array(e),s=0;s<e;++s)i[s]=t[s];return i}function g(t,e,i,s){if("function"==typeof t.on)s.once?t.once(e,i):t.on(e,i);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function r(a){s.once&&t.removeEventListener(e,r),i(a)}))}}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");h=t}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},n.prototype.getMaxListeners=function(){return l(this)},n.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var s="error"===t,r=this._events;if(void 0!==r)s=s&&void 0===r.error;else if(!s)return!1;if(s){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var n=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw n.context=o,n}var h=r[t];if(void 0===h)return!1;if("function"==typeof h)a(h,this,e);else{var d=h.length,l=_(h,d);for(i=0;i<d;++i)a(l[i],this,e)}return!0},n.prototype.addListener=function(t,e){return u(this,t,e,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(t,e){return u(this,t,e,!0)},n.prototype.once=function(t,e){return d(e),this.on(t,p(this,t,e)),this},n.prototype.prependOnceListener=function(t,e){return d(e),this.prependListener(t,p(this,t,e)),this},n.prototype.removeListener=function(t,e){var i,s,r,a,o;if(d(e),void 0===(s=this._events))return this;if(void 0===(i=s[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===e||i[a].listener===e){o=i[a].listener,r=a;break}if(r<0)return this;0===r?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,r),1===i.length&&(s[t]=i[0]),void 0!==s.removeListener&&this.emit("removeListener",t,o||e)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(t){var e,i,s;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var r,a=Object.keys(i);for(s=0;s<a.length;++s)"removeListener"!==(r=a[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this},n.prototype.listeners=function(t){return m(this,t,!0)},n.prototype.rawListeners=function(t){return m(this,t,!1)},n.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):f.call(t,e)},n.prototype.listenerCount=f,n.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]}},function(t,e,i){var s=i(12);t.exports=function(t,e,i){for(var r in e)i&&t[r]?t[r]=e[r]:s(t,r,e[r]);return t}},function(t,e){t.exports=function(t,e,i,s){if(!(t instanceof e)||void 0!==s&&s in t)throw TypeError(i+": incorrect invocation!");return t}},function(t,e,i){var s=i(89),r=i(7)("iterator"),a=i(25);t.exports=i(4).getIteratorMethod=function(t){if(null!=t)return t[r]||t["@@iterator"]||a[s(t)]}},function(t,e,i){var s=i(49),r=i(7)("toStringTag"),a="Arguments"==s(function(){return arguments}());t.exports=function(t){var e,i,o;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),r))?i:a?s(e):"Object"==(o=s(e))&&"function"==typeof e.callee?"Arguments":o}},function(t,e,i){var s=i(11);t.exports=function(t,e){if(!s(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}},function(t,e,i){var s={"./CdnAllocateInfo":57,"./CdnAllocateInfo.js":57,"./CdnGroupID":20,"./CdnGroupID.js":20,"./CurrentCdnProxyInfo":59,"./CurrentCdnProxyInfo.js":59,"./PCDNGetProxyListReq":92,"./PCDNGetProxyListReq.js":92,"./PCDNGetProxyListRsp":93,"./PCDNGetProxyListRsp.js":93,"./PP2pSliceAudioData":94,"./PP2pSliceAudioData.js":94,"./PP2pSliceAudioDataV2":95,"./PP2pSliceAudioDataV2.js":95,"./PP2pSliceAudioDataV3":96,"./PP2pSliceAudioDataV3.js":96,"./PP2pSliceControlData":97,"./PP2pSliceControlData.js":97,"./PP2pSliceData":60,"./PP2pSliceData.js":60,"./PP2pSliceVideoData":98,"./PP2pSliceVideoData.js":98,"./SlaveProxyInfo":36,"./SlaveProxyInfo.js":36,"./StreamCodecType":58,"./StreamCodecType.js":58};function r(t){var e=a(t);return i(e)}function a(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}r.keys=function(){return Object.keys(s)},r.resolve=a,t.exports=r,r.id=91},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=l(i(159)),r=l(i(10)),a=l(i(0)),o=l(i(1)),n=l(i(3)),h=l(i(2)),d=(l(i(20)),l(i(59)));function l(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(){(0,a.default)(this,t),this.uid=0,this.version=0,this.cdnGroupIdList=[],this.currentInfo=new d.default,this.appid=0,this.clientAppid=0,this.clientType=0,this.ip=0,this.sendTime=0,this.sdkVersion=0,this.imsi=0,this.appId=0,this.anchorStreamNam2UId=new r.default}return(0,o.default)(t,[{key:"marshall",value:function(){var t=new h.default;t.setUri(n.default.PCDNGetProxyListReq),t.pushUInt64(this.uid),t.pushUInt8(this.version),t.pushUInt32(this.cdnGroupIdList.length),this.cdnGroupIdList.forEach((function(e){t.pushUint8ArrayWithoutLen(e.marshall())})),t.pushUint8ArrayWithoutLen(this.currentInfo.marshall()),t.pushUInt8(this.appid),t.pushUInt32(this.clientAppid),t.pushUInt32(this.clientType),t.pushUInt32(this.ip),t.pushUInt32(this.sendTime),t.pushUInt32(this.sdkVersion),t.pushUInt64(this.imsi),t.pushUInt32(this.appId),t.pushUInt32(this.anchorStreamNam2UId.size);var e=!0,i=!1,r=void 0;try{for(var a,o=(0,s.default)(this.anchorStreamNam2UId.keys());!(e=(a=o.next()).done);e=!0){var d=a.value;t.pushString(d),t.pushUInt64(this.anchorStreamNam2UId.get(d))}}catch(t){i=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw r}}return t.marshall()}}]),t}();e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o(i(0)),r=o(i(1)),a=(o(i(3)),o(i(57)));function o(t){return t&&t.__esModule?t:{default:t}}var n=function(){function t(){(0,s.default)(this,t),this.uid=0,this.allocatedStreams=[],this.clientAppid=0,this.clientType=0,this.sendTime=0,this.userArea=0,this.videoGroupId=0,this.retryType=0,this.retryFreq=0,this.result=0,this.proxyType=0,this.tokenVersion=0,this.sslUrl="",this.appId=0}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.uid=t.popUInt64(),this.allocatedStreams=[];for(var e=t.popUInt32(),i=0;i<e;i++){var s=new a.default;this.allocatedStreams.push(s.unmarshall(t))}return this.clientAppid=t.popUInt32(),this.clientType=t.popUInt32(),this.sendTime=t.popUInt32(),this.userArea=t.popUInt32(),this.videoGroupId=t.popUInt32(),this.retryType=t.popUInt8(),this.retryFreq=t.popUInt16(),this.result=t.popUInt32(),this.proxyType=t.popUInt32(),this.tokenVersion=t.popUInt32(),this.sslUrl=t.popString(),this.appId=t.popUInt32(),this}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(3)),o=n(i(2));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.seq=0,this.checkSum=0,this.codecType=0,this.streamData=null}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new o.default;return t.setUri(a.default.PP2pSliceAudioData),t.pushUInt8(this.checkSum),t.pushUInt16(this.codecType),t.pushUint8Array(this.streamData),t.marshall()}},{key:"unmarshall",value:function(t){return this.checkSum=t.popUInt8(),this.codecType=t.popUInt16(),this.streamData=t.popUint8Array(),this}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(2)),o=n(i(3));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.checkSum=0,this.codecType=0,this.seqNum=0,this.frameNum=0,this.frameId=0,this.audioHeader=null,this.streamData=null}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new a.default;t.setUri(o.default.PP2pSliceAudioDataV2),t.pushUInt8(this.checkSum),t.pushUInt16(this.codecType),t.pushUInt16(this.seqNum),t.pushUInt16(this.frameNum),t.pushUInt32(this.frameId),t.pushUint8Array(this.audioHeader),t.pushUint8Array(this.streamData)}},{key:"unmarshall",value:function(t){this.checkSum=t.popUInt8(),this.codecType=t.popUInt16(),this.seqNum=t.popUInt16(),this.frameNum=t.popUInt16(),this.frameId=t.popUInt32(),this.audioHeader=t.popUint8Array(),this.streamData=t.popUint8Array()}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(2)),o=n(i(3));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.checkSum=0,this.codecType=0,this.seqNum=0,this.frameNum=0,this.frameId=0,this.audioHeader=null,this.streamData=null}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new a.default;return t.setUri(o.default.PP2pSliceAudioDataV3),t.pushUInt8(this.checkSum),t.pushUInt16(this.codecType),t.pushUInt16(this.seqNum),t.pushUInt16(this.frameNum),t.pushUInt32(this.frameId),t.pushUint8Array(this.audioHeader),t.pushUint8Array(this.streamData),t.marshall()}},{key:"unmarshall",value:function(t){this.checkSum=t.popUInt8(),this.codecType=t.popUInt16(),this.seqNum=t.popUInt16(),this.frameNum=t.popUInt16(),this.frameId=t.popUInt32(),this.audioHeader=t.popUint8Array(),this.streamData=t.popUint8Array()}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(3)),o=n(i(2));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.seq=0,this.strData=null}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new o.default;return t.setUri(a.default.PP2pSliceControlData),t.pushUint8Array(this.strData),t.marshall()}},{key:"unmarshall",value:function(t){return this.strData=t.popUint8Array(),this}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=h(i(10)),r=h(i(0)),a=h(i(1)),o=h(i(3)),n=h(i(2));function h(t){return t&&t.__esModule?t:{default:t}}var d=function(){function t(){(0,r.default)(this,t),this.seq=0,this.uid=0,this.isResend=!1,this.checkSum=0,this.seqNum=0,this.frameNum=0,this.frameId=0,this.config=new s.default,this.streamData=null}return(0,a.default)(t,[{key:"marshall",value:function(){var t=new n.default;return t.setUri(o.default.PP2pSliceVideoData),t.pushUInt8(this.checkSum),t.pushUInt16(this.seqNum),t.pushUInt16(this.frameNum),t.pushUInt32(this.frameId),t.pushUInt32(this.config.size),this.config.forEach((function(e,i){t.pushUInt8(i),t.pushUInt32(e)})),t.pushUint8Array(this.streamData),t.marshall()}},{key:"unmarshall",value:function(t){this.checkSum=t.popUInt8(),this.seqNum=t.popUInt16(),this.frameNum=t.popUInt16(),this.frameId=t.popUInt32(),this.config.clear();for(var e=t.popUInt32(),i=0;i<e;i++){var s=t.popUInt8(),r=t.popUInt32();this.config.set(s,r)}return this.streamData=t.popUint8Array(),this}}]),t}();e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o(i(0)),r=o(i(1)),a=o(i(2));function o(t){return t&&t.__esModule?t:{default:t}}var n=function(){function t(){(0,s.default)(this,t),this.strToken=""}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new a.default(!1);return t.pushString(this.strToken),t.marshall()}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(0)),r=a(i(1));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(){(0,s.default)(this,t),this.ip=0,this.tcpPorts=[],this.udpPorts=[]}return(0,r.default)(t,[{key:"unmarshall",value:function(t){return this.ip=t.popUInt32(),this.tcpPorts=t.popUInt16Vector(),this.udpPorts=t.popUInt16Vector(),this}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={ACCEPT_SUBSCRIBE:0,EMPTY_UPLINK_BW:1,DETECT_SUBSCRIBE_CYCLE:2,EMPTY_PEER_INFO:3,SUBSCRIBE_UPLINK_NOT_ENOUGH:4,PUBLISHER_KICK_OFF:5,NOT_SUBSCRIBER:6,INVALID_SUB_STREAM:7,ACCEPT_BY_SUBSCRIBER_UPLINK:9,INVALID_STREAMID:10,SERVER_EMPTY_BW:11,PUBLISHER_LEAVE:12,DIFFERENT_VIDEO_PROXY:13,OLD_VERSION_REQ:14,SUBSCRIBER_NO_PERMISSION:15}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(0)),r=a(i(1));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(){(0,s.default)(this,t),this.ssrc=0,this.framenum=0,this.type=0,this.framebase=0,this.critical=!1,this.payload=null,this.transMode=0,this.packData=!1,this.bHasVideoSid=!1,this.byteVoiceMarks=0,this.capTimeStamp=0,this.m_isMarshalVoiceMarks=!1}return(0,r.default)(t,[{key:"unmarshall",value:function(e){this.capTimeStamp=e.popUInt32(),this.ssrc=e.popUInt8();var i=e.popUInt8();return this.type=e.popUInt16(),this.framebase=e.popUInt32(),this.payload=e.popUint8Array(),e.bytesAvailable()?this.byteVoiceMarks=e.popUInt8():this.byteVoiceMarks=t.VOICE_MARK_KEY_BIT0,this.framenum=i&t.FRAMENUM_MASK,this.critical=!!(i&t.CRITICAL_MASK),this.bHasVideoSid=!!(i&t.VIDEOSID_MASK),this.transMode=1+((i&t.FTMMODE_MASK)>>4),this}},{key:"setIsKeyVoice",value:function(e){this.byteVoiceMarks|=e?t.VOICE_MARK_KEY_BIT0:0}},{key:"isKeyVoice",get:function(){return this.byteVoiceMarks&t.VOICE_MARK_KEY_BIT0}}]),t}();o.FRAMENUM_MASK=15,o.FTMMODE_MASK=48,o.VIDEOSID_MASK=64,o.CRITICAL_MASK=128,o.VOICE_MARK_KEY_BIT0=1,e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o(i(0)),r=o(i(1)),a=o(i(2));function o(t){return t&&t.__esModule?t:{default:t}}var n=function(){function t(){(0,s.default)(this,t),this.strToken=""}return(0,r.default)(t,[{key:"marshall",value:function(){var t=new a.default(!1);return t.pushString(this.strToken),t.marshall()}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={getCookie:function(t){for(var e=t+"=",i=document.cookie.split(";"),s=0,r=i.length;s<r;s++){var a=i[s].trim();if(0==a.indexOf(e))return a.substr(e.length)}return""}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(0)),r=a(i(1));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(){(0,s.default)(this,t),this.listeners={}}return(0,r.default)(t,[{key:"clear",value:function(){this.listeners={}}},{key:"has",value:function(t,e,i){var s=this.listeners[t];if(!s)return!1;for(var r=0,a=s.length;r<a;r++){var o=s[r];if(o.callback==e&&o.thisObj==i)return!0}return!1}},{key:"on",value:function(t,e,i,s){if(!this.has(t,e,i)){var r=this.listeners[t]||[];r.push({priority:s||0,callback:e,thisObj:i,bindCallback:i?e.bind(i):e}),r.sort((function(t,e){return e.priority-t.priority})),this.listeners[t]=r}}},{key:"off",value:function(t,e,i){var s=this.listeners[t];if(s)for(var r=s.length-1;r>=0;r--){var a=s[r];if(a.callback==e&&a.thisObj==i)return void s.splice(r,1)}}},{key:"trigger",value:function(t,e){var i=this.listeners[t];if(i)for(var s=i.length-1;s>=0;s--)(0,i[s].bindCallback)(e)}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(0)),r=a(i(1));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){function t(){(0,s.default)(this,t),this.systime=0,this.encode_delay=0,this.send_buffer=0}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.systime=t.popUInt64(),this.encode_delay=t.popUInt32(),this.send_buffer=t.popUInt32()}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),r=n(i(1)),a=n(i(69)),o=n(i(70));function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function t(){(0,s.default)(this,t),this.anchorSei=new a.default,this.serverSei=new o.default}return(0,r.default)(t,[{key:"unmarshall",value:function(t){this.anchorSei.unmarshall(t),this.serverSei.unmarshall(t)}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=P(i(40)),r=P(i(109)),a=P(i(110)),o=P(i(163)),n=P(i(3)),h=P(i(2)),d=P(i(34)),l=P(i(165)),u=P(i(166)),c=P(i(20)),p=P(i(60)),m=P(i(72)),f=P(i(167)),_=P(i(105)),g=P(i(19)),S=P(i(168)),T=P(i(68)),y=P(i(169)),E=P(i(171)),v=P(i(16)),C=P(i(176));function P(t){return t&&t.__esModule?t:{default:t}}e.default={setLogger:function(t){v.default.logger=t},TafBase:m.default,HUYA:s.default,HUYA_Local:r.default,ProtoUri:n.default,ProtoMarshall:h.default,ProtoUnmarshall:d.default,TafLinkImpl:a.default,NtpImpl:o.default,SignalRttImpl:l.default,TafLinkSignalImpl:u.default,MediaLink:f.default,ListenerImpl:_.default,TimeUtilImpl:g.default,BrowserImpl:E.default,CdnGroupID:c.default,PP2pSliceData:p.default,PcdnVodProxy:C.default,ProtoHandler:T.default,SliceProtoHandler:S.default,SeiProtoHandler:y.default}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,r=(s=i(72))&&s.__esModule?s:{default:s},a={};e.default=a,a.EWebSocketCommandType={EWSCmd_NULL:0,EWSCmd_RegisterReq:1,EWSCmd_RegisterRsp:2,EWSCmd_WupReq:3,EWSCmd_WupRsp:4,EWSCmdC2S_HeartBeat:5,EWSCmdS2C_HeartBeatAck:6,EWSCmdS2C_MsgPushReq:7,EWSCmdC2S_DeregisterReq:8,EWSCmdS2C_DeRegisterRsp:9,EWSCmdC2S_VerifyCookieReq:10,EWSCmdS2C_VerifyCookieRsp:11,EWSCmdC2S_VerifyHuyaTokenReq:12,EWSCmdS2C_VerifyHuyaTokenRsp:13,EWSCmdC2S_UNVerifyReq:14,EWSCmdS2C_UNVerifyRsp:15,EWSCmdC2S_RegisterGroupReq:16,EWSCmdS2C_RegisterGroupRsp:17,EWSCmdC2S_UnRegisterGroupReq:18,EWSCmdS2C_UnRegisterGroupRsp:19,EWSCmdC2S_HeartBeatReq:20,EWSCmdS2C_HeartBeatRsp:21,EWSCmdS2C_MsgPushReq_V2:22},a.WebSocketCommand=function(){this.iCmdType=0,this.vData=new r.default.BinBuffer,this.lRequestId=0,this.traceId=""},a.WebSocketCommand.prototype._clone=function(){return new a.WebSocketCommand},a.WebSocketCommand.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.WebSocketCommand.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.WebSocketCommand.prototype.writeTo=function(t){t.writeInt32(0,this.iCmdType),t.writeBytes(1,this.vData),t.writeInt64(2,this.lRequestId),t.writeString(3,this.traceId)},a.WebSocketCommand.prototype.readFrom=function(t){this.iCmdType=t.readInt32(0,!1,this.iCmdType),this.vData=t.readBytes(1,!1,this.vData),this.lRequestId=t.readInt64(2,!1,this.lRequestId),this.traceId=t.readString(3,!1,this.traceId)},a.WSPushMessage=function(){this.ePushType=0,this.iUri=0,this.sMsg=new r.default.BinBuffer,this.iProtocolType=0,this.sGroupId=""},a.WSPushMessage.prototype._clone=function(){return new a.WSPushMessage},a.WSPushMessage.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.WSPushMessage.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.WSPushMessage.prototype.writeTo=function(t){t.writeInt32(0,this.ePushType),t.writeInt64(1,this.iUri),t.writeBytes(2,this.sMsg),t.writeInt32(3,this.iProtocolType),t.writeString(4,this.sGroupId)},a.WSPushMessage.prototype.readFrom=function(t){this.ePushType=t.readInt32(0,!1,this.ePushType),this.iUri=t.readInt64(1,!1,this.iUri),this.sMsg=t.readBytes(2,!1,this.sMsg),this.iProtocolType=t.readInt32(3,!1,this.iProtocolType),this.sGroupId=t.readString(4,!1,this.sGroupId)},a.WSUserInfo=function(){this.lUid=0,this.bAnonymous=!0,this.sGuid="",this.sToken="",this.lTid=0,this.lSid=0,this.lGroupId=0,this.lGroupType=0,this.sAppId="",this.sUA=""},a.WSUserInfo.prototype._clone=function(){return new a.WSUserInfo},a.WSUserInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.WSUserInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.WSUserInfo.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeBoolean(1,this.bAnonymous),t.writeString(2,this.sGuid),t.writeString(3,this.sToken),t.writeInt64(4,this.lTid),t.writeInt64(5,this.lSid),t.writeInt64(6,this.lGroupId),t.writeInt64(7,this.lGroupType),t.writeString(8,this.sAppId),t.writeString(9,this.sUA)},a.WSUserInfo.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.bAnonymous=t.readBoolean(1,!1,this.bAnonymous),this.sGuid=t.readString(2,!1,this.sGuid),this.sToken=t.readString(3,!1,this.sToken),this.lTid=t.readInt64(4,!1,this.lTid),this.lSid=t.readInt64(5,!1,this.lSid),this.lGroupId=t.readInt64(6,!1,this.lGroupId),this.lGroupType=t.readInt64(7,!1,this.lGroupType),this.sAppId=t.readString(8,!1,this.sAppId),this.sUA=t.readString(9,!1,this.sUA)},a.WSRegisterRsp=function(){this.iResCode=0,this.lRequestId=0,this.sMessage="",this.sBCConnHost=""},a.WSRegisterRsp.prototype._clone=function(){return new a.WSRegisterRsp},a.WSRegisterRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.WSRegisterRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.WSRegisterRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iResCode),t.writeInt64(1,this.lRequestId),t.writeString(2,this.sMessage),t.writeString(3,this.sBCConnHost)},a.WSRegisterRsp.prototype.readFrom=function(t){this.iResCode=t.readInt32(0,!1,this.iResCode),this.lRequestId=t.readInt64(1,!1,this.lRequestId),this.sMessage=t.readString(2,!1,this.sMessage),this.sBCConnHost=t.readString(3,!1,this.sBCConnHost)},a.UserChannelReq=function(){this.tId=new a.UserId,this.lTopcid=0,this.lSubcid=0,this.sSendContent=""},a.UserChannelReq.prototype._clone=function(){return new a.UserChannelReq},a.UserChannelReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.UserChannelReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.UserChannelReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeInt64(1,this.lTopcid),t.writeInt64(2,this.lSubcid),t.writeString(3,this.sSendContent)},a.UserChannelReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.lTopcid=t.readInt64(1,!1,this.lTopcid),this.lSubcid=t.readInt64(2,!1,this.lSubcid),this.sSendContent=t.readString(3,!1,this.sSendContent)},a.UserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sHuYaUA="",this.sCookie="",this.iTokenType=0},a.UserId.prototype._clone=function(){return new a.UserId},a.UserId.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.UserId.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.UserId.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeString(1,this.sGuid),t.writeString(2,this.sToken),t.writeString(3,this.sHuYaUA),t.writeString(4,this.sCookie),t.writeInt32(5,this.iTokenType)},a.UserId.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.sGuid=t.readString(1,!1,this.sGuid),this.sToken=t.readString(2,!1,this.sToken),this.sHuYaUA=t.readString(3,!1,this.sHuYaUA),this.sCookie=t.readString(4,!1,this.sCookie),this.iTokenType=t.readInt32(5,!1,this.iTokenType)},a.LiveLaunchReq=function(){this.tId=new a.UserId,this.tLiveUB=new a.LiveUserbase,this.bSupportDomain=0},a.LiveLaunchReq.prototype._clone=function(){return new a.LiveLaunchReq},a.LiveLaunchReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.LiveLaunchReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.LiveLaunchReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeStruct(1,this.tLiveUB),t.writeInt32(2,this.bSupportDomain)},a.LiveLaunchReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.tLiveUB=t.readStruct(1,!1,this.tLiveUB),this.bSupportDomain=t.readInt32(2,!1,this.bSupportDomain)},a.LiveLaunchRsp=function(){this.sGuid="",this.iTime=0,this.vProxyList=new r.default.Vector(new a.LiveProxyValue),this.eAccess=0,this.sClientIp=""},a.LiveLaunchRsp.prototype._clone=function(){return new a.LiveLaunchRsp},a.LiveLaunchRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.LiveLaunchRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.LiveLaunchRsp.prototype.writeTo=function(t){t.writeString(0,this.sGuid),t.writeInt32(1,this.iTime),t.writeVector(2,this.vProxyList),t.writeInt32(3,this.eAccess),t.writeString(4,this.sClientIp)},a.LiveLaunchRsp.prototype.readFrom=function(t){this.sGuid=t.readString(0,!1,this.sGuid),this.iTime=t.readInt32(1,!1,this.iTime),this.vProxyList=t.readVector(2,!1,this.vProxyList),this.eAccess=t.readInt32(3,!1,this.eAccess),this.sClientIp=t.readString(4,!1,this.sClientIp)},a.LiveUserbase=function(){this.eSource=0,this.eType=0,this.tUAEx=new a.LiveAppUAEx},a.LiveUserbase.prototype._clone=function(){return new a.LiveUserbase},a.LiveUserbase.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.LiveUserbase.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.LiveUserbase.prototype.writeTo=function(t){t.writeInt32(0,this.eSource),t.writeInt32(1,this.eType),t.writeStruct(2,this.tUAEx)},a.LiveUserbase.prototype.readFrom=function(t){this.eSource=t.readInt32(0,!1,this.eSource),this.eType=t.readInt32(1,!1,this.eType),this.tUAEx=t.readStruct(2,!1,this.tUAEx)},a.LiveAppUAEx=function(){this.sIMEI="",this.sAPN="",this.sNetType="",this.sDeviceId=""},a.LiveAppUAEx.prototype._clone=function(){return new a.LiveAppUAEx},a.LiveAppUAEx.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.LiveAppUAEx.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.LiveAppUAEx.prototype.writeTo=function(t){t.writeString(1,this.sIMEI),t.writeString(2,this.sAPN),t.writeString(3,this.sNetType),t.writeString(4,this.sDeviceId)},a.LiveAppUAEx.prototype.readFrom=function(t){this.sIMEI=t.readString(1,!1,this.sIMEI),this.sAPN=t.readString(2,!1,this.sAPN),this.sNetType=t.readString(3,!1,this.sNetType),this.sDeviceId=t.readString(4,!1,this.sDeviceId)},a.LiveProxyValue=function(){this.eProxyType=0,this.sProxy=new r.default.Vector(new r.default.STRING)},a.LiveProxyValue.prototype._clone=function(){return new a.LiveProxyValue},a.LiveProxyValue.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.LiveProxyValue.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.LiveProxyValue.prototype.writeTo=function(t){t.writeInt32(0,this.eProxyType),t.writeVector(1,this.sProxy)},a.LiveProxyValue.prototype.readFrom=function(t){this.eProxyType=t.readInt32(0,!1,this.eProxyType),this.sProxy=t.readVector(1,!1,this.sProxy)},a.GetLivingInfoReq=function(){this.tId=new a.UserId,this.lTopSid=0,this.lSubSid=0,this.lPresenterUid=0,this.sTraceSource="",this.sPassword="",this.iRoomId=0,this.iFreeFlowFlag=0},a.GetLivingInfoReq.prototype._clone=function(){return new a.GetLivingInfoReq},a.GetLivingInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GetLivingInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GetLivingInfoReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeInt64(1,this.lTopSid),t.writeInt64(2,this.lSubSid),t.writeInt64(3,this.lPresenterUid),t.writeString(4,this.sTraceSource),t.writeString(5,this.sPassword),t.writeInt64(6,this.iRoomId),t.writeInt32(7,this.iFreeFlowFlag)},a.GetLivingInfoReq.prototype.readFrom=function(t){this.tId=t.readStruct(0,!1,this.tId),this.lTopSid=t.readInt64(1,!1,this.lTopSid),this.lSubSid=t.readInt64(2,!1,this.lSubSid),this.lPresenterUid=t.readInt64(3,!1,this.lPresenterUid),this.sTraceSource=t.readString(4,!1,this.sTraceSource),this.sPassword=t.readString(5,!1,this.sPassword),this.iRoomId=t.readInt64(6,!1,this.iRoomId),this.iFreeFlowFlag=t.readInt32(7,!1,this.iFreeFlowFlag)},a.GetLivingInfoRsp=function(){this.bIsLiving=0,this.tNotice=new a.BeginLiveNotice,this.tStreamSettingNotice=new a.StreamSettingNotice,this.bIsSelfLiving=0,this.sMessage=""},a.GetLivingInfoRsp.prototype._clone=function(){return new a.GetLivingInfoRsp},a.GetLivingInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GetLivingInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GetLivingInfoRsp.prototype.writeTo=function(t){t.writeInt32(0,this.bIsLiving),t.writeStruct(1,this.tNotice),t.writeStruct(2,this.tStreamSettingNotice),t.writeInt32(3,this.bIsSelfLiving),t.writeString(4,this.sMessage)},a.GetLivingInfoRsp.prototype.readFrom=function(t){this.bIsLiving=t.readInt32(0,!1,this.bIsLiving),this.tNotice=t.readStruct(1,!1,this.tNotice),this.tStreamSettingNotice=t.readStruct(2,!1,this.tStreamSettingNotice),this.bIsSelfLiving=t.readInt32(3,!1,this.bIsSelfLiving),this.sMessage=t.readString(4,!1,this.sMessage)},a.BeginLiveNotice=function(){this.lPresenterUid=0,this.iGameId=0,this.sGameName="",this.iRandomRange=0,this.iStreamType=0,this.vStreamInfo=new r.default.Vector(new a.StreamInfo),this.vCdnList=new r.default.Vector(new r.default.STRING),this.lLiveId=0,this.iPCDefaultBitRate=0,this.iWebDefaultBitRate=0,this.iMobileDefaultBitRate=0,this.lMultiStreamFlag=0,this.sNick="",this.lYYId=0,this.lAttendeeCount=0,this.iCodecType=0,this.iScreenType=0,this.vMultiStreamInfo=new r.default.Vector(new a.MultiStreamInfo),this.sLiveDesc="",this.lLiveCompatibleFlag=0,this.sAvatarUrl="",this.iSourceType=0,this.sSubchannelName="",this.sVideoCaptureUrl="",this.iStartTime=0,this.lChannelId=0,this.lSubChannelId=0,this.sLocation="",this.iCdnPolicyLevel=0,this.iGameType=0,this.mMiscInfo=new r.default.Map(new r.default.STRING,new r.default.STRING),this.iShortChannel=0,this.iRoomId=0,this.bIsRoomSecret=0,this.iHashPolicy=0},a.BeginLiveNotice.prototype._clone=function(){return new a.BeginLiveNotice},a.BeginLiveNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.BeginLiveNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.BeginLiveNotice.prototype.writeTo=function(t){t.writeInt64(0,this.lPresenterUid),t.writeInt32(1,this.iGameId),t.writeString(2,this.sGameName),t.writeInt32(3,this.iRandomRange),t.writeInt32(4,this.iStreamType),t.writeVector(5,this.vStreamInfo),t.writeVector(6,this.vCdnList),t.writeInt64(7,this.lLiveId),t.writeInt32(8,this.iPCDefaultBitRate),t.writeInt32(9,this.iWebDefaultBitRate),t.writeInt32(10,this.iMobileDefaultBitRate),t.writeInt64(11,this.lMultiStreamFlag),t.writeString(12,this.sNick),t.writeInt64(13,this.lYYId),t.writeInt64(14,this.lAttendeeCount),t.writeInt32(15,this.iCodecType),t.writeInt32(16,this.iScreenType),t.writeVector(17,this.vMultiStreamInfo),t.writeString(18,this.sLiveDesc),t.writeInt64(19,this.lLiveCompatibleFlag),t.writeString(20,this.sAvatarUrl),t.writeInt32(21,this.iSourceType),t.writeString(22,this.sSubchannelName),t.writeString(23,this.sVideoCaptureUrl),t.writeInt32(24,this.iStartTime),t.writeInt64(25,this.lChannelId),t.writeInt64(26,this.lSubChannelId),t.writeString(27,this.sLocation),t.writeInt32(28,this.iCdnPolicyLevel),t.writeInt32(29,this.iGameType),t.writeMap(30,this.mMiscInfo),t.writeInt32(31,this.iShortChannel),t.writeInt32(32,this.iRoomId),t.writeInt32(33,this.bIsRoomSecret),t.writeInt32(34,this.iHashPolicy)},a.BeginLiveNotice.prototype.readFrom=function(t){this.lPresenterUid=t.readInt64(0,!1,this.lPresenterUid),this.iGameId=t.readInt32(1,!1,this.iGameId),this.sGameName=t.readString(2,!1,this.sGameName),this.iRandomRange=t.readInt32(3,!1,this.iRandomRange),this.iStreamType=t.readInt32(4,!1,this.iStreamType),this.vStreamInfo=t.readVector(5,!1,this.vStreamInfo),this.vCdnList=t.readVector(6,!1,this.vCdnList),this.lLiveId=t.readInt64(7,!1,this.lLiveId),this.iPCDefaultBitRate=t.readInt32(8,!1,this.iPCDefaultBitRate),this.iWebDefaultBitRate=t.readInt32(9,!1,this.iWebDefaultBitRate),this.iMobileDefaultBitRate=t.readInt32(10,!1,this.iMobileDefaultBitRate),this.lMultiStreamFlag=t.readInt64(11,!1,this.lMultiStreamFlag),this.sNick=t.readString(12,!1,this.sNick),this.lYYId=t.readInt64(13,!1,this.lYYId),this.lAttendeeCount=t.readInt64(14,!1,this.lAttendeeCount),this.iCodecType=t.readInt32(15,!1,this.iCodecType),this.iScreenType=t.readInt32(16,!1,this.iScreenType),this.vMultiStreamInfo=t.readVector(17,!1,this.vMultiStreamInfo),this.sLiveDesc=t.readString(18,!1,this.sLiveDesc),this.lLiveCompatibleFlag=t.readInt64(19,!1,this.lLiveCompatibleFlag),this.sAvatarUrl=t.readString(20,!1,this.sAvatarUrl),this.iSourceType=t.readInt32(21,!1,this.iSourceType),this.sSubchannelName=t.readString(22,!1,this.sSubchannelName),this.sVideoCaptureUrl=t.readString(23,!1,this.sVideoCaptureUrl),this.iStartTime=t.readInt32(24,!1,this.iStartTime),this.lChannelId=t.readInt64(25,!1,this.lChannelId),this.lSubChannelId=t.readInt64(26,!1,this.lSubChannelId),this.sLocation=t.readString(27,!1,this.sLocation),this.iCdnPolicyLevel=t.readInt32(28,!1,this.iCdnPolicyLevel),this.iGameType=t.readInt32(29,!1,this.iGameType),this.mMiscInfo=t.readMap(30,!1,this.mMiscInfo),this.iShortChannel=t.readInt32(31,!1,this.iShortChannel),this.iRoomId=t.readInt32(32,!1,this.iRoomId),this.bIsRoomSecret=t.readInt32(33,!1,this.bIsRoomSecret),this.iHashPolicy=t.readInt32(34,!1,this.iHashPolicy)},a.StreamSettingNotice=function(){this.lPresenterUid=0,this.iBitRate=0,this.iResolution=0,this.iFrameRate=0,this.lLiveId=0,this.sDisplayName=""},a.StreamSettingNotice.prototype._clone=function(){return new a.StreamSettingNotice},a.StreamSettingNotice.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.StreamSettingNotice.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.StreamSettingNotice.prototype.writeTo=function(t){t.writeInt64(0,this.lPresenterUid),t.writeInt32(1,this.iBitRate),t.writeInt32(2,this.iResolution),t.writeInt32(3,this.iFrameRate),t.writeInt64(4,this.lLiveId),t.writeString(5,this.sDisplayName)},a.StreamSettingNotice.prototype.readFrom=function(t){this.lPresenterUid=t.readInt64(0,!1,this.lPresenterUid),this.iBitRate=t.readInt32(1,!1,this.iBitRate),this.iResolution=t.readInt32(2,!1,this.iResolution),this.iFrameRate=t.readInt32(3,!1,this.iFrameRate),this.lLiveId=t.readInt64(4,!1,this.lLiveId),this.sDisplayName=t.readString(5,!1,this.sDisplayName)},a.StreamInfo=function(){this.sCdnType="",this.iIsMaster=0,this.lChannelId=0,this.lSubChannelId=0,this.lPresenterUid=0,this.sStreamName="",this.sFlvUrl="",this.sFlvUrlSuffix="",this.sFlvAntiCode="",this.sHlsUrl="",this.sHlsUrlSuffix="",this.sHlsAntiCode="",this.iLineIndex=0,this.iIsMultiStream=0,this.iPCPriorityRate=0,this.iWebPriorityRate=0,this.iMobilePriorityRate=0,this.vFlvIPList=new r.default.Vector(new r.default.STRING),this.iIsP2PSupport=0,this.sP2pUrl="",this.sP2pUrlSuffix="",this.sP2pAntiCode="",this.lFreeFlag=0,this.iIsHEVCSupport=0,this.vP2pIPList=new r.default.Vector(new r.default.STRING),this.mpExtArgs=new r.default.Map(new r.default.STRING,new r.default.STRING),this.lTimespan=0},a.StreamInfo.prototype._clone=function(){return new a.StreamInfo},a.StreamInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.StreamInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.StreamInfo.prototype.writeTo=function(t){t.writeString(0,this.sCdnType),t.writeInt32(1,this.iIsMaster),t.writeInt64(2,this.lChannelId),t.writeInt64(3,this.lSubChannelId),t.writeInt64(4,this.lPresenterUid),t.writeString(5,this.sStreamName),t.writeString(6,this.sFlvUrl),t.writeString(7,this.sFlvUrlSuffix),t.writeString(8,this.sFlvAntiCode),t.writeString(9,this.sHlsUrl),t.writeString(10,this.sHlsUrlSuffix),t.writeString(11,this.sHlsAntiCode),t.writeInt32(12,this.iLineIndex),t.writeInt32(13,this.iIsMultiStream),t.writeInt32(14,this.iPCPriorityRate),t.writeInt32(15,this.iWebPriorityRate),t.writeInt32(16,this.iMobilePriorityRate),t.writeVector(17,this.vFlvIPList),t.writeInt32(18,this.iIsP2PSupport),t.writeString(19,this.sP2pUrl),t.writeString(20,this.sP2pUrlSuffix),t.writeString(21,this.sP2pAntiCode),t.writeInt64(22,this.lFreeFlag),t.writeInt32(23,this.iIsHEVCSupport),t.writeVector(24,this.vP2pIPList),t.writeMap(25,this.mpExtArgs),t.writeInt64(26,this.lTimespan)},a.StreamInfo.prototype.readFrom=function(t){this.sCdnType=t.readString(0,!1,this.sCdnType),this.iIsMaster=t.readInt32(1,!1,this.iIsMaster),this.lChannelId=t.readInt64(2,!1,this.lChannelId),this.lSubChannelId=t.readInt64(3,!1,this.lSubChannelId),this.lPresenterUid=t.readInt64(4,!1,this.lPresenterUid),this.sStreamName=t.readString(5,!1,this.sStreamName),this.sFlvUrl=t.readString(6,!1,this.sFlvUrl),this.sFlvUrlSuffix=t.readString(7,!1,this.sFlvUrlSuffix),this.sFlvAntiCode=t.readString(8,!1,this.sFlvAntiCode),this.sHlsUrl=t.readString(9,!1,this.sHlsUrl),this.sHlsUrlSuffix=t.readString(10,!1,this.sHlsUrlSuffix),this.sHlsAntiCode=t.readString(11,!1,this.sHlsAntiCode),this.iLineIndex=t.readInt32(12,!1,this.iLineIndex),this.iIsMultiStream=t.readInt32(13,!1,this.iIsMultiStream),this.iPCPriorityRate=t.readInt32(14,!1,this.iPCPriorityRate),this.iWebPriorityRate=t.readInt32(15,!1,this.iWebPriorityRate),this.iMobilePriorityRate=t.readInt32(16,!1,this.iMobilePriorityRate),this.vFlvIPList=t.readVector(17,!1,this.vFlvIPList),this.iIsP2PSupport=t.readInt32(18,!1,this.iIsP2PSupport),this.sP2pUrl=t.readString(19,!1,this.sP2pUrl),this.sP2pUrlSuffix=t.readString(20,!1,this.sP2pUrlSuffix),this.sP2pAntiCode=t.readString(21,!1,this.sP2pAntiCode),this.lFreeFlag=t.readInt64(22,!1,this.lFreeFlag),this.iIsHEVCSupport=t.readInt32(23,!1,this.iIsHEVCSupport),this.vP2pIPList=t.readVector(24,!1,this.vP2pIPList),this.mpExtArgs=t.readMap(25,!1,this.mpExtArgs),this.lTimespan=t.readInt64(26,!1,this.lTimespan)},a.MultiStreamInfo=function(){this.sDisplayName="",this.iBitRate=0,this.iCodecType=0,this.iCompatibleFlag=0,this.iHEVCBitRate=-1},a.MultiStreamInfo.prototype._clone=function(){return new a.MultiStreamInfo},a.MultiStreamInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.MultiStreamInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.MultiStreamInfo.prototype.writeTo=function(t){t.writeString(0,this.sDisplayName),t.writeInt32(1,this.iBitRate),t.writeInt32(2,this.iCodecType),t.writeInt32(3,this.iCompatibleFlag),t.writeInt32(4,this.iHEVCBitRate)},a.MultiStreamInfo.prototype.readFrom=function(t){this.sDisplayName=t.readString(0,!1,this.sDisplayName),this.iBitRate=t.readInt32(1,!1,this.iBitRate),this.iCodecType=t.readInt32(2,!1,this.iCodecType),this.iCompatibleFlag=t.readInt32(3,!1,this.iCompatibleFlag),this.iHEVCBitRate=t.readInt32(4,!1,this.iHEVCBitRate)},a.WSRegisterGroupReq=function(){this.vGroupId=new r.default.Vector(new r.default.STRING),this.sToken=""},a.WSRegisterGroupReq.prototype._clone=function(){return new a.WSRegisterGroupReq},a.WSRegisterGroupReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.WSRegisterGroupReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.WSRegisterGroupReq.prototype.writeTo=function(t){t.writeVector(0,this.vGroupId),t.writeString(1,this.sToken)},a.WSRegisterGroupReq.prototype.readFrom=function(t){this.vGroupId=t.readVector(0,!1,this.vGroupId),this.sToken=t.readString(1,!1,this.sToken)},a.WSRegisterGroupRsp=function(){this.iResCode=0,this.vSupportP2PGroupId=new r.default.Vector(new r.default.STRING)},a.WSRegisterGroupRsp.prototype._clone=function(){return new a.WSRegisterGroupRsp},a.WSRegisterGroupRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.WSRegisterGroupRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.WSRegisterGroupRsp.prototype.writeTo=function(t){t.writeInt32(0,this.iResCode),t.writeVector(1,this.vSupportP2PGroupId)},a.WSRegisterGroupRsp.prototype.readFrom=function(t){this.iResCode=t.readInt32(0,!1,this.iResCode),this.vSupportP2PGroupId=t.readVector(1,!1,this.vSupportP2PGroupId)},a.GetOrderBroadcastInfoReq=function(){this.busses=new r.default.Vector(new r.default.STRING),this.anthorId=0,this.streamName="",this.appid=0},a.GetOrderBroadcastInfoReq.prototype._clone=function(){return new a.GetOrderBroadcastInfoReq},a.GetOrderBroadcastInfoReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GetOrderBroadcastInfoReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GetOrderBroadcastInfoReq.prototype.writeTo=function(t){t.writeVector(0,this.busses),t.writeInt64(1,this.anthorId),t.writeString(2,this.streamName),t.writeInt32(3,this.appid)},a.GetOrderBroadcastInfoReq.prototype.readFrom=function(t){this.busses=t.readVector(0,!1,this.busses),this.anthorId=t.readInt64(1,!1,this.anthorId),this.streamName=t.readString(2,!1,this.streamName),this.appid=t.readInt32(3,!1,this.appid)},a.GetOrderBroadcastInfoRsp=function(){this.ret=0,this.anthorId=0,this.broadcastInfos=new r.default.Vector(new a.OrderBroadcastInfo)},a.GetOrderBroadcastInfoRsp.prototype._clone=function(){return new a.GetOrderBroadcastInfoRsp},a.GetOrderBroadcastInfoRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GetOrderBroadcastInfoRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GetOrderBroadcastInfoRsp.prototype.writeTo=function(t){t.writeInt32(0,this.ret),t.writeInt64(1,this.anthorId),t.writeVector(2,this.broadcastInfos)},a.GetOrderBroadcastInfoRsp.prototype.readFrom=function(t){this.ret=t.readInt32(0,!1,this.ret),this.anthorId=t.readInt64(1,!1,this.anthorId),this.broadcastInfos=t.readVector(2,!1,this.broadcastInfos)},a.OrderBroadcastInfo=function(){this.buss="",this.enable=0,this.broadcastGroup="",this.uri=0,this.configJson=""},a.OrderBroadcastInfo.prototype._clone=function(){return new a.OrderBroadcastInfo},a.OrderBroadcastInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.OrderBroadcastInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.OrderBroadcastInfo.prototype.writeTo=function(t){t.writeString(0,this.buss),t.writeInt32(1,this.enable),t.writeString(2,this.broadcastGroup),t.writeInt32(3,this.uri),t.writeString(4,this.configJson)},a.OrderBroadcastInfo.prototype.readFrom=function(t){this.buss=t.readString(0,!1,this.buss),this.enable=t.readInt32(1,!1,this.enable),this.broadcastGroup=t.readString(2,!1,this.broadcastGroup),this.uri=t.readInt32(3,!1,this.uri),this.configJson=t.readString(4,!1,this.configJson)},(a=a||{}).PixelateInfo=function(){this.dtsType=0,this.beginDts=0,this.endDts=0,this.pixelateKey=0,this.shapeInfos=new r.default.BinBuffer},a.PixelateInfo.prototype._clone=function(){return new a.PixelateInfo},a.PixelateInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.PixelateInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.PixelateInfo.prototype.writeTo=function(t){t.writeInt32(0,this.dtsType),t.writeUInt32(1,this.beginDts),t.writeUInt32(2,this.endDts),t.writeUInt32(3,this.pixelateKey),t.writeBytes(4,this.shapeInfos)},a.PixelateInfo.prototype.readFrom=function(t){this.dtsType=t.readInt32(0,!1,this.dtsType),this.beginDts=t.readUInt32(1,!1,this.beginDts),this.endDts=t.readUInt32(2,!1,this.endDts),this.pixelateKey=t.readUInt32(3,!1,this.pixelateKey),this.shapeInfos=t.readBytes(4,!1,this.shapeInfos)},a.MaskShape=function(){this.points=new r.default.Vector(new r.default.INT64),this.type=0,this.x=0,this.y=0,this.w=0,this.h=0,this.ext="",this.pixelcolor=0},a.MaskShape.prototype._clone=function(){return new a.MaskShape},a.MaskShape.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.MaskShape.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.MaskShape.prototype.writeTo=function(t){t.writeVector(0,this.points),t.writeUInt32(1,this.type),t.writeUInt32(2,this.x),t.writeUInt32(3,this.y),t.writeUInt32(4,this.w),t.writeUInt32(5,this.h),t.writeString(6,this.ext),t.writeUInt32(8,this.pixelcolor)},a.MaskShape.prototype.readFrom=function(t){this.points=t.readVector(0,!1,this.points),this.type=t.readUInt32(1,!1,this.type),this.x=t.readUInt32(2,!1,this.x),this.y=t.readUInt32(3,!1,this.y),this.w=t.readUInt32(4,!1,this.w),this.h=t.readUInt32(5,!1,this.h),this.ext=t.readString(6,!1,this.ext),this.pixelcolor=t.readUInt32(8,!1,this.pixelcolor)},a.SafeRoiMaskProto=function(){this.ver_no=0,this.dts=0,this.frame_width=0,this.frame_height=0,this.contrs=new r.default.Vector(new a.MaskShape),this.ext=""},a.SafeRoiMaskProto.prototype._clone=function(){return new a.SafeRoiMaskProto},a.SafeRoiMaskProto.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.SafeRoiMaskProto.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.SafeRoiMaskProto.prototype.writeTo=function(t){t.writeUInt32(0,this.ver_no),t.writeUInt32(1,this.dts),t.writeUInt32(2,this.frame_width),t.writeUInt32(3,this.frame_height),t.writeVector(4,this.contrs),t.writeString(5,this.ext)},a.SafeRoiMaskProto.prototype.readFrom=function(t){this.ver_no=t.readUInt32(0,!1,this.ver_no),this.dts=t.readUInt32(1,!1,this.dts),this.frame_width=t.readUInt32(2,!1,this.frame_width),this.frame_height=t.readUInt32(3,!1,this.frame_height),this.contrs=t.readVector(4,!1,this.contrs),this.ext=t.readString(5,!1,this.ext)},a.GetVideoHisUponReq=function(){this.lUid=0,this.lLiveId=0,this.tId=new a.UserId},a.GetVideoHisUponReq.prototype._clone=function(){return new a.GetVideoHisUponReq},a.GetVideoHisUponReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GetVideoHisUponReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GetVideoHisUponReq.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeInt64(1,this.lLiveId),t.writeStruct(2,this.tId)},a.GetVideoHisUponReq.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.lLiveId=t.readInt64(1,!1,this.lLiveId),this.tId=t.readStruct(2,!1,this.tId)},a.GetVideoHisUponRsp=function(){this.lUid=0,this.vHistoryList=new r.default.Vector(new a.GameLiveHlsInfo)},a.GetVideoHisUponRsp.prototype._clone=function(){return new a.GetVideoHisUponRsp},a.GetVideoHisUponRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GetVideoHisUponRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GetVideoHisUponRsp.prototype.writeTo=function(t){t.writeInt64(0,this.lUid),t.writeVector(1,this.vHistoryList)},a.GetVideoHisUponRsp.prototype.readFrom=function(t){this.lUid=t.readInt64(0,!1,this.lUid),this.vHistoryList=t.readVector(1,!1,this.vHistoryList)},a.GameLiveHlsInfo=function(){this.tGameInfo=new a.GameLiveInfo,this.sHlsUrl="",this.iVideoSyncTime=0,this.vDefinitions=new r.default.Vector(new a.VideoDefinition)},a.GameLiveHlsInfo.prototype._clone=function(){return new a.GameLiveHlsInfo},a.GameLiveHlsInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GameLiveHlsInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GameLiveHlsInfo.prototype.writeTo=function(t){t.writeStruct(0,this.tGameInfo),t.writeString(1,this.sHlsUrl),t.writeInt32(2,this.iVideoSyncTime),t.writeVector(3,this.vDefinitions)},a.GameLiveHlsInfo.prototype.readFrom=function(t){this.tGameInfo=t.readStruct(0,!1,this.tGameInfo),this.sHlsUrl=t.readString(1,!1,this.sHlsUrl),this.iVideoSyncTime=t.readInt32(2,!1,this.iVideoSyncTime),this.vDefinitions=t.readVector(3,!1,this.vDefinitions)},a.EGender={MALE:0,FEMALE:1},a.VideoStreamInfo=function(){this.sSize="",this.sWidth="",this.sHeight="",this.sFormat="",this.sUrl="",this.sM3u8="",this.sTs1Url="",this.sTs1Offset="",this.iBitRate=0,this.sCodec="",this.mpExtraParam=new r.default.Map(new r.default.STRING,new r.default.STRING)},a.VideoStreamInfo.prototype._clone=function(){return new a.VideoStreamInfo},a.VideoStreamInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.VideoStreamInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.VideoStreamInfo.prototype.writeTo=function(t){t.writeString(0,this.sSize),t.writeString(1,this.sWidth),t.writeString(2,this.sHeight),t.writeString(3,this.sFormat),t.writeString(4,this.sUrl),t.writeString(5,this.sM3u8),t.writeString(6,this.sTs1Url),t.writeString(7,this.sTs1Offset),t.writeInt32(8,this.iBitRate),t.writeString(9,this.sCodec),t.writeMap(10,this.mpExtraParam)},a.VideoStreamInfo.prototype.readFrom=function(t){this.sSize=t.readString(0,!1,this.sSize),this.sWidth=t.readString(1,!1,this.sWidth),this.sHeight=t.readString(2,!1,this.sHeight),this.sFormat=t.readString(3,!1,this.sFormat),this.sUrl=t.readString(4,!1,this.sUrl),this.sM3u8=t.readString(5,!1,this.sM3u8),this.sTs1Url=t.readString(6,!1,this.sTs1Url),this.sTs1Offset=t.readString(7,!1,this.sTs1Offset),this.iBitRate=t.readInt32(8,!1,this.iBitRate),this.sCodec=t.readString(9,!1,this.sCodec),this.mpExtraParam=t.readMap(10,!1,this.mpExtraParam)},a.VideoDefinition=function(){this.sSize="",this.sWidth="",this.sHeight="",this.sDefinition="",this.sUrl="",this.sM3u8="",this.sDefName="",this.sTs1Url="",this.sTs1Offset="",this.iLineIndex=0,this.iBitRate=0,this.mpExtraParam=new r.default.Map(new r.default.STRING,new r.default.STRING),this.vStreamInfo=new r.default.Vector(new a.VideoStreamInfo),this.sCodec="",this.sFormat="",this.sDuration=""},a.VideoDefinition.prototype._clone=function(){return new a.VideoDefinition},a.VideoDefinition.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.VideoDefinition.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.VideoDefinition.prototype.writeTo=function(t){t.writeString(0,this.sSize),t.writeString(1,this.sWidth),t.writeString(2,this.sHeight),t.writeString(3,this.sDefinition),t.writeString(4,this.sUrl),t.writeString(5,this.sM3u8),t.writeString(6,this.sDefName),t.writeString(7,this.sTs1Url),t.writeString(8,this.sTs1Offset),t.writeInt32(9,this.iLineIndex),t.writeInt32(10,this.iBitRate),t.writeMap(11,this.mpExtraParam),t.writeVector(12,this.vStreamInfo),t.writeString(13,this.sCodec),t.writeString(14,this.sFormat),t.writeString(15,this.sDuration)},a.VideoDefinition.prototype.readFrom=function(t){this.sSize=t.readString(0,!1,this.sSize),this.sWidth=t.readString(1,!1,this.sWidth),this.sHeight=t.readString(2,!1,this.sHeight),this.sDefinition=t.readString(3,!1,this.sDefinition),this.sUrl=t.readString(4,!1,this.sUrl),this.sM3u8=t.readString(5,!1,this.sM3u8),this.sDefName=t.readString(6,!1,this.sDefName),this.sTs1Url=t.readString(7,!1,this.sTs1Url),this.sTs1Offset=t.readString(8,!1,this.sTs1Offset),this.iLineIndex=t.readInt32(9,!1,this.iLineIndex),this.iBitRate=t.readInt32(10,!1,this.iBitRate),this.mpExtraParam=t.readMap(11,!1,this.mpExtraParam),this.vStreamInfo=t.readVector(12,!1,this.vStreamInfo),this.sCodec=t.readString(13,!1,this.sCodec),this.sFormat=t.readString(14,!1,this.sFormat),this.sDuration=t.readString(15,!1,this.sDuration)},a.GameLiveTag=function(){this.iTagId=0,this.sTagName="",this.bIsShow=!0,this.iBindingGameId=0,this.iShowType=0},a.GameLiveTag.prototype._clone=function(){return new a.GameLiveTag},a.GameLiveTag.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GameLiveTag.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GameLiveTag.prototype.writeTo=function(t){t.writeInt32(0,this.iTagId),t.writeString(1,this.sTagName),t.writeBoolean(2,this.bIsShow),t.writeInt32(3,this.iBindingGameId),t.writeInt32(4,this.iShowType)},a.GameLiveTag.prototype.readFrom=function(t){this.iTagId=t.readInt32(0,!1,this.iTagId),this.sTagName=t.readString(1,!1,this.sTagName),this.bIsShow=t.readBoolean(2,!1,this.bIsShow),this.iBindingGameId=t.readInt32(3,!1,this.iBindingGameId),this.iShowType=t.readInt32(4,!1,this.iShowType)},a.GameLiveInfo=function(){this.lLiveId=0,this.lUid=0,this.lChannelId=0,this.iShortChannel=0,this.lSubchannel=0,this.sSubchannelName="",this.iGameId=0,this.sGameName="",this.iAttendeeCount=0,this.eGender=a.EGender.MALE,this.iAid=0,this.sNick="",this.sAvatarUrl="",this.iStartTime=0,this.iEndTime=0,this.iSourceType=0,this.bIsCameraOpen=!1,this.bIsRoomSecret=!1,this.sVideoCaptureUrl="",this.iCdnAttendee=0,this.lYYId=0,this.bCertified=!1,this.iRecType=0,this.lSignChannel=0,this.sLiveDesc="",this.iLevel=0,this.sGameShortName="",this.iGameType=0,this.sPrivateHost="",this.iActivityCount=0,this.iStreamType=0,this.iBitRate=0,this.iResolution=0,this.iFrameRate=0,this.iIsMultiStream=0,this.iExeGameId=0,this.lExp=0,this.sReplayHls="",this.lMultiStreamFlag=0,this.iScreenType=0,this.iChannelType=0,this.sLocation="",this.iCodecType=0,this.vPresenterTags=new r.default.Vector(new a.GameLiveTag),this.vGameTags=new r.default.Vector(new a.GameLiveTag),this.lLiveCompatibleFlag=0,this.sTraceId="",this.iRoomId=0,this.mpExtInfo=new r.default.Map(new r.default.STRING,new r.default.STRING)},a.GameLiveInfo.prototype._clone=function(){return new a.GameLiveInfo},a.GameLiveInfo.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.GameLiveInfo.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.GameLiveInfo.prototype.writeTo=function(t){t.writeInt64(0,this.lLiveId),t.writeInt64(1,this.lUid),t.writeInt64(2,this.lChannelId),t.writeInt32(3,this.iShortChannel),t.writeInt64(4,this.lSubchannel),t.writeString(5,this.sSubchannelName),t.writeInt32(6,this.iGameId),t.writeString(7,this.sGameName),t.writeInt32(8,this.iAttendeeCount),t.writeInt32(9,this.eGender),t.writeInt32(10,this.iAid),t.writeString(11,this.sNick),t.writeString(12,this.sAvatarUrl),t.writeInt32(13,this.iStartTime),t.writeInt32(14,this.iEndTime),t.writeInt32(15,this.iSourceType),t.writeBoolean(16,this.bIsCameraOpen),t.writeBoolean(17,this.bIsRoomSecret),t.writeString(18,this.sVideoCaptureUrl),t.writeInt32(19,this.iCdnAttendee),t.writeInt64(20,this.lYYId),t.writeBoolean(21,this.bCertified),t.writeInt32(22,this.iRecType),t.writeInt64(23,this.lSignChannel),t.writeString(24,this.sLiveDesc),t.writeInt32(25,this.iLevel),t.writeString(26,this.sGameShortName),t.writeInt32(27,this.iGameType),t.writeString(28,this.sPrivateHost),t.writeInt32(29,this.iActivityCount),t.writeInt32(30,this.iStreamType),t.writeInt32(31,this.iBitRate),t.writeInt32(32,this.iResolution),t.writeInt32(33,this.iFrameRate),t.writeInt32(34,this.iIsMultiStream),t.writeInt32(35,this.iExeGameId),t.writeInt64(36,this.lExp),t.writeString(37,this.sReplayHls),t.writeInt64(38,this.lMultiStreamFlag),t.writeInt32(39,this.iScreenType),t.writeInt32(40,this.iChannelType),t.writeString(41,this.sLocation),t.writeInt32(42,this.iCodecType),t.writeVector(43,this.vPresenterTags),t.writeVector(44,this.vGameTags),t.writeInt64(45,this.lLiveCompatibleFlag),t.writeString(46,this.sTraceId),t.writeInt32(47,this.iRoomId),t.writeMap(48,this.mpExtInfo)},a.GameLiveInfo.prototype.readFrom=function(t){this.lLiveId=t.readInt64(0,!1,this.lLiveId),this.lUid=t.readInt64(1,!1,this.lUid),this.lChannelId=t.readInt64(2,!1,this.lChannelId),this.iShortChannel=t.readInt32(3,!1,this.iShortChannel),this.lSubchannel=t.readInt64(4,!1,this.lSubchannel),this.sSubchannelName=t.readString(5,!1,this.sSubchannelName),this.iGameId=t.readInt32(6,!1,this.iGameId),this.sGameName=t.readString(7,!1,this.sGameName),this.iAttendeeCount=t.readInt32(8,!1,this.iAttendeeCount),this.eGender=t.readInt32(9,!1,this.eGender),this.iAid=t.readInt32(10,!1,this.iAid),this.sNick=t.readString(11,!1,this.sNick),this.sAvatarUrl=t.readString(12,!1,this.sAvatarUrl),this.iStartTime=t.readInt32(13,!1,this.iStartTime),this.iEndTime=t.readInt32(14,!1,this.iEndTime),this.iSourceType=t.readInt32(15,!1,this.iSourceType),this.bIsCameraOpen=t.readBoolean(16,!1,this.bIsCameraOpen),this.bIsRoomSecret=t.readBoolean(17,!1,this.bIsRoomSecret),this.sVideoCaptureUrl=t.readString(18,!1,this.sVideoCaptureUrl),this.iCdnAttendee=t.readInt32(19,!1,this.iCdnAttendee),this.lYYId=t.readInt64(20,!1,this.lYYId),this.bCertified=t.readBoolean(21,!1,this.bCertified),this.iRecType=t.readInt32(22,!1,this.iRecType),this.lSignChannel=t.readInt64(23,!1,this.lSignChannel),this.sLiveDesc=t.readString(24,!1,this.sLiveDesc),this.iLevel=t.readInt32(25,!1,this.iLevel),this.sGameShortName=t.readString(26,!1,this.sGameShortName),this.iGameType=t.readInt32(27,!1,this.iGameType),this.sPrivateHost=t.readString(28,!1,this.sPrivateHost),this.iActivityCount=t.readInt32(29,!1,this.iActivityCount),this.iStreamType=t.readInt32(30,!1,this.iStreamType),this.iBitRate=t.readInt32(31,!1,this.iBitRate),this.iResolution=t.readInt32(32,!1,this.iResolution),this.iFrameRate=t.readInt32(33,!1,this.iFrameRate),this.iIsMultiStream=t.readInt32(34,!1,this.iIsMultiStream),this.iExeGameId=t.readInt32(35,!1,this.iExeGameId),this.lExp=t.readInt64(36,!1,this.lExp),this.sReplayHls=t.readString(37,!1,this.sReplayHls),this.lMultiStreamFlag=t.readInt64(38,!1,this.lMultiStreamFlag),this.iScreenType=t.readInt32(39,!1,this.iScreenType),this.iChannelType=t.readInt32(40,!1,this.iChannelType),this.sLocation=t.readString(41,!1,this.sLocation),this.iCodecType=t.readInt32(42,!1,this.iCodecType),this.vPresenterTags=t.readVector(43,!1,this.vPresenterTags),this.vGameTags=t.readVector(44,!1,this.vGameTags),this.lLiveCompatibleFlag=t.readInt64(45,!1,this.lLiveCompatibleFlag),this.sTraceId=t.readString(46,!1,this.sTraceId),this.iRoomId=t.readInt32(47,!1,this.iRoomId),this.mpExtInfo=t.readMap(48,!1,this.mpExtInfo)},a.UserEventReq=function(){this.tId=new a.UserId,this.lTid=0,this.lSid=0,this.eOp=0,this.sChan="",this.eSource=0,this.lPid=0,this.bWatchVideo=!1,this.bAnonymous=!1,this.eTemplateType=a.TemplateType.PRIMARY,this.sTraceSource=""},a.UserEventReq.prototype._clone=function(){return new a.UserEventReq},a.UserEventReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.UserEventReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.UserEventReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeInt64(1,this.lTid),t.writeInt64(2,this.lSid),t.writeInt32(4,this.eOp),t.writeString(5,this.sChan),t.writeInt32(6,this.eSource),t.writeInt64(7,this.lPid),t.writeBoolean(8,this.bWatchVideo),t.writeBoolean(9,this.bAnonymous),t.writeInt32(10,this.eTemplateType),t.writeString(11,this.sTraceSource)},a.UserEventRsp=function(){this.lTid=0,this.lSid=0,this.iUserHeartBeatInterval=60,this.iPresentHeartBeatInterval=60},a.UserEventRsp.prototype._clone=function(){return new a.UserEventRsp},a.UserEventRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.UserEventRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.UserEventRsp.prototype.readFrom=function(t){this.lTid=t.readInt64(0,!1,this.lTid),this.lSid=t.readInt64(1,!1,this.lSid),this.iUserHeartBeatInterval=t.readInt32(2,!1,this.iUserHeartBeatInterval),this.iPresentHeartBeatInterval=t.readInt32(3,!1,this.iPresentHeartBeatInterval)},a.UserHeartBeatReq=function(){this.tId=new a.UserId,this.lTid=0,this.lSid=0,this.lPid=0,this.bWatchVideo=!1,this.eLineType=0,this.iFps=0,this.iAttendee=0,this.iBandwidth=0,this.iLastHeartElapseTime=0},a.UserHeartBeatReq.prototype._clone=function(){return new a.UserHeartBeatReq},a.UserHeartBeatReq.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.UserHeartBeatReq.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.UserHeartBeatReq.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeInt64(1,this.lTid),t.writeInt64(2,this.lSid),t.writeInt64(4,this.lPid),t.writeBoolean(5,this.bWatchVideo),t.writeInt32(6,this.eLineType),t.writeInt32(7,this.iFps),t.writeInt32(8,this.iAttendee),t.writeInt32(9,this.iBandwidth),t.writeInt32(10,this.iLastHeartElapseTime)},a.UserHeartBeatRsp=function(){this.iRet=0},a.UserHeartBeatRsp.prototype._clone=function(){return new a.UserHeartBeatRsp},a.UserHeartBeatRsp.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.UserHeartBeatRsp.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.UserHeartBeatRsp.prototype.readFrom=function(t){this.iRet=t.readInt32(0,!1,this.iRet)},a.TemplateType={PRIMARY:1,RECEPTION:2},a.MetricDetailSet=function(){this.tId=new a.UserId,this.vMetricDetail=new r.default.Vector(new a.MetricDetail)},a.MetricDetailSet.prototype._clone=function(){return new a.MetricDetailSet},a.MetricDetailSet.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.MetricDetailSet.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.MetricDetailSet.prototype.writeTo=function(t){t.writeStruct(0,this.tId),t.writeVector(1,this.vMetricDetail)},a.MetricDetailSet.prototype.readFrom=function(t){this.tId=t.readStruct(0,!0,this.tId),this.vMetricDetail=t.readVector(1,!0,this.vMetricDetail)},a.MetricDetail=function(){this.sMetricName="",this.iTS=0,this.vDimension=new r.default.Vector(new a.Dimension),this.vFiled=new r.default.Vector(new a.Field),this.vExLog=new r.default.Vector(new a.Dimension)},a.MetricDetail.prototype._clone=function(){return new a.MetricDetail},a.MetricDetail.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.MetricDetail.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.MetricDetail.prototype.writeTo=function(t){t.writeString(0,this.sMetricName),t.writeInt64(1,this.iTS),t.writeVector(2,this.vDimension),t.writeVector(3,this.vFiled),t.writeVector(4,this.vExLog)},a.MetricDetail.prototype.readFrom=function(t){this.sMetricName=t.readString(0,!0,this.sMetricName),this.iTS=t.readInt64(1,!1,this.iTS),this.vDimension=t.readVector(2,!1,this.vDimension),this.vFiled=t.readVector(3,!1,this.vFiled),this.vExLog=t.readVector(4,!1,this.vExLog)},a.Field=function(){this.sName="",this.fValue=0},a.Field.prototype._clone=function(){return new a.Field},a.Field.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.Field.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.Field.prototype.writeTo=function(t){t.writeString(0,this.sName),t.writeDouble(1,this.fValue)},a.Field.prototype.readFrom=function(t){this.sName=t.readString(0,!1,this.sName),this.fValue=t.readDouble(1,!1,this.fValue)},a.Metric=function(){this.sMetricName="",this.vDimension=new r.default.Vector(new a.Dimension),this.iTS=0,this.iSuccess=0,this.iRetCode=0,this.fValue=0,this.eUnit=0,this.tStatsSet=new a.StatsSet,this.sExtDesc="",this.vExLog=new r.default.Vector(new a.Dimension)},a.Metric.prototype._clone=function(){return new a.Metric},a.Metric.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.Metric.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.Metric.prototype.writeTo=function(t){t.writeString(0,this.sMetricName),t.writeVector(1,this.vDimension),t.writeInt64(2,this.iTS),t.writeInt32(3,this.iSuccess),t.writeInt32(4,this.iRetCode),t.writeDouble(5,this.fValue),t.writeInt32(6,this.eUnit),t.writeStruct(7,this.tStatsSet),t.writeString(8,this.sExtDesc),t.writeVector(9,this.vExLog)},a.Metric.prototype.readFrom=function(t){this.sMetricName=t.readString(0,!0,this.sMetricName),this.vDimension=t.readVector(1,!1,this.vDimension),this.iTS=t.readInt64(2,!1,this.iTS),this.iSuccess=t.readInt32(3,!1,this.iSuccess),this.iRetCode=t.readInt32(4,!1,this.iRetCode),this.fValue=t.readDouble(5,!1,this.fValue),this.eUnit=t.readInt32(6,!1,this.eUnit),this.tStatsSet=t.readStruct(7,!1,this.tStatsSet),this.sExtDesc=t.readString(8,!1,this.sExtDesc),this.vExLog=t.readVector(9,!1,this.vExLog)},a.Dimension=function(){this.sName="",this.sValue=""},a.Dimension.prototype._clone=function(){return new a.Dimension},a.Dimension.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.Dimension.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.Dimension.prototype.writeTo=function(t){t.writeString(0,this.sName),t.writeString(1,this.sValue)},a.Dimension.prototype.readFrom=function(t){this.sName=t.readString(0,!1,this.sName),this.sValue=t.readString(1,!1,this.sValue)},a.HuYaUdbNotify=function(){this.eNotifyType=0,this.sMsg=""},a.HuYaUdbNotify.prototype._clone=function(){return new a.HuYaUdbNotify},a.HuYaUdbNotify.prototype._write=function(t,e,i){t.writeStruct(e,i)},a.HuYaUdbNotify.prototype._read=function(t,e,i){return t.readStruct(e,!0,i)},a.HuYaUdbNotify.prototype.writeTo=function(t){t.writeInt32(0,this.eNotifyType),t.writeString(1,this.sMsg)},a.HuYaUdbNotify.prototype.readFrom=function(t){this.eNotifyType=t.readInt32(0,!1,this.eNotifyType),this.sMsg=t.readString(1,!1,this.sMsg)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(111).default;e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=m(i(22)),r=m(i(0)),a=m(i(1)),o=m(i(24)),n=m(i(26)),h=i(85),d=m(i(19)),l=m(i(21)),u=m(i(3)),c=m(i(34)),p=m(i(16));function m(t){return t&&t.__esModule?t:{default:t}}var f=!!Number(localStorage._printProtocol),_=!!Number(localStorage._printGateway),g=function(t){function e(t,i){(0,r.default)(this,e);var a=(0,o.default)(this,(e.__proto__||(0,s.default)(e)).call(this));return a.WEBSOCKET_CONNECTED="WEBSOCKET_CONNECTED",a.WEBSOCKET_CLOSED="WEBSOCKET_CLOSED",a.WEBSOCKET_ERROR="WEBSOCKET_ERROR",a.TAFLINK_INITED="TAFLINK_INITED",a._taf=null,a.delayWup=[],a.delayListener=[],a.streamName=null,a.requestId=1,a.config=t,a.const=i,a}return(0,n.default)(e,t),(0,a.default)(e,[{key:"getRequestId",value:function(){return this.requestId++,1e5===this.requestId&&(this.requestId=1),this.requestId}},{key:"getTaf",value:function(){return this._taf}},{key:"isWap",value:function(){return 1==localStorage._testUa||this.config.platform==this.const.PLATFORM_TYPE_NAME.wap}},{key:"setTafHandler",value:function(t){var e=d.default.now();p.default.logger.log("%c[TIME] initTafTime="+e,"color:#A23400;background:#FFF5C2"),t.getTaf&&l.default.setTaf(t.getTaf()),t.registerUriMap(T.UriMapping),t.registerWupMap(T.WupMapping),this._taf=t,this.isWap()?this._taf.isWSConnected()?this._onConnected():this._taf.on(this.WEBSOCKET_CONNECTED,this._onConnected.bind(this)):this._taf.connected?this._onConnected():this._taf.addListener(this.WEBSOCKET_CONNECTED,this._onConnected.bind(this)),this.emit(this.TAFLINK_INITED)}},{key:"_onConnected",value:function(){p.default.logger.log("TafLink._onConnected sendWup size="+this.delayWup.length);var t=this;this.delayWup.forEach((function(e){var i=e.servantName,s=e.funcName,r=e.data,a=e.callback,o=e.once,n=e.iRequestId,h=e.noTid;t.sendWup(i,s,r,a,o,n,h)})),this.delayWup=[],this.delayListener.forEach((function(e){var i=e.p0,s=e.p1,r=e.p2;switch(i){case"add":t.addListener(s,r);break;case"remove":t.removeListener(s,r);break;case"dispatch":t.dispatch(s,r)}})),this.delayListener=[]}},{key:"getUserId",value:function(){return this._taf.getUserId()}},{key:"sendWup",value:function(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!this.connected)return p.default.logger.log("TafLink.sendWup connected=false",t,e),void this.delayWup.push({servantName:t,funcName:e,data:i,callback:s,once:r,iRequestId:a,noTid:o});this._taf.sendWup2?this._taf.sendWup2(t,e,i,s,r,a,o):this._taf.sendWup(t,e,i,s,r,a,o)}},{key:"getInfoFromVG",value:function(t,e,i,s){if(this._taf){var r=this._taf.getTaf().BinBuffer,a=new l.default.GetInfoFromVGReq;a.lUid=t,a.sMsg=new r(i.marshall().buffer),a.sProtoName="yy",a.iUri=e,a.tId=this.getUserId(),this.sendWup("videogateway","getInfoFromVG",a,(function(t){s(t)}),!0)}else p.default.logger.warn("TafLink.sendYY taf not init!")}},{key:"sendYY",value:function(t,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._taf){var o=t.constructor.name,n=u.default[o];n||"function"!=typeof t.marshall||(n=new DataView(t.marshall().buffer).getUint32(4,!0)),f&&p.default.logger.log("%c>>>>>>> "+o,S("#009100"),"uri="+n,t);var h=null,d="mediaui",m="getInfoFromVGM";if("function"==typeof this._taf.packVGInfo)h=this._taf.packVGInfo(n,t,this.streamName);else{var g=this._taf.getTaf().BinBuffer;d="videogateway",m=a?"getInfoFromCdnVG":"getInfoFromVG",(h=new l.default.GetInfoFromVGReq).lUid=s||0,h.sMsg=new g(t.marshall().buffer),h.sProtoName="yy",h.iUri=n||0,h.lSid=0,h.tId=this.getUserId()}this.sendWup(d,m,h,function(s){if(0!=s.sMsg.len){if(!s.lUid||!h.lUid||s.lUid==h.lUid){var r=new DataView(s.sMsg.buffer),n=new c.default(r);if(!(o=u.default[n.uri]))throw _||p.default.logger.log("%c<<<<<<< %crspWup:%c GetInfoFromVG",S("#0000E3"),S("black"),S("#0000E3"),"videogateway",s),new Error("[x] Unmatched protocol, uri="+(n.uri>>8)+" resCode="+n.resCode+" len="+n.len);var d=n,l=null;try{l=a?i(91)("./"+o).default:i(162)("./"+o).default}catch(t){p.default.logger.warn("[x] Unmatched protocol",n.uri>>8,o)}l&&(d=new l).unmarshall(n),f&&p.default.logger.log("%c<<<<<<< "+o,S("#0000E3"),d),"function"==typeof e?e(d):this.dispatch(n.uri,d)}}else p.default.logger.warn("GetInfoFromVG response an empty pkg.",t,h,s)}.bind(this),r)}else p.default.logger.warn("TafLink.sendYY taf not init!")}},{key:"addListener",value:function(t,e){this.connected?this._taf.addListener(t,e):this.delayListener.push({p0:"add",p1:t,p2:e})}},{key:"removeListener",value:function(t,e){this.connected?this._taf.removeListener(t,e):this.delayListener.push({p0:"remove",p1:t,p2:e})}},{key:"dispatch",value:function(t,e){this.connected?this._taf.dispatch(t,e):this.delayListener.push({p0:"dispatch",p1:t,p2:e})}},{key:"inited",get:function(){return!!this._taf}},{key:"connected",get:function(){return this.isWap()?this._taf.isWSConnected():this._taf&&this._taf.connected}}]),e}(h.EventEmitter);function S(t,e,i){var s="font-weight:900";return t&&(s+=";color:"+t),e&&(s+=";background:"+e),i&&(s+=";border:3px solid "+i),s}var T={UriMapping:{8102:l.default.LivingStreamInfoNotice,8103:l.default.LivingStreamEndNotice,1025601:l.default.LiveMeetingSyncNotice,1400200:l.default.ImgplusABTestNotice},WupMapping:{getInfoFromVG:l.default.GetInfoFromVGRsp,GetInfoFromVG:l.default.GetInfoFromVGRsp,getInfoFromCdnVG:l.default.GetInfoFromVGRsp,getCdnTokenInfoEx:l.default.GetCdnTokenExRsp,getLivingStreamInfo:l.default.GetLivingStreamInfoRsp,getP2PStreamInfo:l.default.GetP2PStreamInfoRsp,getP2PStreamTokenInfoEx:l.default.GetP2PStreamTokenExRsp,queryHttpDns:l.default.QueryHttpDnsRsp,loginVerify:l.default.LoginVerifyRsp,joinGroup:l.default.JoinMediaGroupRsp,quitGroup:l.default.QuitMediaGroupRsp,wsTimeSync:l.default.WSTimeSyncRsp,pingSignal:l.default.PingSignalContext,onClientGetStunAndPcdnProxyReq:l.default.ClientGetStunAndPcdnProxyRsp,clientQueryPcdnSchedule:l.default.ClientQueryPcdnScheduleRsp,onClientGetPcdnFlvOutsideSdkFullstreamInfo:l.default.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp,onClientGetPcdnFlvHttpFullstreamInfo:l.default.ClientGetPcdnFlvHttpFullstreamInfoRsp,onClientGetVodPcdnProxyReq:l.default.ClientGetVodPcdnProxyReqRsp,getMediaRec:l.default.RecSysRsp,getStreamInfoByRoomFake:l.default.GetStreamInfoByRoomFakeRsp},NoLog:{8102:1,8103:1,1025601:1,getInfoFromVG:1,GetInfoFromVG:1,getInfoFromCdnVG:1,getInfoFromVGM:1,getCdnTokenInfoEx:1,videoClientReport:1}};e.default=g},function(t,e,i){i(113),t.exports=i(4).Object.getPrototypeOf},function(t,e,i){var s=i(23),r=i(73);i(114)("getPrototypeOf",(function(){return function(t){return r(s(t))}}))},function(t,e,i){var s=i(5),r=i(4),a=i(15);t.exports=function(t,e){var i=(r.Object||{})[t]||Object[t],o={};o[t]=e(i),s(s.S+s.F*a((function(){i(1)})),"Object",o)}},function(t,e,i){t.exports={default:i(116),__esModule:!0}},function(t,e,i){i(117);var s=i(4).Object;t.exports=function(t,e,i){return s.defineProperty(t,e,i)}},function(t,e,i){var s=i(5);s(s.S+s.F*!i(6),"Object",{defineProperty:i(9).f})},function(t,e,i){t.exports={default:i(119),__esModule:!0}},function(t,e,i){i(45),i(52),t.exports=i(53).f("iterator")},function(t,e,i){var s=i(46),r=i(41);t.exports=function(t){return function(e,i){var a,o,n=String(r(e)),h=s(i),d=n.length;return h<0||h>=d?t?"":void 0:(a=n.charCodeAt(h))<55296||a>56319||h+1===d||(o=n.charCodeAt(h+1))<56320||o>57343?t?n.charAt(h):a:t?n.slice(h,h+2):o-56320+(a-55296<<10)+65536}}},function(t,e,i){"use strict";var s=i(30),r=i(29),a=i(32),o={};i(12)(o,i(7)("iterator"),(function(){return this})),t.exports=function(t,e,i){t.prototype=s(o,{next:r(1,i)}),a(t,e+" Iterator")}},function(t,e,i){var s=i(9),r=i(13),a=i(31);t.exports=i(6)?Object.defineProperties:function(t,e){r(t);for(var i,o=a(e),n=o.length,h=0;n>h;)s.f(t,i=o[h++],e[i]);return t}},function(t,e,i){var s=i(18),r=i(50),a=i(124);t.exports=function(t){return function(e,i,o){var n,h=s(e),d=r(h.length),l=a(o,d);if(t&&i!=i){for(;d>l;)if((n=h[l++])!=n)return!0}else for(;d>l;l++)if((t||l in h)&&h[l]===i)return t||l||0;return!t&&-1}}},function(t,e,i){var s=i(46),r=Math.max,a=Math.min;t.exports=function(t,e){return(t=s(t))<0?r(t+e,0):a(t,e)}},function(t,e,i){var s=i(8).document;t.exports=s&&s.documentElement},function(t,e,i){"use strict";var s=i(127),r=i(80),a=i(25),o=i(18);t.exports=i(47)(Array,"Array",(function(t,e){this._t=o(t),this._i=0,this._k=e}),(function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,r(1)):r(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])}),"values"),a.Arguments=a.Array,s("keys"),s("values"),s("entries")},function(t,e){t.exports=function(){}},function(t,e,i){t.exports={default:i(129),__esModule:!0}},function(t,e,i){i(130),i(84),i(133),i(134),t.exports=i(4).Symbol},function(t,e,i){"use strict";var s=i(8),r=i(14),a=i(6),o=i(5),n=i(78),h=i(54).KEY,d=i(15),l=i(43),u=i(32),c=i(28),p=i(7),m=i(53),f=i(55),_=i(131),g=i(81),S=i(13),T=i(11),y=i(23),E=i(18),v=i(44),C=i(29),P=i(30),D=i(132),I=i(83),A=i(56),R=i(9),O=i(31),w=I.f,L=R.f,M=D.f,V=s.Symbol,b=s.JSON,N=b&&b.stringify,F=p("_hidden"),B=p("toPrimitive"),U={}.propertyIsEnumerable,k=l("symbol-registry"),x=l("symbols"),H=l("op-symbols"),G=Object.prototype,W="function"==typeof V&&!!A.f,$=s.QObject,Y=!$||!$.prototype||!$.prototype.findChild,K=a&&d((function(){return 7!=P(L({},"a",{get:function(){return L(this,"a",{value:7}).a}})).a}))?function(t,e,i){var s=w(G,e);s&&delete G[e],L(t,e,i),s&&t!==G&&L(G,e,s)}:L,j=function(t){var e=x[t]=P(V.prototype);return e._k=t,e},q=W&&"symbol"==typeof V.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof V},z=function(t,e,i){return t===G&&z(H,e,i),S(t),e=v(e,!0),S(i),r(x,e)?(i.enumerable?(r(t,F)&&t[F][e]&&(t[F][e]=!1),i=P(i,{enumerable:C(0,!1)})):(r(t,F)||L(t,F,C(1,{})),t[F][e]=!0),K(t,e,i)):L(t,e,i)},J=function(t,e){S(t);for(var i,s=_(e=E(e)),r=0,a=s.length;a>r;)z(t,i=s[r++],e[i]);return t},Q=function(t){var e=U.call(this,t=v(t,!0));return!(this===G&&r(x,t)&&!r(H,t))&&(!(e||!r(this,t)||!r(x,t)||r(this,F)&&this[F][t])||e)},X=function(t,e){if(t=E(t),e=v(e,!0),t!==G||!r(x,e)||r(H,e)){var i=w(t,e);return!i||!r(x,e)||r(t,F)&&t[F][e]||(i.enumerable=!0),i}},Z=function(t){for(var e,i=M(E(t)),s=[],a=0;i.length>a;)r(x,e=i[a++])||e==F||e==h||s.push(e);return s},tt=function(t){for(var e,i=t===G,s=M(i?H:E(t)),a=[],o=0;s.length>o;)!r(x,e=s[o++])||i&&!r(G,e)||a.push(x[e]);return a};W||(n((V=function(){if(this instanceof V)throw TypeError("Symbol is not a constructor!");var t=c(arguments.length>0?arguments[0]:void 0),e=function(i){this===G&&e.call(H,i),r(this,F)&&r(this[F],t)&&(this[F][t]=!1),K(this,t,C(1,i))};return a&&Y&&K(G,t,{configurable:!0,set:e}),j(t)}).prototype,"toString",(function(){return this._k})),I.f=X,R.f=z,i(82).f=D.f=Z,i(33).f=Q,A.f=tt,a&&!i(27)&&n(G,"propertyIsEnumerable",Q,!0),m.f=function(t){return j(p(t))}),o(o.G+o.W+o.F*!W,{Symbol:V});for(var et="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),it=0;et.length>it;)p(et[it++]);for(var st=O(p.store),rt=0;st.length>rt;)f(st[rt++]);o(o.S+o.F*!W,"Symbol",{for:function(t){return r(k,t+="")?k[t]:k[t]=V(t)},keyFor:function(t){if(!q(t))throw TypeError(t+" is not a symbol!");for(var e in k)if(k[e]===t)return e},useSetter:function(){Y=!0},useSimple:function(){Y=!1}}),o(o.S+o.F*!W,"Object",{create:function(t,e){return void 0===e?P(t):J(P(t),e)},defineProperty:z,defineProperties:J,getOwnPropertyDescriptor:X,getOwnPropertyNames:Z,getOwnPropertySymbols:tt});var at=d((function(){A.f(1)}));o(o.S+o.F*at,"Object",{getOwnPropertySymbols:function(t){return A.f(y(t))}}),b&&o(o.S+o.F*(!W||d((function(){var t=V();return"[null]"!=N([t])||"{}"!=N({a:t})||"{}"!=N(Object(t))}))),"JSON",{stringify:function(t){for(var e,i,s=[t],r=1;arguments.length>r;)s.push(arguments[r++]);if(i=e=s[1],(T(e)||void 0!==t)&&!q(t))return g(e)||(e=function(t,e){if("function"==typeof i&&(e=i.call(this,t,e)),!q(e))return e}),s[1]=e,N.apply(b,s)}}),V.prototype[B]||i(12)(V.prototype,B,V.prototype.valueOf),u(V,"Symbol"),u(Math,"Math",!0),u(s.JSON,"JSON",!0)},function(t,e,i){var s=i(31),r=i(56),a=i(33);t.exports=function(t){var e=s(t),i=r.f;if(i)for(var o,n=i(t),h=a.f,d=0;n.length>d;)h.call(t,o=n[d++])&&e.push(o);return e}},function(t,e,i){var s=i(18),r=i(82).f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return o&&"[object Window]"==a.call(t)?function(t){try{return r(t)}catch(t){return o.slice()}}(t):r(s(t))}},function(t,e,i){i(55)("asyncIterator")},function(t,e,i){i(55)("observable")},function(t,e,i){t.exports={default:i(136),__esModule:!0}},function(t,e,i){i(137),t.exports=i(4).Object.setPrototypeOf},function(t,e,i){var s=i(5);s(s.S,"Object",{setPrototypeOf:i(138).set})},function(t,e,i){var s=i(11),r=i(13),a=function(t,e){if(r(t),!s(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,s){try{(s=i(17)(Function.call,i(83).f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,i){return a(t,i),e?t.__proto__=i:s(t,i),t}}({},!1):void 0),check:a}},function(t,e,i){t.exports={default:i(140),__esModule:!0}},function(t,e,i){i(141);var s=i(4).Object;t.exports=function(t,e){return s.create(t,e)}},function(t,e,i){var s=i(5);s(s.S,"Object",{create:i(30)})},function(t,e,i){i(84),i(45),i(52),i(143),i(152),i(155),i(157),t.exports=i(4).Map},function(t,e,i){"use strict";var s=i(144),r=i(90);t.exports=i(148)("Map",(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(t){var e=s.getEntry(r(this,"Map"),t);return e&&e.v},set:function(t,e){return s.def(r(this,"Map"),0===t?0:t,e)}},s,!0)},function(t,e,i){"use strict";var s=i(9).f,r=i(30),a=i(86),o=i(17),n=i(87),h=i(35),d=i(47),l=i(80),u=i(147),c=i(6),p=i(54).fastKey,m=i(90),f=c?"_s":"size",_=function(t,e){var i,s=p(e);if("F"!==s)return t._i[s];for(i=t._f;i;i=i.n)if(i.k==e)return i};t.exports={getConstructor:function(t,e,i,d){var l=t((function(t,s){n(t,l,e,"_i"),t._t=e,t._i=r(null),t._f=void 0,t._l=void 0,t[f]=0,null!=s&&h(s,i,t[d],t)}));return a(l.prototype,{clear:function(){for(var t=m(this,e),i=t._i,s=t._f;s;s=s.n)s.r=!0,s.p&&(s.p=s.p.n=void 0),delete i[s.i];t._f=t._l=void 0,t[f]=0},delete:function(t){var i=m(this,e),s=_(i,t);if(s){var r=s.n,a=s.p;delete i._i[s.i],s.r=!0,a&&(a.n=r),r&&(r.p=a),i._f==s&&(i._f=r),i._l==s&&(i._l=a),i[f]--}return!!s},forEach:function(t){m(this,e);for(var i,s=o(t,arguments.length>1?arguments[1]:void 0,3);i=i?i.n:this._f;)for(s(i.v,i.k,this);i&&i.r;)i=i.p},has:function(t){return!!_(m(this,e),t)}}),c&&s(l.prototype,"size",{get:function(){return m(this,e)[f]}}),l},def:function(t,e,i){var s,r,a=_(t,e);return a?a.v=i:(t._l=a={i:r=p(e,!0),k:e,v:i,p:s=t._l,n:void 0,r:!1},t._f||(t._f=a),s&&(s.n=a),t[f]++,"F"!==r&&(t._i[r]=a)),t},getEntry:_,setStrong:function(t,e,i){d(t,e,(function(t,i){this._t=m(t,e),this._k=i,this._l=void 0}),(function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?l(0,"keys"==t?e.k:"values"==t?e.v:[e.k,e.v]):(this._t=void 0,l(1))}),i?"entries":"values",!i,!0),u(e)}}},function(t,e,i){var s=i(13);t.exports=function(t,e,i,r){try{return r?e(s(i)[0],i[1]):e(i)}catch(e){var a=t.return;throw void 0!==a&&s(a.call(t)),e}}},function(t,e,i){var s=i(25),r=i(7)("iterator"),a=Array.prototype;t.exports=function(t){return void 0!==t&&(s.Array===t||a[r]===t)}},function(t,e,i){"use strict";var s=i(8),r=i(4),a=i(9),o=i(6),n=i(7)("species");t.exports=function(t){var e="function"==typeof r[t]?r[t]:s[t];o&&e&&!e[n]&&a.f(e,n,{configurable:!0,get:function(){return this}})}},function(t,e,i){"use strict";var s=i(8),r=i(5),a=i(54),o=i(15),n=i(12),h=i(86),d=i(35),l=i(87),u=i(11),c=i(32),p=i(9).f,m=i(149)(0),f=i(6);t.exports=function(t,e,i,_,g,S){var T=s[t],y=T,E=g?"set":"add",v=y&&y.prototype,C={};return f&&"function"==typeof y&&(S||v.forEach&&!o((function(){(new y).entries().next()})))?(y=e((function(e,i){l(e,y,t,"_c"),e._c=new T,null!=i&&d(i,g,e[E],e)})),m("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(t){var e="add"==t||"set"==t;!(t in v)||S&&"clear"==t||n(y.prototype,t,(function(i,s){if(l(this,y,t),!e&&S&&!u(i))return"get"==t&&void 0;var r=this._c[t](0===i?0:i,s);return e?this:r}))})),S||p(y.prototype,"size",{get:function(){return this._c.size}})):(y=_.getConstructor(e,t,g,E),h(y.prototype,i),a.NEED=!0),c(y,t),C[t]=y,r(r.G+r.W+r.F,C),S||_.setStrong(y,t,g),y}},function(t,e,i){var s=i(17),r=i(48),a=i(23),o=i(50),n=i(150);t.exports=function(t,e){var i=1==t,h=2==t,d=3==t,l=4==t,u=6==t,c=5==t||u,p=e||n;return function(e,n,m){for(var f,_,g=a(e),S=r(g),T=s(n,m,3),y=o(S.length),E=0,v=i?p(e,y):h?p(e,0):void 0;y>E;E++)if((c||E in S)&&(_=T(f=S[E],E,g),t))if(i)v[E]=_;else if(_)switch(t){case 3:return!0;case 5:return f;case 6:return E;case 2:v.push(f)}else if(l)return!1;return u?-1:d||l?l:v}}},function(t,e,i){var s=i(151);t.exports=function(t,e){return new(s(t))(e)}},function(t,e,i){var s=i(11),r=i(81),a=i(7)("species");t.exports=function(t){var e;return r(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!r(e.prototype)||(e=void 0),s(e)&&null===(e=e[a])&&(e=void 0)),void 0===e?Array:e}},function(t,e,i){var s=i(5);s(s.P+s.R,"Map",{toJSON:i(153)("Map")})},function(t,e,i){var s=i(89),r=i(154);t.exports=function(t){return function(){if(s(this)!=t)throw TypeError(t+"#toJSON isn't generic");return r(this)}}},function(t,e,i){var s=i(35);t.exports=function(t,e){var i=[];return s(t,!1,i.push,i,e),i}},function(t,e,i){i(156)("Map")},function(t,e,i){"use strict";var s=i(5);t.exports=function(t){s(s.S,t,{of:function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}})}},function(t,e,i){i(158)("Map")},function(t,e,i){"use strict";var s=i(5),r=i(74),a=i(17),o=i(35);t.exports=function(t){s(s.S,t,{from:function(t){var e,i,s,n,h=arguments[1];return r(this),(e=void 0!==h)&&r(h),null==t?new this:(i=[],e?(s=0,n=a(h,arguments[2],2),o(t,!1,(function(t){i.push(n(t,s++))}))):o(t,!1,i.push,i),new this(i))}})}},function(t,e,i){t.exports={default:i(160),__esModule:!0}},function(t,e,i){i(52),i(45),t.exports=i(161)},function(t,e,i){var s=i(13),r=i(88);t.exports=i(4).getIterator=function(t){var e=r(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return s(e.call(t))}},function(t,e,i){var s={"./ApToken":99,"./ApToken.js":99,"./CurrentProxyInfo":61,"./CurrentProxyInfo.js":61,"./FuzzyQueryKey":39,"./FuzzyQueryKey.js":39,"./FuzzyQueryParam":64,"./FuzzyQueryParam.js":64,"./IpInfo":100,"./IpInfo.js":100,"./PAudienceGetProxyListReq":65,"./PAudienceGetProxyListReq.js":65,"./PAudienceGetProxyListRsp":66,"./PAudienceGetProxyListRsp.js":66,"./SlaveProxyInfo":38,"./SlaveProxyInfo.js":38,"./StreamAllocateInfo":67,"./StreamAllocateInfo.js":67,"./StreamCodecType":63,"./StreamCodecType.js":63,"./StreamGroupID":37,"./StreamGroupID.js":37,"./StreamType":62,"./StreamType.js":62,"./SubscribeResCode":101,"./SubscribeResCode.js":101,"./VoiceChatEx":102,"./VoiceChatEx.js":102,"./VpToken":103,"./VpToken.js":103};function r(t){var e=a(t);return i(e)}function a(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}r.keys=function(){return Object.keys(s)},r.resolve=a,t.exports=r,r.id=162},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=h(i(0)),r=h(i(1)),a=h(i(19)),o=h(i(164)),n=h(i(40));function h(t){return t&&t.__esModule?t:{default:t}}var d=function(){function t(e){(0,s.default)(this,t),this._tafLink=e,this._info=new o.default,this._lastTs=0,this._started=!1,this._sguid="",this._clientTime=0,this._requestId=0,this._onWsTimeSyncBind=this._onWsTimeSync.bind(this)}return(0,r.default)(t,[{key:"destroy",value:function(){this._started=!1,this._tafLink=null}},{key:"start",value:function(t){this._started||""===t||(this._started=!0,this._sguid=t,this.wsTimeSync())}},{key:"onTimer",value:function(t){this._started&&(0===this._lastTs?this._lastTs=t:t-this._lastTs>=6e4&&(this._lastTs=t,this.wsTimeSync()))}},{key:"wsTimeSync",value:function(){this._req||(this._req=new n.default.WSTimeSyncReq),this._requestId=this._tafLink.getRequestId(),this._clientTime=a.default.now(),this._req.sGuid=this._sguid,this._req.lClientTime=this._clientTime,this._tafLink.sendWup("launch","wsTimeSync",this._req,this._onWsTimeSyncBind,!0,this._requestId)}},{key:"_onWsTimeSync",value:function(t){this._info.ntpProcess(this._clientTime,Number(t.lServerTime))}},{key:"getSyncTime",value:function(){return this._info.convertToSrvTime(a.default.now())}},{key:"isFinishNtp",value:function(){return this._info.isFinishNtp()}}]),t}();e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=o(i(0)),r=o(i(1)),a=o(i(19));function o(t){return t&&t.__esModule?t:{default:t}}var n=function(){function t(){(0,s.default)(this,t),this.osTime=0,this.syncLocalTime=0,this.rttList=[]}return(0,r.default)(t,[{key:"convertToSrvTime",value:function(t){if(0===this.osTime)return 0;var e=t-this.osTime;return this.syncLocalTime+e}},{key:"isFinishNtp",value:function(){return 0!==this.osTime}},{key:"ntpProcess",value:function(t,e){var i=a.default.now(),s=i-t,r=Math.round(e+s/2);if(0===this.osTime&&0===this.syncLocalTime)this.osTime=i,this.syncLocalTime=r,this.rttList.push(s);else if(this.rttList.length<10)this.osTime=i,this.syncLocalTime=r,this.rttList.push(s);else{for(var o=[],n=0;n<this.rttList.length;++n)o.push(this.rttList[n]);o.sort((function(t,e){return t-e}));for(var h=0,d=0;d<4;++d)h+=o[d];var l=h>>2;(4*s>3*l&&4*s<5*l||s>6e4)&&(this.osTime=i,this.syncLocalTime=r),this.rttList.shift(),this.rttList.push(s),o=null}}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=h(i(0)),r=h(i(1)),a=h(i(21)),o=h(i(19)),n=h(i(16));function h(t){return t&&t.__esModule?t:{default:t}}var d=function(){function t(e){(0,s.default)(this,t),this.TafLink=e,this._rttCur=0,this._rttMax=0,this._rttSmooth=0,this._rttSamples=[],this._lastPingTs=0,this._lastSampleTs=0,this._pingRspBind=this._pingRsp.bind(this)}return(0,r.default)(t,[{key:"getStats",value:function(){var t={rttMax:this._rttMax,rttSmooth:this._rttSmooth,rttSamples:this._rttSamples.slice()};return this._rttMax=0,this._rttSamples=[],t}},{key:"onTimer",value:function(t){0===this._lastPingTs?this._lastPingTs=t:t-this._lastPingTs>=3e3&&(this._lastPingTs=t,this._pingReq(t)),0===this._lastSampleTs?this._lastSampleTs=t:t-this._lastSampleTs>=1e3&&(this._lastSampleTs=t,this._rttSamples.push(this._rttCur))}},{key:"_pingReq",value:function(t){if(this.TafLink.connected){var e=new a.default.PingSignalContext;e.mTracePoint.put("sendTime",t),this.TafLink.sendWup("launch","pingSignal",e,this._pingRspBind,!0,this.TafLink.getRequestId())}}},{key:"_pingRsp",value:function(t){var e=o.default.now(),i=t.mTracePoint.get("sendTime");if(i>0){var s=Math.round((e-i)/2);this._rttCur=s,0===this._rttSmooth?this._rttSmooth=s:this._rttSmooth=Math.round((7*this._rttSmooth+s)/8),this._rttMax<s&&(this._rttMax=s)}else n.default.logger.warn("[SignalRtt] pingRsp not a number: sendTime="+i)}}]),t}();e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=g(i(22)),r=g(i(0)),a=g(i(1)),o=g(i(24)),n=g(i(26)),h=g(i(21)),d=g(i(39)),l=g(i(3)),u=g(i(34)),c=g(i(65)),p=g(i(66)),m=i(85),f=g(i(104)),_=g(i(16));function g(t){return t&&t.__esModule?t:{default:t}}var S=function(t){function e(t){var i=arguments[2];(0,r.default)(this,e);var a=(0,o.default)(this,(e.__proto__||(0,s.default)(e)).call(this));return a.player=t,a.wupProtocolList=[],a.vpRequestId=0,a.vpGetted=!1,a.TafLink=i,a}return(0,n.default)(e,t),(0,a.default)(e,[{key:"getRequestId",value:function(){return this.TafLink.getRequestId()}},{key:"resetVpRequest",value:function(){this.vpRequestId=0}},{key:"setTafWup",value:function(t){this._tafwup=t,h.default.setTaf(this._tafwup),this.emit(e.TAF_WUP_READY)}},{key:"getVoiceProxy",value:function(t){var i=this;t&&t.requestId?this.vpRequestId=t.requestId:(this.vpRequestId=this.getRequestId(),t.requestId=this.vpRequestId),this.vpGetted=!1,this.TafLink.connected?this._getVoiceProxy(t):(this.TafLink.on(this.TafLink.TAFLINK_INITED,(function(){i.vpGetted?_.default.logger.log("vp had been getted by http"):i._getVoiceProxy(t)})),this.on(e.TAF_WUP_READY,(function(){i.vpGetted?_.default.logger.log("vp had been getted by socket"):i._getVoiceProxyHttp(t)})))}},{key:"_getVoiceProxyHttp",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.vpGetted=!0;var i=e.userid,s=e.presenterUid,r=e.streamName,a=e.sid,o=e.latencyModel,n=new d.default;n.sid=s,n.fuzzyParam.h264Only=!0,n.fuzzyParam.maxCodeRateH264=0,n.fuzzyParam.maxCodeRateH265=0;var u=new c.default;u.uid=i,u.version=1,u.sdkVersion=1,u.fuzzyQueryKeys=[n],u.streamNames=[r],u.appid=e.appid,u.clientAppid=0,u.clientType=14,u.sendTime=.001*Date.now()>>0,u.useCase=3,u.appUA="webh5&2410211149&websocket";var p=e.playerdata||{},m=(p.gameId||0)+"";u.extInfo.set("categoryId",m),e&&e.rtctrans&&u.extInfo.set("rtctrans",e.rtctrans),e&&void 0!==e.iBitRate&&u.extInfo.set("coderate",String(e.iBitRate)),u.latencyModel=o,_.default.logger.log("TafLinkSignal._getVoiceProxyHttp req=",u);var f=u.constructor.name,g=l.default[f],S=new h.default.GetInfoFromVGReq;S.lUid=i,S.sProtoName="yy",S.iUri=g||0,S.lSid=a||0,S.tId=this._getUserId();var T=this._tafwup.BinBuffer;S.sMsg=new T(u.marshall().buffer);var y="videogateway",E="getInfoFromVG",v=new this._tafwup.Wup;v.setServant(y),v.setFunc(E),v.writeStruct("tReq",S);var C=v.encode().getBuffer();this._tafwup.Util.ajax("//cdn.wup.huya.com",C,(function(e){var i=new t._tafwup.Wup;i.decode(e);var s=new h.default.GetInfoFromVGRsp;i.readStruct("tRsp",s,h.default.GetInfoFromVGRsp),t._onGetProxyResp(s)}),(function(t){_.default.logger.error("Get vp error, status=",t)}))}},{key:"_getVoiceProxy",value:function(t){var e=t.playerdata,i=t.appid,s=t.streamName,r=(t.subSid,t.presenterUid),a=(t.serviceType,t.userid),o=t.latencyModel,n=(t.maxCodeRateH264,t.maxCodeRateH265,t.clientType,t.sid),u=t.requestId,p=t.rtctrans,m=t.iBitRate;this.vpGetted=!0;var f=new d.default;f.sid=r,f.fuzzyParam.h264Only=!0,f.fuzzyParam.maxCodeRateH264=0,f.fuzzyParam.maxCodeRateH265=0;var g=a||(Date.now()%1e10*1e3+(1e3*Math.random()|0))%4294967295,S=new c.default;S.uid=g,S.version=1,S.sdkVersion=1,S.fuzzyQueryKeys=[f],S.streamNames=[s],S.appid=i,S.clientAppid=0,S.clientType=14,S.sendTime=.001*Date.now()>>0,S.useCase=3,S.appUA="webh5&2410211149&websocket";var T=((e=e||{}).gameId||0)+"";S.extInfo.set("categoryId",T),p&&S.extInfo.set("rtctrans",p),void 0!==m&&S.extInfo.set("coderate",String(m)),S.latencyModel=o,_.default.logger.log("TafLinkSignal._getVoiceProxy uid=%s, requestId=%s",g,u,S);var y=S.constructor.name,E=l.default[y],v=new h.default.GetInfoFromVGReq;v.lUid=g;var C=this.TafLink.getTaf().getTaf().BinBuffer;v.sMsg=new C(S.marshall().buffer),v.sProtoName="yy",v.iUri=E||0,v.lSid=n||0,v.tId=this.TafLink.getUserId(),this.TafLink.sendWup("videogateway","getInfoFromVG",v,this._onGetProxyResp.bind(this),!0,u)}},{key:"_onGetProxyResp",value:function(t){_.default.logger.log("TafLinkSignal.onGetProxyResp",t);var e=t.iRequestId;if(e&&e!==this.vpRequestId)_.default.logger.error("Request id is inequality iRequestId=%d, vpRequestId=%d",e,this.vpRequestId);else{var i=new DataView(t.sMsg.buffer),s=new u.default(i),r=new p.default;r.unmarshall(s);var a=[];r.allocatedStreams.forEach((function(t,e){a=a.concat(t)})),this.emit(l.default.PAudienceGetProxyListRsp,r)}}},{key:"_getUserId",value:function(t){var e=new h.default.UserId;return e.lUid=t,e.sGuid=f.default.getCookie("guid"),e.sToken="",e.sHuYaUA="webh5&0.0.0&websocket",e.sCookie=document.cookie,e}}]),e}(m.EventEmitter);S.TAF_WUP_READY="TAF_WUP_READY",e.default=S},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=h(i(0)),r=h(i(1)),a=h(i(21)),o=h(i(104)),n=h(i(16));function h(t){return t&&t.__esModule?t:{default:t}}var d=function(){function t(e){(0,s.default)(this,t),this._tafLink=e,this._mediaUserId=null,this._bAnonymous=0,this._tryTimes=0,this._isLogin=!1,this._roomId=0}return(0,r.default)(t,[{key:"loginMedia",value:function(t,e,i,s){if(this._roomId=e,!this._mediaUserId){var r=new a.default.MediaUserId;r.lUid=i,r.sGuid=o.default.getCookie("guid"),r.sToken=t,r.sUA="media_web&1000&",r.iAppid=s,r.sStrUid="",this._mediaUserId=r}this._login()}},{key:"_login",value:function(){this._mediaUserId.bAnonymous=this._bAnonymous;var t=new a.default.LoginVerifyReq;t.tId=this._mediaUserId,this._tafLink.sendWup("mediaui","loginVerify",t,this._onLogin.bind(this),!0,this._tafLink.getRequestId(),!0)}},{key:"_onLogin",value:function(t){n.default.logger.log("MediaLink._onLogin iResCode="+t.iResCode),0===t.iResCode?(this._isLogin=!0,this._mediaUserId.sCookie=t.sCookie,this._join()):1===t.iResCode&&(this._tryTimes++,this._tryTimes<5&&(this._bAnonymous=1,this._login()))}},{key:"_join",value:function(){var t=new a.default.JoinMediaGroupReq;t.tId=this._mediaUserId,t.vGroupId.value=[this._roomId],this._tafLink.sendWup("mediaui","joinGroup",t,this._onJoin.bind(this),!0,this._tafLink.getRequestId(),!0)}},{key:"_onJoin",value:function(t){n.default.logger.log("MediaLink._onJoin iCode="+t.iCode)}},{key:"quitMedia",value:function(){var t=new a.default.QuitMediaGroupReq;t.tId=this._mediaUserId,t.vGroupId.value=[this._roomId],this._tafLink.sendWup("mediaui","quitGroup",t,this._onQuit.bind(this),!0,this._tafLink.getRequestId(),!0)}},{key:"_onQuit",value:function(t){n.default.logger.log("MediaLink._onQuit iCode="+t.iCode)}}]),t}();e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=l(i(22)),r=l(i(0)),a=l(i(1)),o=l(i(24)),n=l(i(26)),h=l(i(68)),d=l(i(3));function l(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(){return(0,r.default)(this,e),(0,o.default)(this,(e.__proto__||(0,s.default)(e)).call(this))}return(0,n.default)(e,t),(0,a.default)(e,[{key:"onSlice",value:function(t){var e=new DataView(t.payload.buffer),i=this.unmarshall(t.uri,e);i.seq=t.seq,this.trigger(d.default.PP2pSliceData,{parent:t,child:i})}},{key:"getClass",value:function(t){return i(91)("./"+t).default}}]),e}(h.default);e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=h(i(22)),r=h(i(0)),a=h(i(1)),o=h(i(24)),n=h(i(26));function h(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(){return(0,r.default)(this,e),(0,o.default)(this,(e.__proto__||(0,s.default)(e)).call(this))}return(0,n.default)(e,t),(0,a.default)(e,[{key:"getClass",value:function(t){return i(170)("./"+t).default}}]),e}(h(i(68)).default);e.default=d},function(t,e,i){var s={"./AnchorDtsSei":69,"./AnchorDtsSei.js":69,"./AnchorSeiInfo":106,"./AnchorSeiInfo.js":106,"./HuyaDelaySeiData":107,"./HuyaDelaySeiData.js":107,"./ServerDtsSei":70,"./ServerDtsSei.js":70,"./ServerNodeInfo":71,"./ServerNodeInfo.js":71};function r(t){var e=a(t);return i(e)}function a(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}r.keys=function(){return Object.keys(s)},r.resolve=a,t.exports=r,r.id=170},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,r=(s=i(172))&&s.__esModule?s:{default:s},a={};self||(self=window),function(){var t=self.navigator.userAgent.toLowerCase(),e=/(edge)\/([\w.]+)/.exec(t)||/(edg)\/([\w.]+)/.exec(t)||/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(iemobile)[\/]([\w.]+)/.exec(t)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(t)||[],i=/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(windows phone)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(android)/.exec(t)||/(windows)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||[],s={browser:e[5]||e[3]||e[1]||"",version:e[2]||e[4]||"0",majorVersion:e[4]||e[2]||"0",platform:i[0]||""},o={};if(s.browser){o[s.browser]=!0;var n=s.majorVersion.split(".");o.version={major:parseInt(s.majorVersion,10),string:s.version,majorVersion:s.majorVersion},n.length>1&&(o.version.minor=parseInt(n[1],10)),n.length>2&&(o.version.build=parseInt(n[2],10))}for(var h in s.platform&&(o[s.platform]=!0),(o.chrome||o.opr||o.safari)&&(o.webkit=!0),(o.rv||o.iemobile)&&(o.rv&&delete o.rv,s.browser="msie",o.msie=!0),o.edge&&(delete o.edge,s.browser="msedge",o.chrome=!0),o.edg&&(delete o.edg,s.browser="msedge",o.chrome=!0),o.opr&&(s.browser="opera",o.opera=!0),o.safari&&o.android&&(s.browser="android",o.android=!0),o.name=s.browser,o.platform=s.platform,a)a.hasOwnProperty(h)&&delete a[h];(0,r.default)(a,o)}(),a.version||(a.version={major:0,minor:0,build:0,string:"0.0.0"}),e.default=a},function(t,e,i){t.exports={default:i(173),__esModule:!0}},function(t,e,i){i(174),t.exports=i(4).Object.assign},function(t,e,i){var s=i(5);s(s.S+s.F,"Object",{assign:i(175)})},function(t,e,i){"use strict";var s=i(6),r=i(31),a=i(56),o=i(33),n=i(23),h=i(48),d=Object.assign;t.exports=!d||i(15)((function(){var t={},e={},i=Symbol(),s="abcdefghijklmnopqrst";return t[i]=7,s.split("").forEach((function(t){e[t]=t})),7!=d({},t)[i]||Object.keys(d({},e)).join("")!=s}))?function(t,e){for(var i=n(t),d=arguments.length,l=1,u=a.f,c=o.f;d>l;)for(var p,m=h(arguments[l++]),f=u?r(m).concat(u(m)):r(m),_=f.length,g=0;_>g;)p=f[g++],s&&!c.call(m,p)||(i[p]=m[p]);return i}:d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=d(i(10)),r=d(i(0)),a=d(i(1)),o=d(i(40)),n=d(i(16)),h=d(i(19));function d(t){return t&&t.__esModule?t:{default:t}}var l=function(){function t(e,i,a,o,n){(0,r.default)(this,t),this.StatCfg=a,this.VodPcdnState=o,this.Timer=n,this._statVod=e,this._oldStat=i,this._open=!0,this._fragsMap=new s.default,this._subsUrlReqTs=0,this.isLoading=!1,this.isAborted=!1,this._onGetVodPcdnProxyBind=this._onGetVodPcdnProxy.bind(this),this._onGetVodPcdnProxyTimeoutBind=this._onGetVodPcdnProxyTimeout.bind(this)}return(0,a.default)(t,[{key:"_getVodPcdnProxy",value:function(t,e,i){var s=i.uid,r=i.appid,a=i.sGuid,d=i.TafLink;if(this._open&&!this.isLoading){this.isLoading=!0,this.isAborted=!1,this._subsUrlReqTs=h.default.now();var l=new o.default.ClientGetVodPcdnProxyReq;l.appid=r,l.lReqTs=Date.now(),l.lUid=s,l.sGuid=a,l.iCliType=o.default.EM_CLINET_TYPE.E_CLIENT_WEB,l.lBucketPara=0,l.sOrigUrl=t,this._fragsMap.clear();for(var u=e.length,c=0;c<u;c++){var p=e[c],m=p.url.replace(/http.*?\/\//,"");this._fragsMap.set(p.sn,p);var f=new o.default.VodUrlRange;f.sUrl=m,p.byteRangeEndOffset&&(f.sRange="bytes="+p.byteRangeStartOffset+"-"+(p.byteRangeEndOffset-1)),f.index=p.sn,l.vKeys.value.push(f)}Number(localStorage._print_pcdn_req)<=1&&n.default.logger.log("PcdnVodProxy.getVodPcdnProxy",l),d.sendWup("hypcdnvodgw","onClientGetVodPcdnProxyReq",l,this._onGetVodPcdnProxyBind),this.Timer.has(this._onGetVodPcdnProxyTimeoutBind,this)||this.Timer.once(this._onGetVodPcdnProxyTimeoutBind,this,5e3)}}},{key:"_onGetVodPcdnProxy",value:function(t){if(Number(localStorage._print_pcdn_req)<=1&&n.default.logger.log("PcdnVodProxy._onGetVodPcdnProxy rsp:",t),this.Timer.remove(this._onGetVodPcdnProxyTimeoutBind,this),!this.isAborted)if(this.isLoading=!1,this._subsUrlReqTs>0&&(this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_SUBS_URL_TIME,h.default.now()-this._subsUrlReqTs),this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_SUBS_URL_TIME_CNT,1),this._subsUrlReqTs=0),t)if(this._oldStat.setComDim(this.StatCfg.DIM_COM.PCDN_ORIGIN,t.pcdnName),this._statVod.setComDim(this.StatCfg.DIM_COM.PCDN_ORIGIN,t.pcdnName),this._statVod.setComDim(this.StatCfg.DIM_COM.CLI_ISP,t.cliIsp),this._statVod.setComDim(this.StatCfg.DIM_COM.CLI_PROV,t.cliProv),this._statVod.setCoreDim(this.StatCfg.DIM_CORE.PCDN_SVR_ISP,t.sPcdnIsp),this._statVod.setCoreDim(this.StatCfg.DIM_CORE.PCDN_SVR_AREA,t.sPcdnArea),t.iErrCode===o.default.ERR_CODE_FOR_HY_PCDNGW_CLIENT_RSP.E_SUCCESS){this._statVod.setComDim(this.StatCfg.PCDN_DATA.USE_PCDN,1);for(var e=t.vPcdnUrls.value.length,i=0;i<e;i++){var s=t.vPcdnUrls.value[i],r=this._fragsMap.get(s.reqKey.index);if(r){switch(!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_URL_TOTAL_CNT,1),s.iStatusPcdn){case 100:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_URL_SUCCESS,1),this._updateFragPcdnState(this.VodPcdnState.PCDN_REALTIME,s),this._rspVodPcdnProxyUrl(s);break;case 101:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_ERR_NOT_REACHED,1),this._updateFragPcdnState(this.VodPcdnState.REALTIME_NOT_REACHED,s);break;case 102:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_ERR_OVER_RUN,1),this._updateFragPcdnState(this.VodPcdnState.REALTIME_OVER_RUN,s);break;case 200:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_URL_SUC_FREETIME,1),this._updateFragPcdnState(this.VodPcdnState.PCDN_FREETIME,s),this._rspVodPcdnProxyUrl(s);break;case 201:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_ERR_OVER_RUN_FREETIME,1),this._updateFragPcdnState(this.VodPcdnState.FREETIME_OVER_RUN,s);break;case 301:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_ERR_NOT_COVERD,1),this._updateFragPcdnState(this.VodPcdnState.FREETIME_NOT_COVERD,s);break;case 302:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_ERROR_REQ,1),this._updateFragPcdnState(this.VodPcdnState.ERROR_REQ,s);break;default:!r.statPcdn&&this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_ERR_OTHER,1),this._updateFragPcdnState(this.VodPcdnState.PCDN_REQ_OTHER,s)}r.statPcdn=!0}}}else t.iErrCode===o.default.ERR_CODE_FOR_HY_PCDNGW_CLIENT_RSP.E_PCDN_OFF?(this._open=!1,this._statVod.setComDim(this.StatCfg.PCDN_DATA.USE_PCDN,0),this._updateFragPcdnState(this.VodPcdnState.PCDN_NOT_OPEN)):(this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_URL_TOTAL_CNT,1),this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_SUBS_URL_ERROR_CNT,1),this._updateFragPcdnState(this.VodPcdnState.TAF_REQ_ERROR));else this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_URL_TOTAL_CNT,1),this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_SUBS_URL_ERROR_CNT,1),this._updateFragPcdnState(this.VodPcdnState.TAF_REQ_ERROR)}},{key:"_onGetVodPcdnProxyTimeout",value:function(){n.default.logger.warn("PcdnVodProxy._onGetVodPcdnProxyTimeout pcdn proxy time out"),this.isLoading=!1,this.isAborted=!0,this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_PCDN_URL_TOTAL_CNT,1),this._statVod.addCore(this.StatCfg.PCDN_DATA.GET_SUBS_URL_ERROR_CNT,1),this._updateFragPcdnState(this.VodPcdnState.TAF_REQ_ERROR),this.Timer.remove(this._onGetVodPcdnProxyTimeoutBind,this)}},{key:"_rspVodPcdnProxyUrl",value:function(t){var e=this._fragsMap.get(t.reqKey.index);e&&(e.pcdnUrls=t.vUrls.value.slice(),e.tryCnt=e.pcdnUrls.length,e.pcdnFreetime=200===t.iStatusPcdn)}},{key:"_updateFragPcdnState",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t)if(e){var i=this._fragsMap.get(e.reqKey.index);i&&(i.pcdnStatus=t)}else this._fragsMap.forEach((function(e,i){return e.pcdnStatus=t}))}},{key:"isPcdnOpen",get:function(){return this._open}}]),t}();e.default=l}]).default},function(t,e,i){"use strict";e.a={printTodecodeVideo:!1,printToDecodeAudio:!1,printDecodedVideo:!1,printDecodedAudio:!1,printTorenderVideo:!1,printTorenderAudio:!1,printAppendVideo:!1,printAppendAudio:!1,printVideoDecodeFast:!1,printRenderSkipFrame:!1,setCfg:function(t){for(let e in t)this[e]=t[e]}}},function(t,e,i){"use strict";var s=i(18),r=i(2);e.a={AVC1:"avc1.42E01E,mp4a.40.2",HVC1:"hvc1.1.6.L93,mp4a.40.2",AV01:"av01.0.08M.08,mp4a.40.2",isMseSupportedH264:function(){return this._isSupported(this.AVC1)},isMseSupportedHevc:function(){return this._isSupported(this.HVC1)},isMseSupportedAV01:function(){return this._isSupported(this.AV01)},_isSupported:function(t){let e=s.a.getMediaSource(r.a.mmsOpen);return e&&e.isTypeSupported("video/mp4; codecs="+t)}}},function(t,e,i){function s(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.i=function(t){return t},i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i.oe=function(t){throw console.error(t),t};var s=i(i.s=ENTRY_MODULE);return s.default||s}function r(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(t,e,s){var a={};a[s]=[];var o=e.toString(),n=o.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!n)return a;for(var h,d=n[1],l=new RegExp("(\\\\n|\\W)"+r(d)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");h=l.exec(o);)"dll-reference"!==h[3]&&a[s].push(h[3]);for(l=new RegExp("\\("+r(d)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");h=l.exec(o);)t[h[2]]||(a[s].push(h[1]),t[h[2]]=i(h[1]).m),a[h[2]]=a[h[2]]||[],a[h[2]].push(h[4]);for(var u,c=Object.keys(a),p=0;p<c.length;p++)for(var m=0;m<a[c[p]].length;m++)u=a[c[p]][m],isNaN(1*u)||(a[c[p]][m]=1*a[c[p]][m]);return a}function o(t){return Object.keys(t).reduce((function(e,i){return e||t[i].length>0}),!1)}t.exports=function(t,e){e=e||{};var r={main:i.m},n=e.all?{main:Object.keys(r.main)}:function(t,e){for(var i={main:[e]},s={main:[]},r={main:{}};o(i);)for(var n=Object.keys(i),h=0;h<n.length;h++){var d=n[h],l=i[d].pop();if(r[d]=r[d]||{},!r[d][l]&&t[d][l]){r[d][l]=!0,s[d]=s[d]||[],s[d].push(l);for(var u=a(t,t[d][l],d),c=Object.keys(u),p=0;p<c.length;p++)i[c[p]]=i[c[p]]||[],i[c[p]]=i[c[p]].concat(u[c[p]])}}return s}(r,t),h="";Object.keys(n).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;n[t][e];)e++;n[t].push(e),r[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",h=h+"var "+t+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n[t].map((function(e){return JSON.stringify(e)+": "+r[t][e].toString()})).join(",")+"});\n"})),h=h+"new (("+s.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+n.main.map((function(t){return JSON.stringify(t)+": "+r.main[t].toString()})).join(",")+"}))(self);";var d=new window.Blob([h],{type:"text/javascript"});if(e.bare)return d;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(d),u=new window.Worker(l);return u.objectURL=l,u}},function(t,e,i){"use strict";e.a=class{static getMediaSource(t){return window.ManagedMediaSource&&t?window.ManagedMediaSource:window.MediaSource?window.MediaSource:null}static isManagedMediaSource(t){return t===window.ManagedMediaSource}}},function(t,e,i){t.exports=function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function a(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function n(t,e){var i=t.toString().length,s=Math.max(0,e-i),r="";if(s>0)for(var a=0;a<s;a++)r+="0";return r+t}function h(){var t=new Date,e=t.getFullYear(),i=n(t.getMonth()+1,2),s=n(t.getDate(),2),r=n(t.getHours(),2),a=n(t.getMinutes(),2),o=n(t.getSeconds(),2);return"["+"".concat(e,"-").concat(i,"-").concat(s," ").concat(r,":").concat(a,":").concat(o)+"."+n(t.getMilliseconds(),3)+"][w265]"}i.r(e);var d=[];function l(){for(var t,e=h(),i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];s[0]=e+s[0],self.logCallback?(t=self.logCallback).call.apply(t,[null].concat(s)):d.push(s)}var u=function(){function t(e,i){s(this,t),this.width=e,this.height=i,this.stridey=this.width,this.strideu=this.stridey/2,this.stridev=this.stridey/2}return a(t,[{key:"calc",value:function(t){for(var e=new Uint8Array(this.stridey*this.height).fill(128,0,this.stridey*this.height),i=new Uint8Array(this.strideu*this.height).fill(128,0,this.strideu*this.height),s=new Uint8Array(this.stridev*this.height).fill(128,0,this.stridev*this.height),r=new Uint8Array(this.width*this.height*4),a=1e3*window.performance.now(),o=0;o<t;o++)this.convertYUV420(e,i,s,this.width,this.height,this.stridey,this.strideu,this.stridev,r);return 1e3*window.performance.now()-a}},{key:"convertYUV420",value:function(t,e,i,s,r,a,o,n,h){for(var d,l,u,c,p,m=0,f=0,_=s>>1,g=_*r,S=0,T=0,y=0,E=0;E<g;E++)p=E<<1,d=1.164*(t[S+(c=m<<1)]-16),l=e[T+m]-128,u=i[y+m]-128,h[0+(p<<2)]=d+1.596*u,h[1+(p<<2)]=d-.813*u-.391*l,h[2+(p<<2)]=d+2.018*l,h[3+(p<<2)]=255,d=1.164*(t[S+c+1]-16),h[0+(p+1<<2)]=d+1.596*u,h[1+(p+1<<2)]=d-.813*u-.391*l,h[2+(p+1<<2)]=d+2.018*l,h[3+(p+1<<2)]=255,++m===_&&(m=0,S+=a,T=(++f>>1)*o,y=(f>>1)*n)}}]),t}(),c=function(){function t(){s(this,t)}return a(t,null,[{key:"isSupportWasm",value:function(){return"object"==typeof WebAssembly}},{key:"isSupportWasmThread",value:function(){if("undefined"==typeof SharedArrayBuffer||"undefined"==typeof Atomics)return l("hevcd","SharedArrayBuffer undefined or Atomics undefined"),!1;var t=new WebAssembly.Memory({initial:1,maximum:1,shared:!0}).buffer instanceof SharedArrayBuffer;return self.SharedArrayBuffer&&self.Atomics&&t}}]),t}(),p=function(){function t(){s(this,t),this.cla="hevcd",this.configs=null,this.costUs=0,this.reason=0,this.cores=navigator.hardwareConcurrency,this.is64bit=this.is64bitSoftware(),this.enableCost=!0}return a(t,[{key:"parseConfigs",value:function(t){this.configs=t,l(this.cla,"parse",JSON.stringify(t),"cfg",this.configs.enableWebH265)}},{key:"isSupportH265",value:function(t,e){if(null==this.configs)return l(this.cla,"isSupportH265 configs==null"),!1;this.reason=0;var i=this.isConfigEnable()&&this.isCPUCoresSatisfy(e)&&this.isWasm()&&this.isBitrateInRange(e)&&this.isCostInRange(e);return l(this.cla,"isSupportH265",i,"kbps=",e,"costUs",this.costUs.toFixed(0),"cores",this.cores,"64b",this.is64bit,"reason",this.reason,"version",t,"cfg",JSON.stringify(this.configs)),l("ua:",navigator.userAgent),{isSupport:i,costUs:this.costUs.toFixed(0),reason:this.reason}}},{key:"isWasm",value:function(){return!!c.isSupportWasm()||(this.reason=7,!1)}},{key:"isConfigEnable",value:function(){return!(!this.hasOwnProperty("enableWebH265")||1!=this.configs.enableWebH265&&(this.reason=1,1))}},{key:"isCPUCoresSatisfy",value:function(t){if(this.hasOwnProperty("core")){var e=this.configs.core[2e3];if(this.configs.core.hasOwnProperty(t)&&(e=this.configs.core[t]),this.cores>e)return!0}else if(this.cores>4)return!0;return this.reason=2,!1}},{key:"is64bitSoftware",value:function(){return-1!=navigator.userAgent.indexOf("Macintosh")||-1!=navigator.userAgent.indexOf("x64")}},{key:"isBitrateInRange",value:function(t){return c.isSupportWasmThread()?!(!this.hasOwnProperty("multiThreadBitKbps")||((t>=4e3||0==t)&&!this.checkX86(t)?(this.reason=4,1):(!Array.isArray(this.configs.multiThreadBitKbps)||!this.configs.multiThreadBitKbps.includes(t))&&(this.reason=3,1))):(this.reason=6,!1)}},{key:"checkX86",value:function(t){if(this.is64bit)return!0;if(!this.hasOwnProperty("x86"))return!1;var e=!1;return this.configs.x86.hasOwnProperty(t)&&(e=1==this.configs.x86[t]),e}},{key:"isCostInRange",value:function(t){if(!this.enableCost)return!0;if(!this.hasOwnProperty("baseCostUs"))return!1;var e=this.configs.baseCostUs[2e3];return this.configs.baseCostUs.hasOwnProperty(t)&&(e=this.configs.baseCostUs[t]),this.costUs=this.getCost(),this.costUs<=e||(this.reason=5,!1)}},{key:"getCost",value:function(){var t=this;if(!this.hasOwnProperty("loopCount"))return l(this.cla,"getCost configs==null or has no key=loopCount"),0;var e=0;return localStorage.hasOwnProperty("w265LastCost")&&(e=Number(localStorage.w265LastCost)),this.sid&&clearTimeout(this.sid),this.sid=setTimeout((function(){var e=new u(120,120);localStorage.w265LastCost=Math.floor(e.calc(t.configs.loopCount))}),5e3),e}},{key:"hasOwnProperty",value:function(t){return!!this.configs.hasOwnProperty(t)||(this.reason=1,!1)}}]),t}(),m=function(){function t(){s(this,t),this.configMgr=new p}return a(t,[{key:"parseConfigs",value:function(t){this.configMgr.parseConfigs(t)}},{key:"isSupportH265",value:function(t){return this.configMgr.isSupportH265(this.version(),t)}},{key:"version",value:function(){return"1.5.3"}},{key:"setLogCallback",value:function(t){var e;e=t,self.logCallback=e,l("Logger setLogCallback"),d.length>0&&(d.forEach((function(t){var e;(e=self.logCallback).call.apply(e,[null].concat(function(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t)))})),d.length=0)}},{key:"isStripe",value:function(){return-1!==navigator.userAgent.indexOf("Windows")}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new t),this.instance}}]),t}();e.default=m}]).default},function(t,e,i){"use strict";var s={buildAbsoluteURL:function(t,e){if(e=e.trim(),/^[a-z]+:/i.test(e))return e;var i=null,r=null,a=/^([^#]*)(.*)$/.exec(e);a&&(r=a[2],e=a[1]);var o=/^([^\?]*)(.*)$/.exec(e);o&&(i=o[2],e=o[1]);var n=/^([^#]*)(.*)$/.exec(t);n&&(t=n[1]);var h=/^([^\?]*)(.*)$/.exec(t);h&&(t=h[1]);var d=/^((([a-z]+):)?\/\/[a-z0-9\.-]+(:[0-9]+)?\/)(.*)$/i.exec(t),l=d[3],u=d[1],c=d[5],p=null;if(/^\/\//.test(e))p=l+"://"+s.buildAbsolutePath("",e.substring(2));else if(/^\//.test(e))p=u+s.buildAbsolutePath("",e.substring(1));else{p=u+s.buildAbsolutePath(c,e)}return i&&(p+=i),r&&(p+=r),p},buildAbsolutePath:function(t,e){for(var i,s,r=e,a="",o=t.replace(/[^\/]*$/,r.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),n=0;(s=o.indexOf("/../",n))>-1;n=s+i)i=/^\/(?:\.\.\/)*/.exec(o.slice(s))[0].length,a=(a+o.substring(n,s)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(i-1)/3+"}$"),"/");let h=/\.\.\//g;if(h.test(e)){let i=t.split("/"),s=e.match(h).length;a=i.splice(0,i.length-1-s);let r=o.substr(n);return r.startsWith("/")?a.join("/")+r:a.join("/")+"/"+r}return a+o.substr(n)},getTimeFromUrl:function(t,e){var i=e?/\d+_(\d+)_\d+.ts?/:/(\d+)_\d+_\d+.ts?/,s=t.match(i);return s?e?s[1]:Math.round(s[1]/1e3):-1},getVodUrl:function(t,e,i,s){return"http://106.38.255.95:9123/xcrs/"+t+"_"+e+"_"+i+".m3u8?btime="+s}};t.exports=s},function(t,e,i){"use strict";var s,r="object"==typeof Reflect?Reflect:null,a=r&&"function"==typeof r.apply?r.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};s=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var o=Number.isNaN||function(t){return t!=t};function n(){n.init.call(this)}t.exports=n,t.exports.once=function(t,e){return new Promise((function(i,s){function r(i){t.removeListener(e,a),s(i)}function a(){"function"==typeof t.removeListener&&t.removeListener("error",r),i([].slice.call(arguments))}g(t,e,a,{once:!0}),"error"!==e&&function(t,e,i){"function"==typeof t.on&&g(t,"error",e,i)}(t,r,{once:!0})}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var h=10;function d(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function l(t){return void 0===t._maxListeners?n.defaultMaxListeners:t._maxListeners}function u(t,e,i,s){var r,a,o,n;if(d(i),void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),a=t._events),o=a[e]),void 0===o)o=a[e]=i,++t._eventsCount;else if("function"==typeof o?o=a[e]=s?[i,o]:[o,i]:s?o.unshift(i):o.push(i),(r=l(t))>0&&o.length>r&&!o.warned){o.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=o.length,n=h,console&&console.warn&&console.warn(n)}return t}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(t,e,i){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},r=c.bind(s);return r.listener=i,s.wrapFn=r,r}function m(t,e,i){var s=t._events;if(void 0===s)return[];var r=s[e];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(r):_(r,r.length)}function f(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function _(t,e){for(var i=new Array(e),s=0;s<e;++s)i[s]=t[s];return i}function g(t,e,i,s){if("function"==typeof t.on)s.once?t.once(e,i):t.on(e,i);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function r(a){s.once&&t.removeEventListener(e,r),i(a)}))}}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");h=t}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},n.prototype.getMaxListeners=function(){return l(this)},n.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var s="error"===t,r=this._events;if(void 0!==r)s=s&&void 0===r.error;else if(!s)return!1;if(s){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var n=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw n.context=o,n}var h=r[t];if(void 0===h)return!1;if("function"==typeof h)a(h,this,e);else{var d=h.length,l=_(h,d);for(i=0;i<d;++i)a(l[i],this,e)}return!0},n.prototype.addListener=function(t,e){return u(this,t,e,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(t,e){return u(this,t,e,!0)},n.prototype.once=function(t,e){return d(e),this.on(t,p(this,t,e)),this},n.prototype.prependOnceListener=function(t,e){return d(e),this.prependListener(t,p(this,t,e)),this},n.prototype.removeListener=function(t,e){var i,s,r,a,o;if(d(e),void 0===(s=this._events))return this;if(void 0===(i=s[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===e||i[a].listener===e){o=i[a].listener,r=a;break}if(r<0)return this;0===r?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,r),1===i.length&&(s[t]=i[0]),void 0!==s.removeListener&&this.emit("removeListener",t,o||e)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(t){var e,i,s;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var r,a=Object.keys(i);for(s=0;s<a.length;++s)"removeListener"!==(r=a[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this},n.prototype.listeners=function(t){return m(this,t,!0)},n.prototype.rawListeners=function(t){return m(this,t,!1)},n.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):f.call(t,e)},n.prototype.listenerCount=f,n.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]}},function(t,e,i){"use strict";function s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.d(e,"a",(function(){return s}))},function(t,e,i){"use strict";i.r(e);var s=i(21),r=i(14),a=i(2),o=i(7);class n extends s.EventEmitter{constructor(){super(),this._taf=null,this._tafLink=new r.TafLinkImpl(a.a,o.a),this.WEBSOCKET_CONNECTED="WEBSOCKET_CONNECTED",this.WEBSOCKET_CLOSED="WEBSOCKET_CLOSED",this.WEBSOCKET_ERROR="WEBSOCKET_ERROR",this.TAFLINK_INITED="TAFLINK_INITED"}getRequestId(){return this._tafLink.getRequestId()}getTaf(){return this._tafLink.getTaf()}setTafHandler(t){this._tafLink.setTafHandler(t)}get inited(){return!!this._tafLink.getTaf()}get connected(){return this._tafLink.connected}getUserId(){return this._tafLink.getUserId()}sendWup(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._tafLink.sendWup(t,e,i,s,r,a,o)}getInfoFromVG(t,e,i,s){this._tafLink.getInfoFromVG(t,e,i,s)}sendYY(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this._tafLink.sendYY(t,e,i,s,r)}on(t,e){return this._tafLink.on(t,e)}off(t,e){return this._tafLink.off(t,e)}addListener(t,e){return this._tafLink.addListener(t,e)}removeListener(t,e){return this._tafLink.removeListener(t,e)}}let h=new n;e.default=h},function(t,e){t.exports=function(t){console.log("[ Timer worker init ]");const e=1,i=2;var s=null;function r(){clearInterval(s),s=null}t.addEventListener("message",(function(i){switch(i.data){case"start":r(),s=setInterval((function(){t.postMessage({type:e})}),10);break;case"stop":r()}})),t.addEventListener("messageerror",(function(t){console.error("[TimerWorker.messageerror]",t)}));let a=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame||t.oRequestAnimationFrame;let o=0,n=0,h=0;a((function e(){requestAnimationFrame(e),function(){let e=function(){let t=0;return t=performance&&performance.now?performance.now():Date.now(),t}();if(o++,0===n)n=e;else{let s=e-n;if(s>=1e3){n=e;let r=Math.round(o/(s/1e3));o=0,h=Math.max(r,h),t.postMessage({type:i,data:h})}}}()}))}},function(t,e,i){t.exports=i(26)('!function(t){var e={};function s(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i{constructor(){}}i.INIT="init",i.INITED="inited",i.STOP="stop",i.PAUSE="pause",i.RESUME="resume",i.PLAY="play",i.AUDIO_FRAME="audio_frame",i.UPDATE_CURRENT_TIME="update_current_time",i.TIME_STAMP="timestamp",i.VOLUME="volume",i.AUDIO_DATA_NAN="AUDIO_DATA_NAN",i.AUDIO_DATA_MUTE="AUDIO_DATA_MUTE",i.LOG_CFG="LOG_CFG",i.UPDATE_PLAYBACKRATE="UPDATE_PLAYBACKRATE",i.SEEK="SEEK",i.ON_VIDEO_SEEK="ON_VIDEO_SEEK";var a=i;const r=12,h=13,o=31;var u=class{constructor(){this.m_sampleRate=44100,this.MAX_WSOLA_DELAY_MS=80,this.MIN_32bit=-2147483648,this.m_DelaySamples=this.m_sampleRate*this.MAX_WSOLA_DELAY_MS/1e3,this.m_channels=2,this.m_leftSampleNum=0,this.m_speedWsola=1,this.m_tempoInstr=0,this.m_outBuffer=[],this.m_inBuffer=[],this.dataCallback=null,this.lastFrameTimeStamp=0}updateSpeed(t){t=(t=t<.2?.2:t)>2?2:t,this.m_speedWsola=t,1==this.m_speedWsola?this.m_tempoInstr=0:this.m_speedWsola>=1?this.m_speedWsola>=1.25?(this.m_speedWsola=this.m_speedWsola>2?2:this.m_speedWsola,this.m_tempoInstr=2):this.m_tempoInstr=1:this.m_speedWsola<.5?(this.m_speedWsola=this.m_speedWsola<.2?.2:this.m_speedWsola,this.m_tempoInstr=-2):this.m_tempoInstr=-1}init(t,e,s,i){this.dataCallback=i,this.m_sampleRate=t,this.m_DelaySamples=this.m_sampleRate*this.MAX_WSOLA_DELAY_MS/1e3,this.m_channels=e,this.updateSpeed(s)}clearInputBuffer(){this.m_leftSampleNum=0,this.lastFrameTimeStamp=0,this.m_inBuffer=[],this.m_outBuffer=[]}tempo_processData(t,e,s){this.lastFrameTimeStamp=s;let i=this.m_sampleRate/100,a=0,r=0,h=0,o=0,u=0,m=0,n=0,l=0,p=0,f=0,d=0,_=1,c=0,A=0,N=0,S=0;for(let e=0;e<t.length;e++)this.m_inBuffer.push(t[e]);if(this.m_leftSampleNum+=e,this.m_leftSampleNum<this.m_DelaySamples)return 0;switch(this.m_tempoInstr){case 2:case 1:u=2*i,a=4*i,r=u,h=Math.floor(i*(4*this.m_speedWsola-2)),o=i+1>>1;break;case-1:u=4*i,a=8*i,r=u,h=Math.floor(i*(8*this.m_speedWsola-4)),o=i+1>>1;break;case-2:{e>this.m_leftSampleNum&&(e=this.m_leftSampleNum),this.m_leftSampleNum-=e,this.m_inBuffer.splice(0,e*this.m_channels);let t=[],s=e*this.m_channels/this.m_speedWsola;for(let e=0;e<s;e++)t.push(0);let i=this.m_leftSampleNum/e*10,a=this.lastFrameTimeStamp-i;return this.dataCallback(t,a),e*this.m_channels}case 0:{this.m_outBuffer=[];for(let t=0;t<e*this.m_channels;t++)this.m_outBuffer.push(this.m_inBuffer[t]);e>this.m_leftSampleNum&&(e=this.m_leftSampleNum),this.m_leftSampleNum-=e,this.m_inBuffer.splice(0,e*this.m_channels);let t=[];for(let s=0;s<e*this.m_channels;s++)t.push(this.m_outBuffer.shift());let s=this.m_leftSampleNum/e*10,i=this.lastFrameTimeStamp-s;return this.dataCallback(t,i),e*this.m_channels}}A=1/u;let D=(new Date).getTime();for(;this.m_leftSampleNum>=this.m_DelaySamples;){if((new Date).getTime()-D>2e3)return;for(l=0;l<a*this.m_channels;l++)this.m_outBuffer[l]=this.m_inBuffer[l];if(n=this.MIN_32bit,2==this.m_channels){for(l=0;l<2*o;l++){m=0;let t=(a-u)*this.m_channels;for(let e=0;e<u;e++)m+=Math.floor(this.m_outBuffer[t+2*e]*this.m_inBuffer[2*(h+l-o)+2*e]),m+=Math.floor(this.m_outBuffer[t+2*e+1]*this.m_inBuffer[2*(h+l-o)+2*e+1]);n<m&&(n=m,f=l)}for(d=f-o,_=1,c=0,l=0;l<u;l++)this.m_outBuffer[2*(l+r)]=_*this.m_outBuffer[2*(l+r)]+c*this.m_inBuffer[2*(l+h+d)],this.m_outBuffer[2*(l+r)+1]=_*this.m_outBuffer[2*(l+r)+1]+c*this.m_inBuffer[2*(l+h+d)+1],_-=A,c+=A}else{for(l=0;l<2*o;l++){for(m=0,p=0;p<u;p++)m+=Math.floor(psOutBuffer[a-u+p]*psInBuffer[h+l-o+p]);n<m&&(n=m,f=l)}for(d=f-o,_=1,c=0,l=0;l<u;l++)this.m_outBuffer[l+r]=_*this.m_outBuffer[l+r]+c*this.m_inBuffer[l+h+d],_-=A,c+=A}N+=a*this.m_channels,S=h+d+u,S>this.m_leftSampleNum&&(S=this.m_leftSampleNum),this.m_leftSampleNum-=S,this.m_inBuffer.splice(0,2*S)}let T=[];for(let t=0;t<N;t++)T.push(this.m_outBuffer.shift());let g=this.m_leftSampleNum/e*10,y=this.lastFrameTimeStamp-g;this.dataCallback(T,y)}};class m extends AudioWorkletProcessor{constructor(t){super(t),this.port.onmessage=this.onMessage.bind(this),this.audioList=[],this.channelDataLength=128,this.outputChannelNums=2,this.traceNums=0,this.currentTime=0,this.inited=!1,this.renderNums=0,this._id=0,this.postMessage(a.INITED),this.isAudioDataNaNCnt=0,this.isAudioDataZeroCnt=0,this.printProcess=!1,this.printAudioData=!1,this.overFlowTs=0,this.volume=1,this.simulateTempo=null,this.audioSampleRate=44100,this.playbackRate=1,this.playMode=0,this.isSeek=!1,this.recvNums=0,this.paused=!1}postMessage(t,e){this.port.postMessage({type:t,data:e})}onMessage(t){switch(t.data.type){case a.INIT:this.outputChannelNums=t.data.data.outputChannelCount,this.inited=!0,this._id=t.data.data.id,this.playMode=t.data.data.playMode,this.mainSharedArrayBuffer=t.data.data.mainSharedArrayBuffer,this.playbackRate=t.data.data.playbackRate,this.initSimulateTempo();break;case a.PAUSE:this.paused=!0;break;case a.STOP:this.audioList.length=0;break;case a.PLAY:case a.RESUME:this.paused=!1;break;case a.AUDIO_FRAME:if(this.recvNums++,this.isSeek)return;0==this.playMode?this.audioFrameTransToFloat32Array_new(t.data.data):this.audioFrameTransToFloat32Array_playbackrate(t.data.data);break;case a.VOLUME:this.volume=t.data.data;break;case a.LOG_CFG:this.printProcess=t.data.data.printProcess,this.printAudioData=t.data.data.printAudioData,this.printRenderSkipAudio=t.data.data.printRenderSkipAudio;break;case a.UPDATE_PLAYBACKRATE:this.playbackRate=t.data.data,this.simulateTempo.updateSpeed(this.playbackRate);break;case a.SEEK:this.printProcess&&console.log("AudioWorkletNodeRenderer web seek"),this.isSeek=!0,this.audioList.length=0,this.simulateTempo&&this.simulateTempo.clearInputBuffer();break;case a.ON_VIDEO_SEEK:this.printProcess&&console.log("AudioWorkletNodeRenderer web onVideoSeek"),this.isSeek=!1}}initSimulateTempo(){this.simulateTempo=new u,this.simulateTempo.init(this.audioSampleRate,this.outputChannelNums,this.playbackRate,this.simulateTempoDataCallback.bind(this))}setAudioCurrentDts(t){this.currentTime!=t&&(this.printProcess&&console.log("BypassProcessor.setAudioCurrentDts now",t,"diff",t-this.currentTime),this.currentTime=t,this.currentTime&&(this.renderNums+=1,this.mainSharedArrayBuffer&&Atomics.store(this.mainSharedArrayBuffer,r,this.currentTime),this.mainSharedArrayBuffer&&Atomics.store(this.mainSharedArrayBuffer,h,this.renderNums),this.mainSharedArrayBuffer&&Atomics.store(this.mainSharedArrayBuffer,o,this.recvNums-this.renderNums)),this.postMessage("timestamp",{timeStamp:t,renderNums:this.renderNums}))}handleOuputs(t,e){if(this.audioList.length<1||this.paused)return!0;const s=t[0];this.channelDataLength=s[0].length;let i=this.audioList.shift(),a=i.buffer,r=this.renderNums<5?0:this.volume;i.isEmptyAudioFrame&&(r=0);for(var h=0;h<a.byteLength;h++)for(var o=0;o<s.length;o++)s[o][h]=a[h*s.length+o]*r,this.traceNums++;return this.setAudioCurrentDts(i.timestamp),!0}handleOuputs_playbackrate(t,e){if(this.audioList.length<1||this.paused)return!0;const s=t[0];this.channelDataLength=s[0].length;let i=this.audioList[0],a=i.buffer,r=i.offset,h=this.renderNums<5?0:this.volume;for(var o=0;o<this.channelDataLength;o++)for(var u=0;u<s.length;u++)if(s[u][o]=a[r]*h,r++,r==a.length){if(this.audioList.shift(),this.audioList.length<1)return!0;r=0,i=this.audioList[0],a=i.buffer}return i.offset=r,this.setAudioCurrentDts(i.timestamp),!0}checkDrop(){let t=this.audioList.length;if(t>2){let e=this.audioList[0];if(this.audioList[t-1].timestamp-e.timestamp>80){let s=Date.now();if(0===this.overFlowTs)this.overFlowTs=s;else if(s-this.overFlowTs>4e3&&this.renderNums%10==0){let s=0,i=0,a=0;for(let r=0;r<t;r++){let t=this.audioList[r];if(0===s&&e.timestamp<t.timestamp)i=r,s=t.timestamp;else if(s>0&&t.timestamp>s){a=r;break}}let r=this.audioList.splice(i,a-i);if(this.printRenderSkipAudio){let t=[];r.forEach(e=>{t.push(e.timestamp)}),console.log(`BypassProcessor.checkDrop pts=${s} dropIndex=[${i},${a}] ${t.toString()}`)}}}else this.overFlowTs=0}}audioFrameTransToFloat32Array_new(t){if(!this.inited)return;t.frameBuffer;let e=!0,s=[];for(let e=0;e<t.frameBuffers.length;e++){let i=new Float32Array(t.frameBuffers[e],0,1024);s.push(i)}let i=[],r=s[0].length;for(var h=0;h<r;h++)for(let r=0;r<s.length;r++){if(Number.isNaN(s[r][h])&&(this.isAudioDataNaNCnt++,this.isAudioDataNaNCnt>=3)){this.postMessage(a.AUDIO_DATA_NAN);break}if(0!=s[r][h]&&(e=!1),i.push(s[r][h]),i.length===this.channelDataLength*this.outputChannelNums){let e=new Float32Array(this.channelDataLength*this.outputChannelNums);e.set(i.splice(0,this.channelDataLength*this.outputChannelNums)),this.audioList.push({timestamp:t.timeStamp,buffer:e,isEmptyAudioFrame:t.isEmptyAudioFrame})}}this.printAudioData&&console.log(`BypassProcessor.audioFrameTransToFloat32Array_new timeStamp=${t.timeStamp} audioList.length=${this.audioList.length}`),e&&0!=this.volume&&(this.isAudioDataZeroCnt++,this.isAudioDataZeroCnt>=100&&this.postMessage(a.AUDIO_DATA_MUTE))}simulateTempoDataCallback(t,e){let s=new Float32Array(t.length);s.set(t),this.audioList.push({timestamp:e,buffer:s,offset:0})}audioFrameTransToFloat32Array_playbackrate(t){if(!this.inited)return;t.frameBuffer;let e=!0,s=[];for(let e=0;e<t.frameBuffers.length;e++){let i=new Float32Array(t.frameBuffers[e],0,1024);s.push(i)}let i=[],r=s[0].length;for(var h=0;h<r;h++)for(let t=0;t<s.length;t++){if(Number.isNaN(s[t][h])&&(this.isAudioDataNaNCnt++,this.isAudioDataNaNCnt>=3)){this.postMessage(a.AUDIO_DATA_NAN);break}0!=s[t][h]&&(e=!1),i.push(s[t][h])}this.simulateTempo.tempo_processData(i,i.length/this.outputChannelNums,t.timeStamp),this.printAudioData&&console.log(`BypassProcessor.audioFrameTransToFloat32Array_new timeStamp=${t.timeStamp} audioList.length=${this.audioList.length}`),e&&0!=this.volume&&(this.isAudioDataZeroCnt++,this.isAudioDataZeroCnt>=100&&this.postMessage(a.AUDIO_DATA_MUTE))}audioFrameTransToFloat32Array(t){if(!this.inited)return;let e=t.frameBuffer,s=new Float32Array(e),i=[],r=!0;for(let e=0;e<s.length;e++){if(Number.isNaN(s[e])&&(this.isAudioDataNaNCnt++,this.isAudioDataNaNCnt>=3)){this.postMessage(a.AUDIO_DATA_NAN);break}if(0!=s[e]&&(r=!1),i.push(s[e]),i.length===this.channelDataLength*this.outputChannelNums){let e=new Float32Array(this.channelDataLength*this.outputChannelNums);e.set(i.splice(0,this.channelDataLength*this.outputChannelNums)),this.audioList.push({timestamp:t.timeStamp,buffer:e,isEmptyAudioFrame:t.isEmptyAudioFrame})}}r&&0!=this.volume&&(this.isAudioDataZeroCnt++,this.isAudioDataZeroCnt>=100&&this.postMessage(a.AUDIO_DATA_MUTE))}process(t,e){return 0==this.playMode?this.handleOuputs(e):this.handleOuputs_playbackrate(e)}}registerProcessor("bypass-processor",m)}]);')},function(t,e,i){"use strict";var s=window.URL||window.webkitURL;t.exports=function(t){try{var e;try{(e=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),e=e.getBlob("application/javascript; charset=utf-8")}catch(i){e=new Blob([t],{type:"application/javascript; charset=utf-8"})}return s.createObjectURL(e)}catch(e){return"data:application/javascript,"+encodeURIComponent(t)}}},function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return r}));var s=i(15);function r(t){const e=i(29).default,r=i(4).default,{ToMainMessageType:a,ReceiveMessageType:o}=i(9);r.postMessage(a.WOREKR_READY);const n=new e;function h(){r.postMessage(a.VIDEORENDERERROR)}requestAnimationFrame((function t(){n.rafHandler(r.getNow()),requestAnimationFrame(t)})),t.addEventListener("message",(function(e){let i=e.data,a=i.data;switch(i.type){case o.START:n.startVideoRender(a,h),t.mainSharedArrayBuffer=a.mainSharedArrayBuffer;break;case o.POSTFRAME:break;case o.RESIZE:n.updateRect(a.sizes.width,a.sizes.height);break;case o.CLOSE:t.audioSamples=[],t.isBrowserHidden=!1,t.userPaused=!1,n.destroy();break;case o.VISIBILITYCHANGE:t.isBrowserHidden="hidden"==a.state,n.setBrowserHidden(t.isBrowserHidden);break;case o.FAST_OVER:n.fastOver();break;case o.VIDEOSAMPLES:n.appendVideoFrame(a.videoSamples);break;case o.AUDIOSAMPLES:n.appendAudioFrame(a.audioSamples);break;case o.AVCCONFIG:n.updateAVCConfig(a);break;case o.AVCPPS:case o.AVCSPS:case o.AVCVPS:break;case o.AACCONFIG:n.updateAudioConfig(a.codec,a.sampleRate,a.numberOfChannels,a.timestamp);break;case o.UPDATE_VIDEOFPS:n.updateVideoFPS(a.fps,a.noReferFps);break;case o.SET_PLAY_MINBUFFER:n.setPlayMinBuffer(a.bufferLen);break;case o.SET_JITTER:n.setJitter(a);break;case o.SET_USE_SOFTACCELERATION:n.setUseSoftAcceleration();break;case o.UPDATE_SOFTACCELERATION:n.updateSoftAcceleration();break;case o.LOCAL_CONFIG:r.log("ReceiveMessageType.LOCAL_CONFIG",a),n.setLocalConfig(a);break;case o.PAUSE_VIDEO_DECODE:r.log("ReceiveMessageType.PAUSE_VIDEO_DECODE",a),n.setPauseVideoDecode(a);break;case o.PAUSE_AUDIO_DECODE:r.log("ReceiveMessageType.PAUSE_AUDIO_DECODE",a),n.setPauseAudioDecode(a);break;case o.ENABLE_DISCARD_VIDEO:r.log("ReceiveMessageType.ENABLE_DISCARD_VIDEO",a.enableDiscard),n.setEnableDiscard(a);break;case o.SET_AUDIO_WRITER:r.log("ReceiveMessageType.SET_AUDIO_WRITER"),n.startAudioRender(a.ageneratorWriter);break;case o.UPDATE_CURBITRATE:r.log("ReceiveMessageType.UPDATE_CURBITRATE",a.curBitrate),n.updateCurBitrate(a.curBitrate);break;case o.INIT_CONFIG:r.log("ReceiveMessageType.INIT_CONFIG",JSON.stringify(a));let e=JSON.parse(a.config);n.initWebcodecCfg(e);break;case o.RECV_FPS:n.setRealFps(a.recvFps);break;case o.LOG_CFG:r.log("ReceiveMessageType.LOG_CFG "+JSON.stringify(a)),s.a.setCfg(a);break;case o.SET_ENHANCE:r.log("ReceiveMessageType.LOG_CFG "+JSON.stringify(a)),n.setEnhance(a);break;case o.SET_SEGMENTTION:r.log("ReceiveMessageType.LOG_CFG setSegmenttion "+JSON.stringify(a)),n.setSegmenttion(a);break;case o.RECV_FAST_OVER:r.log("ReceiveMessageType.LOG_CFG onRevFastOver"),n.onRevFastOver();break;case o.AV1_INIT_SEG:n.initAv1Seg(a);break;case o.SEEK_TIME:n.seek(a);break;case o.SET_PLAYBACKRATE:n.setPlaybackRate(a);break;case o.SET_VOD_AV1:n.setVodAv1()}}))}},function(t,e,i){"use strict";i.r(e);var s=i(21),r=i.n(s);let a={PLAY_STATUS:"PLAY_STATUS",PLAY_CARTON:"PLAY_CARTON",PLAY_TIME_STATUS:"PLAY_TIME_STATUS",VIDEO_PLAY:"VIDEO_PLAY",VIDEO_PLAY_CON_SUC:"VIDEO_PLAY_CON_SUC",VIDEO_PLAYING:"VIDEO_PLAYING",VIDEO_PAUSE:"VIDEO_PAUSE",VIDEO_BAD_QUALITY:"VIDEO_BAD_QUALITY",METADATA:"METADATA",RECV_VIDEO_FRAME:"RECV_VIDEO_FRAME",VIDEO_STOP:"VIDEO_STOP",VIDEO_SEEK:"VIDEO_SEEK",BROWSER_PAUSE:"BROWSER_PAUSE",AUDIO_PLAY:"AUDIO_PLAY",AUDIO_SOUND:"AUDIO_SOUND",ANCHOR_STOP:"ANCHOR_STOP",VIDEO_LINK_CLOSE:"VIDEO_LINK_CLOSE",NO_VIDEO:"NO_VIDEO",HLS_URL_UNAVAILABLE:"HLS_URL_UNAVAILABLE",HLS_URL_LOAD_TIMEOUT:"HLS_URL_LOAD_TIMEOUT",HLS_MAINFEST_LOAD_TIMEOUT:"HLS_MAINFEST_LOAD_TIMEOUT",FLV_URL_UNAVAILABLE:"FLV_URL_UNAVAILABLE",FLV_CHANGE_LINE:"FLV_CHANGE_LINE",FLV_URL_LOAD_TIMEOUT:"FLV_URL_LOAD_TIMEOUT",H5_PLAYER_ERROR:"H5_PLAYER_ERROR",H5_PLAY_FAIL:"H5_PLAY_FAIL",H5_NO_STREAM:"H5_NO_STREAM",PAUSE_5S_RETRY:"PAUSE_5S_RETRY",NO_DATA_RECEIVED:"NO_DATA_RECEIVED",P2P_REPORT:"P2P_REPORT",AUTO_LOG:"AUTO_LOG",DATA_METRIC:"DATA_METRIC",DATA_METRIC2:"DATA_METRIC2",P2P_TIMEOUT:"P2P_TIMEOUT",FLV_TO_P2P:"FLV_TO_P2P",FLV_TRY_TO_P2P:"FLV_TRY_TO_P2P",FLAC_AUDIO_START:"FLAC_AUDIO_START",FLAC_AUDIO_ERROR:"FLAC_AUDIO_ERROR",FLAC_AUDIO_NEED_RETRY:"FLAC_AUDIO_NEED_RETRY",SIGNAL_PLAY:"SIGNAL_PLAY",SIGNAL_HEART:"SIGNAL_HEART",SIGNAL_DATA:"SIGNAL_DATA",SIGNAL_ERROR:"SIGNAL_ERROR",H264_SEI_PLAY:"H264_SEI_PLAY",TRANS_END:"TRANS_END",NEED_UPDATE_M3U8:"NEED_UPDATE_M3U8",PLAYBACK_UPDATE:"PLAYBACK_UPDATE",PLAYBACK_M3U8_UPDATED:"PLAYBACK_M3U8_UPDATED",PLAYBACK_DIF_CDN:"PLAYBACK_DIF_CDN",UPDATE_INTERSITY:"UPDATE_INTERSITY",PLAY_DOWNLINK_INFO:"PLAY_DOWNLINK_INFO",PLAY_FRAME_BUFFER:"PLAY_FRAME_BUFFER",WEBRTC_VIDEO_ERROR:"WEBRTC_VIDEO_ERROR",SWITCH_DONE:"SWITCH_DONE",AUTO_BITRATE_CHANGED:"AUTO_BITRATE_CHANGED",AUTO_FORCE_RSP:"AUTO_FORCE_RSP",VISIBILITY_CHANGE:"VISIBILITY_CHANGE",REPLAY_VIDEO:"REPLAY_VIDEO",P2P_PLAYING_EVENT:"P2P_PLAYING_EVENT",TURN_TO_H264:"TURN_TO_H264",H265_VIDEO_RETRY:"H265_VIDEO_RETRY",H265_PLAY:"H265_PLAY",PAUSE_5SEC_ERROR:"PAUSE_5SEC_ERROR",TRY_TO_AV1:"TRY_TO_AV1",M3U8_PLAY_ENDED:"M3U8_PLAY_ENDED",SEI_INFO:"SEI_INFO",SEI_DATACHANNEL_INFO:"SEI_DATACHANNEL_INFO",VIDEO_RESOLUTION_CHANGE:"VIDEO_RESOLUTION_CHANGE",TURN_TO_MSE:"TURN_TO_MSE",TURN_TO_WEBCODECS_SOFT:"TURN_TO_WEBCODECS_SOFT",WEBCODECS_RETRY:"WEBCODECS_RETRY",TURN_TO_H265_WASM:"TURN_TO_H265_WASM",SHIELD_AUDIO_SWITCH_STATUS:"SHIELD_AUDIO_SWITCH_STATUS",RESET_PLAYER:"RESET_PLAYER",PLAY_TIMEOUT:"PLAY_TIMEOUT",SEEK_TIMEOUT:"SEEK_TIMEOUT",ON_VIDEO_ENHANCE_ERROR:"ON_VIDEO_ENHANCE_ERROR",ON_VIDEO_ENHANCE_SUCCESS:"ON_VIDEO_ENHANCE_SUCCESS",ON_VIDEO_ENHANCE_UNSUPPORT:"ON_VIDEO_ENHANCE_UNSUPPORT",VIDEO_AVCCFG_CHANGE:"VIDEO_AVCCFG_CHANGE",VIDEO_ENDED:"VIDEO_ENDED",VIDEO_LOOP_ENDED:"VIDEO_LOOP_ENDED",VIDEO_MP4_ERROR:"VIDEO_MP4_ERROR",VIDEO_TAG_ENDED:"VIDEO_TAG_ENDED",VIDEO_TAG_SEEKED:"VIDEO_TAG_SEEKED",VIDEO_TAG_PLAYING:"VIDEO_TAG_PLAYING",VIDEO_TAG_PROGRESS:"VIDEO_TAG_PROGRESS",VIDEO_TAG_CANPLAY:"VIDEO_TAG_CANPLAY",VIDEO_TAG_PAUSE:"VIDEO_TAG_PAUSE",VIDEO_TAG_LOADSTART:"VIDEO_TAG_LOADSTART",VIDEO_TAG_PLAY:"VIDEO_TAG_PLAY",VIDEO_NATIVE_PLAY:"VIDEO_NATIVE_PLAY"},o="VIDEO_INIT",n="VIDEO_LOADING",h="VIDEO_PLAYING",d="VIDEO_STOP",l="VIDEO_CACHING",u="BROWSER_PAUSE",c="SYS_PAUSE",p="AUDIO_PLAYING";var m=a,f=i(0);var _={VIDEO_CANPLAY:"VIDEO_CANPLAY",VIDEO_TIMEUPDATE:"VIDEO_TIMEUPDATE",VIDEO_PROGRESS:"VIDEO_PROGRESS",VIDEO_ERROR:"VIDEO_ERROR",VIDEO_ENDED:"VIDEO_ENDED",VIDEO_LOAD_START:"VIDEO_LOAD_START"};let g=[m.H264_SEI_PLAY,m.AUDIO_SOUND,m.SIGNAL_DATA,m.UPDATE_INTERSITY,m.SIGNAL_HEART,m.METADATA,m.TRANS_END,m.PLAY_DOWNLINK_INFO,m.PLAY_FRAME_BUFFER,m.PLAY_TIME_STATUS,m.PLAYBACK_UPDATE,m.PLAYBACK_M3U8_UPDATED,m.SEI_INFO,_.VIDEO_TIMEUPDATE,_.VIDEO_PROGRESS,m.VIDEO_TAG_ENDED,m.VIDEO_TAG_SEEKED,m.VIDEO_TAG_PLAYING,m.VIDEO_TAG_PROGRESS,m.VIDEO_TAG_CANPLAY,m.VIDEO_TAG_PAUSE,m.VIDEO_TAG_LOADSTART,m.VIDEO_TAG_PLAY];function S(){let t=new r.a;return t.setMaxListeners(0),t.trigger=function(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];let a=s;if("Array"===s.constructor.name&&(a=s[0]),e===m.PLAY_STATUS?f.a.log("%c"+e+" %c"+a.status,"color:#F9F900;background:gray","color:#53FF53;background:gray"):-1===g.indexOf(e)&&f.a.log("%c"+e,"color:#F9F900;background:gray",a),e===m.DATA_METRIC2&&navigator){let t=navigator.userAgent;if(t=t.toLowerCase(),-1!=t.indexOf("headlesschrome"))return}t.emit(e,e,...s)},t.off=function(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];t.removeListener(e,...s)},t}var T=class{constructor(t){t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup),this.fromByte=0,this.toByte=0}destroy(){this.abort(),this.loader=null}abort(){this.loader&&(this.stats.aborted=!0,this.loader.abort()),this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}load(t,e,i,s,r,a,o,n){let h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.url=t,this.responseType=e,this.onSuccess=i,this.onError=s,this.onTimeout=r,this.onProgress=h,this.stats={trequest:performance.now(),retry:0},this.timeout=a,this.maxRetry=o,this.retryDelay=n,this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),a),this.loadInternal()}loadBuffer(t,e,i,s,r,a,o,n,h){this.onOpen=e,this.load(t,"arraybuffer",t=>{let{target:e}=t;i(e.response),s()},r,a,o,n,h)}loadInternal(){let t=this.loader=new XMLHttpRequest;t.onload=this.loadsuccess.bind(this),t.onerror=this.loaderror.bind(this),t.onprogress=this.loadprogress.bind(this),t.onloadend=this.loadend.bind(this),t.onloadstart=this.loadstart.bind(this),t.responseType=this.responseType,""!==this.responseType&&"text"!==this.responseType||!t.overrideMimeType||t.overrideMimeType("text/plain; charset=utf-8"),t.open("GET",this.url,!0),this.fromByte>0&&t.setRequestHeader("Range",`bytes=${this.fromByte}-${this.toByte>0?this.toByte:""}`),this.stats.tstart=null,this.stats.loaded=0,this.xhrSetup&&this.xhrSetup(t),this.stats.tstart=performance.now(),t.send()}loadsuccess(t){404===t.currentTarget.status?this.onError(t):(window.clearTimeout(this.timeoutHandle),this.stats.tload=performance.now(),t.requestURL=this.url,this.onSuccess(t,this.stats))}loaderror(t){if(404===t.currentTarget.status||0===t.currentTarget.status)return window.clearTimeout(this.timeoutHandle),void this.onError(t);this.stats.retry<this.maxRetry?(f.a.warn("XhrLoader.loaderror url="+this.url+" retryDelay="+this.retryDelay),this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++):(window.clearTimeout(this.timeoutHandle),f.a.warn("XhrLoader.loaderror reach max retry url="+this.url),this.onError(t))}loadtimeout(){this.stats.retry<this.maxRetry?(f.a.warn("XhrLoader.loadtimeout url="+this.url+" retryDelay="+this.retryDelay),this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++):(window.clearTimeout(this.timeoutHandle),f.a.warn("XhrLoader.loadtimeout max retry url="+this.url),this.onTimeout(this.loader))}loadstart(){this.onOpen&&this.onOpen()}loadprogress(t){let e=this.stats;null===e.tfirst&&(e.tfirst=performance.now()),e.loaded=t.loaded,this.onProgress&&this.onProgress(t,e)}loadend(t){404===t.currentTarget.status&&this.loaderror(t)}getResponseHeader(t){return this.loader&&this.loader.getResponseHeader&&this.loader.getResponseHeader(t)}getLoaderHandler(){return this.loader}},y=i(3),E=i(20),v=i.n(E);var C=class{constructor(){this.startSeq=1e3,this.m3u8Len=0,this.preTsArr=void 0}genSnFromM3u8(t){let e=this.convertM3u8ToArray(t);if(void 0===this.preTsArr)this.preTsArr=e;else{let t=this.findSeq(this.preTsArr,e[0],this.startSeq);-1===t&&(t=this.startSeq+this.preTsArr.length),this.preTsArr=e,this.startSeq=t}return this.startSeq}convertM3u8ToArray(t){let e,i=/#EXT(INF):([\d\.]+)[^\r\n]*[\r\n]+([^#|\r\n]+)?/gi,s=[];for(;null!==(e=i.exec(t));)e.shift(),e=e.filter((function(t){return void 0!==t})),"INF"===e[0]&&s.push(e[2]),e=[];return s}findSeq(t,e,i){for(let s=t.length-1;s>=0;s--){let r=t[s],a=r.split("?");r=a.length>1?a[0]:r;let o=e.split("?");if(r===(e=o.length>1?o[0]:e))return i+s}return-1}},P=i(2),D=i(7),I={PCDN_REALTIME:1,PCDN_FREETIME:2,PCDN_NOT_OPEN:3,PCDN_CLIENT_NOT_OPEN:4,FIRST_TS:5,NOT_SEND_REQ:6,OPEN_BUFFER_NOT_REACHED:7,BUFFER_LACK_TO_CDN:8,REALTIME_NOT_REACHED:9,REALTIME_OVER_RUN:10,FREETIME_OVER_RUN:11,FREETIME_NOT_COVERD:12,ERROR_REQ:13,PCDN_REQ_OTHER:14,TAF_REQ_ERROR:15,TS_LOAD_ERROR:16};var A=class{constructor(t){this.url="",this.time=0,this.duration=0,this.start=0,this.level=0,this.sn=0,this.discontinuity=!1,this.discontinuityCnt=0,this.byteRangeStartOffset=0,this.byteRangeEndOffset=0,this.decryptdata=null,this.pcdnFreetime=!1,this.isPcdn=!1,this.tryCnt=0,this.pcdnUrls=[],this.isLoadError=!1,this.statPcdn=!1,this.isFirstLoad=!1,this.pcdnStatus=I.NOT_SEND_REQ,this.pcdnStatusBk1=I.NOT_SEND_REQ,this.pcdnStatusBk2=I.NOT_SEND_REQ,this.loadStartTs=0,this.loadEndTs=0}setUrl(t){this.url=t+""}getUrl(t){const{useCdn:e,bufferLen:i}=t;return this.pcdnUrls.length>0&&i>=P.a.vodPcdnOpenBuffer&&!e?(this.isPcdn=!0,this.pcdnUrls.shift()):(this.isPcdn=!1,this.url)}hasPcdn(){return this.pcdnUrls.length>0}loadError(){this.isLoadError=!0}},R=i(6),O={TS:1,M4S:2,getType:function(t){return-1!==t.indexOf(".m4s")?this.M4S:this.TS}};var w=class{constructor(t){this.isLive=t,this.seqGener=new C,this.isSwitchSeamLessLine=!1}resolve(t,e){return t.indexOf("../")>=0?v.a.buildAbsolutePath(e,t):v.a.buildAbsoluteURL(e,t)}resolveUrlQuery(t,e){return""!==e&&(-1===t.indexOf("?")?t+="?":t+="&",t+=e),t}cloneObj(t){return JSON.parse(JSON.stringify(t))}parseMasterPlaylist(t,e){for(var i,s,r,a=[],o={},n=/#EXT-X-STREAM-INF:([^\n\r]*(BAND)WIDTH=(\d+))?([^\n\r]*(CODECS)=\"([^\"\n\r]*)\",?)?([^\n\r]*(RES)OLUTION=(\d+)x(\d+))?([^\n\r]*(NAME)=\"(.*)\")?[^\n\r]*[\r\n]+([^\r\n]+)/gi;null!=(i=n.exec(t));){for(i.shift(),i=i.filter((function(t){return void 0!==t})),(o={}).url=this.resolve(i.pop(),e);i.length>0;)switch(i.shift()){case"RES":o.width=parseInt(i.shift()),o.height=parseInt(i.shift());break;case"BAND":o.bitrate=parseInt(i.shift());break;case"NAME":o.name=i.shift();break;case"CODECS":for(s=i.shift().split(",");s.length>0;)-1!==(r=s.shift()).indexOf("avc1")?o.videoCodec=this.avc1toavcoti(r):o.audioCodec=r}a.push(o)}return a}avc1toavcoti(t){var e,i=t.split(".");return i.length>2?(e=i.shift()+".",e+=parseInt(i.shift()).toString(16),e+=("00"+parseInt(i.shift()).toString(16)).substr(-4)):e=t,e}parseKeyParamsByRegex(t,e){var i=e.exec(t);return i&&(i.shift(),2===(i=i.filter((function(t){return void 0!==t}))).length)?i[1]:null}parseLevelPlaylist(t,e,i){return this._parseByLine(t,e,i)}_getUrlQuery(){let t="";const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split("?");return e.length>=2&&e.shift(),t=e.join(""),t}_getValue(t,e,i){for(let s=e+1;s<i;s++)if(!t[s].startsWith("#"))return[s,t[s]];return!1}_getIv(t){for(var e=new Uint8Array(16),i=12;i<16;i++)e[i]=t>>8*(15-i)&255;return e}_parseByLine(t,e,i){var s,r,a,o,n,h,d=0,l=0,u=!1,c=0,p={url:e,initUrl:"",fragments:[],fileType:-1,live:this.isLive,startSN:0},m=!1;let _=0,g=!1,S="";if(!this.isLive){g=!0,s=this.seqGener.genSnFromM3u8(t),p.startSN=s;S=R.b.getQueryString("newmode",e)?this._getUrlQuery(e):""}var T={method:null,key:null,iv:null,uri:null};let y=t.replace("\r").split("\n"),E=y.length;for(let t=0;t<E;t++){let R=y[t];if(-1!==R.indexOf("#EXT-X-MEDIA-SEQUENCE"))this.isLive&&(l=p.startSN=parseInt(R.match(/\d+/g)[0]));else if(-1!==R.indexOf("#EXT-X-TARGETDURATION"))p.targetduration=parseFloat(R.match(/[\d\.]+/g)[0]);else if(-1!==R.indexOf("#EXT-X-ENDLIST"))p.live=!1,f.a.info("M3u8Parser.parseLevelPlaylist ENDLIST isLive=false");else if(-1!==R.indexOf("#EXT-X-MAP")){let t=R.match(/URI=\"(.+?)\"/);if(t[1]&&(p.initUrl=this.resolveUrlQuery(this.resolve(t[1],e),S),-1==p.initUrl.indexOf("?"))){let t=e.split("?");t.length>1&&(p.initUrl+="?"+t[1])}}else if(-1!==R.indexOf("#EXT-X-DISCONTINUITY"))m=!0,_++;else if(-1!==R.indexOf("#EXT-X-BYTERANGE")){var C=R.match(/[\d@]+/g)[0].split("@");if(h=1===C.length?n:parseInt(C[1]),n=parseInt(C[0])+h,(o=p.fragments.length?p.fragments[p.fragments.length-1]:null)&&(o.byteRangeStartOffset=h,o.byteRangeEndOffset=n,(r=this._getValue(y,t,E))&&!o.url)){let t=r[1];o.setUrl(t?this.resolve(t,e):null)}}else if(-1!==R.indexOf("#EXT-ALIGN-PTS"))1===P.a.switchSeamLessLine&&(d=Number(R.replace("#EXT-ALIGN-PTS:","")),u=!0,this.isSwitchSeamLessLine=!0);else if(-1!==R.indexOf("#EXTINF")){var D=parseFloat(R.match(/[\d\.]+/g)[0]);if(!isNaN(D)){if(g&&D<1)continue;var I;if(g=!1,a=u?d:++l,this.isLive||(a=s++),T.method&&T.uri&&!T.iv?(I=this.cloneObj(T)).iv=this._getIv(this.isLive?l:a):I=T,r=this._getValue(y,t,E)){let t=r[1];(o=new A).setUrl(t?this.resolveUrlQuery(this.resolve(t,e),S):null),o.time=t?v.a.getTimeFromUrl(t,this.isLive):0,o.duration=D,o.start=c,o.level=i,o.sn=a,o.discontinuity=m,o.discontinuityCnt=_,o.byteRangeStartOffset=h,o.byteRangeEndOffset=n,o.decryptdata=I,p.fragments.push(o),-1===p.fileType&&(p.fileType=O.getType(t)),m&&(m=!1),c+=D,h=null}}}else if(-1!==R.indexOf("#EXT-X-KEY")){var w=R.replace("#EXT-X-KEY:",""),L=this.parseKeyParamsByRegex(w,/(METHOD)=([^,]*)/),M=this.parseKeyParamsByRegex(w,/(URI)=["]([^,]*)["]/),V=this.parseKeyParamsByRegex(w,/(IV)=([^,]*)/);L&&(T={method:null,key:null,iv:null,uri:null},M&&"AES-128"===L&&(T.method=L,T.uri=this.resolve(M,e),T.key=null,V&&(T.iv=V,"0x"===T.iv.substring(0,2)&&(T.iv=T.iv.substring(2)),T.iv=T.iv.match(/.{8}/g),T.iv[0]=parseInt(T.iv[0],16),T.iv[1]=parseInt(T.iv[1],16),T.iv[2]=parseInt(T.iv[2],16),T.iv[3]=parseInt(T.iv[3],16),T.iv=new Uint32Array(T.iv))))}}return p.totalduration=c,p.endSN=d-1,this.isLive||(p.endSN=s-1),p}_parseByReg(t,e,i){var s,r,a,o,n,h=0,d=0,l={url:e,fragments:[],live:this.isLive,startSN:0},u=!1;this.isLive||(s=this.seqGener.genSnFromM3u8(t),l.startSN=s);for(var c={method:null,key:null,iv:null,uri:null},p=/(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT-X-(KEY):(.*))|(?:#EXT(INF):([\d\.]+)[^\r\n]*([\r\n]+[^#|\r\n]+)?)|(?:#EXT-X-(BYTERANGE):([\d]+[@[\d]*)]*[\r\n]+([^#|\r\n]+)?|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DIS)CONTINUITY))/g;null!==(r=p.exec(t));)switch(r.shift(),(r=r.filter((function(t){return void 0!==t})))[0]){case"MEDIA-SEQUENCE":this.isLive&&(h=l.startSN=parseInt(r[1]));break;case"TARGETDURATION":l.targetduration=parseFloat(r[1]);break;case"ENDLIST":l.live=!1,f.a.info("M3u8Parser.parseLevelPlaylist ENDLIST isLive=false");break;case"DIS":u=!0;break;case"BYTERANGE":var m=r[1].split("@");n=1===m.length?o:parseInt(m[1]),o=parseInt(m[0])+n,(a=l.fragments.length?l.fragments[l.fragments.length-1]:null)&&!a.url&&(a.byteRangeStartOffset=n,a.byteRangeEndOffset=o,a.setUrl(this.resolve(r[2],e)));break;case"INF":var _=parseFloat(r[1]);if(!isNaN(_)){var g,S=h++;if(this.isLive||(S=s++),c.method&&c.uri&&!c.iv){g=this.cloneObj(c);for(var T=new Uint8Array(16),y=12;y<16;y++)T[y]=S>>8*(15-y)&255;g.iv=T}else g=c;let t=r[2];l.fragments.push({url:t?this.resolve(t,e):null,time:t?v.a.getTimeFromUrl(t,this.isLive):0,duration:_,start:d,level:i,sn:S,discontinuity:u,byteRangeStartOffset:n,byteRangeEndOffset:o,decryptdata:g}),u&&(u=!1),d+=_,n=null}break;case"KEY":var E=r[1],C=this.parseKeyParamsByRegex(E,/(METHOD)=([^,]*)/),P=this.parseKeyParamsByRegex(E,/(URI)=["]([^,]*)["]/),D=this.parseKeyParamsByRegex(E,/(IV)=([^,]*)/);C&&(c={method:null,key:null,iv:null,uri:null},P&&"AES-128"===C&&(c.method=C,c.uri=this.resolve(P,e),c.key=null,D&&(c.iv=D,"0x"===c.iv.substring(0,2)&&(c.iv=c.iv.substring(2)),c.iv=c.iv.match(/.{8}/g),c.iv[0]=parseInt(c.iv[0],16),c.iv[1]=parseInt(c.iv[1],16),c.iv[2]=parseInt(c.iv[2],16),c.iv[3]=parseInt(c.iv[3],16),c.iv=new Uint32Array(c.iv))))}return l.totalduration=d,l.endSN=h-1,this.isLive||(l.endSN=s-1),l}},L=i(1),M=i(10),V=i(14),b=i(17),N=i.n(b);var F=!1,B=[],U=-1,k=null,x=!1,H=!1;const G=1;function W(t,e){for(var i=0,s=B.length;i<s;i++){var r=B[i];if(r.callback==t&&r.thisObj==e)return r}return null}function $(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if((i=0|(Number(i)||0))<10||i%10!=0||!t)return f.a.error("Timer.add Invalide interval value or callback function."),!1;var a=W(t,e);return a||(a={callback:t,thisObj:e,bindCallback:e?t.bind(e):t,param:s},B.push(a)),a.times=r,a.tickCount=0,a.interval=i/10,a.delayDel=!1,Y(),!0}function Y(){k&&1==Number(P.a.isForceUseWorker)?(x=!0,H=!1,k.postMessage("start")):(x=!1,H=!0,-1===U&&(U=setInterval(K,10)))}function K(){!x&&H&&j()}function j(){if(0==B.length)return x=!1,H=!1,void(k?k.postMessage("stop"):(clearInterval(U),U=-1));F=!0;for(var t=y.a.now(),e=B.length-1;e>=0;e--){var i=B[e];if(i&&!i.delayDel){if(++i.tickCount%i.interval==0){var s=i.bindCallback,r=i.tickCount/i.interval;s(t,r,i.param),i.times>0&&i.times<=r&&i.tickCount>0&&B.splice(e,1)}}else B.splice(e,1)}F=!1}var q={initWorker:function(){!k&&window.Worker&&(f.a.log("[ TimerWorker init ]"),(k=N()(24)).addEventListener("message",t=>{t.data.type==G&&x&&j()}),k.addEventListener("error",t=>{f.a.error("TimerWorker.error:",t.lineno+","+t.colno,t.message),k.terminate(),k=null,f.a.warn("[ TimerWorker terminate ]"),Y()}))},has:function(t,e){return!!W(t,e)},add:$,remove:function(t,e){for(var i=0,s=B.length;i<s;i++){var r=B[i];if(r.callback==t&&r.thisObj==e)return F?r.delayDel=!0:B.splice(i,1),!0}return!1},once:function(t,e,i,s){$(t,e,i+10,s,1)},getSize:()=>B.length};var z=i(23).default;class J extends V.PcdnVodProxy{constructor(t,e){super(t,e,L.a,I,q)}getVodPcdnProxy(t,e){let i=M.a.uid||M.a.getAnonymouUid();this._getVodPcdnProxy(t,e,{uid:i,appid:M.a.appid,sGuid:M.a.sGuid,TafLink:z})}}var Q=J;var X=localStorage||{removeItem:function(t){},getItem:function(t){return null},setItem:function(t,e){},clear:function(){}},Z={AUTO_VIEW_REPORT:"_autoViewReport",LOAD_VIDEO_TS_V2_FAIL:"_load_video_ts_v2_fail",VIDEO_BAD_QUALITY:"_video_bad_quality",RETRY_STREAM:"_retry_stream",LOCAL_RETRY:"_localRetry",LOAD_VOD_FAIL:"_load_vod_fail",VIDEO_BAD_QUALITY_VOD:"_video_bad_quality_vod",RETRY_STREAM_VOD:"_retry_stream_vod",AUTO_VIEW_LOG:"_autoViewLog",getLocalRetry:function(t){1==localStorage[this.LOCAL_RETRY]&&t.push(1)}},tt=101,et=102,it=103,st=104,rt=105,at=106,ot=107,nt=108,ht=109,dt=110,lt=111,ut=112,ct=113,pt=114,mt=115;const ft=1,_t=-1,gt=-2,St=-3,Tt=-4,yt=1,Et=2,vt=3,Ct=4,Pt=-1,Dt=-2,It=-3,At=-4,Rt=1,Ot=-1;var wt=new class{constructor(){this._hlsPlayer=null,this._m3u8Status=0,this._m3u8Loader=null,this._firstTs=null,this._firstFragStatus=0,this._mp4Status=0}reset(){this._hlsPlayer=null,this._m3u8Status=0,this._m3u8Loader=null,this._firstTs=null,this._firstFragStatus=0,this._mp4Status=0}setHlsPlayer(t){this._hlsPlayer=t}setM3u8Loader(t){this._m3u8Loader=t}setM3u8Status(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;f.a.log("VodNoPictureHelper.setM3u8Status status: ",t),this._m3u8Status=t}getM3u8Status(){if(0!==this._m3u8Status||!this._m3u8Loader)return this._m3u8Status;const t=this._m3u8Loader.getLoaderHandler();return t?(t.status>=200&&t.status<300&&4===t.readyState?this._m3u8Status=ft:t.status>=200&&t.status<300&&t.readyState<4?this._m3u8Status=Tt:t.status>=300?this._m3u8Status=_t:0===t.status&&4===t.readyState?this._m3u8Status=gt:this._m3u8Status=St,this._m3u8Status):this._m3u8Status}getM3u8Reason(){let t=0;switch(this.getM3u8Status()){case _t:t=tt;break;case gt:t=et;break;case Tt:t=st;break;case St:t=it}return t}setFirstTs(t){this._firstTs=t}setFirstFragStatus(t){f.a.log("VodNoPictureHelper.setFirstFragStatus status: ",t),this._firstFragStatus=t}getFirstFragStatus(){return this._firstFragStatus}getTsReason(){let t=0;switch(this._firstFragStatus){case yt:t=at;break;case Pt:t=rt;break;case Dt:t=at;break;case Et:t=ot;break;case It:t=nt;break;case vt:case Ct:if(this._hlsPlayer){t=this._hlsPlayer.getBufferLen()<=200?ht:dt}break;case At:t=lt}return t}getHlsNoPictureReason(){let t=0;return this._firstTs?t=this.getTsReason():(t=this.getM3u8Reason(),0===t&&(t=this.getTsReason())),0===t&&(t=ut),f.a.log("VodNoPictureHelper.getHlsNoPictureReason reason: ",t),t}setMP4Status(t){this._mp4Status=t}getMP4NoPictureReason(){let t=0;switch(this._mp4Status){case Rt:t=ct;break;case Ot:t=pt}return 0===t&&(t=mt),f.a.log("VodNoPictureHelper.getMP4NoPictureReason reason: ",t),t}};var Lt=new class{constructor(){this._tsdb=null,this._sessionId=0,this._line=0,this._sDisplayName="",this._bitrate=0,this._fails=this.readLocal(Z.LOAD_VIDEO_TS_V2_FAIL),this._qualitys=this.readLocal(Z.VIDEO_BAD_QUALITY),this._retrys=this.readLocal(Z.RETRY_STREAM),this._vodFails=this.readLocal(Z.LOAD_VOD_FAIL),this._vodQualitys=this.readLocal(Z.VIDEO_BAD_QUALITY_VOD),this._vodRetrys=this.readLocal(Z.RETRY_STREAM_VOD)}readLocal(t){return localStorage.hasOwnProperty(t)?JSON.parse(localStorage.getItem(t)):{}}addBadQuality(t){this.isOpen()&&(this._addHis(t,this._qualitys),X.setItem(Z.VIDEO_BAD_QUALITY,JSON.stringify(this._qualitys)))}addRetryStream(t){this.isOpen()&&(this._addHis(t,this._retrys),X.setItem(Z.RETRY_STREAM,JSON.stringify(this._retrys)))}_addHis(t,e){let i=this._getKey(t);this._addHisByKey(i,e)}_addHisByKey(t,e){e.hasOwnProperty(t)?e[t]++:e[t]=1}delFail(t){if(this.isOpen()){let e=this._getKey(t);delete this._fails[e],X.setItem(Z.LOAD_VIDEO_TS_V2_FAIL,JSON.stringify(this._fails)),delete this._retrys[e],X.setItem(Z.RETRY_STREAM,JSON.stringify(this._retrys)),f.a.log("AutoTestHelper.delFail: "+e)}}addFail(t,e){let{loadTime:i,connectTime:s,recvDataTime:r}=e;if(!this.isOpen())return;let a=t.getComDim(L.a.DIM_COM.P2P),o=t.getComDim(L.a.DIM_COM.CDN_CIP),n=t.getComDim(L.a.DIM_COM.CDN_SIP),h=this._getKey(t);f.a.log(`AutoTestHelper.addFail: ${h}, loadTime=${i} connectTime=${s} recvDataTime=${r} cdn_cip=${o} cdn_sip=${n}`);let d="";0===s?d=a===L.a.LIVE_TYPE.HLS?"m3u8下载失败":"拉流连接不上":(d=0===r?a===L.a.LIVE_TYPE.HLS?"ts下载失败":"拉流连接成功没收到数据":a===L.a.LIVE_TYPE.HLS?`m3u8下载耗时=${s}ms、ts下载耗时=${r}`:`拉流连接耗时=${s}ms、收数据耗时=${r}ms`,n&&(d+=","+n)),this._fails.hasOwnProperty(h)?this._fails[h].push(d):this._fails[h]=[d],X.setItem(Z.LOAD_VIDEO_TS_V2_FAIL,JSON.stringify(this._fails))}_getKey(t){const e=t.getComDim(L.a.DIM_COM.P2P),i=t.getComDim(L.a.DIM_COM.H265);return`${this._line}_${this._sDisplayName}_${this._bitrate}_${e}_${i}`}addVodFail(t){if(!this.isOpen())return;let e=-1!==t.indexOf(".mp4")?wt.getMP4NoPictureReason():wt.getHlsNoPictureReason(),i=this._getVodKey(t);f.a.log(`AutoTestHelper.addVodFail: ${i}, ${e}`);let s=this._vodFails[i];s||(s=[],this._vodFails[i]=s),s.push(e),X.setItem(Z.LOAD_VOD_FAIL,JSON.stringify(this._vodFails))}delVodFail(t){if(!this.isOpen())return;let e=this._getVodKey(t);f.a.log("AutoTestHelper.delVodFail: "+e),delete this._vodFails[e],X.removeItem(Z.LOAD_VOD_FAIL)}addBadQualityVod(t){if(!this.isOpen())return;let e=this._getVodKey(t);f.a.log("AutoTestHelper.addBadQualityVod: "+e),this._addHisByKey(e,this._vodQualitys),X.setItem(Z.VIDEO_BAD_QUALITY_VOD,JSON.stringify(this._vodQualitys))}addRetryStreamVod(t){if(!this.isOpen())return;let e=this._getVodKey(t);f.a.log("AutoTestHelper.addRetryStreamVod: "+e),this._addHisByKey(e,this._vodRetrys),X.setItem(Z.RETRY_STREAM_VOD,JSON.stringify(this._vodRetrys))}_getVodKey(t){return t.split("//")[1].split("?")[0]}isOpen(){return"1"===X.getItem(Z.AUTO_VIEW_REPORT)}bindEvent(t,e,i,s,r){this._sessionId=e,this._line=i,this._sDisplayName=s,this._bitrate=r,this.isOpen()&&(this._tsdb=t,window._autoTestComplete=t=>{this._tsdb.sendAutoTestResult(t)},window._autoTestAct=(t,e,i)=>{this._tsdb.sendAutoTestAct(t,e,i)})}};var Mt=class{constructor(t,e,i){this._isLive=i,this._details=null,this._fragments=null,this._totalDuration=0,this._idx=0,this._lastFrag=null,this._curFrag=null,this._seekTime=0,this._sOrigUrl="",this._initUrl="",this._fileType=1,this._pcdnIdx=-1,this._pcdnVodProxy=new Q(t,e)}setOrigUrl(t){this._sOrigUrl=t}setFileType(t){this._fileType=t}reset(){this._details=null,this._fragments=null,this._totalDuration=0,this._idx=0,this._lastFrag=null,this._curFrag=null,this._seekTime=0,this._pcdnIdx=-1,this._sOrigUrl=""}set details(t){this._details=t,this._fragments=t.fragments,this._totalDuration=t.totalduration,this._initUrl=t.initUrl,this._fileType=t.fileType,this._seekTime>0&&(this.seek(this._seekTime),this._seekTime=0)}get details(){return this._details}isM4s(){return this._fileType===O.M4S}setInitUrl(t){this._initUrl=t}getInitUrl(){return this._initUrl}setFirst(){this._idx++}get currFragNum(){return this._fragments?this._fragments.length:0}get totalDuration(){return this._totalDuration}get lastFrag(){return this._lastFrag}set lastFrag(t){t&&(this._lastFrag=t)}get curFrag(){return this._curFrag}set curFrag(t){t&&(this._lastFrag=this._curFrag,this._curFrag=t)}get isPcdnProxyOpen(){return this._pcdnVodProxy.isPcdnOpen}get isPcdnClientOpen(){return!P.a.isCloseVodPcdn}getNearFragStart(t){let e=this._fragments;if(e){let i=null,s=0,r=e.length-1;for(;s<r;s++)if(i=e[s],i.start>t)return i.start}return Math.ceil(t+1)}getFrag(t){let e=this._idx,i=this._fragments,s=null;return t?i.length>0&&(s=i.shift()):e<i.length&&(s=i[e],e++),s&&(this._idx=e,this._lastFrag=this._curFrag,this._curFrag=s),s}seek(t){this._pcdnIdx=-1;let e=this._fragments;if(!e)return this._seekTime=t,!1;t=Math.min(t,this._totalDuration);let i=null,s=0,r=0,a=!1,o=this._fragments.length;for(;r<o;r++)if(i=e[r],s=i.start+i.duration,i.start<=t&&t<s){s-.2<t&&r<o-1&&(i=e[r+1],r+=1),i.seeking=!0,a=!0;break}return a?(f.a.info(`HlsPlaylist.seek suc seekTime=${t} fragIdx=${this._idx}, ${r}`,i.sn),this._idx=r):f.a.info(`HlsPlaylist.seek fail seekTime=${t} fragIdx=${this._idx}`),a}mergeDetails(t){let e=null;if(this._details){e=this._details;let i=t,s=0,r=0,a=0,o=null;o=e.fragments.length>0?e.fragments[e.fragments.length-1]:this._curFrag,a=o.sn,r=o.start+o.duration;let n=[];i.fragments.forEach(t=>{t.sn>a&&(e.fragments.push(t),n.push(t))}),e.endSN=i.endSN,e.fragments.forEach(t=>{s+=t.duration,t.sn>a&&(t.start=r,r+=t.duration)}),e.totalduration=s,n.length>0&&Lt.isOpen()&&f.a.log("FragHelper.mergeDetails newFrags="+n.length)}else e=t,this._isLive&&f.a.log("FragHelper.mergeDetails first frags="+t.fragments.length);this.details=e}getVodPcdnProxy(){if(1!==P.a.isCloseVodPcdn&&(-1===this._pcdnIdx||this._pcdnIdx-this._idx<=3)){-1===this._pcdnIdx&&(this._pcdnIdx=this._idx);let t=this._pcdnIdx+10,e=Math.min(this._fragments.length,t),i=[],s=[];for(let t=this._pcdnIdx;t<e;t++){let e=this._fragments[t];i.push(e),s.push(e.sn)}i.length>0&&(f.a.log(`FragHelper.getVodPcdnProxy firstIdx=${this._pcdnIdx} sn=${s.join(",")}`),this._pcdnVodProxy.getVodPcdnProxy(this._sOrigUrl,i),this._pcdnIdx=t)}}getVodPcdnProxyCursor(){if(1===P.a.isCloseVodPcdn)return;if(!this._pcdnVodProxy.isPcdnOpen)return;let t=[],e=[],i=this._idx;if(this._fragments.length-i>=3&&this._fragments[i].pcdnUrls.length>0&&this._fragments[i+1].pcdnUrls.length>0&&this._fragments[i+2].pcdnUrls.length>0)f.a.log(`FragHelper.getVodPcdnProxy idx=${this._idx-1} curFrag.sn=${this._curFrag.sn} pcdn fragment is enough`);else{for(;i<this._fragments.length;){let s=this._fragments[i];if(s.pcdnUrls.length<=0&&(t.push(s),e.push(s.sn)),t.length>=10)break;i++}t.length>0&&(f.a.log(`FragHelper.getVodPcdnProxy idx=${this._idx-1} curFrag.sn=${this._curFrag.sn} req sn=${e.join(",")}`),this._pcdnVodProxy.getVodPcdnProxy(this._sOrigUrl,t))}}};var Vt=class{constructor(t){this.hls=t,this.isLive=t.isLive,this.config=t.config,this.m3u8Parser=new w(t.isLive),this.currLevelId=0,this.m3u8FileSize=0,this.levels=[],this.firstLevelLoaded=!1,this.m3u8Parsered=!1,this.loader=null,this.manifestLoadedTs=0,this.isMasterPlayList=!1,this.currLevel=null,this.fragHelper=new Mt(t.statVod,t.stat,t.isLive),this.firstTsInfo=null,this.loadM3u8HttpCode=-1,this.m3u8ContentErrorCnt=0}destroy(){this.m3u8Parser=null,this.currLevelId=0,this.m3u8FileSize=0,this.levels=null,this.currLevel=null,this.firstLevelLoaded=!1,this.m3u8Parsered=!1,this.loader.abort(),this.loader=null,this.manifestLoadedTs=0,this.isMasterPlayList=!1,this.fragHelper.reset(),this.firstTsInfo=null,this.loadM3u8HttpCode=-1}get currDetails(){return this.fragHelper.details}get currFragNum(){return this.fragHelper.currFragNum}get totalDuration(){return this.firstTsInfo&&this.firstTsInfo.totalDuration||this.fragHelper.totalDuration}get currFrag(){return this.fragHelper.curFrag}set currFrag(t){t&&(this.lastFrag=this.currFrag,this.fragHelper.curFrag=t)}get lastFrag(){return this.fragHelper.lastFrag}set lastFrag(t){t&&(this.fragHelper.lastFrag=t)}get nextFrag(){return this.fragHelper.getFrag(this.isLive)}getNearFragStart(t){return this.fragHelper.getNearFragStart(t)}setOrigUrl(t){this.fragHelper.setOrigUrl(t)}setCurrentFrag(t){t&&(this.lastFrag=this.currFrag,this.currFrag=t)}seek(t){return!this.isLive&&this.fragHelper.seek(t)}loadFirstFragment(t){t&&t.tsUrl&&!this.firstLevelLoaded&&(f.a.log("HlsPlaylist.loadFirstFragment firstTsInfo = ",t),this.fragHelper.setFileType(O.getType(t.tsUrl)),t.initUrl&&this.fragHelper.setInitUrl(t.initUrl),this.fragHelper.setFirst(),t.tsUrl=this.addUrlParams(t.tsUrl),this.firstLevelLoaded=!0,this.firstTsInfo=t,this.hls.loadFragment(!1,t),wt.setFirstTs(t))}loadManifest(t){this.hls.vodSecHelper.setM3u8Start(),this.m3u8Parser.isSwitchSeamLessLine=!1,this.loader&&(this.loader.destroy(),this.loader=null),t=this.addUrlParams(t),this.manifsetUrl=t,f.a.log("HlsPlaylist.loadManifest url="+t),this.hls.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.M3U8_CNT,1),this.loader=new T(this.config),this.loader.onOpen=this.onManiFestOpen.bind(this),this.loader.load(t,"text",this.onManifestLoaded.bind(this),this.loadManifestError.bind(this),this.loadManifestTimeout.bind(this),this.config.listLoadingTimeOut,this.config.listLoadingMaxRetry,this.config.listLoadingRetryDelay),wt.setM3u8Loader(this.loader)}onManiFestOpen(){this.hls.vodSecHelper.setM3u8Open()}refreshManifsetUrl(t){t=this.addUrlParams(t),this.manifsetUrl=t}addUrlParams(t){if(-1!==t.indexOf("hyscence=vodadv")&&(t=t.replace("hyscence=vodadv","hyscence=vodbusiness")),-1!==t.indexOf("scene=vodadv")&&(t=t.replace("scene=vodadv","scene=vodbusiness")),-1===t.indexOf("&sv=")){const e=P.a.platform,i=D.a.PLATFORM_TYPE[e]||D.a.PLATFORM_TYPE.web;t+=-1===t.indexOf("?")?"?":"&";t+=`${e===D.a.PLATFORM_TYPE_NAME.wap?`uid=${M.a.uid}&uuid=${M.a.uuid}`:"u="+M.a.convertUid}&t=${i}`,t=R.b.urlInfoParams(t,this.hls.info),this.m3u8ContentErrorCnt>0&&(t+="&mceCnt="+this.m3u8ContentErrorCnt)}return R.b.checkDMod(t,this.hls.info._dMod,this.hls.info._sMod)}onManifestLoaded(t,e){if(0==this.manifestLoadedTs&&(this.manifestLoadedTs=y.a.now()),this.loadM3u8HttpCode=t.currentTarget.status,404===this.loadM3u8HttpCode||0===this.loadM3u8HttpCode||403===this.loadM3u8HttpCode)return f.a.warn("HlsPlaylist.onManifestLoaded status="+this.loadM3u8HttpCode),this.hls.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.M3U8_FAIL_CNT,1),void this.hls.setLoadStatus(D.a.LoadVideoTimeoutReason.HLS_LOADMANIFEST_ERROR);if(wt.setM3u8Status(ft),!this.isLive){const t=this.loader.getResponseHeader("Content-length")||0;this.m3u8FileSize=1*t,this.hls.statVod.setCore(L.a.VOD_CORE.M3U8_FILE_BW,this.m3u8FileSize),this.hls.statVod.addCore(L.a.CORE.CDN_TOTAL_BW,this.m3u8FileSize),this.hls.stat.addCore(L.a.CORE.CDN_TOTAL_BW,this.m3u8FileSize)}let i,s=t.currentTarget.response,r=this.manifsetUrl,a=null,o=[];if(-1==s.indexOf("#EXTM3U"))return this.hls.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.M3U8_WRONG_CNT,1),f.a.warn("HlsPlaylist.onManifestLoaded m3u8 doesn't match #EXTM3U\n",s),this.hls.setLoadStatus(D.a.LoadVideoTimeoutReason.HLS_LOADMANIFEST_ERROR),void(this.m3u8ContentErrorCnt<3&&(this.m3u8ContentErrorCnt++,this.hls.onM3u8ContentError()));this.hls.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.M3U8_SUC_CNT,1);let n=-1==s.indexOf("#EXTINF:");n?(this.isMasterPlayList=!0,a=this.m3u8Parser.parseMasterPlaylist(s,r)):(this.isMasterPlayList=!1,a=[{url:r}]),o=a,i=o[0].bitrate,o.sort((t,e)=>t.bitrate-e.bitrate),this.levels=o;for(let t=0;t<o.length;t++)if(o[t].bitrate===i){this.currLevelId=t;break}this.currLevel={bitrate:i},this.hls.setLoadStatus(D.a.LoadVideoTimeoutReason.HLS_LOADMANIFEST_SUCCESS),n?(this.currLevel.url=o[this.currLevelId].url,this.loadLevel()):(this.currLevel.url=this.manifsetUrl,this.onLevelLoaded(t))}loadManifestError(t){this.hls.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.M3U8_FAIL_CNT,1),f.a.warn("HlsPlaylist.loadManifestError "+t.currentTarget.status,t.currentTarget.readyState),this.loadM3u8HttpCode=t.currentTarget.status,wt.setM3u8Status(t.currentTarget.status>0?_t:gt),404!==t.currentTarget.status&&0!==t.currentTarget.status||this.hls.onAnchorStop(),this.hls.onLoadM3u8Error(t)}loadManifestTimeout(t){this.hls.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.M3U8_TIMEOUT_CNT,1),t&&t.readyState>=2?(wt.setM3u8Status(Tt),this.hls.onLoadManifestTimeout()):(wt.setM3u8Status(St),this.hls.onConnectManifestTimeout())}loadLevel(){if(!this.currLevel)return;let t=this.currLevel.url;if(!this.isLive&&this.currDetails){let e=this.currDetails.fragments,i=e[e.length-1];i||(f.a.log("HlsPlaylist.loadLevel: fragments run out"),i=this.fragHelper.curFrag),t=e.length<=this.config.minFragBufferNum?this.currLevel.url.replace(/\?btime=\d*$/,"?btime="+i.time):null}t&&this._loadLevel(t)}updateLiveVodUrl(t){this.currLevel&&(t=this.addUrlParams(t),this.manifsetUrl=t,this.m3u8Updating=!0,this.currLevel.url=t,this._loadLevel(t))}_loadLevel(t){this.isLive&&Lt.isOpen()&&f.a.log("HlsPlaylist._loadLevel url="+t),this.loader&&(this.loader.destroy(),this.loader=null),this.anticode&&(t+="?"+this.anticode),this.hls.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.M3U8_CNT,1),this.loader=new T(this.config),this.loader.load(t,"",this.onLevelLoaded.bind(this),this.loadLevelError.bind(this),this.loadLevelTimeout.bind(this),this.config.listLoadingTimeOut,this.config.listLoadingMaxRetry,this.config.listLoadingRetryDelay)}onLevelLoaded(t,e){if(404===t.currentTarget.status||0===t.currentTarget.status)return void this.hls.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.M3U8_FAIL_CNT,1);let i=t.currentTarget.responseText,s=this.manifsetUrl,r=this.currLevel,o=null;if(s&&(r.url=s),this.isLive&&f.a.log(i),0===i.indexOf("#EXTM3U")&&i.indexOf("#EXTINF:")>0){if(this.hls.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.M3U8_SUC_CNT,1),o=this.m3u8Parser.parseLevelPlaylist(i,r.url,this.currLevelId),this.fragHelper.mergeDetails(o),r.details=this.fragHelper.details,this.isLive||(f.a.log("HlsPlaylist.onLevelLoaded : fragments.length:"+r.details.fragments.length),this.hls.eventEmitter.trigger(a.PLAYBACK_M3U8_UPDATED,{totalDuration:this.totalDuration})),this.m3u8Parsered=!0,this.isLive&&r.details.fragments.length>P.a.hlsLiveMaxFragNum)return f.a.info("HlsPlaylist.onLevelLoaded fragments.length =",r.details.fragments.length),void this.hls.reconnectLive();this.hls.setTargetDuration(this.currDetails.targetduration),this.hls.vodSecHelper.setM3u8End(),this.firstLevelLoaded||(this.firstLevelLoaded=!0,this.hls.loadFragment())}else{this.hls.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.M3U8_EMPTY_CNT,1);var n=r.details.fragments.length;f.a.warn(`HlsPlaylist.onLevelLoaded no playlist. fragments.length=${n}\n${i}`)}this.hls.isSwitchSeamLessLine=this.m3u8Parser.isSwitchSeamLessLine}loadLevelError(t){this.hls.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.M3U8_FAIL_CNT,1),f.a.warn("HlsPlaylist.loadLevelError "+t.currentTarget.status),404!==t.currentTarget.status&&0!==t.currentTarget.status||this.hls.onAnchorStop()}loadLevelTimeout(){this.hls.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.M3U8_TIMEOUT_CNT,1),this.hls.reset()}onCheckTimer(t){this.isLive&&this.loadLevel()}};var bt=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this.maxSize=t,this.sum=0,this.list=[],this.idx=0,this.cur=0}reset(){this.sum=0,this.list=[],this.idx=0,this.cur=0}addCur(t){this.cur+=t}calculate(){this.add(this.cur);let t=this.cur;return this.cur=0,t}add(t){this.sum+=t,this.list.length<this.maxSize?this.list.push(t):(this.sum-=this.list[this.idx],this.list[this.idx]=t),this.idx++,this.idx>=this.maxSize&&(this.idx=0)}average(){return 0===this.list.length?R.b.UintMax:Math.round(this.sum/this.list.length)}getSamples(){return this.list}max(){if(0===this.list.length)return R.b.UintMax;let t=0;for(let e of this.list)e>t&&(t=e);return t}min(){let t=R.b.UintMax;for(let e of this.list)e<t&&(t=e);return t}};var Nt=class{constructor(t){this.data=t,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){let t=this.data.byteLength-this.bytesAvailable,e=new Uint8Array(4),i=Math.min(4,this.bytesAvailable);if(0===i)throw new Error("no bytes available");e.set(this.data.subarray(t,t+i)),this.word=new DataView(e.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}skipBits(t){let e;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(e=(t-=this.bitsAvailable)>>3,t-=e>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}readBits(t){let e=Math.min(this.bitsAvailable,t),i=this.word>>>32-e;return t>32&&f.a.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),e=t-e,e>0?i<<e|this.readBits(e):i}skipLZ(){let t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){let t=this.skipLZ();return this.readBits(t+1)-1}readEG(){let t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}skipScalingList(t){let e,i,s=8,r=8;for(e=0;e<t;e++)0!==r&&(i=this.readEG(),r=(s+i+256)%256),s=0===r?s:r}readSPS(){let t,e,i,s,r,a,o,n,h,d=0,l=0,u=0,c=0;if(this.readUByte(),t=this.readUByte(),e=this.readBits(5),this.skipBits(3),i=this.readUByte(),this.skipUEG(),100===t||110===t||122===t||144===t||244===t||44===t||83===t||86===t||118===t||128===t||138===t){let t=this.readUEG();if(3===t&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(n=3!==t?8:12,h=0;h<n;h++)this.readBoolean()&&(h<6?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();let p=this.readUEG();if(0===p)this.readUEG();else if(1===p)for(this.skipBits(1),this.skipEG(),this.skipEG(),s=this.readUEG(),h=0;h<s;h++)this.skipEG();if(this.skipUEG(),this.skipBits(1),r=this.readUEG(),a=this.readUEG(),o=this.readBits(1),0===o&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(d=this.readUEG(),l=this.readUEG(),u=this.readUEG(),c=this.readUEG()),this.readBoolean()){if(this.readBoolean()){if(255===this.readUByte()){this.readBits(16),this.readBits(16)}}if(this.readBoolean()&&this.skipBits(1),this.readBoolean()){this.readBits(3);if(this.skipBits(1),this.readBoolean()){this.readUByte(),this.readUByte(),this.readUByte()}}if(this.readBoolean()){this.readUEG(),this.readUEG()}}return{fps:0,width:16*(r+1)-2*d-2*l,height:(2-o)*(a+1)*16-(u+c)*(o?2:4)}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}};var Ft=class{constructor(){this.size=0,this.buffers=[]}destroy(){this.reset()}reset(){f.a.log("FlvCacher.reset",this.size),this.size=0,this.buffers=[]}append(t){0!==t.length&&(this.buffers.push(t),this.size+=t.length)}getByte(t){let e=0;for(let i=0;i<this.buffers.length;++i){let s=this.buffers[i];if(e+s.length>t){return s[t-e]}e+=s.length}return f.a.warn("FlvCacher.getByte has no offset="+t),0}popFrame(){if(0===this.size)return null;if(0===this.buffers.length)return f.a.error("FlvCacher.popFront error no buffers, size:"+this.size+" not eq 0"),this.reset(),null;if(this.size<=We.TAG_HEADER_LEN+We.PREV_TAG_SIZE_LEN)return null;let t=(this.getByte(1)<<16)+(this.getByte(2)<<8)+this.getByte(3),e=We.TAG_HEADER_LEN+t+We.PREV_TAG_SIZE_LEN;if(this.size<e)return null;if(1===this.buffers.length){if(this.buffers[0].length===e)return this.size-=e,this.buffers.shift();{let t=this.buffers[0].slice(0,e);return this.buffers[0]=this.buffers[0].slice(e),this.size-=e,t}}let i,s=new Uint8Array(e),r=0,a=0;for(;r<e;){let t=e-r;if(this.buffers[0].length>t){i=this.buffers[0].slice(0,t),s.set(i,a),a+=t,r+=t,this.buffers[0]=this.buffers[0].slice(t),this.size-=t;break}i=this.buffers.shift(),s.set(i,a),a+=i.length,r+=i.length,this.size-=i.length}return s}};let Bt=function(){let t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}();class Ut{constructor(){}static parseObject(t,e,i){let s=Ut.parseString(t,e),r=Ut.parseScript(t,e+s.size);return{data:{name:s.data,value:r.data},size:r.size}}static parseVariable(t,e,i){return Ut.parseObject(t,e,i)}static parseDate(t,e,i){if(i<10)throw new Error("Data size invalid when parse Date");let s=new DataView(t,e),r=s.getFloat64(0,!Bt);return r+=60*s.getInt16(8,!Bt)*1e3,{data:new Date(r),size:10}}static parseString(t,e){let i=new DataView(t,e),s=i.getUint16(0,!Bt),r="";if(s>0)for(let t=0;t<s;t++)r+=String.fromCharCode(i.getUint8(t+2));return{data:r,size:2+s}}static parseMetadata(t){let e=Ut.parseScript(t,0);return Ut.parseScript(t,e.size,t.length-e.size)}static parseScript(t,e,i){let s=e,r=new Uint8Array(t).buffer,a=new DataView(r,0,i),o=null,n=a.getUint8(s);switch(s+=1,n){case 0:o=a.getFloat64(s,!Bt),s+=8;break;case 1:o=!!a.getUint8(s),s+=1;break;case 2:{let t=Ut.parseString(r,s);o=t.data,s+=t.size;break}case 3:for(o={};s<i-3;){let t=Ut.parseObject(r,s,i-e);if(o[t.data.name]=t.data.value,s=t.size,0===a.getUint8(s)&&0===a.getUint8(s+1)&&9===a.getUint8(s+2)){s+=3;break}}break;case 8:for(o={},s+=4;s<i-8;){let t=Ut.parseVariable(r,s);o[t.data.name]=t.data.value,s=t.size}if(s<=i-3){9===(16777215&a.getUint32(s-1,!Bt))&&(s+=3)}break;case 10:{o=[];let t=a.getUint32(s,!Bt);s+=4;for(let e=0;e<t;e++){let t=Ut.parseScript(r,s);o.push(t.data),s=t.size}break}case 11:{let t=Ut.parseDate(r,s+1,i-1);o=t.data,s+=t.size;break}case 12:{let t=Ut.parseString(r,s+1);o=t.data,s+=t.size;break}default:s=i,console.log("AMF","Unsupported AMF value type "+n)}return{data:o,size:s}}static getStr(t,e,i){let s="";for(let r=0;r<i;r++)s+=String.fromCharCode(t[e++]);return s}}var kt=Ut;var xt=new class{constructor(){this._ntp=new V.NtpImpl(z)}start(){this._ntp.start(M.a.sGuid),q.add(this._onTimer,this,1e3)}wsTimeSync(){this._ntp.wsTimeSync()}_onTimer(t,e){this._ntp.onTimer(t)}getSyncTime(){return this._ntp.getSyncTime()}isFinishNtp(){return this._ntp.isFinishNtp()}};var Ht=class{constructor(t){this._split=t,this._str=""}isEmpty(){return""===this._str}addStr(t){this._str.length>0&&(this._str+=this._split),this._str+=t}getStr(){return this._str}};const Gt=[72,85,89,65,58],Wt=[44,162,222,9,181,23,71,219,187,85,164,254,127,194,252,78],$t={HUMEN:"00000001",DELAY:"00000200",VOLUME:"00000400",VOLUME1:"00000401",IFRAME:"00000600",DATACHANNEL:"00000230"};class Yt{constructor(t){this._mse=t,this._protoHandler=new V.SeiProtoHandler,this._proto=null,this._netDelaySum=0,this._c2cDelaySum=0,this._svrDelaySum=0,this._delayCnt=0,this._curAnchorDelay=0,this._offset=0,this.initDts=0,this.initSeiDts=0}getStat(){if(0===this._delayCnt)return null;let t={fields:{},dims:{}};if(this._delayCnt>0&&(t.fields[L.a.CORE.DELAY_ANCHOR]=Math.floor(this._c2cDelaySum/this._delayCnt),t.fields[L.a.CORE.DELAY_SERVER]=Math.floor(this._svrDelaySum/this._delayCnt),t.fields[L.a.CORE.DELAY_NET]=Math.floor(this._netDelaySum/this._delayCnt),this._proto)){t.dims[L.a.CORE.UPLOADER_TYPE]=this._proto.anchorSei.uploadType+"",t.dims[L.a.CORE.ENCODER_SOURCE]=this._proto.anchorSei.encoderSource+"";let e=new Ht(","),i=new Ht(","),s=new Ht(",");this._proto.serverSei.serverInfos.forEach(t=>{t.enable>0&&(e.addStr(t.getProxyIdStr()+"-"+t.proxyType),t.serverDelay>0&&t.serverDelay<1e4&&i.addStr(t.proxyType+":"+t.serverDelay),t.lastPeriodDelay>0&&t.lastPeriodDelay<1e4&&s.addStr(t.proxyType+":"+t.lastPeriodDelay))}),e.isEmpty()||(t.dims[L.a.CORE.DELAY_NODE_INFO]=e.getStr()),i.isEmpty()||(t.dims[L.a.CORE.SVR_DELAY_INFOS]=i.getStr()),s.isEmpty()||(t.dims[L.a.CORE.SVR_LAST_P_DELAY]=s.getStr())}return this._netDelaySum=0,this._c2cDelaySum=0,this._svrDelaySum=0,this._delayCnt=0,this._proto=null,t}_record(t,e){this._proto=e;let i=xt.getSyncTime(),s=t-e.serverSei.dtsGapSum-e.anchorSei.frameDts,r=i-e.anchorSei.sendFrameTime-s;if(this.initSeiDts!=e.anchorSei.frameDts&&(this._mse.offsetDts=t-e.anchorSei.frameDts),this.initSeiDts=e.anchorSei.frameDts,0<r&&r<3e4){const t=i-e.anchorSei.caputureTime-s;this._netDelaySum+=r,this._c2cDelaySum+=t,this._svrDelaySum+=r-e.serverSei.delaySum,this._delayCnt++,this._curAnchorDelay=t||this._curAnchorDelay,this._curAnchorDelay>3e5&&(this._curAnchorDelay=0),this._mse.setSeiDelay(this._curAnchorDelay)}}parseSei(t,e,i,s){t+=this.initDts,this._offset=0,i==Yt.H265_CODEC_TYPE?(e=this._nalUintExtractRbsp(e),this._offset+=2):i==Yt.AV1_CODEC_TYPE||(this._offset+=1);this._getValue(e),this._getValue(e),this._getH265Len(e);if(this._isHuya(e)){let i=e.subarray(this._offset),r=this._getType(i);if(s[r]=1,this._mse.saveSeiInfo(t,i,r),r===$t.DELAY)this._parseDelay(t,i);else if(r===$t.HUMEN)this._mse.saveH264SeiData(t,i);else if(r===$t.VOLUME){let e=this._getStr(i);this._mse.scriptVolumeInfos.addMixAudio(e,t)}else if(r===$t.VOLUME1){let e=this._getStrVolume1(i);this._mse.scriptVolumeInfos.addMixAudio(e,t)}else r===$t.DATACHANNEL&&this._parseDataChannel(t,i)}}_nalUintExtractRbsp(t){let e=new Uint8Array(t.length),i=t.length,s=0,r=0;for(;s+2<i;)t[s]||t[s+1]||3!==t[s+2]?e[r++]=t[s++]:(e[r++]=t[s++],e[r++]=t[s++],s++);for(;s<i;)e[r++]=t[s++];return e.subarray(0,r)}_getStr(t){let e=t.length,i=new Uint8Array(t.length);for(let s=0;s<e;s++)i[s]=t[s];e=this._getLength(t)+8+16+2;let s=new DataView(i.buffer);return this._readVolume(s,e,26)}_readVolume(t,e,i){let s=[];for(;i+9<=e;){let e=4294967296*t.getUint32(i,!1)+t.getUint32(i+4,!1),r=t.getUint8(i+8);s.push(e+"_"+r),i+=9}return s.join(",")}_getStrVolume1(t){let e=this._getStrChar(t),i=this._getStrCode(e),s=new DataView(i.buffer);return this._readVolume(s,i.length,0)}_getStrChar(t){let e=this._getLength(t)+8+16+2,i="";for(let s=26;s<e;s++)i+=String.fromCharCode(t[s]);return atob(i)}_getStrCode(t){let e=new Uint8Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}_getLength(t){let e="";for(let i=9;i<26;i++)e+=String.fromCharCode(t[i]);return parseInt(e)}_getValue(t){let e=0,i=t.length;for(;this._offset<i;){if(e+=t[this._offset],255!==t[this._offset]){this._offset++;break}this._offset++}return e}_parseDataChannel(t,e){let i=Number(this._getDataChannelPortStr(e)),s=this._getDataChannelStr(e);this._mse.saveSeiDataChannel(t,i,s,e),f.a.log("getDataChannelStr",s,"portStr",i)}_getDataChannelPortStr(t){let e="";for(let i=0;i<10;i++)e+=String.fromCharCode(t[i+26]);return e}_getDataChannelStr(t){let e="",i=this._getPayloadLen(t);for(let s=0;s<i;s++)e+=String.fromCharCode(t[s+62]);return e=decodeURIComponent(escape(e)),e}_parseDelay(t,e){if(!xt.isFinishNtp())return;let i=this._decodeData(e),s=i.length,r=new DataView(i.buffer),a=0;for(;a+10<s;){let e=r.getUint32(a,!0),o=r.getUint32(a+4,!0);if(0===e||e>s)break;if(o===V.ProtoUri.HuyaDelaySeiData){let s=new DataView(i.buffer,a,e),r=this._protoHandler.unmarshall(o,s);this._record(t,r)}a+=e}}_decodeData(t){let e=this._decodeBase64(t),i=e.length,s=new Uint8Array(i);for(let t=0;t<i;t++)s[t]=e.charCodeAt(t);return s}_decodeBase64(t){let e="",i=this._getPayloadLen(t);for(let s=0;s<i;s++)e+=String.fromCharCode(t[s+26]);return e=atob(e),e}_getPayloadLen(t){let e="";for(let i=0;i<16;i++)e+=String.fromCharCode(t[i+9]);return parseInt(e)}_getType(t){let e="";for(let i=0;i<8;i++)e+=String.fromCharCode(t[i]);return e}_getH265Len(t){let e=0;for(let i=0;i<16&&t[this._offset]===Wt[i];i++)this._offset++,e++;return e}_isHuya(t){for(let e=0;e<5;e++){if(t[this._offset]!==Gt[e])return!1;this._offset++}return!0}}Yt.H264_CODEC_TYPE=0,Yt.H265_CODEC_TYPE=1,Yt.AV1_CODEC_TYPE=2,Yt.SEI_TYPES=$t;var Kt=Yt;class jt extends V.ListenerImpl{}var qt=jt;var zt=class{constructor(t){this._bytes=t,this._bitIndex=0,this._bitLen=8*t.byteLength}getBits(t){var e=Math.floor(this._bitIndex/8),i=8-this._bitIndex%8,s=this._bytes[e]&(1<<i)-1;if(t<=i)return this._bitIndex+=t,s>>>i-t;var r=t-i;return this._bitIndex+=i,(s<<r|this.getBits(r))>>>0}skipBits(t){this._bitIndex+=t}getBytes(t){if(this._bitIndex%8!=0)throw new Error("can't get bytes from mid-byte: bit index="+this._bitIndex);var e=Math.floor(this._bitIndex/8);return this._bitIndex+=8*t,this._bytes.subarray(e,e+t)}get bytePosition(){return Math.floor(this._bitIndex/8)}get bitposition(){return this._bitIndex}};class Jt{constructor(){}static leb128(t){let e=0;for(let i=0;i<8;i++){let s=t.getBits(8);if(e|=(127&s)<<7*i,!(128&s))break}return e}static parseOBUHeader(t){let e={},i=t.bits;return e.obu_forbidden_bit=i.getBits(1),e.obu_type=i.getBits(4),e.obu_extension_flag=i.getBits(1),e.obu_has_size_field=i.getBits(1),e.obu_reserved_1bit=i.getBits(1),1==e.obu_extension_flag&&(e.temporal_id=i.getBits(3),e.spatial_id=i.getBits(2),e.extension_header_reserved_3bits=i.getBits(3)),e}static uvlc(t){for(var e=0;!t.getBits(1);)++e;return e>=32?0:t.getBits(e)+(1<<e)-1}static color_config(t){var e={};return e.high_bitdepth=t.getBits(1),2==e.seq_profile&&e.high_bitdepth?(e.twelve_bit=t.getBits(1),e.BitDepth=e.twelve_bit?12:10):e.BitDepth=e.high_bitdepth?10:8,1==e.seq_profile?e.mono_chrome=0:e.mono_chrome=t.getBits(1),e.color_description_present_flag=t.getBits(1),e.color_description_present_flag?(e.color_primaries=t.getBits(8),e.transfer_characteristics=t.getBits(8),e.matrix_coefficients=t.getBits(8)):(e.color_primaries=Jt.CP_UNSPECIFIED,e.transfer_characteristics=Jt.TC_UNSPECIFIED,e.matrix_coefficients=Jt.MC_UNSPECIFIED),e.mono_chrome?(e.color_range=t.getBits(1),e.subsampling_x=1,e.subsampling_y=1,e.chroma_sample_position=Jt.CSP_UNKNOWN,e.separate_uv_delta_q=0,e):(e.color_primaries==Jt.CP_BT_709&&e.transfer_characteristics==Jt.TC_SRGB&&e.matrix_coefficients==Jt.MC_IDENTITY?(e.color_range=1,e.subsampling_x=0,e.subsampling_y=0):(e.color_range=t.getBits(1),0==e.seq_profile?(e.subsampling_x=1,e.subsampling_y=1):1==e.seq_profile?(e.subsampling_x=0,e.subsampling_y=0):12==e.BitDepth?(e.subsampling_x=t.getBits(1),e.subsampling_x?e.subsampling_y=t.getBits(1):e.subsampling_y=0):(e.subsampling_x=1,e.subsampling_y=0),e.subsampling_x&&e.subsampling_y&&(e.chroma_sample_position=t.getBits(2))),e.separate_uv_delta_q=t.getBits(1),e)}static metadata_obu(t,e){let i={},s=t.bits;if(i.metadata_type=Jt.leb128(s),i.metadata_type==Jt.METADATA_TYPE_ITUT_T35){i.itu_t_t35_country_code=s.getBits(8),255==i.itu_t_t35_country_code&&(i.itu_t_t35_country_code_extension_byte=s.getBits(8));var r=(8*e-s.bitposition)/8;i.itu_t_t35_payload_bytes=s.getBytes(r)}else if(i.metadata_type==Jt.METADATA_TYPE_HDR_CLL)i.max_cll=s.getBits(16),i.max_fall=s.getBits(16);else if(i.metadata_type==Jt.METADATA_TYPE_HDR_MDCV){i.primary_chromaticity_x=[],i.primary_chromaticity_y=[];for(let t=0;t<3;t++)i.primary_chromaticity_x[t]=s.getBits(16),i.primary_chromaticity_y[t]=s.getBits(16);i.white_point_chromaticity_x=s.getBits(16),i.white_point_chromaticity_y=s.getBits(16),i.luminance_max=s.getBits(32),i.luminance_min=s.getBits(32)}else if(i.metadata_type==Jt.METADATA_TYPE_SCALABILITY){if(i.scalability_mode_idc=s.getBits(8),i.scalability_mode_idc==Jt.SCALABILITY_SS){if(i.spatial_layers_cnt_minus_1=s.getBits(2),i.spatial_layer_dimensions_present_flag=s.getBits(1),i.spatial_layer_description_present_flag=s.getBits(1),i.temporal_group_description_present_flag=s.getBits(1),i.scalability_structure_reserved_3bits=s.getBits(3),i.spatial_layer_dimensions_present_flag)for(let t=0;t<=i.spatial_layers_cnt_minus_1;t++)i.spatial_layer_max_width[t]=s.getBits(16),i.spatial_layer_max_height[t]=s.getBits(16);if(i.spatial_layer_description_present_flag)for(let t=0;t<=i.spatial_layers_cnt_minus_1;t++)i.spatial_layer_ref_id[t]=s.getBits(8);if(i.temporal_group_description_present_flag){i.temporal_group_size=s.getBits(8);for(let t=0;t<i.temporal_group_size;t++){i.temporal_group_temporal_id[t]=s.getBits(3),i.temporal_group_temporal_switching_up_point_flag[t]=s.getBits(1),i.temporal_group_spatial_switching_up_point_flag[t]=s.getBits(1),i.temporal_group_ref_cnt[t]=s.getBits(3);for(let e=0;e<temporal_group_ref_cnt[t];e++)i.temporal_group_ref_pic_diff[t][e]=s.getBits(8)}}}}else i.metadata_type==Jt.METADATA_TYPE_TIMECODE&&(i.counting_type=s.getBits(5),i.full_timestamp_flag=s.getBits(1),i.discontinuity_flag=s.getBits(1),i.cnt_dropped_flag=s.getBits(1),i.n_frames=s.getBits(9),i.full_timestamp_flag?(i.seconds_value=s.getBits(6),i.minutes_value=s.getBits(6),i.hours_value=s.getBits(5)):(i.seconds_flag=s.getBits(1),i.seconds_flag&&(i.seconds_value=s.getBits(6),i.minutes_flag=s.getBits(1),i.minutes_flag&&(i.minutes_value=s.getBits(6),i.hours_flag=s.getBits(1),i.hours_flag&&(i.hours_value=s.getBits(5))))),i.time_offset_length=s.getBits(5),i.time_offset_length>0&&(i.time_offset_value=s.getBits(i.time_offset_length)));return i}static sequence_header_obu(t){let e={},i=t.bits;if(e.seq_profile=i.getBits(3),e.still_picture=i.getBits(1),e.reduced_still_picture_header=i.getBits(1),e.reduced_still_picture_header)e.timing_info_present_flag=0,e.decoder_model_info_present_flag=0,e.initial_display_delay_present_flag=0,e.operating_points_cnt_minus_1=0,e["operating_point_idc[0]"]=0,e["seq_level_idx[0]"]=i.getBits(5),e["seq_tier[0]"]=0,e["decoder_model_present_for_this_op[0]"]=0,e["initial_display_delay_present_for_this_op[0]"]=0;else{e.timing_info_present_flag=i.getBits(1),e.timing_info_present_flag?(e.num_units_in_display_tick=i.getBits(32),e.time_scale=i.getBits(32),e.equal_picture_interval=i.getBits(1),e.equal_picture_interval&&(e.num_ticks_per_picture_minus_1=Jt.uvlc(i)),e.decoder_model_info_present_flag=i.getBits(1),e.decoder_model_info_present_flag&&(e.buffer_delay_length_minus_1=i.getBits(5)),e.num_units_in_decoding_tick=i.getBits(32),e.buffer_removal_time_length_minus_1=i.getBits(5),e.frame_presentation_time_length_minus_1=i.getBits(5),e.initial_display_delay_present_flag=i.getBits(1),e.operating_points_cnt_minus_1=i.getBits(5)):(e.decoder_model_info_present_flag=0,e.initial_display_delay_present_flag=i.getBits(1),e.operating_points_cnt_minus_1=i.getBits(5));for(var s=0;s<=e.operating_points_cnt_minus_1;s++){if(e["operating_point_idc["+s+"]"]=i.getBits(12),e["seq_level_idx["+s+"]"]=i.getBits(5),e["seq_level_idx["+s+"]"]>7?e["seq_tier["+s+"]"]=i.getBits(1):e["seq_tier["+s+"]"]=0,e.decoder_model_info_present_flag){if(e["decoder_model_present_for_this_op["+s+"]"]=i.getBits(1),e["decoder_model_present_for_this_op["+s+"]"]){var r=e.buffer_delay_length_minus_1+1;e["decoder_buffer_delay["+s+"]"]=i.getBits(r),e["encoder_buffer_delay["+s+"]"]=i.getBits(r),e["low_delay_mode_flag["+s+"]"]=i.getBits(1)}}else e["decoder_model_present_for_this_op["+s+"]"]=0;e.initial_display_delay_present_flag&&(e["initial_display_delay_present_for_this_op["+s+"]"]=i.getBits(1)),e["initial_display_delay_present_for_this_op["+s+"]"]&&(e["initial_display_delay_minus_1["+s+"]"]=i.getBits(4))}}return e.frame_width_bits_minus_1=i.getBits(4),e.frame_height_bits_minus_1=i.getBits(4),e.max_frame_width_minus_1=i.getBits(e.frame_width_bits_minus_1+1),e.max_frame_height_minus_1=i.getBits(e.frame_height_bits_minus_1+1),e.reduced_still_picture_header?e.frame_id_numbers_present_flag=0:e.frame_id_numbers_present_flag=i.getBits(1),e.frame_id_numbers_present_flag&&(e.delta_frame_id_length_minus_2=i.getBits(4),e.additional_frame_id_length_minus_1=i.getBits(3)),e.use_128x128_superblock=i.getBits(1),e.enable_filter_intra=i.getBits(1),e.enable_intra_edge_filter=i.getBits(1),e.reduced_still_picture_header?(e.enable_interintra_compound=0,e.enable_masked_compound=0,e.enable_warped_motion=0,e.enable_dual_filter=0,e.enable_order_hint=0,e.enable_jnt_comp=0,e.enable_ref_frame_mvs=0,e.seq_force_screen_content_tools=Jt.SELECT_SCREEN_CONTENT_TOOLS,e.seq_force_integer_mv=1,e["#OrderHintBits"]=0):(e.enable_interintra_compound=i.getBits(1),e.enable_masked_compound=i.getBits(1),e.enable_warped_motion=i.getBits(1),e.enable_dual_filter=i.getBits(1),e.enable_order_hint=i.getBits(1),e.enable_order_hint&&(e.enable_jnt_comp=i.getBits(1),e.enable_ref_frame_mvs=i.getBits(1)),e.seq_choose_screen_content_tools=i.getBits(1),e.seq_choose_screen_content_tools?e.seq_force_screen_content_tools=Jt.SELECT_SCREEN_CONTENT_TOOLS:e.seq_force_screen_content_tools=i.getBits(1),e.seq_force_screen_content_tools>0&&(e.seq_choose_integer_mv=i.getBits(1),e.seq_choose_integer_mv?e.seq_force_integer_mv=1:e.seq_force_integer_mv=i.getBits(1)),e.enable_order_hint?(e.order_hint_bits_minus_1=i.getBits(3),e["#OrderHintBits"]=e.order_hint_bits_minus_1+1):e["#OrderHintBits"]=0,e.enable_superres=i.getBits(1),e.enable_cdef=i.getBits(1),e.enable_restoration=i.getBits(1),Object.assign(e,Jt.color_config(i)),e.film_grain_params_present=i.getBits(1)),e}static parseOBU(t,e,i,s){let r={bits:new zt(t)},a=0;for(;t.length-a>1;){let o;o=Jt.parseOBUHeader(r),1==o.obu_extension_flag&&a++;let n=0,h=t.length-a;if(n=o.obu_has_size_field?Jt.leb128(r.bits):h-1-o.obu_extension_flag,o.obu_type==Jt.OBU_SEQUENCE_HEADER&&i){i(Jt.sequence_header_obu(r))}else if(o.obu_type==Jt.OBU_METADATA&&s){let t=Jt.metadata_obu(r,r.bits.bytePosition+n);t.itu_t_t35_payload_bytes&&s(e,t)}else r.bits.skipBits(8*n);a=r.bits.bytePosition}}static zeroPad(t,e,i){t||(t=0),void 0===i&&(i=10);for(var s=t.toString(i);s.length<e;)s="0"+s;return s}}Jt.OBU_SEQUENCE_HEADER=1,Jt.OBU_TEMPORAL_DELIMITER=2,Jt.OBU_FRAME_HEADER=3,Jt.OBU_TILE_GROUP=4,Jt.OBU_METADATA=5,Jt.OBU_FRAME=6,Jt.OBU_REDUNDANT_FRAME_HEADER=7,Jt.OBU_TILE_LIST=8,Jt.OBU_PADDING=15,Jt.SELECT_SCREEN_CONTENT_TOOLS=2,Jt.CP_BT_709=1,Jt.CP_UNSPECIFIED=2,Jt.TC_SRGB=13,Jt.TC_UNSPECIFIED=2,Jt.MC_IDENTITY=0,Jt.MC_UNSPECIFIED=2,Jt.CSP_UNKNOWN=0,Jt.METADATA_TYPE_HDR_CLL=1,Jt.METADATA_TYPE_HDR_MDCV=2,Jt.METADATA_TYPE_SCALABILITY=3,Jt.METADATA_TYPE_ITUT_T35=4,Jt.METADATA_TYPE_TIMECODE=5,Jt.SCALABILITY_SS=14;var Qt=Jt;var Xt=class{constructor(t){this.hasSample=!1,this.samples=new bt(t)}getSamples(){return this.samples.getSamples()}addCur(t,e){this.hasSample=!0}getResult(){let t=[],e=this.samples.getSamples(),i=e.length;if(i>0){t.push("size:"+i);for(let s=0;s<i;s++)t.push(`${i-s}:${e[s]}`)}return t.join(",")}reset(){let t=this.samples.cur;this.samples.reset(),this.samples.addCur(t)}};var Zt=class extends Xt{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:100),this.lastTs=0}addCur(t,e){super.addCur(t,e);let i=parseInt(e/1e3);this.lastTs>0&&this.lastTs!==i&&this.samples.calculate(),this.lastTs=i,this.samples.addCur(t)}};var te=class{constructor(){this.aSample=new Zt(20),this.vSample=new Zt(20),this.aAutoSample=new Zt(20),this.vAutoSample=new Zt(20)}addAudioSample(t,e){this.aSample.addCur(t,e),this.aAutoSample.addCur(t,e)}addVideoSample(t,e){this.vSample.addCur(t,e),this.vAutoSample.addCur(t,e)}getResult(){let t=[],e=this.aSample.getSamples(),i=this.vSample.getSamples(),s=Math.min(i.length,e.length);if(s>0){t.push("size:"+s);for(let r=0;r<s;r++)t.push(`${s-r}:${i[r]+e[r]}`)}return t.join(",")}reset(){this.aSample.reset(),this.vSample.reset()}getAutoSamples(){let t={aSamples:this.aAutoSample.getSamples(),vSamples:this.vAutoSample.getSamples()};return this.aAutoSample.reset(),this.vAutoSample.reset(),t}recordStat(t){let e=this.getResult();""!==e&&(this.reset(),t.setCoreDim(L.a.CORE.REAL_KBPS_SAMPLE,e))}};var ee=class{constructor(t){this.realFps=0,this.maxDropCnt=0,this.curDropCnt=0,this.startDropDts=0,this.lastDropDts=0,this.started=!1,this.discardGap=0,this.minFps=1e3,this.corePlayer=t,this.info=null,this.isRandom=!1}setConfig(t){this.dropTime=t.dropTime||0;let e=t.minFps||1e3;this.minFps=Math.max(e,parseInt(2*this.realFps/3))}setInfo(t){this.info=t;let e=!0;this.info&&(e=R.b.getSdkAbRandom(this.info,P.a.dropFrameAb)),this.isRandom=e}reset(){this.realFps=0,this.maxDropCnt=0,this.curDropCnt=0,this.startDropDts=0,this.lastDropDts=0,this.started=!1,this.isRandom=!1}start(){f.a.log("DropFrameController.start"),this.started=!0}stop(){this.started=!1}setRealFps(t){t>0&&0===this.realFps&&(this.realFps=t,this.minFps=Math.max(this.minFps,parseInt(2*t/3)),this.maxDropCnt=Math.max(0,t-this.minFps),f.a.log(`DropFrameController.setRealFps fps=${t} minFps=${this.minFps} maxDrop=${this.maxDropCnt}`))}isCanDrop(t,e,i){if(!this.isRandom)return;if(this.corePlayer.webcodecType==D.a.PLAYER_CORE_TYPE.WEBCODECS)return;if(this.corePlayer.bitrate<P.a.perfBitrate)return;if(this.corePlayer.h265Proxy&&this.corePlayer.h265Proxy.isReady)return;if(this.corePlayer.getBufferLen()<=2e3)return;let s=this.corePlayer.renderList;if(s.length<10)return;let r=0;s.forEach(t=>{r+=t});let a=Math.floor(r/s.length),o=~~(1e3/this.realFps*2);return a<=~~(.5*this.realFps)?this.discardGap=o:a<=~~(.6*this.realFps)?this.discardGap=~~(1.3*o):a<=~~(.7*this.realFps)?this.discardGap=~~(1.6*o):a<=~~(.8*this.realFps)?this.discardGap=2*o:a<=~~(.9*this.realFps)&&(this.discardGap=3*o),!e&&0==(96&i)&&(0===this.lastDropDts||t-this.lastDropDts>=this.discardGap)&&(this.lastDropDts=t,!0)}};class ie{constructor(){this.totalTime=0,this.frameNum=0}}var se=class{constructor(){this.started=!1,this.lastCheckTs=0,this.seg=new ie,this.segList=[],this.segSize=10}getSize(){return this.segList.length}addFrame(){let t=y.a.now();this.started||(this.started=!0,this.lastCheckTs=t,q.add(this.onCheckFrameRate,this,200)),this.seg.frameNum++,this.onCheckFrameRate(t)}reset(){this.started=!1,this.lastCheckTs=0,this.seg=new ie,this.segList=[],q.remove(this.onCheckFrameRate,this)}onCheckFrameRate(t){if(this.lastCheckTs>0&&this.seg){let e=t-this.lastCheckTs;e>=1e3&&(this.seg.totalTime=e,this.segList.push(this.seg),this.segList.length>this.segSize&&this.segList.shift(),this.seg=new ie,this.lastCheckTs=t)}}isDownEnough(t){return t>0&&this.segList.length>0&&this.getAvg()>.9*t}getAvg(){return this.getLastRate(this.segList.length)}getLastRate(t){let e=0,i=0,s=this.segList.length;t=Math.min(t,s);for(let r=s-1;r>=0;r--){let s=this.segList[r];if(e+=s.frameNum,i+=s.totalTime,--t<=0)break}return i>0?e/i*1e3:0}};var re=class{constructor(){this.m_idx=0,this.m_data=null,this.m_len=0,this.m_bits=0,this.m_byte=0,this.m_zeros=0}init(t,e){this.m_data=t,this.m_len=e,this.m_idx=0,this.m_bits=0,this.m_byte=0,this.m_zeros=0}getByte(){if(this.m_idx>=this.m_len)return 0;let t=this.m_data[this.m_idx++];return 0==t?(this.m_zeros++,this.m_idx<this.m_len&&2==this.m_zeros&&3==this.m_data[this.m_idx]&&(this.m_idx++,this.m_zeros=0)):this.m_zeros=0,t}getBit(){return 0==this.m_bits&&(this.m_byte=this.getByte(),this.m_bits=8),this.m_bits--,this.m_byte>>this.m_bits&1}getWord(t){let e=0;for(;t>0;)e<<=1,e|=this.getBit(),t--;return e}getUe(){let t=0;for(;this.m_idx<this.m_len&&0==this.getBit();)t++;let e=(1<<t)-1;return 31==t?0:(t>0&&(e+=this.getWord(t)),e)}getSe(){let t=this.getUe(),e=t+1>>1;return 1&t||(e=-e),e}parseSequenceParameterSet(t,e,i){if(e<20)return!1;this.init(t,e),this.getWord(16);let s=this.getWord(4);i.sps_video_parameter_set_id=s;let r=this.getWord(3);i.sps_max_sub_layers_minus1=r,s=this.getWord(1),i.temporal_id_nesting_flag=s,this.hevc_parse_profile_tier_level(i,r);let a=this.getUe();i.sps_seq_parameter_set_id=a;let o=this.getUe();i.chroma_format_idc=o;let n=0;3==o&&(n=s=this.getWord(1)),i.separate_colour_plane_flag=n;let h=this.getUe(),d=this.getUe();f.a.log(`HevcSpsParser.parseSequenceParameterSet', ue_width=${h}, ue_height=${d}`);let l=0,u=0,c=0,p=0;this.getWord(1)&&(l=this.getUe(),u=this.getUe(),c=this.getUe(),p=this.getUe());let m=1!=o&&2!=o||0!=n?1:2,_=1==o&&0==n?2:1;return h-=m*u+m*l,d-=_*p+_*c,i.width=h,i.height=d,this.getUe()==this.getUe()}hevc_parse_profile_tier_level(t,e){if(this.hevc_parse_profile_tier_level_common(t,1,1,1),0==e)return;let i=[],s=[];i[6]={},s[6]={};for(let t=0;t<e;t++)i[t]=this.getWord(1),s[t]=this.getWord(1);if(e>0)for(let t=e;t<8;t++)this.getWord(2);t.sub_layer=[];for(let r=0;r<e;r++)t.sub_layer[r]={},this.hevc_parse_profile_tier_level_common(t.sub_layer[r],i[r],s[r],0)}hevc_parse_profile_tier_level_common(t,e,i,s){e&&(t.profile_space=this.getWord(2),t.tier_flag=this.getWord(1),t.profile_idc=this.getWord(5),t.profile_compatibility_flags=this.getWord(32),t.progressive_source_flag=this.getWord(1),t.interlaced_source_flag=this.getWord(1),t.non_packed_constraint_flag=this.getWord(1),t.frame_only_constraint_flag=this.getWord(1),t.reserved_zero_44bits=this.getWord(44)),i&&(t.level_idc=this.getWord(8))}};const ae=1,oe=2,ne=1,he=3,de=4;let le=null;var ue=function(){return!!le},ce=function(){if(null==le)try{let t=document.createElement("canvas").getContext("experimental-webgl"),e=t.getExtension("WEBGL_debug_renderer_info");le=t.getParameter(e.UNMASKED_RENDERER_WEBGL),localStorage._renderInfo=le}catch(t){le="",f.a.log("RenderInfo.getRenderInfo",t.message)}return le},pe=i(11);var me=class{constructor(t,e){this.corePlayer=t,this.parser=e,this.dropLevel=0,this.open=!1,this.started=!1,this.dropFrames=0,this.lastDropFrames=0,this.lastDropTs=0,this.realFps=0,this.discardGap=0,this.lastDropDts=0,this.dropRenderLevel=0,this.lastCheckDisCardTs=0,this.checkDiscardTimes=0,this.dropRenderLevel=!1,this.isRenderDrop=!1}setRealFps(t){t>0&&0===this.realFps&&(this.realFps=t,f.a.log("DropFrameByDts.setRealFps fps="+t))}getRecrod(){const t=y.a.now()-this.lastDropTs,e=Math.round(t/1e3),i=this.dropFrames-this.lastDropFrames,s=Math.round(i/e);return this.lastDropFrames=this.dropFrames,this.lastDropTs=y.a.now(),s<0?0:s}start(){let t=(pe.a.browser+"").toLowerCase();"safari"===t?f.a.log("DropFrameDts.start fail browser="+t):(f.a.log("DropFrameDts.start"),this.started=!0,this.lastDropTs=y.a.now())}stop(){this.started=!1}reset(){this.dropLevel=0,this.dropFrames=0,this.lastDropFrames=0,this.realFps=0,this.lastDropDts=0,this.dropRenderLevel=0,this.discardGap=0,this.lastCheckDisCardTs=0,this.checkDiscardTimes=0}isCanDrop(t,e,i){if(1==P.a.isCloseMseDrop)return;if(1!=P.a.isLimitNaluType)return;if(!this.open||!this.started||this.corePlayer.webcodecType!==D.a.PLAYER_CORE_TYPE.MSE||this.corePlayer.isPureAudio)return!1;if(1==localStorage._closeDrop)return!1;let s=this.corePlayer.renderList;if(s.length>=5&&this.getDisCardCfg(s),e)0!==this.dropLevel&&f.a.log(`DropFrameByDts.dropFrames level=${this.dropLevel} dromNum=${this.dropFrames}`),this.dropLevel=0;else{let e=this.corePlayer.getBufferLen(),s=0;if(s=P.a.dtsJumpOpen?t-this.corePlayer.getCorrentCurrentDts():t-this.corePlayer.getCurrentRealTime(),this.dropLevel<2&&s>=P.a.dropFrameDts[1]&&e<.5*P.a.dropFrameDts[1]?(this.dropLevel=2,f.a.log(`DropFrameByDts.dropFrame level=2 buffer=${e} gap=${s}`)):this.dropLevel<1&&s>=P.a.dropFrameDts[0]&&e<.7*P.a.dropFrameDts[0]&&(this.dropLevel=1,f.a.log(`DropFrameByDts.dropFrame level=1 buffer=${e} gap=${s}`)),2===this.dropLevel)return this.dropFrames++,this.lastDropDts=t,!0;if(1===this.dropLevel&&0==(96&i))return this.dropFrames++,this.lastDropDts=t,!0;if(e<=1e3)return 2==localStorage._printMseDropInfo&&f.a.log("DropFrameByDts buffer <= 1000"),!1;if(!this.corePlayer.isSupportRequestVideoFrameCallback())return!1;if(this.isRenderDrop&&0==(96&i)&&t-this.lastDropDts>=this.discardGap)return this.lastDropDts=t,this.dropFrames++,this.dropLevel=3,!0}return!1}getDisCardCfg(t){const e=y.a.now();if(0!=this.lastCheckDisCardTs&&e-this.lastCheckDisCardTs<1e3)return;this.checkDiscardTimes++,this.lastCheckDisCardTs=e;let i=0,s=0,r=!1,a=0,o=0,n=0;if(0==this.realFps)return;let h=this.parser.fps.getHeartReceiveFps();t.forEach(t=>{i+=t}),a=Math.floor(i/t.length),0!=h&&(n=Math.floor(a/h*100)/100),o=this.realFps,Number(localStorage._forceDropFrame)>0&&(o=Number(localStorage._forceDropFrame));let d=Math.floor(a/o*100)/100;const l=~~(1e3/o*2),u=3*l,c=2*l,p=~~(1.6*l),m=~~(1.3*l),_=l,g=~~(.9*o),S=~~(.8*o),T=~~(.7*o),E=~~(.6*o),v=~~(.5*o);n>=.9&&1!=localStorage._forceMseDropReal?(n>=.95&&this.checkDiscardTimes%10==0?1==this.dropRenderLevel?(r=!1,s=0):2==this.dropRenderLevel?(this.discardGap=u,s=1,r=!0):3==this.dropRenderLevel?(this.discardGap=c,s=2,r=!0):4==this.dropRenderLevel?(this.discardGap=p,s=3,r=!0):5==this.dropRenderLevel&&(this.discardGap=m,s=4,r=!0):(s=0,r=!1),1==localStorage._printMseDropInfo&&f.a.log(`DropFrameByDts.getDisCardCfg.realRate back,lastDropLevel=${this.dropRenderLevel},isRenderDropLevel=${s},isRenderDrop=${r},realRenderRate=${n},fpsRenderRate=${d},renderSec=${a},heartReceiveFps=${h}`)):(a<=g&&a>S?(this.discardGap=u,s=1,r=!0):a<=S&&a>T?(this.discardGap=c,s=2,r=!0):a<=T&&a>E?(this.discardGap=p,s=3,r=!0):a<=E&&a>v?(this.discardGap=m,s=4,r=!0):a<=v?(this.discardGap=_,s=5,r=!0):(s=this.dropRenderLevel,r=this.isRenderDrop),1==localStorage._printMseDropInfo&&f.a.log(`DropFrameByDts.getDisCardCfg.realFps,lastDropLevel=${this.dropRenderLevel},isRenderDropLevel=${s},isRenderDrop=${r},realRenderRate=${n},fpsRenderRate=${d},renderSec=${a},heartReceiveFps=${h}`)),this.dropRenderLevel=s,this.isRenderDrop=r}destroy(){this.corePlayer=null,this.parser=null,this.isRenderDrop=!1}};const fe=1,_e=2,ge=3,Se=5,Te=9,ye="h264",Ee="h265",ve="av1";class Ce{constructor(t){this.next=null,this.prev=null,this.data=t}}var Pe=class{constructor(){this.size=0,this.head=null,this.freeChainSize=0,this.freeChain=null,this.travelNode=null}resetTravel(){this.travelNode=this.head}travel(){if(null===this.travelNode&&(this.travelNode=this.head,null===this.travelNode))return null;let t=this.travelNode.data;return this.travelNode=this.travelNode.next,this.travelNode===this.head||null===this.travelNode?null:t}reset(){this.resetTravel();let t=null,e=null;for(t=this.head;null!=t;)e=t,t=t.next,e.data=null,e.prev=null,e.next=null,t===this.head&&(t=null);for(this.head=null,t=this.freeChain;null!=t;)e=t,t=t.next,e.data=null,e.prev=null,e.next=null;this.freeChain=null,this.size=0,this.freeChainSize=0}put(t){let e=this.getFree(t);if(this.size++,null===this.head)e.prev=e,e.next=e,this.head=e;else if(e.data.key<this.head.data.key)e.prev=this.head.prev,e.next=this.head,e.prev.next=e,e.next.prev=e,this.head=e;else{let t=this.head.prev;for(;e.data.key<t.data.key;)t=t.prev;if(e.data.key===t.data.key)return this.size--,this.putFree(e),!1;e.prev=t,e.next=t.next,e.prev.next=e,e.next.prev=e}return!0}put2(t){let e=this.getFree(t);if(this.size++,null===this.head)e.prev=e,e.next=e,this.head=e;else if(e.data.key<this.head.data.key)e.prev=this.head.prev,e.next=this.head,e.prev.next=e,e.next.prev=e,this.head=e;else{let t=this.head;for(;e.data.key>t.data.key&&(t=t.next,t!==this.head););if(e.data.key===t.data.key)return this.size--,this.putFree(e),!1;e.prev=t.prev,e.next=t,t.prev.next=e,t.prev=e}return!0}get(){if(null===this.head)return null;let t=this.head,e=t.data;return this.size--,0===this.size?this.head=null:(t.prev.next=t.next,t.next.prev=t.prev,this.head=this.head.next),this.putFree(t),e}peek(){return null===this.head?null:this.head.data}peekLast(){return null===this.head?null:this.head.prev.data}getOrNewNode(t){let e=null;if(null===this.head)this.size++,e=this.getFree(null),e.prev=e,e.next=e,this.head=e;else if(t<this.head.data.key)this.size++,e=this.getFree(null),e.prev=this.head.prev,e.next=this.head,e.prev.next=e,e.next.prev=e,this.head=e;else{let i=this.head.prev;for(;t<i.data.key;)i=i.prev;i.data.key===t?e=i:(this.size++,e=this.getFree(null),e.prev=i,e.next=i.next,e.prev.next=e,e.next.prev=e)}return e}putFree(t){t.data=null,t.next=this.freeChain,t.prev=null,this.freeChain=t,this.freeChainSize++}getFree(t){if(null===this.freeChain)return new Ce(t);let e=this.freeChain;return e.data=t,this.freeChain=e.next,this.freeChainSize--,e}getLast(){if(null==this.head)return null;let t=this.head.prev,e=t.data;return this.size--,0===this.size?this.head=null:(t.prev.next=t.next,t.next.prev=t.prev),this.putFree(t),e}static addData(t,e,i){t.put(e),t.size>i&&t.get()}};var De=class{constructor(){this.beforeChangeVideo=new Pe,this.beforeChangeAudio=new Pe,this.afterChangeVideo=new Pe,this.afterChangeAudio=new Pe,this.avcChangeCnt=0,this.avcChange=!1,this.duration=P.a.avHeaderChangeStatCfg[1]||3e3,this.avcChangeInfo=""}setAvcChange(){this.avcChangeCnt++,this.avcChangeCnt>1&&(this.avcChange=!0,this.afterChangeVideo.reset(),this.afterChangeAudio.reset())}addVideo(t){this.addChain(this.avcChange?this.afterChangeVideo:this.beforeChangeVideo,t)}addAudio(t){this.addChain(this.avcChange?this.afterChangeAudio:this.beforeChangeAudio,t)}addChain(t,e){t.put(e);let i=t.peek();i&&e.key-i.key>this.duration&&(this.avcChange?this.recordAvcChangeInfo():t.get())}recordAvcChangeInfo(){this.avcChange=!1;let t=this.getInfo(this.beforeChangeVideo),e=this.getInfo(this.afterChangeVideo),i=this.getInfo(this.beforeChangeAudio),s=this.getInfo(this.afterChangeAudio);this.avcChangeInfo=`vDts=[${t.dtsArr.join("-")}--${e.dtsArr.join("-")}]`,this.avcChangeInfo+=`  vCts=[${t.ctsArr.join("-")}--${e.ctsArr.join("-")}]`,this.avcChangeInfo+=`  aDts=[${i.dtsArr.join("-")}--${s.dtsArr.join("-")}]`}getInfo(t){let e=t.get(),i=[],s=[];if(e)for(i.push(e.key),e.hasOwnProperty("cts")&&s.push(e.cts);t.size>0;){let r=t.get();i.push(r.key-e.key),r.hasOwnProperty("cts")&&s.push(r.cts),e=r,0===t.size&&i.push(r.key)}return{dtsArr:i,ctsArr:s}}record(t,e){""!==this.avcChangeInfo&&e&&t.setComp(L.a.DIM_H265_SAM.name,"avcChange",this.avcChangeInfo),this.avcChangeInfo=""}},Ie=1,Ae=2;var Re=class{constructor(t){this.type=t,this.totalDuration=0,this.referDts=0,this.firstDts=0,this.lastDts=0,this.durations=[],this.open=!1}reset(){f.a.log("DtsTimeline.reset type="+this.type),this.totalDuration=0,this.referDts=0,this.firstDts=0,this.lastDts=0,this.durations=[]}isFirstDts(t){return t===this.firstDts}alignTimeline(t){this.firstDts=t.firstDts,this.referDts=t.firstDts,this.lastDts=t.firstDts}correctDts(t,e){if(!this.open)return t;let i=0;if(0===this.firstDts)this.firstDts=t,this.referDts=t,this.lastDts=t,i=t;else{let s=this.lastDts;this.lastDts=t;let r=t-s;if(r<0&&(r=-r),r>P.a.dtsJumpThreshold){let i=s-this.referDts,r=this.totalDuration+i;this.durations.push({startTime:this.totalDuration,firstDts:this.referDts,endTime:r}),this.totalDuration=r,0===e&&(e="audio"===this.type?44:30);let a=1e3/e;this.referDts=Math.floor(t-a),f.a.log(`DtsTimeline.setDts:dtsJump type=${this.type} lastDts=${s}, curDts=${t}`)}i=this.firstDts+this.totalDuration+(t-this.referDts),1==localStorage._printCorrectDts&&f.a.log(`DtsTimeline.setDts:type=${this.type} dts=${t}, correctDts=${i}`)}return i}getRealDtsByCurrentTime(t){for(let e=this.durations.length-1;e>=0;e--){let{startTime:i,endTime:s,firstDts:r}=this.durations[e];if(t>=i&&t<s)return 0!==e&&(this.durations=this.durations.slice(e)),r+(t-i)}return this.referDts+t-this.totalDuration}getCorrentDtsByCurrentTime(t){return this.firstDts+t}getRealDtsByPts(t){let e=t-this.firstDts-this.totalDuration;return this.referDts+e}};const Oe=0,we=1;var Le=class{constructor(){this._lastVideoDts=0,this._lastAudioDts=0,this._mode=Oe}reset(){this._lastVideoDts=0,this._lastAudioDts=0,this._mode=Oe}isSync(){return this._mode===Oe}isVideoDtsDiffLarge(t){return this._lastVideoDts=t,this._isJump()}isAudioDtsDiffLarge(t){return this._lastAudioDts=t,this._isJump()}_isJump(){if(!P.a.dtsJumpOpen)return!1;if(this._lastVideoDts>0&&this._lastAudioDts>0){let t=0;if(t=this._lastVideoDts>this._lastAudioDts?this._lastVideoDts-this._lastAudioDts:this._lastAudioDts-this._lastVideoDts,t>P.a.dtsJumpThreshold)return this._mode=we,!0}return!1}};class Me{constructor(t,e){this._jitterLimit=t,this._type=e,this._lastFrameId=0,this._lastDts=0,this._jitters=0,this._jitterMax=0}reset(){this._lastFrameId=0,this._lastDts=0,this._jitters=0,this._jitterMax=0}addCapture(t,e){if(0===this._lastFrameId)this._lastFrameId=t,this._lastDts=e;else{if(t-this._lastFrameId==1){let t=e-this._lastDts;t>this._jitterLimit&&this._jitters++,t>this._jitterMax&&(this._jitterMax=t)}this._lastFrameId=t,this._lastDts=e}}getStats(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e={},i=this._type===Me.Types.VIDEO?L.a.CORE.V_CAPTURE_JITTERS:L.a.CORE.A_CAPTURE_JITTERS,s=this._type===Me.Types.VIDEO?L.a.CORE.V_CAPTURE_JITTER_MAX:L.a.CORE.A_CAPTURE_JITTER_MAX;return e[i]=this._jitters,e[s]=this._jitterMax,t&&(this._jitters=0,this._jitterMax=0),e}}Me.Types={AUDIO:"audio",VIDEO:"video"};var Ve=Me;const be=0;let Ne=!!Number(localStorage._dropAudio),Fe=!!Number(localStorage._dropVideo);Number(localStorage._dropGap);const Be="Hvcc",Ue="AnnexB",ke="Avcc";class xe{constructor(){this.lastDts=0,this.lastPts=0,this.lastCts=0,this.dtsStat=[0,0,0,0,0,0],this.ptsStat=[0,0,0,0,0,0],this.ctsStat=[0,0,0,0,0,0],this.playVideoFrameCnt=0,this.playAudioFrameCnt=0}reset(){this.lastDts=this.lastPts=this.lastCts=0,this.playVideoFrameCnt=this.playAudioFrameCnt=0,this.dtsStat=[0,0,0,0,0,0],this.ptsStat=[0,0,0,0,0,0],this.ctsStat=[0,0,0,0,0,0]}setTimeStamp(t,e,i){this.addStat(this.dtsStat,this.lastDts,t),this.addStat(this.ptsStat,this.lastPts,e),this.addStat(this.ctsStat,this.lastCts,i),this.lastDts=t,this.lastPts=e,this.lastCts=i}addStat(t,e,i){if(e>0&&i>e){let s=i-e;s>=1e3?t[4]++:s>=800?t[3]++:s>=600?t[2]++:s>=400?t[1]++:s>=200&&t[0]++}}}let He=[43,138,8,0];class Ge extends qt{constructor(t,e,i){super(),this.audioFrameId=0,this.videoFrameId=0,this.corePlayer=t,this.remuxer=e,this.metadata={},this.flvCacher=new Ft,this.fps=new Ye,this.downFrameRate=new se,this.audioFps=new Ye,this.sei=new Kt(t),this.avSample=new te,this.hevcSpsParser=new re,this.vCaptureJitterStat=new Ve(200,Ve.Types.VIDEO),this.aCaptureJitterStat=new Ve(200,Ve.Types.AUDIO),this.timeStampStat=new xe,this.emptyFrames=0,this.avcChangeStat=new De,this.dropFrameCtrl=new ee(t),this.dropFrameDts=new me(t,this),this.videoChain=new Pe,this.audioChain=new Pe,this.ctsMax=0,this.ctsVideoChain=new Pe,this.DEFAULT_GOP=200,this.bufLen=400,this.firstBufLen=400,this.remuxLen=this.firstBufLen,this.maxWaitTime=2e3,this.repairSameDts=!1,this.lastDtsDis=0,this.pushGop=!1,this.parseFlvHead=!1,this.lengthSizeMinusOne=0,this.recvVideoFrameTimeStamp=0,this.recvVideoFrameNums=0,this.videoFramePlayDelayTs=0,this.videoFrameCalculatePlayDelayFrames=0,this.recvAudioConfig=!1,this.audioConfig=He.slice(),this.audioSampleRate=22050,this.aacTimeLen=1024e3/this.audioSampleRate,this.validAacTime=500*this.aacTimeLen,this.audioChannelCount=1,this.audioObjectType=5,this.audioIncreaseTSMap=new Map,this.firstDemuxAudioTS=-1,this.streamFormat=Ue,this.spsUnit=null,this.ppsUnit=null,this.vpsUnit=null,this.videoConfig={},this.hasCtsZero=!1,this.paused=!1,this.hasEmptyFrames=!1,this.playVideoFrameCnt=0,this.playVideoLength=0,this.playAudioFrameCnt=0,this.playAudioLength=0,this.playEmptyAudioFrameCnt=0,this.beginParseTs=0,this.hasAudioTag=!1,this.lastAacTs=0,this.hasKeyFrame=!1,this.lastAudioTs=0,this.lastAudioOriginDts=0,this.lastVideoTs=0,this.lastVideoOriginDts=0,this.lastParseDts=0,this.maxaudioptsList=[0,0,0,0,0,0,0,0,0,0],this.last10anduiptsList=[0,0,0,0,0,0,0,0,0,0],this.firstAudioTs=-1,this.showH265Tip=!1,this.appendHighQualityEmptyAudio=!0,this.deleteH264Aud=!1,this.incompleteFlvheaderLen=0,this.videoFrames=0,this.audioFrames=0,this.headCache=null,this.useWebCodes=!0,this.decodeNums=0,this.OBUParser=new Qt,this.seiTypes={},this.av1Bytes=0,this.lastDropDts=0,this.PPS=[],this.SPS=[],this.VPS=[],this.videoCodec="",this.videoWidth=1280,this.videoHeight=720,this.reset(),this.onAV1SequenceHeaderBind=this.onAV1SequenceHeader.bind(this),this.onAV1MetaDataBind=this.onAV1MetaData.bind(this),this.parseType=i,this.startAudioTs=0,this.startVideoTs=0,this.audioDropTs=0,this.audioDropFrames=[],this.firstAudioDts=0,this.firstAudioFrameId=0,this.parseVideoTagCnt=0,this.parseVideoSucCnt=0,this.isFirstPrintVideoTs=!1,this.isFirstPrintAudioTs=!1,this.isSwap=!1,this.fromType=Ie,this.startDtsType=be,this.swapStartDts=0,this.timelineVideo=new Re("video"),this.timelineAudio=new Re("audio"),this.dtsChecker=new Le}setCorrentDtsOpen(t){f.a.log("FlvParser.setCorrentDtsOpen: "+t),this.timelineVideo.open=t,this.timelineAudio.open=t}getAudioFrameId(){return this.audioFrameId++,this.audioFrameId}getVideoFrameId(){return this.videoFrameId++,this.videoFrameId}printVideoInfo(){let t=this.videoChain;if(t.size>0){let e=t.get(),i=[e.key],s=[e.cts];for(;t.size>0;){let r=t.get();i.push(r.key-e.key),s.push(r.cts),e=r}f.a.log("FlvParser video dtsList："+i.join(",")),f.a.log("FlvParser video ctsList："+s.join(","))}}printAudioInfo(){let t=this.audioChain;if(t.size>0){let e=t.get(),i=[e.key];for(;t.size>0;){let s=t.get();i.push(s.key-e.key),e=s}f.a.log("FlvParser audio dtsList："+i.join(","))}}getCodecType(){return 12===this.codec?Ee:13===this.codec?ve:ye}printPlayFrameInfo(){f.a.log("FlvParser.playFrameInfo",this.timeStampStat.playVideoFrameCnt,this.timeStampStat.playAudioFrameCnt)}static probe(t){return!(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])}getAudioFrames(){return this.audioFrames}getVideoFrames(){return this.videoFrames}getFps(){return this.fps.getFps()}getRealFps(){return this.fps.realFps}getRealFpsAudio(){return this.audioFps.realFps}isDownEnough(){return this.downFrameRate.isDownEnough(this.fps.realFps)}getAudioFps(){return this.audioFps&&this.audioFps.getFps()}setDecoctorTimeAbnormal(){let t=localStorage.decodeabnormal;if(t&&t.split("_").length>1){let e=parseInt(t.split("_")[1]),i=(new Date).getTime()-e;i&&i>864e5?(this.appendHighQualityEmptyAudio=!0,localStorage.decodeabnormal=""):this.appendHighQualityEmptyAudio=!1}}destroy(){this.reset()}reset(t){f.a.log("FlvParser.reset"),this.audioFrameId=0,this.videoFrameId=0,this.printFirstVideoTs=!1,this.printFirstAudioTs=!1,this.pfvTs=!1,this.pfaTs=!1,this.fps.reset(),this.audioFps.reset(),this.flvCacher.destroy(),this.timeStampStat.reset(),this.dropFrameCtrl.reset(),this.dropFrameDts.reset(),this.videoChain.reset(),this.audioChain.reset(),this.lastParseDts=0,this.hasAudioTag=!1,this.lastAacTs=0,this.hasKeyFrame=!1,this.lastAudioTs=0,this.lastAudioOriginDts=0,this.lastVideoTs=0,this.lastVideoOriginDts=0,this.lastDropDts=0,this.showH265Tip=!1,this.bufLen=400,this.remuxLen=this.firstBufLen,this.hasCtsZero=!1,this.audioIncreaseTSMap.clear(),this.firstDemuxAudioTS=-1,this.recvVideoFrameTimeStamp=0,this.recvVideoFrameNums=0,this.videoFramePlayDelayTs=0,this.videoFrameCalculatePlayDelayFrames=0,this.incompleteFlvheaderLen=0,this.parseFlvHead=!1,this.switchingUrl=!1,this.droppingSample=null,this.disError302=null,this.decodeIFRTime=0,this.waitRemuxTime=0,this.isFirstRemux=!1,this.av1Bytes=0,this.onAV1SequenceHeaderBind=null,this.onAV1MetaDataBind=null,this.startAudioTs=0,this.startVideoTs=0,this.PPS.length=0,this.SPS.length=0,this.VPS.length=0,this.videoCodec="",this.videoWidth=1280,this.videoHeight=720}getPlayStat(){let t={videoFrameCnt:this.playVideoFrameCnt,videoLength:this.playVideoLength,audioFrameCnt:this.playAudioFrameCnt,audioLength:this.playAudioLength,emptyAudioFrameCnt:this.playEmptyAudioFrameCnt};return this.playVideoFrameCnt=0,this.playVideoLength=0,this.playAudioFrameCnt=0,this.playAudioLength=0,this.playEmptyAudioFrameCnt=0,t}setPaused(t){this.paused=t}setPushGop(t){this.pushGop=t,f.a.log("FlvParser.setPushGop "+t)}setDeleteH264Aud(t){this.deleteH264Aud=t,f.a.log("FlvParser.deleteH264Aud "+t)}setDroppingSample(t){this.droppingSample=t}setDisError(t){this.disError302=t}parseFlv(t,e){let i=0;if(this.headCache){let e=new Uint8Array(t.length+this.headCache.length);e.set(this.headCache,0),e.set(t,this.headCache.length),t=e}let s,r=t.length;if(!1===this.parseFlvHead){let e=Ge.FLV_HEADER_LEN+Ge.PREV_TAG_SIZE_LEN;if(r<e)return f.a.warn("FlvParser.parseFlv flv has no header len="+r),void(this.headCache=t.slice());if(this.headCache=null,i+=e,!Ge.probe(t))return;this.parseFlvHead=!0,this.beginParseTs=Date.now()}for(0===i?this.flvCacher.append(t):this.flvCacher.append(t.slice(i));null!==(s=this.flvCacher.popFrame());)this.parseTag(s,e)}parseTag(t,e,i){let s=t.length;if(s<Ge.TAG_HEADER_LEN+Ge.PREV_TAG_SIZE_LEN)return void f.a.warn("FlvParser.parseTag flv has no whole tag len="+s+" data="+t);let r=0,a=t[r++],o=(t[r++]<<16)+(t[r++]<<8)+t[r++];if(s-(Ge.TAG_HEADER_LEN+Ge.PREV_TAG_SIZE_LEN)<o)return void f.a.warn("FlvParser.parseTag flv has no enough data dataLen="+o+" len="+s);if(0===o)return void f.a.warn("FlvParser.parseTag flvtag empty type="+a);let n=(t[r++]<<16)+(t[r++]<<8)+t[r++]+parseInt(t[r++].toString(16)+"000000",16);if(r+=3,a===Ge.VIDEO_TYPE){if(this.parseType===oe)return;1==localStorage._jumpV1?n+=1e6:2==localStorage._jumpV1&&(n-=1e6),this.avSample.addVideoSample(s,n),Fe||(this.parseVideo(t,11,o,n,i),this.corePlayer.setExceptionStat(L.a.DIM_LINK_STA.VIDEO_FRAME,1))}else if(a===Ge.AUDIO_TYPE){if(localStorage._dropAudioNum>0&&(this.dropAudioNum=Number(localStorage._dropAudioNum),localStorage._dropAudioNum=0),this.dropAudioNum>0)return void this.dropAudioNum--;if(1==localStorage._noAudio)return;1==localStorage._jumpA1?n+=1e6:2==localStorage._jumpA1&&(n-=1e6),this.avSample.addAudioSample(s,n),Ne||this.corePlayer.isPureVideo||(this.parseAudio(t,11,o,n,i),this.corePlayer.setExceptionStat(L.a.DIM_LINK_STA.AUDIO_FRAME,1))}else a===Ge.SCRIPT_TYPE?this.parseScriptTag(t,11,o,n):(f.a.warn("%cFlvParser.parseTag discard type="+a+" len="+o,"color:white;background:black"),this.corePlayer.onVideoParseInvalid&&this.corePlayer.onVideoParseInvalid())}parseScriptTag(t,e,i,s){if(e+Ge.SCRIPT_AMF1_HEAD_LEN>i)return void f.a.log("script too small");t[e++];let r=(t[e++]<<8)+t[e++],a=kt.getStr(t,e,r);e+=r,this.corePlayer&&("onMetaData"===a?(this.metadata=kt.parseScript(t,e,t.length).data,Object.assign(this.corePlayer.metadata,this.metadata)):-1!==a.indexOf("onMixAudio")&&this.corePlayer.scriptVolumeInfos.addMixAudio(a.replace("onMixAudio:",""),s))}parseVideo(t,e,i,s,r){let a=s;if(this.isFirstPrintTs||(f.a.log("FlvParser.firstVideoTs="+s),this.isFirstPrintTs=!0),this.repairSameDts&&s===this.lastVideoTs&&this.lastDtsDis>0){let t=this.fps.realFps;s+=t>0?parseInt(1e3/t):this.lastDtsDis}if(this.lastVideoTs>0&&this.lastVideoTs<s&&(this.lastDtsDis=s-this.lastVideoTs),i<5)return void f.a.warn("FlvParser.parseVideo avc videotag not enough dataLen="+i);let o=t[e]>>4;this.codec=15&t[e++];let n=t[e++];if(5!==i)if(0===n)this.parseVideoConfig(t,e,i,s);else if(1===n){if(r||(r=this.getVideoFrameId()),this.vCaptureJitterStat.addCapture(r,a),s=this.timelineVideo.correctDts(s,this.fps.realFps),this.dtsChecker.isVideoDtsDiffLarge(s)&&this.timelineVideo.isFirstDts(s)&&(this.corePlayer.resetAudioDts(),this.corePlayer.ctrlBuffer.avBuffer.dtsChecker.reset(),this.timelineAudio.reset()),this.parseVideoTagCnt++,o==Ge.IFRAME)this.corePlayer&&this.corePlayer.setExceptionStat(L.a.DIM_LINK_STA.VIDEO_IFRAME,1),this.hasKeyFrame||(this.decodeIFRTime=y.a.now()),this.hasKeyFrame=!0;else if(!this.hasKeyFrame)return void f.a.log("-------- drop video tag has no IFrame",s);if(0===P.a.pcdnFlvSyncMob&&!this.isFirstPrintVideoTs&&this.fromType==Ae){const t=s-this.swapStartDts;if(f.a.log(`FlvParser.PCDN, firstVideoTs=${s} dis=${t}`),this.isFirstPrintVideoTs=!0,this.getPcdnDisError(t))return}if(Number(localStorage._printVideoTs)&&f.a.debug("%cFlvParser video ts","color:green",` oriDts=${a} dif=${a-this.lastVideoOriginDts} fixDts=${s} dif=${s-this.lastVideoTs} fixDts-oriDts=${s-a} frameType=${o}`),localStorage.gap&&(s+=Number(localStorage.gap)),this.lastVideoTs>0&&(s-this.lastVideoTs>200||s-this.lastVideoTs<-200)){const t=s-this.lastVideoTs;f.a.warn(`FlvParser video dts jump lastDts=${this.lastVideoTs} curDts=${s} gap=${t}`),(t>=P.a.videoMaxGap||t<=-P.a.videoMaxGap)&&this.resetPlayer()}if(1==Number(localStorage._printAudioTsSec)){let t=y.a.now();t-this.startVideoTs>1e3&&(f.a.debug("%cFlvParser shield video sec ts","color:blue",s),this.startVideoTs=t)}this.lastVideoTs=s,this.lastVideoOriginDts=a,this.parseVideoNalu(t,e,i,s,o)}else 2===n?f.a.info("%cFlvParser.parseVideo avc_end dataLen="+i,"color:white;background:black"):f.a.warn("%cFlvParser.parseVideo error avc packet type="+n,"color:white;background:black");else f.a.log("FlvParser.parseVideo avc_empty frameType="+o+" avcPacketType="+n)}resetPlayer(){this.corePlayer.resetPlayer()}onAV1SequenceHeader(t){let e="av01."+t.seq_profile+"."+Qt.zeroPad(t["seq_level_idx[0]"],2)+(t["seq_tier[0]"]?"H":"M")+"."+Qt.zeroPad(t.BitDepth,2)+"."+t.mono_chrome+"."+t.subsampling_x+t.subsampling_y+(1===t.subsampling_x&&1===t.subsampling_y?t.chroma_sample_position:0);t.color_description_present_flag&&(e+="."+Qt.zeroPad(t.colorPrimaries,2)+"."+Qt.zeroPad(t.transferCharacteristics,2)+"."+Qt.zeroPad(t.matrixCoefficients,2)+"."+t.color_range);let i={isHevc:!1,isAV01:!0,width:t.max_frame_width_minus_1+1,height:t.max_frame_height_minus_1+1,codec:e};this.corePlayer.setExceptionStat(L.a.DIM_LINK_STA.VIDEO_CONFIG,1),this.remuxer&&this.remuxer.switchLevel(!1,!1),this.corePlayer.updateVideoConfig(i,!1)}onAV1MetaData(t,e){e.itu_t_t35_payload_bytes&&this.sei.parseSei(t,e.itu_t_t35_payload_bytes,Kt.AV1_CODEC_TYPE,this.seiTypes)}parseVideoConfig(t,e,i,s){let r,a,o=[],n=[],h=[],d=[],l=[],u=[],c=!1,p=null,m=(e+=3)+i-5;if(this.isAv01()){this.av1Bytes=t.subarray(e,e+i-5);let s=t.subarray(e+=4,e+i);Qt.parseOBU(s,0,this.onAV1SequenceHeaderBind)}else{if(this.isHevc()){this.showH265Tip||(this.showH265Tip=!0,f.a.warn("This is a H265 video.")),this.corePlayer.setExceptionStat(L.a.DIM_LINK_STA.H265,1);let s=this.hevcFindNextStartCode(t,e);if(s.found){this.streamFormat=Ue,this.corePlayer.setStreamFormat(this.streamFormat),f.a.log("FlvParser.parseVideoConfig AnnexB");let i=(126&t[e+=s.startCodeSize])>>1,r=e;for(;e<m;){if(s=this.hevcFindNextStartCode(t,e),s.found||e+1===m){switch(i){case Ge.NAL_VPS:let s=null;s=e+1===m?{data:t.subarray(r,e+1),type:i}:{data:t.subarray(r,e),type:i},this.vpsUnit&&this.vpsUnit.data.toString(16)!==s.data.toString(16)&&(f.a.log("FlvParser.parseVideoConfig vps changed"),c=!0),this.vpsUnit=s,h.push(s.data),u[u.length]={length:s.data.length,nalu:s.data};break;case Ge.NAL_SPS:let a=null;a=e+1===m?{data:t.subarray(r,e+1),type:i}:{data:t.subarray(r,e),type:i},this.spsUnit&&this.spsUnit.data.toString(16)!==a.data.toString(16)&&(f.a.log("FlvParser.parseVideoConfig sps changed"),c=!0),this.spsUnit=a,o.push(a.data),d[d.length]={length:a.data.length,nalu:a.data};break;case Ge.NAL_PPS:let p=null;p=e+1===m?{data:t.subarray(r,e+1),type:i}:{data:t.subarray(r,e),type:i},this.ppsUnit&&this.ppsUnit.data.toString(16)!==p.data.toString(16)&&(f.a.log("FlvParser.parseVideoConfig pps changed"),c=!0),this.ppsUnit=p,n.push(p.data),l[l.length]={length:p.data.length,nalu:p.data}}if(e+s.startCodeSize<m){i=(126&t[e+=s.startCodeSize])>>1,r=e;continue}}e++}}else{if(!P.a.enableHvcc)return f.a.warn("hevcFindNextStartCode failed! dataLen",i),void this.corePlayer.on265StartCodeError();{this.streamFormat=Be,this.corePlayer.setStreamFormat(this.streamFormat),f.a.log("FlvParser.parseVideoConfig Hvcc"),e+=21,this.lengthSizeMinusOne=3&t[e++];const i=t[e++];f.a.log("FlvParser.parseVideoConfig Hvcc nNaluArrayCount="+i);for(let s=0;s<i;s++){let i=99&t[e++];if(i===Ge.NAL_VPS){let i=(t[e++]<<8)+t[e++],s=0;for(let r=0;r<i;++r){s=(t[e++]<<8)+t[e++];let i={data:t.subarray(e,e+s),type:Ge.NAL_VPS};this.vpsUnit&&this.vpsUnit.data.toString(16)!==i.data.toString(16)&&(f.a.log("FlvParser.parseVideoConfig vps changed"),c=!0),this.vpsUnit=i,e+=s,h.push(i.data),u[u.length]={length:i.data.length,nalu:i.data}}}else if(i===Ge.NAL_SPS){let i=(t[e++]<<8)+t[e++];for(let s=0;s<i;++s){r=(t[e++]<<8)+t[e++];let i={data:t.subarray(e,e+r),type:Ge.NAL_SPS};this.spsUnit&&this.spsUnit.data.toString(16)!==i.data.toString(16)&&(f.a.log("FlvParser.parseVideoConfig sps changed"),c=!0),this.spsUnit=i,e+=r,o.push(i.data),d[d.length]={length:i.data.length,nalu:i.data}}}else if(i===Ge.NAL_PPS){let i=(t[e++]<<8)+t[e++];for(let s=0;s<i;++s){a=(t[e++]<<8)+t[e++];let i={data:t.subarray(e,e+a),type:Ge.NAL_PPS};this.ppsUnit&&this.ppsUnit.data.toString(16)!==i.data.toString(16)&&(f.a.log("FlvParser.parseVideoConfig pps changed"),c=!0),this.ppsUnit=i,e+=a,n.push(i.data),l[l.length]={length:i.data.length,nalu:i.data}}}}}}p=this.parseSps(this.spsUnit,h,o,n),this.hasCtsZero=!0,this.corePlayer.setAvcCfg(p.width,p.height)}else{e+=4,this.lengthSizeMinusOne=3&t[e++],this.streamFormat=ke,f.a.log("FlvParser.parseVideoConfig Avcc"),this.corePlayer.setStreamFormat(this.streamFormat);let i=31&t[e++];for(let s=0;s<i;++s){r=(t[e++]<<8)+t[e++];let i={data:t.subarray(e,e+r),type:7};this.spsUnit&&this.spsUnit.data.toString(16)!==i.data.toString(16)&&(f.a.log("FlvParser.parseVideoConfig sps changed",this.spsUnit.data.toString(16),i.data.toString(16)),c=!0),this.spsUnit=i,e+=r,o.push(i.data),d[s]={length:r,nalu:i.data}}let s=t[e++];for(let i=0;i<s;++i){a=(t[e++]<<8)+t[e++];let s={data:t.subarray(e,e+a),type:8};this.ppsUnit&&this.ppsUnit.data.toString(16)!==s.data.toString(16)&&(f.a.log("FlvParser.parseVideoConfig pps changed",this.ppsUnit.data.toString(16),s.data.toString(16)),c=!0),this.ppsUnit=s,e+=a,n.push(s.data),l[i]={length:a,nalu:s.data}}p=this.parseSps(this.spsUnit,h,o,n),this.corePlayer.setAvcCfg(p.width,p.height)}this.corePlayer.setExceptionStat(L.a.DIM_LINK_STA.VIDEO_CONFIG,1),this.corePlayer.updateAVCConfig&&this.corePlayer.updateAVCConfig({pps:l,sps:d,vps:u,codec:p.codec,width:p.width,height:p.height,timestamp:s}),this.PPS=l,this.SPS=d,this.VPS=u,this.videoCodec=p.codec,this.videoWidth=p.width,this.videoHeight=p.height,this.avcChangeStat.setAvcChange(),this.corePlayer.updateVideoConfig(p,c),this.remuxer&&this.remuxer.switchLevel(c,!1),f.a.log("FlvParser.parseVideoConfig avccfg dataLen="+i+" spsLen="+r+" ppsLen="+a+" w/h="+p.width+"/"+p.height+" codec="+p.codec,"sps="+JSON.stringify(d),"pps="+JSON.stringify(l),"vps="+JSON.stringify(u))}}parseSps(t,e,i,s){let r=null,a="",o=0,n=0;if(this.isHevc()){this.spsConfig={},this.hevcSpsParser.parseSequenceParameterSet(t.data,t.data.length,this.spsConfig);let h=this.spsConfig.profile_space,d=this.spsConfig.profile_idc,l=this.spsConfig.profile_compatibility_flags;l=l>>1&1431655765|(1431655765&l)<<1,l=l>>2&858993459|(858993459&l)<<2,l=l>>4&252645135|(252645135&l)<<4,l=l>>8&16711935|(16711935&l)<<8,l=l>>16|l<<16;let u=this.spsConfig.tier_flag,c=this.spsConfig.level_idc;a="hvc1."+["","A","B","C"][h%4]+d.toString()+"."+l.toString(16).toLowerCase()+"."+["L","H"][u%2]+c.toString(),o=this.spsConfig.width||this.corePlayer.width,n=this.spsConfig.height||this.corePlayer.height,f.a.log("FlvParser.parseVideoConfig.hevcSpsConfig",this.spsConfig,a),r={isHevc:!0,isAV01:!1,vps:e,sps:i,pps:s,codec:a,width:o,height:n}}else{try{r=new Nt(t.data).readSPS(),o=r.width,n=r.height}catch(t){f.a.log("FlvParser.parseSPS error, msg="+t.message),o=this.metadata.width||1280,n=this.metadata.height||720}let e=t.data.subarray(1,4),h="avc1.";for(let t=0;t<3;t++){let i=e[t].toString(16);i.length<2&&(i="0"+i),h+=i}a=h,r={isHevc:!1,isAV01:!1,sps:i,pps:s,width:o,height:n,codec:a}}return r}calcCtsMax(t,e){if(e>0){this.ctsVideoChain.put({key:t,cts:e});let i=0,s=this.ctsVideoChain.head.data.key;if(this.ctsVideoChain.head.prev.data.key-s>=1e4&&(i=this.ctsVideoChain.head.data.cts,this.ctsVideoChain.get()),this.ctsMax<e)this.ctsMax=e;else if(this.ctsMax===i){let t=this.ctsVideoChain.head,e=0;for(;e<t.data.cts&&(e=t.data.cts),t.next!==this.ctsVideoChain.head;)t=t.next}}}parseVideoNalu(t,e,i,s,r){let a,o,n=[],h=0,d=[],l=[],u=[],c=null,p=!1,m=r===Ge.IFRAME,_=(t[e++]<<16)+(t[e++]<<8)+t[e++];0===_?this.hasCtsZero||(this.hasCtsZero=!0):_>=8388608?_-=16777216:_>2500&&_<3500?_=0:_>600&&f.a.warn("FlvParser.parseVideoNalu large cts="+_+" dts="+s),Pe.addData(this.videoChain,{key:s,cts:_},Number(P.a.avHeaderChangeCfg[2])),this.avcChangeStat.addVideo({key:s,cts:_}),this.calcCtsMax(s,_);let g=e+i-5,S=!1;if(this.seiTypes={},this.isAv01()){let o=t.subarray(e,e+i-5);n.push({data:o,type:1===r?5:1}),Qt.parseOBU(o,s,null,this.onAV1MetaDataBind),h+=o.length,a=1}else if(this.isHevc()){if(this.streamFormat==Ue){let r=this.hevcFindNextStartCode(t,e);if(!r.found)return f.a.error("hevcFindNextStartCode failed! dataLen",i),void this.corePlayer.on265StartCodeError();{let i=(126&t[e+=r.startCodeSize])>>1,a=e;for(;e<g;)r=this.hevcFindNextStartCode(t,e),(r.found||e+1===g)&&(i<10&&(S=!((98&i)>>1)),o=e+1===g?{data:t.subarray(a,e+1),type:i}:{data:t.subarray(a,e),type:i},i===Ge.HEVC_NAL_SEI?this.sei.parseSei(s,o.data,Kt.H265_CODEC_TYPE,this.seiTypes):i===Ge.HEVC_NAL_AUD||(i===Ge.NAL_VPS?(u.push({length:o.data.length,nalu:o.data}),n.push(o),h+=o.data.length,this.corePlayer.updateAVCVPS&&this.corePlayer.updateAVCVPS(o.data,s)):i===Ge.NAL_SPS?(c=o,l.push({length:o.data.length,nalu:o.data}),n.push(o),h+=o.data.length,this.corePlayer.updateAVCSPS&&this.corePlayer.updateAVCSPS(o.data,s)):i===Ge.NAL_PPS?(d.push({length:o.data.length,nalu:o.data}),n.push(o),h+=o.data.length,this.corePlayer.updateAVCPPS&&this.corePlayer.updateAVCPPS(o.data,s)):(o.discardAllow=i<10&&!(1&i),o.isUnit=!0,n.push(o),h+=o.data.length)),e+r.startCodeSize<g)?(i=(126&t[e+=r.startCodeSize])>>1,a=e):e++}}else if(this.streamFormat==Be){let r=i-5;for(;r;){a=0;for(let i=0;i<=this.lengthSizeMinusOne;++i)a+=t[e++]<<8*(this.lengthSizeMinusOne-i);if(r-=this.lengthSizeMinusOne+1,0===a)continue;if(a<0||a>i-5)break;if(a>r){e+=r;break}let p=(126&t[e])>>1;r-=a,o={data:t.subarray(e,e+a),type:p},o.naluType=p,p===Ge.HEVC_NAL_SEI?this.sei.parseSei(s,o.data,Kt.H265_CODEC_TYPE,this.seiTypes):p===Ge.HEVC_NAL_AUD||(p===Ge.NAL_VPS?(u.push({length:o.data.length,nalu:o.data}),n.push(o),h+=o.data.length,this.corePlayer.updateAVCVPS&&this.corePlayer.updateAVCVPS(o.data,s)):p===Ge.NAL_SPS?(c=o,l.push({length:o.data.length,nalu:o.data}),n.push(o),h+=o.data.length,this.corePlayer.updateAVCSPS&&this.corePlayer.updateAVCSPS(o.data,s)):p===Ge.NAL_PPS?(d.push({length:o.data.length,nalu:o.data}),n.push(o),h+=o.data.length,this.corePlayer.updateAVCPPS&&this.corePlayer.updateAVCPPS(o.data,s)):(o.discardAllow=p<10&&!(1&p),o.isUnit=!0,n.push(o),h+=o.data.length)),e+=a}}}else{let u=i-5;for(;u;){a=0;let f=t[e+4];for(let i=0;i<=this.lengthSizeMinusOne;++i)a+=t[e++]<<8*(this.lengthSizeMinusOne-i);if(u-=this.lengthSizeMinusOne+1,0===a)continue;if(a<0||a>i-5)break;if(a>u){e+=u;break}u-=a,o={data:t.subarray(e,e+a),type:1===r?5:1};const _=31&o.data[0];if(o.naluType=_,this.isH264Sei(o.data))this.sei.parseSei(s,o.data,Kt.H264_CODEC_TYPE,this.seiTypes);else if(this.isH264NALUPPS(o.data))d.push({length:a,nalu:o.data}),n.push(o),h+=o.data.length,this.corePlayer.updateAVCPPS&&this.corePlayer.updateAVCPPS(o.data,s);else if(this.isH264NALUPSPS(o.data))c=o,l.push({length:a,nalu:o.data}),n.push(o),h+=o.data.length,this.corePlayer.updateAVCSPS&&this.corePlayer.updateAVCSPS(o.data,s);else if(this.corePlayer.webcodecType==D.a.PLAYER_CORE_TYPE.WEBCODECS){if(_>=1&&_<=5){let t=!1;1!=r&&0==(96&f)&&(t=!0,p=!0),o.discardAllow=t,o.isUnit=!0,n.push(o),h+=o.data.length}}else 1==P.a.isLimitNaluType?_>=1&&_<=5&&!this.dropFrameDts.isCanDrop(s,m,f)&&(n.push(o),h+=o.data.length):this.isH264Aud(o.data)&&this.deleteH264Aud||(this.isH264Aud(o.data)?(n.push(o),h+=o.data.length):this.dropFrameDts.isCanDrop(s,m,f)||(n.push(o),h+=o.data.length));e+=a}}if(m&&!this.isAv01()&&(this.vpsUnit&&0==u.length&&(n.push(this.vpsUnit),h+=this.vpsUnit.data.length),this.spsUnit&&0==l.length&&(n.push(this.spsUnit),h+=this.spsUnit.data.length),this.ppsUnit&&0==d.length&&(n.push(this.ppsUnit),h+=this.ppsUnit.data.length)),h>0){let t=!1,e=[],a=[],g=[];if(m){a=l.length>0?l:this.SPS,e=u.length>0?u:this.VPS,g=d.length>0?d:this.PPS;let i=!1,r=!1,o=!1;if(this._isCfgChange(this.SPS,l)&&(t=!0,i=!0),this._isCfgChange(this.PPS,d)&&(t=!0,r=!0),this._isCfgChange(this.VPS,u)&&(t=!0,o=!0),t&&this.corePlayer.setIFrameAvcChageStat(),t){i&&this.SPS.length>0&&l.length>0&&f.a.log(`FlvParser.parseVideoNalu IFrame header != avcHeader,avcspsLen=${this.SPS.length},spsLen=${l.length},sps=${l[0].nalu.toString()} && ${this.SPS[0].nalu.toString()}`),r&&this.PPS.length>0&&d.length>0&&f.a.log(`FlvParser.parseVideoNalu IFrame header != avcHeader,avcPPSLen=${this.PPS.length},ppsLen=${d.length},pps=${d[0].nalu.toString()} && ${this.PPS[0].nalu.toString()}`),o&&this.VPS.length>0&&u.length>0&&f.a.log(`FlvParser.parseVideoNalu IFrame header != avcHeader,acvVPSLen=${this.VPS.length},vpsLen=${u.length},vps=${u[0].nalu.toString()} && ${this.VPS[0].nalu.toString()}`);const n=this.parseSps(c,e,a,g);this.corePlayer.setAvcCfg(n.width,n.height),this.corePlayer.setExceptionStat(L.a.DIM_LINK_STA.VIDEO_CONFIG,1),this.corePlayer.updateAVCConfig&&this.corePlayer.updateAVCConfig({pps:g,sps:a,vps:e,codec:n.codec,width:n.width,height:n.height,timestamp:s}),this.PPS=g,this.SPS=a,this.VPS=e,this.videoCodec=n.codec,this.videoWidth=n.width,this.videoHeight=n.height,this.remuxer&&this.remuxer.switchLevel(t,!1)}}let T={type:this.isAv01()?"av01":"avc",units:n,len:h,ts:s,cts:_,dts:90*s,pts:90*(s+_),key:r===Ge.IFRAME,origin_iframe:1===this.seiTypes[Kt.SEI_TYPES.IFRAME],isBFrameType:S,av1Bytes:this.av1Bytes};if(1==localStorage._printVideoFrameType&&f.a.log(`FlvParser.parseVideo FrameType=${r} iFrameType=${Ge.IFRAME}, dts=${s}`),m&&(1==localStorage._printIframeDetail&&f.a.log(`FlvParser.parseVideo iFrame,avcChange=${t},dts=${s},vpslen=${u.length},vLen=${e.length},spsLen=${l.length},sLen=${a.length},ppsLen=${d.length},pLen=${g.length}`),T.spsUnit=a,T.ppsUnit=g,T.vpsUnit=e,T.videoCodec=this.videoCodec,T.videoWidth=this.videoWidth,T.videoHeight=this.videoHeight),this.corePlayer.isLive&&this.corePlayer.videoPlayConsuming&&this.corePlayer.videoPlayConsuming.addRecvFrameData(s,s+_,y.a.now()),this.droppingSample&&this.droppingSample(T))return;if(this.printFirstVideoTs||(this.printFirstVideoTs=!0,f.a.log(`FlvParser.parseVideo dts=${s} pts=${T.pts/90} isIFrame=${m}`)),this.pfvTs||(this.pfvTs=!0,f.a.log(`FlvParser.parseVideo11 dts=${s} pts=${T.pts/90} isIFrame=${m}`)),this.corePlayer.webcodecType!=D.a.PLAYER_CORE_TYPE.WEBCODECS||this.isH264Aud(o.data))this.fps.addDts(s,i);else{let t=m?Ge.IFRAME:p?Ge.NO_REFERENCE_FRAME:0;this.fps.addDts(s,i,t)}this.downFrameRate.addFrame(),this.dropFrameCtrl.setRealFps(this.fps.realFps),this.dropFrameDts.setRealFps(this.fps.realFps),this.corePlayer.setRealFps(this.fps.realFps),this.corePlayer.curVideoDts=s,this.lastParseDts=s,this.videoFrames++,this.timeStampStat.setTimeStamp(s,s+_,_),this.parseVideoSucCnt++,this.corePlayer.pushAvcSample(T),this.playVideoFrameCnt++,this.timeStampStat.playVideoFrameCnt++,this.playVideoLength+=i}}_isCfgChange(t,e){let i=!1;return t.length>0&&e.length>0&&(t.length!==e.length?i=!0:e.forEach((e,s)=>{i||e.nalu.toString()===t[s].nalu.toString(16)||(i=!0)})),i}addVideoSPS(){}addVideoPPS(){}addVideoVPS(){}parseAudio(t,e,i,s,r){let a=s;Pe.addData(this.audioChain,{key:s},Number(P.a.avHeaderChangeCfg[2])),this.avcChangeStat.addAudio({key:s});let o=t[e++]>>>4,n=s;10!=o&&f.a.warn("FlvParser.parseAudio Unsupported audio codec, soundFormat="+o),this.calcAudioFrameRate(s),null!=this.audioIncreaseTSMap.get(s)&&(s=this.audioIncreaseTSMap.get(s));let h=t[e++];if(0===h)if(i>=4){let i=t[e]>>3;this.audioObjectType=i;let r=((7&t[e])<<1)+((128&t[e+1])>>7);if(r>=Ge.AdtsSampleingRates.length)return void f.a.warn("FlvParser.parseAudio SampleingRate out of bounds. samplingIndex="+r);this.audioChannelCount=(120&t[e+1])>>3;let a=this.getAdtsConfig(i,r,this.audioChannelCount),o=!1;this.recvAudioConfig&&this.audioConfig.toString(16)===a.toString(16)||(o=!0),this.audioConfig=a,this.recvAudioConfig=!0,this.corePlayer.updateAudioConfig({audioConfig:a,codec:"mp4a.40.5",audioSampleRate:this.audioSampleRate,aacTimeLen:this.aacTimeLen,audioObjectType:this.audioObjectType,audioChannelCount:this.audioChannelCount,timeStamp:s},!1,this.parseType),o&&(this.firstAudioTs=-1,this.firstDemuxAudioTS=-1,this.lastAudioTs=0,this.firstAudioDts=0,this.firstAudioFrameId=0,this.corePlayer.resetAudioDts()),this.corePlayer.setExceptionStat(L.a.DIM_LINK_STA.AUDIO_CONFIG,1)}else f.a.warn("FlvParser.parseAudio adts error dataLen="+i+" ts="+s);else if(1===h){if(this.audioFrames++,0===P.a.pcdnFlvSyncMob&&!this.isFirstPrintAudioTs&&this.fromType==Ae){const t=s-this.swapStartDts;if(f.a.log(`FlvParser.PCDN, firstAudioTs=${s} dis=${t}`),this.isFirstPrintAudioTs=!0,this.getPcdnDisError(t))return}if(P.a.dtsJumpOpen&&(s=this.timelineAudio.correctDts(s,this.audioFps.realFps),this.dtsChecker.isAudioDtsDiffLarge(s)&&this.timelineAudio.isFirstDts(s)&&(this.timelineAudio.alignTimeline(this.timelineVideo),s=this.timelineAudio.correctDts(s,this.audioFps.realFps))),!this.recvAudioConfig)return;r||(r=this.getAudioFrameId()),this.aCaptureJitterStat.addCapture(r,a);let o=0;if(P.a.audioDtsOpen)if(0===this.firstAudioDts)this.lastAudioTs=s,this.firstAudioDts=s,this.firstAudioFrameId=r,this.corePlayer.resetAudioDts();else{o=Math.floor(this.firstAudioDts+(r-this.firstAudioFrameId)*this.aacTimeLen);let t=o-s;t<0&&(t=-t),t<100?s=o:t>300&&(f.a.log(`FlvParser.parseAudio timeStamp diff(${t})>300 resetFirstAudioDts, frameId=${r} dts=${o} timeStamp=${s} firstAudioDts=${this.firstAudioDts} firstFrameId=${this.firstAudioFrameId}`),this.lastAudioTs=s,this.firstAudioDts=s,this.firstAudioFrameId=r)}if(this.last10anduiptsList.shift(),this.last10anduiptsList.push(s),-1==this.firstAudioTs&&(this.firstAudioTs=s),-1==this.firstDemuxAudioTS)this.firstDemuxAudioTS=s;else if(s==this.firstDemuxAudioTS)return void f.a.warn("parseaudio audio too much audio in firstTs ts="+s);for(let t=0;t<10;t++)this.maxaudioptsList[t]=this.last10anduiptsList[t];if(this.lastAudioTs>0&&this.lastAudioTs==s){let t=s+(0|this.aacTimeLen);this.audioIncreaseTSMap.set(n,t),s=t}if(Number(localStorage._printAudioTs)&&this.parseType==ae&&f.a.debug("%cFlvParser audio ts","color:red",`oriDts=${a} dif=${a-this.lastAudioOriginDts} fixDts=${s} dif=${s-this.lastAudioTs} fixDts-oriDts=${s-a}`),1==Number(localStorage._printAudioTs2)&&this.parseType==oe&&f.a.debug("%cFlvParser shield audio ts","color:green",`oriDts=${a} dif=${a-this.lastAudioOriginDts} fixDts=${s} dif=${s-this.lastAudioTs} fixDts-oriDts=${s-a}`),1==Number(localStorage._printAudioTsSec)&&this.parseType==oe){let t=y.a.now();t-this.startAudioTs>1e3&&(f.a.debug("%cFlvParser shield audio sec ts","color:green",s),this.startAudioTs=t)}if(this.lastAudioTs=s,this.lastAudioOriginDts=a,this.hasAudioTag=!0,!this.validAacSample(s))return;let h=i-2,d={type:"aac",unit:t.subarray(e,e+h),dts:90*s,pts:90*s,ts:s,sampleDuration:this.aacTimeLen};if(this.corePlayer.isLive&&this.corePlayer.audioPlayConsuming&&this.corePlayer.audioPlayConsuming.addRecvFrameData(s,s,y.a.now()),this.droppingSample&&this.droppingSample(d))return;this.printFirstAudioTs||(this.printFirstAudioTs=!0,f.a.log("FlvParser.parseAudio"+this.parseType,s)),this.pfaTs||(this.pfaTs=!0,f.a.log("FlvParser.parseAudio11"+this.parseType,s)),this.audioFps.addDts(s),this.corePlayer.curAudioDts=s,this.lastParseDts=s,this.corePlayer.pushAacSample(d,this.parseType)}else f.a.warn("FlvParser.parseAudio error aac packet type="+h)}validAacSample(t){let e=[];e=this.parseType==oe?this.corePlayer.ctrlBuffer.avBuffer.aShieldBuffer.samples:this.corePlayer.ctrlBuffer.avBuffer.aBuffer.samples;let i=e.length;if(i>0){let s=e[i-1];return 1===i&&s.ts>t&&s.ts-t>this.validAacTime?(e.shift(),!0):t-s.ts<this.validAacTime}return!0}getAdtsConfig(t,e,i){let s=0,r=null,a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("firefox")?e>=6?(t=5,r=new Array(4),s=e-3):(t=2,r=new Array(2),s=e):-1!==a.indexOf("android")?-1!==a.indexOf("mqqbrowser")?(t=2,r=new Array(2),s=e):(t=5,r=new Array(4),s=e):(t=5,r=new Array(4),s=e,e>=6?s=e-3:1===i&&(t=2,r=new Array(2),s=e)),this.audioSampleRate=Ge.AdtsSampleingRates[e],this.aacTimeLen=1024e3/this.audioSampleRate,f.a.log("FlvParser.getAdtsConfig audioSampleRate="+this.audioSampleRate+" aacTimeLen="+this.aacTimeLen),r[0]=t<<3,r[0]|=(14&e)>>1,r[1]=(1&e)<<7,r[1]|=i<<3,5===t&&(r[1]|=(14&s)>>1,r[2]=(1&s)<<7,r[2]|=8,r[3]=0),f.a.log("FlvParser.getAdtsConfig type="+t+" index="+e+" channel="+i+" exIndex="+s+" config="+r),r}parseOBUHeader(t){let e={};return e.obu_forbidden_bit=t>>7,e.obu_type=(120&t)>>3,e.obu_extension_flag=(4&t)>>2,e.obu_has_size_field=(2&t)>>1,e.obu_reserved_1bit=1&t,e}isHevc(){return 12==this.codec}isAv01(){return 13==this.codec}hevcFindNextStartCode(t,e){return 0===t[e]&&0===t[e+1]?1===t[e+2]?{found:!0,startCodeSize:3}:0===t[e+2]&&1===t[e+3]?{found:!0,startCodeSize:4}:{found:!1}:{found:!1}}isHevcNal(t,e){return 0===t[e]&&0===t[e+1]&&0===t[e+2]&&1===t[e+3]}isH264Sei(t){return 6==(31&t[0])}isH264Aud(t){return 9==(31&t[0])}isH264NALUPPS(t){return(31&t[0])==Ge.NALU_TYPE_PPS}isH264NALUPSPS(t){return(31&t[0])==Ge.NALU_TYPE_SPS}getCalculateVideoFramePlayDelay(){return 0}calcAudioFrameRate(t){this.audioFrameRateTs||(this.audioFrameRateTs=t,this.audioFrameCnt=0),t-this.audioFrameRateTs<1e3?this.audioFrameCnt++:(Number(localStorage._printAudioFrameRate)&&f.a.log("@@@@@@@@ audioFrameRate="+this.audioFrameCnt),this.audioFrameRateTs=t,this.audioFrameCnt=0)}beforeSwap(t,e,i){this.startDtsType=e,this.isSwap=!0,this.fromType=t,this.isFirstPrintVideoTs=!1,this.isFirstPrintAudioTs=!1,this.swapStartDts=i}getPcdnDisError(t){return(t<-100||t>100)&&(this.disError302(),!0)}}Ge.EVENTS={META_DATA:"meta_data",SWITCH_URL_DONE:"switch_url_done"},Ge.REMUX_TYPE_AUDIO=0,Ge.REMUX_TYPE_VIDEO=1,Ge.FLV_HEADER_LEN=9,Ge.TAG_HEADER_LEN=11,Ge.PREV_TAG_SIZE_LEN=4,Ge.AUDIO_TYPE=8,Ge.VIDEO_TYPE=9,Ge.SCRIPT_TYPE=18,Ge.SCRIPT_AMF1_HEAD_LEN=13,Ge.SCRIPT_AMF2_HEAD_LEN=5,Ge.IFRAME=1,Ge.NO_REFERENCE_FRAME=99,Ge.NAL_VPS=32,Ge.NAL_SPS=33,Ge.NAL_PPS=34,Ge.HEVC_NAL_AUD=35,Ge.HEVC_NAL_SEI=39,Ge.NAL_RASL_N=8,Ge.NAL_RASL_R=9,Ge.NALU_TYPE_SLICE=1,Ge.NALU_TYPE_DPA=2,Ge.NALU_TYPE_DPB=3,Ge.NALU_TYPE_DPC=4,Ge.NALU_TYPE_IDR=5,Ge.NALU_TYPE_SEI=6,Ge.NALU_TYPE_SPS=7,Ge.NALU_TYPE_PPS=8,Ge.NALU_TYPE_AUD=9,Ge.NALU_TYPE_EOSEQ=10,Ge.NALU_TYPE_EOSTREAM=11,Ge.NALU_TYPE_FILL=12,Ge.H265_SEI_HEAD=[44,162,222,9,181,23,71,219,187,85,164,254,127,194,252,78],Ge.AdtsSampleingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];var We=Ge;class $e{constructor(){this.fpsIndex=0,this.fpsArr=[],this.fpsMap=new Map,this.started=!1,this.realFps=0,this.recvFps=new bt(20),this.jumpRecvFps=new bt(2),this.perSecondIndex=0,this.perSecondArr=[],this.perSecondMap=new Map,this.recvFrames=0,this.lastRecvFrames=0,this.preRecvFrames=0,this.gopSize=0,this.noReferFrameNums=0,this.preNoReferFrameNums=0,this.noReferSize=0,this.fpsList=[]}getRecord(){let t=this.recvFrames-this.lastRecvFrames;return this.lastRecvFrames=this.recvFrames,t}reset(){this.fpsArr=[],this.fpsMap.clear(),this.started=!1,this.realFps=0,this.recvFps.reset(),this.jumpRecvFps.reset(),this.recvFrames=0,this.lastRecvFrames=0,this.preRecvFrames=0,this.gopSize=0,this.noReferFrameNums=0,q.remove(this.onFrameTimer,this),this.perSecondIndex=0,this.perSecondArr=[],this.perSecondMap.clear(),this.fpsList.length=0}onFrameTimer(t,e){this.recvFps.calculate(),this.jumpRecvFps.calculate()}addDts(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this.recvFrames++,this.recvFps.addCur(1),this.jumpRecvFps.addCur(1),this.started||(this.started=!0,q.add(this.onFrameTimer,this,1e3));let s=parseInt(t/1e3);if(this.fpsMap.has(s))this.fpsMap.set(s,this.fpsMap.get(s)+1);else{this.fpsIndex>=10&&(this.fpsIndex=0),this.calcRealFps();let t=this.fpsArr[this.fpsIndex];this.fpsList.length>=5&&this.fpsList.shift(),this.fpsMap.has(t)&&this.fpsList.push(this.fpsMap.get(t)),this.fpsMap.delete(t),this.fpsArr[this.fpsIndex]=s,this.fpsMap.set(s,1),this.fpsIndex++}e&&this.addDataSize(s,e),i===We.IFRAME?(this.preRecvFrames>0&&(this.gopSize=this.recvFrames-this.preRecvFrames),this.preNoReferFrameNums>0&&(this.noReferSize=this.noReferFrameNums-this.preNoReferFrameNums),this.preRecvFrames=this.recvFrames,this.preNoReferFrameNums=this.noReferFrameNums):i===We.NO_REFERENCE_FRAME&&this.noReferFrameNums++}calcNoRefFps(){if(0===this.noRefFps){let t=this.fpsArr[1];this.noRefFps=this.noRefFpsMap.get(t)}}calcRealFps(){if(this.fpsIndex>1){let t=this.fpsArr[this.fpsIndex-1];this.realFps=this.fpsMap.get(t)}}getRecvFps(){let t=this.recvFps.average();return t===R.b.UintMax?0:t}getJumRecvFps(){let t=this.jumpRecvFps.average();return t===R.b.UintMax?0:t}getFps(){if(this.fpsArr.length>1){let t=this.fpsArr[1],e=this.fpsMap.get(t),i=0,s=e;return $e.FIXED_FPS.forEach(t=>{let r=t>e?t-e:e-t;r<3&&(0===i||r<i)&&(i=r,s=t)}),s}return 0}getCalculate(){this.recvFps.calculate()}getNoReferFps(){return this.noReferSize>0&&this.gopSize>0&&this.getFps()>0?parseInt(this.noReferSize/this.gopSize*this.getFps()):0}addDataSize(t,e){if(this.perSecondMap.has(t))this.perSecondMap.set(t,this.perSecondMap.get(t)+e);else{this.perSecondIndex>=10&&(this.perSecondIndex=0);const i=this.perSecondArr[this.perSecondIndex];this.perSecondMap.delete(i),this.perSecondArr[this.perSecondIndex]=t,this.perSecondMap.set(t,e),this.perSecondIndex++}}getRealBitrate(){let t=0;const e=this.perSecondArr.length;if(e>1){const i=this.perSecondArr[e-2];t=this.perSecondMap.get(i)}return parseInt(8*t/1e3)}getGopSize(){return this.gopSize}getHeartReceiveFps(){if(this.fpsList.length>=5){return this.fpsList.reduce((t,e)=>t+e)/this.fpsList.length}return 0}}$e.FIXED_FPS=[0,15,20,24,30,40,48,60];var Ye=$e;class Ke{static init(){var t;for(t in Ke.types={av01:[],av1C:[],avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},Ke.types)Ke.types.hasOwnProperty(t)&&(Ke.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Ke.HDLR_TYPES={video:e,audio:i};var s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);Ke.STTS=Ke.STSC=Ke.STCO=r,Ke.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Ke.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Ke.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Ke.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),n=new Uint8Array([0,0,0,1]);Ke.FTYP=Ke.box(Ke.types.ftyp,a,n,a,o),Ke.DINF=Ke.box(Ke.types.dinf,Ke.box(Ke.types.dref,s))}static box(t){for(var e,i=Array.prototype.slice.call(arguments,1),s=8,r=i.length,a=r;r--;)s+=i[r].byteLength;for((e=new Uint8Array(s))[0]=s>>24&255,e[1]=s>>16&255,e[2]=s>>8&255,e[3]=255&s,e.set(t,4),r=0,s=8;r<a;r++)e.set(i[r],s),s+=i[r].byteLength;return e}static hdlr(t){return Ke.box(Ke.types.hdlr,Ke.HDLR_TYPES[t])}static mdat(t){return Ke.box(Ke.types.mdat,t)}static mdhd(t,e){return Ke.box(Ke.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))}static mdia(t){return Ke.box(Ke.types.mdia,Ke.mdhd(t.timescale,t.duration),Ke.hdlr(t.type),Ke.minf(t))}static mfhd(t){return Ke.box(Ke.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}static minf(t){return"audio"===t.type?Ke.box(Ke.types.minf,Ke.box(Ke.types.smhd,Ke.SMHD),Ke.DINF,Ke.stbl(t)):Ke.box(Ke.types.minf,Ke.box(Ke.types.vmhd,Ke.VMHD),Ke.DINF,Ke.stbl(t))}static moof(t,e,i){return Ke.box(Ke.types.moof,Ke.mfhd(t),Ke.traf(i,e))}static moov(t){for(var e=t.length,i=[];e--;)i[e]=Ke.trak(t[e]);return Ke.box.apply(null,[Ke.types.moov,Ke.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(Ke.mvex(t)))}static mvex(t){for(var e=t.length,i=[];e--;)i[e]=Ke.trex(t[e]);return Ke.box.apply(null,[Ke.types.mvex].concat(i))}static mvhd(t,e){var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,e>>24&255,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Ke.box(Ke.types.mvhd,i)}static sdtp(t){var e,i,s=t.samples||[],r=new Uint8Array(4+s.length);for(i=0;i<s.length;i++)e=s[i].flags,r[i+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return Ke.box(Ke.types.sdtp,r)}static stbl(t){return Ke.box(Ke.types.stbl,Ke.stsd(t),Ke.box(Ke.types.stts,Ke.STTS),Ke.box(Ke.types.stsc,Ke.STSC),Ke.box(Ke.types.stsz,Ke.STSZ),Ke.box(Ke.types.stco,Ke.STCO))}static av01(t){let e=t.bytes,i=t.width,s=t.height;return Ke.box(Ke.types.av01,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,s>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),Ke.box(Ke.types.av1C,e))}static avc1(t){var e,i,s,r=[],a=[];for(e=0;e<t.sps.length;e++)s=(i=t.sps[e]).byteLength,r.push(s>>>8&255),r.push(255&s),r=r.concat(Array.prototype.slice.call(i));for(e=0;e<t.pps.length;e++)s=(i=t.pps[e]).byteLength,a.push(s>>>8&255),a.push(255&s),a=a.concat(Array.prototype.slice.call(i));var o=Ke.box(Ke.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|t.sps.length].concat(r).concat([t.pps.length]).concat(a))),n=t.width,h=t.height;return Ke.box(Ke.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>8&255,255&n,h>>8&255,255&h,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),o,Ke.box(Ke.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}static hvc1(t){var e,i,s,r=[],a=[],o=[];for(r.push(160),r.push(t.vps.length>>>8&255),r.push(255&t.vps.length),e=0;e<t.vps.length;e++)s=(i=t.vps[e]).byteLength,r.push(s>>>8&255),r.push(255&s),r=r.concat(Array.prototype.slice.call(i));for(a.push(161),a.push(t.sps.length>>>8&255),a.push(255&t.sps.length),e=0;e<t.sps.length;e++)s=(i=t.sps[e]).byteLength,a.push(s>>>8&255),a.push(255&s),a=a.concat(Array.prototype.slice.call(i));let n=[],h=0;for(e=0;e<a.length;)i=a[e],2!==h||3!==i?(0===i?h++:h=0,n.push(i),++e):(++e,h=0);for(o.push(162),o.push(t.pps.length>>>8&255),o.push(255&t.pps.length),e=0;e<t.pps.length;e++)s=(i=t.pps[e]).byteLength,o.push(s>>>8&255),o.push(255&s),o=o.concat(Array.prototype.slice.call(i));const d=new Uint8Array([1,n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15],n[16],n[17],n[18],n[19],240,0,252,253,248,248,0,0,15].concat([3]).concat(r).concat(a).concat(o));var l=Ke.box(Ke.types.hvcC,d),u=t.width,c=t.height;return Ke.box(Ke.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),l,Ke.box(Ke.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}static esds(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))}static mp4a(t){var e=t.audiosamplerate;return Ke.box(Ke.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]),Ke.box(Ke.types.esds,Ke.esds(t)))}static stsd(t){return"audio"===t.type?Ke.box(Ke.types.stsd,Ke.STSD,Ke.mp4a(t)):t.isHevc?Ke.box(Ke.types.stsd,Ke.STSD,Ke.hvc1(t)):t.isAV01?Ke.box(Ke.types.stsd,Ke.STSD,Ke.av01(t)):Ke.box(Ke.types.stsd,Ke.STSD,Ke.avc1(t))}static tkhd(t){var e=t.id,i=t.duration,s=t.width,r=t.height;return Ke.box(Ke.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,r>>8&255,255&r,0,0]))}static traf(t,e){var i=Ke.sdtp(t),s=t.id;return Ke.box(Ke.types.traf,Ke.box(Ke.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),Ke.box(Ke.types.tfdt,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e])),Ke.trun(t,i.length+16+16+8+16+8+8),i)}static trak(t){return t.duration=t.duration||4294967295,Ke.box(Ke.types.trak,Ke.tkhd(t),Ke.mdia(t))}static trex(t){var e=t.id;return Ke.box(Ke.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,e){var i,s,r,a,o,n,h=t.samples||[],d=h.length,l=12+16*d,u=new Uint8Array(l);for(e+=8+l,u.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0),i=0;i<d;i++)r=(s=h[i]).duration,a=s.size,o=s.flags,n=s.cts,u.set([r>>>24&255,r>>>16&255,r>>>8&255,255&r,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,n>>>24&255,n>>>16&255,n>>>8&255,255&n],12+16*i);return Ke.box(Ke.types.trun,u)}static initSegment(t){Ke.types||Ke.init();var e,i=Ke.moov(t);return(e=new Uint8Array(Ke.FTYP.byteLength+i.byteLength)).set(Ke.FTYP),e.set(i,Ke.FTYP.byteLength),e}}var je=Ke,qe=i(8);var ze=class{constructor(t){this.mse=t,this.audioISGenerated=!1,this.videoISGenerated=!1,this.PES2MP4SCALEFACTOR=1,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR,this._forceFirstIDR=!(!qe.a.chrome||!(qe.a.version.major<50||50===qe.a.version.major&&qe.a.version.build<2661))}get timescale(){return this.MP4_TIMESCALE}get isWebglRender(){return this.mse.h265Proxy&&this.mse.h265Proxy.renderInited}destroy(){this.reset()}reset(){this.insertDiscontinuity(),this.switchLevel()}resetInitDts(){this._initPTS=this._initDTS=void 0}insertDiscontinuity(){this.nextAacPts=this.nextAvcDts=void 0}getInitDts(){return void 0!==this._initDTS?this._initDTS/90:void 0}switchLevel(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];f.a.log("mp4-remuxer.switchLevel"),t&&(this.videoISGenerated=!1),e&&(this.audioISGenerated=!1)}remux(t,e,i,s){Number(localStorage._printMp4Remux)&&f.a.debug("\n### Audio",t,"\n### Video",e),this.audioISGenerated||this.generateAudioIS(t,i),this.videoISGenerated||this.isWebglRender||this.generateVideoIS(e,i),this.initTs(t,e,i),e.samples.length&&(this.isWebglRender?this.renderVideo(e,s):this.remuxVideo(e,s)),t.samples.length&&this.remuxAudio(t,s),this.mse.onFragParsed()}initTs(t,e,i){if(null!=this._initPTS)return;let s=t.samples,r=e.samples,a=s.length,o=r.length,n=this.PES_TIMESCALE;0===a&&0===o?f.a.warn("mp4-remuxer.initTs have no nbAudio&nbVideo"):0===o?(this._initPTS=s[0].pts-n*i,this._initDTS=s[0].dts-n*i):0===a?(this._initPTS=r[0].pts-n*i,this._initDTS=r[0].dts-n*i):(this._initPTS=Math.min(r[0].pts,s[0].pts)-n*i,this._initDTS=Math.min(r[0].dts,s[0].dts)-n*i),f.a.log(`mp4-remuxer initDTS/initPTS=[${this._initDTS}, ${this._initPTS}]`)}generateAudioIS(t,e){if(t.config){let e={audioMoov:je.initSegment([t]),audioCodec:t.codec,audioChannelCount:t.channelCount};this.mse.onInitSegment(e),this.audioISGenerated=!0}}generateVideoIS(t,e){if(t.isAV01||t.sps&&t.pps){let e={videoMoov:je.initSegment([t]),videoCodec:t.codec,videoWidth:t.width,videoHeight:t.height};this.mse.onInitSegment(e),this.videoISGenerated=!0}}remuxVideo(t,e){let i,s,r,a,o,n,h,d,l,u,c,p,m,_,g,S=8,T=this.PES2MP4SCALEFACTOR,E=[],v=t.isAV01?0:4*t.naluCnt;for(h=new Uint8Array(t.len+v+8),i=new DataView(h.buffer),i.setUint32(0,h.byteLength),h.set(je.types.mdat,4);t.samples.length;){for(r=t.samples.shift(),o=0;r.units.length;)n=r.units.shift(),s=n.data.byteLength,"av01"!=r.type&&(i.setUint32(S,s),S+=4,o+=4),h.set(n.data,S),S+=s,o+=s;if(p=r.pts-this._initDTS,m=r.dts-this._initDTS,(m<0||p<0)&&Number(localStorage._printMp4RemuxVideo)&&f.a.log(`mp4-remuxer.remuxVideo warn dts=${m}, pts=${p}`),void 0!==c)_=this._PTSNormalize(p,c),g=this._PTSNormalize(m,c),a.duration=(g-c)/T,a.duration<0&&(Number(localStorage._printMp4RemuxVideo)&&f.a.warn("mp4-remuxer.remuxVideo invalid sample duration at pts="+r.pts/90+" dts="+r.dts/90+" duration="+a.duration/90),a.duration=0,g=c);else{let t,i=this.nextAvcDts||m;_=this._PTSNormalize(p,i),g=this._PTSNormalize(m,i),t=Math.round((g-i)/90),(e||Math.abs(t)<600)&&t&&(t>1&&Number(localStorage._printMp4RemuxVideo)?f.a.warn("mp4-remuxer.remuxVideo hole="+t+" filling it"):t<-1&&Number(localStorage._printMp4RemuxVideo)&&f.a.warn("mp4-remuxer.remuxVideo overlapping="+-t+" detected"),g=i,_=Math.max(_-t,g)),l=Math.max(0,_),u=Math.max(0,g)}let d=r.key;a={size:o,duration:0,cts:(_-g)/T,flags:{isLeading:0,degradPrio:0,hasRedundancy:0,dependsOn:d?2:1,isDependedOn:d?1:0,isNonSync:d?0:1}},E.push(a),c=g,this.mse.isLive&&this.mse.videoPlayConsuming.addRemuxFrameData(r.ts,r.ts+r.cts,y.a.now())}this._forceFirstIDR&&(E[0].flags.dependsOn=2,E[0].flags.isNonSync=0),void 0!==t.endDts?(a.duration=(90*t.endDts-this._initDTS-g)/T,a.duration<0?(a.duration=0,this.nextAvcDts=g):this.nextAvcDts=90*t.endDts-this._initDTS):(E.length>=2&&(a.duration=E[E.length-2].duration),this.nextAvcDts=g+a.duration*T),t.len=0,t.naluCnt=0,t.samples=E,d=je.moof(t.sn,u/T,t),t.samples=[];let C={type:"video",data:this._mergeBoxes(d,h)};this.mse.onFragParsing(C)}remuxAudio(t,e){let i,s,r,a,o,n,h,d,l,u,c,p,m,_=8,g=this.PES_TIMESCALE,S=this.PES2MP4SCALEFACTOR,T=[];for(o=new Uint8Array(t.len+8),i=new DataView(o.buffer),i.setUint32(0,o.byteLength),o.set(je.types.mdat,4);t.samples.length;){if(s=t.samples.shift(),a=s.unit,o.set(a,_),_+=a.byteLength,u=s.pts-this._initDTS,c=s.dts-this._initDTS,void 0!==l)p=this._PTSNormalize(u,l),m=this._PTSNormalize(c,l),r.duration=(m-l)/S,P.a.popSize0Brows.map(t=>{const e=t[0],i=t[1];qe.a.name==e&&qe.a.version.major>=i&&s.sampleDuration&&(r.duration=90*Math.ceil(s.sampleDuration))}),r.duration<0&&(Number(localStorage._printMp4RemuxAudio)&&f.a.warn("mp4-remuxer.remuxAudio invalid AAC sample duration at PTS="+s.pts+" duration="+r.duration),r.duration=0,p=m=l);else{let t,i=this.nextAacPts||u;p=this._PTSNormalize(u,i),m=this._PTSNormalize(c,i),t=Math.round(1e3*(p-i)/g),(e||Math.abs(t)<600)&&t&&(p=m=i),h=Math.max(0,p),d=Math.max(0,m)}r={size:a.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(r),l=m,this.mse.isLive&&this.mse.audioPlayConsuming.addRemuxFrameData(s.ts,s.ts,y.a.now())}T.length>=2&&(r.duration=T[T.length-2].duration),this.nextAacPts=p+r.duration*S,t.len=0,t.samples=T,n=je.moof(t.sn,d/S,t),t.samples=[];let E={type:"audio",data:this._mergeBoxes(n,o)};this.mse.onFragParsing(E)}renderVideo(t,e){if(this.mse.isLive)for(let e=0;e<t.samples.length;e++){const i=t.samples[e];this.mse.videoPlayConsuming.addRemuxFrameData(i.ts,i.ts+i.cts,y.a.now())}this.mse.h265Proxy.pushVideoFrame(t,e)}_mergeBoxes(t,e){let i=new Uint8Array(t.byteLength+e.byteLength);return i.set(t,0),i.set(e,t.byteLength),i}_PTSNormalize(t,e){let i;if(void 0===e)return t;for(i=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=i;return t}};class Je{static getSilentFrame(t,e){if(2===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}static setWebcodeccEmptyFrame(t){Je.webcodeccEmptyFrame=t.toLocaleString().split(",")}}Je.emptyAacFrameAdts=[255,241,92,64,18,64,252,0,208,32,6,238,90,119,128,0,128,0,0,0,0,26,37,65,0,13,237,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28],Je.emptyAacFrame=[0,208,32,6,238,90,119,128,0,128,0,0,0,0,26,37,65,0,13,237,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28],Je.emptyAacFrame_44_1=[1,64,34,128,163,78,129,64,0,0,0,0,4,96,6,246,81,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94],Je.webcodeccEmptyFrame=null;var Qe=Je,Xe={CODE:1,PRIORITY:11},Ze={CODE:13,PRIORITY:8},ti={CODE:14,PRIORITY:9},ei={CODE:15,PRIORITY:10},ii={CODE:18,PRIORITY:5},si={CODE:19,PRIORITY:3},ri={CODE:20,PRIORITY:4},ai={CODE:21,PRIORITY:2},oi={CODE:22,PRIORITY:1};var ni={ptsJumpTest:!1,jumpConfigs:null,initPts:0,audioTimeOffset:0,videoTimeOffset:0};class hi{constructor(t){this.tsParser=t,this._init()}_init(){this._preAudioDts=0,this._preVideoDts=0,this._audioDtsVec=[],this._videoDtsVec=[],this.aJumpDtsVec=[],this.vJumpDtsVec=[],this.audioFixTimes=0,this.videoFixTimes=0,this._aFrameDuration=0,this._vFrameDuration=0}reset(){this._init()}getFrameDuration(t){let e="video"===t?this._videoDtsVec:this._audioDtsVec;if(e.length<4)return e[0]||0;let i=0,s=[];e.forEach((t,e)=>{e>0&&s.push(Math.abs(t-i)),i=t}),s.sort((t,e)=>t-e),s.pop(),s.shift();const r=s.reduce((t,e)=>e+t);return Math.ceil(r/s.length)}setPreAudioDts(t){this._preAudioDts=t}setPreVideoDts(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._preVideoDts=t}checkAudioDts(t){this._preAudioDts||(this._preAudioDts=t);Math.abs(t-this._preAudioDts)/90>hi.ErrorDtsThreshold&&(1===Number(localStorage._print_dts_fix)&&f.a.log(`%cVodDtsJumpHelper.checkAudioDts audio dts jump dts=${t}, preDts=${this._preAudioDts}`,"color:#50c1d8"),this.aJumpDtsVec.push(this._preAudioDts)),this._preAudioDts=t,this._audioDtsVec.length<=11&&(this._audioDtsVec.push(t),this._aFrameDuration=this.getFrameDuration("audio")||0)}checkVideoDts(t){this._preVideoDts||(this._preVideoDts=t);Math.abs(t-this._preVideoDts)/90>hi.ErrorDtsThreshold&&(1===Number(localStorage._print_dts_fix)&&f.a.log(`%cVodDtsJumpHelpercheckVideoDts video dts jump dts=${t}, preDts=${this._preVideoDts}`,"color:#50c1d8"),this.vJumpDtsVec.push(this._preVideoDts)),this._preVideoDts=t,this._videoDtsVec.length<=11&&(this._videoDtsVec.push(t),this._vFrameDuration=this.getFrameDuration("video")||0)}dtsJumpFix(t,e){let i=0,s=0;this.aJumpDtsVec.length>0&&this.vJumpDtsVec.length>0&&(i=this.aJumpDtsVec[0],s=this.vJumpDtsVec[0]);const r=t.samples;let a=0,o=0;for(let t=0;t<r.length;t++){const n=r[t];if("video"===e){if(o=this._vFrameDuration,a=this._preVideoDts,s&&a>s)break}else if(o=this._aFrameDuration,a=this._preAudioDts,i&&a>i)break;if(Math.abs(n.dts-a)/90>hi.ErrorDtsThreshold){let t=parseInt(a+o);const i=n.dts-t;if(n.dts=n.dts-i,n.pts=n.pts-i,1===Number(localStorage._print_dts_fix)){const s=t-a;f.a.log(`VodDtsJumpHelper.dtsJumpFix fixed type=${e} pts=${n.pts} dts=${n.dts} cts=${n.pts-n.dts} gap=${s} delta=${i}`)}"video"===e?this.videoFixTimes++:this.audioFixTimes++}"video"===e?this._preVideoDts=n.dts:this._preAudioDts=n.dts}}dtsAmend(t,e){let i=hi.FrameThreshold,s=this.aJumpDtsVec.length,r=this.vJumpDtsVec.length;if(s>0&&r>0){let a=this.aJumpDtsVec.shift(),o=this.vJumpDtsVec.shift(),n=a-this.audioDtsDelta,h=o-this.videoDtsDelta;for(;s>0&&r>0;){const d=(n-h)/90;if(d<-i)a=this.aJumpDtsVec.shift(),n=a-this.audioDtsDelta;else if(d>i)o=this.vJumpDtsVec.shift(),h=o-this.videoDtsDelta;else if(d>=-i&&d<=i){this.setPreAudioDts(a),this.setPreVideoDts(o),this.dtsJumpFix(t,"audio"),this.dtsJumpFix(e,"video"),1===Number(localStorage._print_dts_fix)&&f.a.log("%cTsParse._dtsJumpFix fix pts jump","color:#8d3333;background:#FFF5C2");break}s=this.aJumpDtsVec.length,r=this.vJumpDtsVec.length}}else if(s>0){if(e.samples.length<=0)return!0;const t=this.aJumpDtsVec[0],s=e.samples[e.samples.length-1].dts;if(t>s)return 1===Number(localStorage._print_dts_fix)&&f.a.log("TsParser._dtsJumpFix waiting avc jump dts"),!0;if(t<=s&&(s-t)/90<i)return!0}else if(r>0){if(t.samples.length<=0)return!0;const e=this.vJumpDtsVec[0],s=t.samples[t.samples.length-1].dts;if(e>s)return 1===Number(localStorage._print_dts_fix)&&f.a.log("TsParser._dtsJumpFix waiting aac jump dts"),!0;if(e<=s&&(s-e)/90<i)return!0}return!1}get audioDtsDelta(){return this._aFrameDuration*this.audioFixTimes}get videoDtsDelta(){return this._vFrameDuration*this.videoFixTimes}get aFrameDuration(){return this._vFrameDuration}get vFrameDuration(){return this._aFrameDuration}get frameDuration(){return Math.max(this.aFrameDuration,this.vFrameDuration)}}hi.ErrorDtsThreshold=1e3,hi.FrameThreshold=200;var di=hi;const li=98,ui=99;class ci{constructor(t,e){this.mse=t,this.remuxer=e,this.width=0,this.height=0,this.lastSN=0,this.lastLevel=0,this.PES_TIMESCALE=9e4,this.lastTsData=null,this.lastPos=0,this.hasRemux=!1,this.fragStartTs=0,this.ignoreSei=!1,this.closeFetch=!1,this.vFps=new Ye,this.aFps=new Ye,this._initPts=Number.MAX_SAFE_INTEGER,this._initDts=Number.MAX_SAFE_INTEGER,this.nextAudioPts=0,this.isHevc=!1,this.codec=ye,this.vodDtsJumpHelper=new di(this),this.isNoAudio=!0,this.hevcSpsParser=new re,this.hevcCodec="",this.avcCodec="",this.lastTs=0,this.timeOffset=0,this.continuousTimeStamp=!1,this.videoStartPts=Number.MAX_SAFE_INTEGER,this.videoStartDts=Number.MAX_SAFE_INTEGER,this.audioStartPts=Number.MAX_SAFE_INTEGER,this.audioStartDts=Number.MAX_SAFE_INTEGER}getCodecType(){return this.codec}getFps(){return this.vFps&&this.vFps.getFps()}getAudioFps(){return this.aFps&&this.aFps.getFps()}getStartTs(){return this.fragStartTs}destroy(){this.switchLevel(),this.duration=0}probe(t){return t.length>=564&&71===t[0]&&71===t[188]&&71===t[376]}resetAVData(){this._avcTrack&&(this._avcTrack.len=0,this._avcTrack.naluCnt=0,this._avcTrack.samples=[]),this._aacTrack&&(this._aacTrack.len=0,this._aacTrack.samples=[])}pushAllData(){this._avcTrack&&this._avcTrack.sn>0&&this.remuxTs(this._aacTrack,this._avcTrack,this._avcTrack.sn)}parseAllData(){let t=!1;if(this._avcTrack){let e=this._avcTrack.pesData,i=this._aacTrack.pesData,s=this._id3Track.pesData,r=this.continuousTimeStamp?this.timeOffset:0;e&&(this._parseAVCPES(this._parsePES(e,r,0,0,1)),t=!0),i&&this._parseAACPES(this._parsePES(i,r,0,0,2)),s&&this._parseID3PES(this._parsePES(s,r,0,0,3)),this._avcTrack.pesData=void 0,this._aacTrack.pesData=void 0,this._id3Track.pesData=void 0}return t}switchLevel(){let t=this.createTrack;!this._avcTrack&&(this._avcTrack=t("video")),!this._aacTrack&&(this._aacTrack=t("audio")),!this._id3Track&&(this._id3Track=t("id3")),this.pmtParsed=!1,this._pmtId=-1,this.isHevc=!1,this.remuxer.switchLevel()}createTrack(t){return{type:t,id:-1,sn:0,samples:[],len:0,naluCnt:0}}insertDiscontinuity(t){f.a.log("TsParser.insertDiscontinuity timeOffset="+t),this.resetTsData(),this.switchLevel(),this.remuxer.insertDiscontinuity(),this.mse.insertDiscontinuity&&this.mse.insertDiscontinuity(t)}reset(){this.vFps.reset(),this.aFps.reset(),this.resetTsData(),this.hasRemux=!1,this.lastTsData=null,this._avcTrack&&(this._avcTrack.sps=null,this._avcTrack.pps=null,this._avcTrack.len=0,this._avcTrack.naluCnt=0,this._avcTrack.samples=[]),this._aacTrack&&(this._aacTrack.len=0,this._aacTrack.naluCnt=0,this._aacTrack.samples=[]),this.vodDtsJumpHelper.reset()}resetTsData(){let{_avcTrack:t,_aacTrack:e,_id3Track:i}=this;e&&(t.pesData=null,e.pesData=null,i.pesData=null,this.lastTsData=null),this.fragStartTs=0}appendTsData(t,e){let i;e&&this.resetTsData(),t instanceof Uint8Array||(t=new Uint8Array(t));let s=this.lastTsData,r=this.lastPos;if(s){let e=s.byteLength-r,a=e+t.byteLength;i=new Uint8Array(a),i.set(s.slice(r),0),i.set(t,e)}else i=t;return this.lastPos=0,this.lastTsData=i,i}syncOffset(t){let e=Math.min(188,t.length-564),i=0;for(;i<e;){if(71===t[i]&&71===t[i+188]&&71===t[i+376])return i;i++}return-1}parseTs(t){let{data:e,audioCodec:i,videoCodec:s,timeOffset:r,duration:a,discontinuity:o,_discontinuity:n,level:h,sn:d,seeking:l,hlsDT:u,tsDT:c}=t;this.contiguous=!1,o||n?(f.a.log("TsParser.parseTs discontinuity detected timeOffset="+r),this.continuousTimeStamp||this.insertDiscontinuity(r)):h!==this.lastLevel?(f.a.log("TsParser.parseTs level switch detected"),this.switchLevel(),this.lastLevel=h):d===this.lastSN+1&&(this.contiguous=!0),e=this.appendTsData(e,l,d);var p=e.length;this.audioCodec=i,this.videoCodec=s,r!==this.timeOffset&&(this.videoStartDts=Number.MAX_SAFE_INTEGER,this.videoStartPts=Number.MAX_SAFE_INTEGER,this.audioStartDts=Number.MAX_SAFE_INTEGER,this.audioStartPts=Number.MAX_SAFE_INTEGER),this.timeOffset=r,this.duration=a,this.lastSN=d,this.contiguous||(this.aacOverFlow=null),this._avcTrack||this.insertDiscontinuity(r);let m=this.syncOffset(e);if(m<0)return;this.lastPos=p-=(p+m)%188,p===e.length&&(this.lastTsData=null);let _=this._avcTrack,g=this._aacTrack,S=this._id3Track,T=this.pmtParsed,y=_.pesData,E=g.pesData,v=S.pesData,C=_.id,P=g.id,D=S.id;var I,A,R,O,w;try{for(var L=m;L<p;L+=188)if(71===e[L]){if(I=!!(64&e[L+1]),A=((31&e[L+1])<<8)+e[L+2],(48&e[L+3])>>4>1){if((R=L+5+e[L+4])===L+188)continue}else R=L+4;if(T)if(O=(w=L+188)-R,A===C){if(this.mse.isPureAudio)continue;I&&(y&&this._parseAVCPES(this._parsePES(y,r,u,c,1)),y={data:[],size:0}),y&&(y.data.push(e.subarray(R,w)),y.size+=O)}else if(A===P){if(this.mse.isPureVideo)continue;I&&(E&&(this._parseAACPES(this._parsePES(E,r,u,c,2)),!this.closeFetch&&!this.hasRemux&&_.samples.length>1&&this.remuxTs(g,_,d)),E={data:[],size:0}),E&&(E.data.push(e.subarray(R,w)),E.size+=O)}else A===D&&(I&&(v&&this._parseID3PES(this._parsePES(v,r,u,c,3)),v={data:[],size:0}),v&&(v.data.push(e.subarray(R,w)),v.size+=O));else I&&(R+=e[R]+1),0===A?this._parsePAT(e,R):A===this._pmtId&&(this._parsePMT(e,R),T=this.pmtParsed=!0,C=this._avcTrack.id,P=this._aacTrack.id,D=this._id3Track.id)}else f.a.error("TsParser.parseTs ERROR: TS packet did not start with 0x47"),this.mse&&this.mse.onParseError(li)}catch(t){f.a.error("TsParser.parseTs error:",t)}if(y&&(_.pesData=y),E&&(g.pesData=E),v&&(S.pesData=v),g.samples.length>1||this.maxVideo()||this.mse.isPureAudio&&g.samples.length>0||this.mse.isPureVideo&&_.samples.length>0){if(0===g.samples.length&&"firefox"===qe.a.name&&this.mse.reloadInError&&!this.mse.isLive)return void this.mse.reloadInError();_.width=this.width,_.height=this.height,this.remuxTs(g,_,d)}}maxVideo(){let t=this._avcTrack;if(t.samples.length>1){let e=t.samples[0];return(t.samples[t.samples.length-1].dts-e.dts)/90>2e3}return!1}remuxTs(t,e,i){e.codec=this.isHevc?this.hevcCodec:this.avcCodec,e.width=this.width,e.height=this.height,e.isHevc=this.isHevc,t.sn=e.sn=i,this.hasRemux=!0,t.samples&&t.samples.length>0&&(this.isNoAudio=!1,this.mse.setNoAuido(!1));try{if(!this.mse.isLive&&!this.mse.isPureVideo){if(P.a.vodDtsFixCfg[1]&&this.vodDtsJumpHelper.dtsAmend(t,e))return void f.a.log("Tsparser.remuxTs found pts jump, waiting fix");this.remuxAudio(t,e.samples.length>0)}this.mse.webcodecType==D.a.PLAYER_CORE_TYPE.MSE?this.remuxer.remux(t,e,this.timeOffset,this.contiguous):(this.mse.initTs&&this.mse.initTs(e,t,this.timeOffset),this.mse.appendAvcTrack(e),this.mse.appendAacSample(t)),this.mse.isLive||wt.getFirstFragStatus()===vt&&wt.setFirstFragStatus(Ct)}catch(t){f.a.error("remux ts error: ",t.message,t),this.mse&&this.mse.onParseError(li)}}remuxAudio(t,e){const i=9216e4/t.audiosamplerate;0==this.nextAudioPts&&(this.nextAudioPts=this._initPts);let s=this.nextAudioPts;const r=t.samples;for(let a=0,o=s;a<r.length;a++){const n=r[a].pts,h=n-o,d=Math.abs(1e3*h/t.timescale);if(h<=-i&&e)0===a&&(f.a.warn(`Audio frame @ ${(n/t.timescale).toFixed(3)}s \n                        overlaps nextAudioPts by ${Math.round(1e3*h/t.timescale)} ms.`),this.nextAudioPts=s=o=n);else if(h>i&&d<1e4&&e){let e=Math.round(h/i);o=n-e*i,o<0&&(e--,o+=i),0===a&&(this.nextAudioPts=s=o),f.a.warn(`[mp4-remuxer]: Injecting ${e} audio frame nextPts=${o} @ ${(o/t.timescale).toFixed(3)}s \n                    due to ${Math.round(1e3*h/t.timescale)} ms gap.`);for(let s=0;s<e;s++){const e=Math.max(o,0);let s=Qe.getSilentFrame(t.config[0],t.channelCount),n={unit:s,pts:Math.round(e),dts:Math.round(e)};r.splice(a,0,n),t.len+=s.length,o+=i,a++}}o+=i,this.nextAudioPts=o}}_updateInitPts(t,e){this._initPts===Number.MAX_SAFE_INTEGER&&(this.continuousTimeStamp?(this._initPts=t-9e4*this.timeOffset,this._initDts=e-9e4*this.timeOffset):(this._initPts=t,this._initDts=e),ni.initPts||(ni.initPts=this._initPts),f.a.log(`Tsparser.remuxTs initPts=${this._initPts} Global initPts=${ni.initPts}`))}_parsePAT(t,e){var i=t[e+8]<<8|t[e+9];1==i&&(this._pmtId=(31&t[e+10])<<8|t[e+11]),f.a.log(`TsParser._parsePAT program_number=${i} pmtId=${this._pmtId}`)}_parsePMT(t,e){var i=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<i;){var s=t[e],r=(31&t[e+1])<<8|t[e+2];switch(s){case 15:this._aacTrack.id=r;break;case 21:this._id3Track.id=r;break;case 27:this._avcTrack.id=r;break;case 36:this._avcTrack.id=r,this.isHevc=!0,this.codec=Ee;break;default:f.a.log("unkown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}f.a.log(`TsParser._parsePMT aacTrack.id=${this._aacTrack.id} avcTrack.id=${this._avcTrack.id}`)}_parsePES(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4?arguments[4]:void 0;var a=t.data[0];if(1!=(a[0]<<16)+(a[1]<<8)+a[2])return null;var o,n,h=(a[4]<<8)+a[5],d=a[7];192&d&&(o=536870912*(14&a[9])+4194304*(255&a[10])+16384*(254&a[11])+128*(255&a[12])+(254&a[13])/2,n=64&d?536870912*(14&a[14])+4194304*(255&a[15])+16384*(254&a[16])+128*(255&a[17])+(254&a[18])/2:o),this.continuousTimeStamp&&(1===r?(this.videoStartDts===Number.MAX_SAFE_INTEGER&&(this.videoStartPts=o,this.videoStartDts=n),this._initPts!==Number.MAX_SAFE_INTEGER&&(o=this._initPts+9e4*e+(o-this.videoStartPts),n=this._initDts+9e4*e+(n-this.videoStartDts))):2===r&&(this.audioStartDts===Number.MAX_SAFE_INTEGER&&(this.audioStartPts=o,this.audioStartDts=n),this._initPts!==Number.MAX_SAFE_INTEGER&&(o=this._initPts+9e4*e+(o-this.audioStartPts),n=this._initDts+9e4*e+(n-this.audioStartDts))));var l=a[8]+9;t.data[0]=t.data[0].subarray(l),t.size-=l;for(var u=0,c=new Uint8Array(t.size);t.data.length;)a=t.data.shift(),c.set(a,u),u+=a.byteLength;return s>i&&s-i-1e3*e>0&&(o-=90*(s-i-1e3*e),n-=90*(s-i-1e3*e)),{data:c,pts:o,dts:n,len:h}}_parseAVCPES(t){if(null==t)return f.a.error("TsParser._parseAVCPES pes is null."),void(this.mse&&this.mse.onParseError(li));!this.mse.isLive&&ni.ptsJumpTest&&this._dtsJumpSimulate(t,"video"),0===this.fragStartTs&&(this.fragStartTs=t.pts/this.PES_TIMESCALE);var e,i=this._avcTrack,s=i.samples,r=this._parseAVCNALu(t.data),a=[],o=0;0===r.length&&s.length>0&&this._pushToPreUnit(t.data),t.data=null;var n=!1,h=!1,d=!1,l="";if(this.isHevc){for(let t of r){switch(t.type){case ci.HEVC_NAL_VPS:!0,h=!0,d=!0,i.vps||(i.vps=[t.data]);break;case ci.HEVC_NAL_SPS:if(!0,h=!0,d=!0,!i.sps){i.sps=[t.data],i.timescale=this.remuxer.timescale,i.duration=this.remuxer.timescale*this.duration,this.spsConfig={},this.hevcSpsParser.parseSequenceParameterSet(t.data,t.data.length,this.spsConfig);let e=this.spsConfig.profile_space,s=this.spsConfig.profile_idc,r=this.spsConfig.profile_compatibility_flags;r=r>>1&1431655765|(1431655765&r)<<1,r=r>>2&858993459|(858993459&r)<<2,r=r>>4&252645135|(252645135&r)<<4,r=r>>8&16711935|(16711935&r)<<8,r=r>>16|r<<16;let a=this.spsConfig.tier_flag,o=this.spsConfig.level_idc;this.hevcCodec="hvc1."+["","A","B","C"][e%4]+s.toString()+"."+r.toString(16).toLowerCase()+"."+["L","H"][a%2]+o.toString(),this.width==this.spsConfig.width&&this.height==this.spsConfig.height||this.mse.updateAVCConfig&&this.mse.updateAVCConfig({width:this.spsConfig.width,height:this.spsConfig.height}),this.width=i.width=this.spsConfig.width,this.height=i.height=this.spsConfig.height,this.mse.setAvcCfg(this.width,this.height)}break;case ci.HEVC_NAL_PPS:!0,h=!0,d=!0,i.pps||(i.pps=[t.data]);break;case 19:!0,h=!0,d=!0,n=!0,i.idr=!0;break;case 20:h=!0,d=!0,n=!0,i.idr=!0;break;case ci.HEVC_NAL_AUD:h=!1,d=!0;break;case 39:case 40:h=!0,d=!0,(this.ignoreSei||1==localStorage._noSei)&&(h=!1);break;case 0:case 1:case 12:h=!0,d=!0;break;default:h=!1,l+="unknown NAL "+t.type+" "}h&&(a.push(t),o+=t.data.byteLength)}if(l.length,i.idr&&this.mse.setExceptionStat(L.a.DIM_LINK_STA.VIDEO_IFRAME,1),i.codec&&this.mse.setExceptionStat(L.a.DIM_LINK_STA.VIDEO_CONFIG,1),a.length&&(!0===n||i.sps)){if(e={type:"hvc",units:a,dts:t.dts,pts:t.pts,key:n,ts:t.dts/90,cts:(t.pts-t.dts)/90,videoCodec:this.hevcCodec,videoWidth:this.width,videoHeight:this.height},n&&(e.ppsUnit=[{length:i.pps[0].length,nalu:i.pps[0]}],e.spsUnit=[{length:i.sps[0].length,nalu:i.sps[0]}],e.vpsUnit=[{length:i.vps[0].length,nalu:i.vps[0]}]),s.push(e),i.len+=o,i.naluCnt+=a.length,this._updateInitPts(e.pts,e.dts),this.vodDtsJumpHelper.checkVideoDts(e.dts),1==localStorage._printVideoTs){const e=parseInt(t.dts-90*this.mse.curVideoDts),i=parseInt((t.pts-ni.initPts)/90);f.a.debug(`%cTsParser.parseAvcPes ts=${t.dts/90} dts=${t.dts} pts=${t.pts} cts=${t.pts-t.dts} gap=${e} timeoffset=${i}`,"color:green")}this.mse&&(this.mse.curVideoDts=t.dts/90,this.mse.setExceptionStat(L.a.DIM_LINK_STA.VIDEO_FRAME,1)),this.vFps.addDts(t.dts/90)}}else{for(let t of r){switch(t.type){case 1:h=!0,d=!0;break;case 5:!0,h=!0,d=!0,n=!0,i.idr=!0;break;case 6:h=!0,d=!0,(this.ignoreSei||1==localStorage._noSei)&&(h=!1);break;case 7:if(!0,h=!0,d=!0,!i.sps){i.sps=[t.data],i.timescale=this.remuxer.timescale,i.duration=this.remuxer.timescale*this.duration;var u=new Nt(t.data).readSPS();this.width==u.width&&this.height==u.height||this.mse.updateAVCConfig&&this.mse.updateAVCConfig({width:u.width,height:u.height}),this.width=i.width=u.width,this.height=i.height=u.height,this.mse.setAvcCfg(this.width,this.height);for(var c=t.data.subarray(1,4),p="avc1.",m=0;m<3;m++){var _=c[m].toString(16);_.length<2&&(_="0"+_),p+=_}i.codec=p,this.avcCodec=p}break;case 8:!0,h=!0,d=!0,i.pps||(i.pps=[t.data]);break;case 9:h=!0,d=!0,1!=localStorage._noAud&&this.mse.getCodecType()!=D.a.PLAYER_CORE_TYPE.WEBCODECS||(h=!1);break;case 12:h=!0,d=!0;break;default:h=!1,l+="unknown NAL "+t.type+" "}h&&(a.push(t),o+=t.data.byteLength)}if(l.length,i.idr&&this.mse.setExceptionStat(L.a.DIM_LINK_STA.VIDEO_IFRAME,1),i.codec&&this.mse.setExceptionStat(L.a.DIM_LINK_STA.VIDEO_CONFIG,1),i.sps&&i.pps&&!i.idr)return;if(a.length&&d){const r=t.dts/90;if(e={type:"avc",units:a,dts:t.dts,pts:t.pts,key:n,ts:r,cts:(t.pts-t.dts)/90,videoCodec:this.avcCodec,videoWidth:this.width,videoHeight:this.height},this.lastTs=r,n&&(e.ppsUnit=[{length:i.pps[0].length,nalu:i.pps[0]}],e.spsUnit=[{length:i.sps[0].length,nalu:i.sps[0]}]),s.push(e),i.len+=o,i.naluCnt+=a.length,this._updateInitPts(e.pts,e.dts),this.vodDtsJumpHelper.checkVideoDts(e.dts),1==localStorage._printVideoTs){const e=parseInt(t.dts-90*this.mse.curVideoDts),i=parseInt((t.pts-ni.initPts)/90);f.a.debug(`%cTsParser.parseAvcPes ts=${t.dts/90} dts=${t.dts} pts=${t.pts} cts=${t.pts-t.dts} gap=${e} timeoffset=${i}`,"color:green")}this.mse&&(this.mse.curVideoDts=t.dts/90,this.mse.setExceptionStat(L.a.DIM_LINK_STA.VIDEO_FRAME,1)),this.vFps.addDts(t.dts/90)}}}_parseAVCNALu(t){for(var e,i,s,r,a,o,n=0,h=t.byteLength,d=0,l=[];n<h;)switch(e=t[n++],d){case 0:0===e&&(d=1);break;case 1:d=0===e?2:0;break;case 2:case 3:0===e?d=3:1===e?(r=this.isHevc?(126&t[n])>>1:31&t[n],a?(s={data:t.subarray(a,n-d-1),type:o},l.push(s)):(i=n-d-1)&&this._pushToPreUnit(t.subarray(0,i)),n<h?(a=n,o=r,d=0):d=-1):d=0}return a&&(s={data:t.subarray(a,h),type:o},l.push(s)),l}_pushToPreUnit(t){var e=this._avcTrack.samples.length;if(0!=e){var i=this._avcTrack.samples[e-1],s=i.units[i.units.length-1],r=new Uint8Array(s.data.byteLength+t.byteLength);r.set(s.data,0),r.set(t,s.data.byteLength),s.data=r,this._avcTrack.len+=t.byteLength}}_parseAACPES(t){if(null==t)return f.a.error("TsParser._parseAACPES pes is null."),void(this.mse&&this.mse.onParseError(li));var e,i,s,r,a,o,n,h,d=this._aacTrack,l=t.data,u=l.length,c=0;if(this.aacOverFlow){var p=new Uint8Array(this.aacOverFlow.byteLength+l.byteLength);p.set(this.aacOverFlow,0),p.set(l,this.aacOverFlow.byteLength),l=p,this.aacOverFlow=null}for(i=0;i<u-1&&(255!==l[i]||240!=(240&l[i+1]));i++);if(i&&(i<u-1?(n="AAC PES did not start with ADTS header, offset:"+i,h=!1):(n="no ADTS header found in AAC PES",h=!0),f.a.error("TsParser._parseAACPES ERROR:"+n),h))return void(this.mse&&this.mse.onParseError(li));const m=t=>{d.config=t.config,d.audiosamplerate=t.samplerate,d.channelCount=t.channelCount,d.codec=t.codec,d.timescale=this.remuxer.timescale,d.duration=this.remuxer.timescale*this.duration,this.mse&&this.mse.setExceptionStat(L.a.DIM_LINK_STA.AUDIO_CONFIG,1),f.a.log(`TsParser._parseAACPES parsed codec:${d.codec},rate:${t.samplerate},nb channel:${t.channelCount}`);const e=1024e3/t.samplerate;this.mse.updateAudioConfig({audioConfig:t,codec:"mp4a.40.5",audioSampleRate:t.samplerate,aacTimeLen:e,audioObjectType:t.adtsObjectType,audioChannelCount:t.channelCount},!1)};if(this.mse&&this.mse.isLive){if(!d.audiosamplerate){m(this._ADTStoAudioConfig(l,i,this.audioCodec))}}else{const t=this._ADTStoAudioConfig(l,i,this.audioCodec);d.audiosamplerate?d.audiosamplerate!==t.samplerate&&this.mse&&this.mse.onParseError(ui):m(t)}for(;i+5<u;){if(s=1&l[i+1]?7:9,r=(3&l[i+3])<<11,r|=l[i+4]<<3,r|=(224&l[i+5])>>>5,(r-=s)<0)return f.a.error(`TsParser._parseAACPES adtsFrameSize:${r}, adtsStartOffset:${i}, len:${u}`),void(this.mse&&this.mse.onParseError(li));if(0!=r){if(!((a=i+s)+r<=u))break;for(o=Math.round(t.pts+1024*c*this.PES_TIMESCALE/d.audiosamplerate),e={unit:l.subarray(a,a+r),pts:o,dts:o,ts:o/90},!this.mse.isLive&&ni.ptsJumpTest&&this._dtsJumpSimulate(e,"audio"),d.samples.push(e),d.len+=r,i+=s+r,c++;i<u-1&&(255!==l[i]||240!=(240&l[i+1]));i++);if(this._updateInitPts(e.pts,e.dts),this.vodDtsJumpHelper.checkAudioDts(e.dts),1==localStorage._printAudioTs){const t=parseInt(e.dts-90*this.mse.curAudioDts),i=parseInt((e.dts-ni.initPts)/90);f.a.debug(`%cTsParser.parseAacPes dts=${e.dts} pts=${e.dts} cts=${e.dts-e.dts} gap=${t} timeoffset=${i}`,"color:red")}this.mse&&(this.mse.curAudioDts=e.dts/90,this.mse.setExceptionStat(L.a.DIM_LINK_STA.AUDIO_FRAME,1)),this.aFps.addDts(o/90)}else i+=s}i<u&&(this.aacOverFlow=l.subarray(i,u))}_ADTStoAudioConfig(t,e,i){var s=ci.AdtsSampleingRates,r=1+((192&t[e+2])>>>6),a=(60&t[e+2])>>>2;if(a>s.length-1)return f.a.error("TsParser._ADTStoAudioConfig ERROR:invalid ADTS sampling index:"+a),void(this.mse&&this.mse.onParseError(li));var o,n,h=(1&t[e+2])<<2|(192&t[e+3])>>>6,d=navigator.userAgent.toLowerCase();return-1!==d.indexOf("firefox")?a>=6?(r=5,n=new Array(4),o=a-3):(r=2,n=new Array(2),o=a):-1!==d.indexOf("android")?-1!==d.indexOf("mqqbrowser")?(r=2,n=new Array(2),o=a):(r=5,n=new Array(4),o=a):(r=5,n=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&a>=6?o=a-3:(i&&-1!==i.indexOf("mp4a.40.2")&&(a>=6||1===h)&&(r=2,n=new Array(2)),o=a)),n[0]=r<<3,n[0]|=(14&a)>>1,n[1]|=(1&a)<<7,n[1]|=h<<3,5===r&&(n[1]|=(14&o)>>1,n[2]=(1&o)<<7,n[2]|=8,n[3]=0),{config:n,samplerate:s[a],channelCount:h,adtsObjectType:r,codec:"mp4a.40."+r}}_parseID3PES(t){this._id3Track.samples.push(t)}_dtsJumpSimulate(t,e){if(!ni.jumpConfig){try{const t=JSON.parse(localStorage.jumpConfig);if(!t.jumpTime||!t.jumpPts)throw new Error("jumpConfig jumpTime is empty or jumpPts is empty");ni.jumpConfig=t}catch(t){return ni.ptsJumpTest=!1,localStorage.removeItem("ptsJumpTest"),void f.a.error("jumpConfig error",t&&t.message)}f.a.log(`%cjump time=${ni.jumpConfig.jumpTime} jumpPts=${ni.jumpConfig.jumpPts}`,"color:#A23400;background:#FFF5C2")}if(t){let i=Math.ceil((t.dts-ni.initPts)/9e4);if("video"===e?(i<ni.videoTimeOffset&&(i=ni.videoTimeOffset),ni.videoTimeOffset=i):(i<ni.audioTimeOffset&&(i=ni.audioTimeOffset),ni.audioTimeOffset=i),i<Number(ni.jumpConfig.jumpTime))return;const s=Number(ni.jumpConfig.jumpPts);t.dts+=s,t.pts+=s}}}ci.AdtsSampleingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],ci.HEVC_NAL_VPS=32,ci.HEVC_NAL_SPS=33,ci.HEVC_NAL_PPS=34,ci.HEVC_NAL_AUD=35;var pi=ci;class mi{constructor(t,e,i){this.video=t,this.callbacks=i,this.destroyed=!1,this.isSupportRVCB=!1,this.callBackId=-1,this.started=!1,this.requestVideoFrameCallbackBind=this.requestVideoFrameCallback.bind(this),"safari"!==qe.a.name&&t&&t.requestVideoFrameCallback&&!e&&(this.isSupportRVCB=!0)}start(){this.started||(this.started=!0,this.isSupportRVCB?this.callBackId=this.video.requestVideoFrameCallback(this.requestVideoFrameCallbackBind):(this._lastPlayTime=0,q.add(this._checkRender,this,100)))}requestVideoFrameCallback(){!this.destroyed&&this.started&&this.video&&(this.callbacks&&this.callbacks.renderCallback(mi.Types.FRAME),this.callBackId=this.video.requestVideoFrameCallback(this.requestVideoFrameCallbackBind))}_checkRender(t){if(this.video){let t=this.video.currentTime;this._lastPlayTime!==t&&(this._lastPlayTime=t,this.callbacks&&this.callbacks.renderCallback(mi.Types.TIMER))}}stop(){f.a.log("VideoChecker.stop"),this.started=!1,this.callBackId=null,q.remove(this._checkRender,this)}destroy(){f.a.log("VideoChecker.destroy"),this.destroyed=!0,this.video=null,this.callBackId=0,this.callbacks=null,q.remove(this._checkRender,this)}}mi.Types={FRAME:"Frame",TIMER:"Timer"};var fi=mi;class _i{constructor(t,e,i){this.video=t,this.audioSource=e,this.analyser=i}}const gi=new class{constructor(){const t=window.AudioContext||window.webkitAudioContext;t&&(this.audioCtx=new t),this.audioItemMap=new Map}getState(){return this.audioCtx&&this.audioCtx.state}getAnalyser(t){if(!this.audioCtx)return null;let e=this.audioItemMap.get(t);if(!e){let i=this.audioCtx.createMediaElementSource(t),s=this.audioCtx.createAnalyser();i.connect(s),s.connect(this.audioCtx.destination),e=new _i(t,i,s),this.audioItemMap.set(t,e)}return e.analyser}delAnalyser(t){let e=this.audioItemMap.get(t);e&&(e.audioSource.disconnect(),e.analyser.disconnect(),this.audioItemMap.delete(t))}resume(){this.audioCtx&&"running"!==this.audioCtx.state&&this.audioCtx.resume().catch(t=>{f.a.log("AudioContextUtils.resume error="+t.message)})}};window.audioIns=gi;var Si=gi;var Ti=class{constructor(t,e,i){this.mse=t,this.video=e,this.isOutSide=i,this.playing=!1,this.seekTime=0,this.isMuffled=!1,this.cacheVolume=1,this.seekSuc=!1,this.seeking=!1,this.triggerPlayed=!1,e.addEventListener("pause",t.onVideoPauseBind),e.addEventListener("error",t.onVideoErrorBind),e.addEventListener("play",t.onVideoPlayBind),e.addEventListener("playing",t.onVideoPlayingBind),e.addEventListener("loadeddata",t.onVideoLoadedBind),e.addEventListener("resize",t.onVideoResizeBind),e.addEventListener("timeupdate",t.onVideoTimeUpdateBind),this.videoChecker=new fi(e,t.isPureAudio,{renderCallback:this._renderCallback.bind(this)}),this.videoChecker.start(),this._initAudioAnalyser(e)}_initAudioAnalyser(t){let e=Si.getAnalyser(t);e&&this.mse.onAudioAnalyserInit(e)}isSupportRequestVideoFrameCallback(){return this.video&&this.video.requestVideoFrameCallback}_renderCallback(){this.mse&&this.mse.requestVideoFrameCallback&&this.mse.requestVideoFrameCallback(),this.mse&&this.mse.handler._hyPlayer&&this.mse.handler._hyPlayer.roomRecordStat&&this.mse.handler._hyPlayer.roomRecordStat.renderCallback()}seek(t){this.seekTime=t,this.seeking=!0}realSeek(){if(this.seeking&&this.video&&this.video.buffered.length>0){let t=!1,e=this.video.buffered,i=this.seekTime;for(let s=0;s<e.length;s++){let r=e.start(s),a=e.end(s);r>=i&&r-i<1?(i=r,t=!0,f.a.log("MseVideo._checkSeek out off buffer, reseek="+i)):i>r&&i<a&&(t=!0,f.a.log("MseVideo._checkSeek in buffer, reseek="+i))}t&&(this.printBuffered(),this.seeking=!1,this.video.currentTime=i,f.a.log(`MSEVideo.seek currentTime=${this.video.currentTime} seekTime=${i}`))}}checkCurrentTime(){this.video&&(this.video.currentTime=this.video.currentTime)}_checkPlay(){f.a.log(`MSEVideo.checkPlay seekTime=${this.seekTime} playing=${this.playing} currentTime=${this.video&&this.video.currentTime}`),this.video&&0===this.video.currentTime&&!this.playing?(this.seekTime>0?(this.seekTime++,this.video.currentTime=this.seekTime):this.video.currentTime+=1,this._play()):q.remove(this._checkPlay,this)}play(){"safari"!==qe.a.name||this.mse.isLive?(this._play(),q.add(this._checkPlay,this,1e3)):(q.add(this._checkPlay,this,1e3),this.triggerPlayed&&this._play())}triggerPlay(){this.triggerPlayed=!0,this.play()}_play(){if(this.video){let t=this.video.play();t?t.then(()=>{q.remove(this._checkPlay,this),f.a.log(`MSEVideo._play suc currentTime=${this.video&&this.video.currentTime} volume=${this.video.volume} audioCtxState=${Si.getState()}`),this._renderCallback(),P.a.platform===D.a.PLATFORM_TYPE_NAME.wap&&!this.playing&&this.mse&&this.mse.triggerH5PlayVideo(),this.playing=!0,this.video.volume>0&&this.audioContextResume()}).catch(t=>{this.playing=!1;const e=t.toString();f.a.warn("MSEVideo.play error: "+e),this.mse&&(e.indexOf("NotAllowedError")>=0||e.indexOf("request was interrupted")>=0||this.video.paused)&&(this.mse&&this.mse.onPauseByBrowser(),P.a.platform===D.a.PLATFORM_TYPE_NAME.wap&&q.remove(this._checkPlay,this))}):this.playing=!1}else q.remove(this._checkPlay,this)}pause(){this.video.pause()}getBufferLen(){let t=0;if(this.video){let e=this.video.buffered;e.length>0&&(t=0===this.video.currentTime?1e3*(e.end(e.length-1)-e.start(e.length-1))>>0:1e3*(e.end(e.length-1)-this.video.currentTime)>>0)}return t}printBuffered(){f.a.log(R.b.getBufferedLog(this.video))}getCurrentTime(){return this.seeking&&this.seekTime>0?1e3*this.seekTime:1e3*this.video.currentTime}setVolume(t){this.isMuffled?this.video.volume=0:(this.video.volume=t,t>0&&this.audioContextResume()),this.cacheVolume=t}audioContextResume(){Si.resume()}setMuffledVolume(t){this.isMuffled=t,this.isMuffled?this.video.volume=0:this.setVolume(this.cacheVolume)}getVolume(){return this.video.volume}setMuted(t){this.video&&(this.video.muted=t,f.a.log(`MSEVideo.setMuted ${t} hasVideo=${!!this.videoSourceBuffer} hasAudio=${!!this.audioSourceBuffer}`))}getMuted(){return this.video?this.video.muted:-1}getVideoWidth(){return this.video?this.video.videoWidth:0}getVideoHeight(){return this.video?this.video.videoHeight:0}destroy(){this.isOutSide||Si.delAnalyser(this.video),this.video.removeEventListener("error",this.mse.onVideoErrorBind),this.video.removeEventListener("pause",this.mse.onVideoPauseBind),this.video.removeEventListener("play",this.mse.onVideoPlayBind),this.video.removeEventListener("playing",this.mse.onVideoPlayingBind),this.video.removeEventListener("loadeddata",this.mse.onVideoLoadedBind),this.video.removeEventListener("resize",this.mse.onVideoResizeBind),this.pause(),this.video.removeAttribute("src"),"function"==typeof this.video.load&&function(){try{this.video.load()}catch(t){}}(),this.videoChecker&&this.videoChecker.destroy(),this.videoChecker=null,this.video=null,this.mse=null}};var yi=class{constructor(t,e){this._mse=t,this._callbacks=e,this._paused=!1,this._playedTime=0,this._pausedTs=0,this._lastPausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}get paused(){return this._paused}get pausedTs(){return this._pausedTs}reset(){this._paused=!1,this._playedTime=0,this._pausedTs=0,this._lastPausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0}check(){let t=y.a.now(),e=this._mse.video.video;0!=this._lastCheckTime&&1==Number(localStorage._printPauseCheck)&&f.a.log("MSEPause.check",t-this._lastCheckTime,e.currentTime),!this._mse.isLive&&e.currentTime<=1||(this._mse.isLive||!this._mse.handler||this._mse.handler.started)&&(0!==this._playedTime&&(e.currentTime===this._playedTime?this._paused?this._fixedCurrentTime(t,e):this._setPaused(t,e):this._paused&&this._setResume(t,e)),this._playedTime=e.currentTime,this._lastCheckTime=t)}_setPaused(t,e){this._paused=!0,this._pausedTs=t,this._lastPausedTs=t,this._log("_setPaused",e),this._callbacks.pause(t)}_setResume(t,e){let i=t-this._pausedTs;this._paused=!1,this._pausedTs=0,this._lastPausedTs=0,this._log("_setResume",e),this._callbacks.resume(t,i)}_fixedCurrentTime(t,e){t-this._lastPausedTs>500&&(this._fixedByBuffered(e)||this._fixedByDts(e))&&(this._lastPausedTs=t)}_fixedByBuffered(t){if("flv"===this._mse.videoType){let e=t.buffered.length;if(e>0){let i=t.buffered.start(e-1),s=t.buffered.end(e-1);if(i>t.currentTime&&s-i>1)return this._log("_fixedByBuffered",t),t.currentTime=i,!0}}else if("ts"===this._mse.videoType&&!this._mse.isLive){const e=((this._mse.handler||{}).playlist||{}).currFrag;let i=2;e&&(i=e.duration);let s=t.buffered.length;for(let e=0;e<s;e++){let s=t.buffered.start(e),r=t.buffered.end(e);if(e>=1){if(t.buffered.end(e-1)-t.currentTime<=1&&s>t.currentTime&&s<=t.currentTime+i&&r-s>1)return f.a.log(`%cMSEPause.fixedByBuffered currentTime=${t.currentTime} fixed time=${s}`,"color:#A23400;background:#FFF5C2"),t.currentTime=s,!0}}}return!1}_fixedByDts(t){return!!(this._mse.getBufferLen()>2e3&&this._mse.isLive)&&(this._log("_fixedByDts",t),t.currentTime+=1,!0)}_log(t,e,i){this._mse.video.printBuffered();let s=this._mse.getBufferLen();"ts"===this._mse.videoType&&!this._mse.isLive&&this._mse.handler&&(s=this._mse.handler.getBufferLen()),f.a.log(`MSEPause(${this._mse._num_}).${t} readyState=${e.readyState} currentTime=${e.currentTime} buf=${s} dts=${this._mse.getCurrentDts()} ${i||""}`)}};var Ei=class{constructor(){this.emptyTs=0,this.emptyTime=0,this.emptyCnt=0,this.aiEmptyTime=0,this.aiEmptyCnt=0}reset(){this.emptyTs=0,this.emptyTime=0,this.emptyCnt=0}getStats(){let t={emptyTime:this.emptyTime,emptyCnt:this.emptyCnt};return this.emptyTime=0,this.emptyCnt=0,t}getAiStats(){let t={aiEmptyTime:this.aiEmptyTime,aiEmptyCnt:this.aiEmptyCnt};return this.aiEmptyTime=0,this.aiEmptyCnt=0,t}checkBuffer(t,e){e<200&&0===this.emptyTs?this.emptyTs=t:e>500&&this.emptyTs>0&&(this.emptyTime+=t-this.emptyTs,this.aiEmptyTime+=t-this.emptyTs,this.emptyTs=0,this.emptyCnt++,this.aiEmptyCnt++)}};var vi=class{constructor(t){this._handler=t,this._cnt=0,this._duration=0,this._pauseTs=0,this._aiCnt=0,this._aiDuration=0,this._aiAutoCnt=0,this._aiAutoDuration=0,this._videoBlockBufferList=[],this._videoBlockContinueList=[],this._blockBadDurationList=[],this._blockBadContinueBufferList=[],this._autoReportProps=null}reset(){this.resetStat(),this.resetAiStat(),this.resetAutoAiStat(),this._pauseTs=0,this._autoReportProps=null}getCnt(){return this._cnt}resetStat(){this._cnt=0,this._duration=0,this._videoBlockBufferList.length=0,this._videoBlockContinueList.length=0}pause(){0===this._pauseTs&&(this._pauseTs=y.a.now()),this.getAutoReportProps(),this._handler&&(this._videoBlockBufferList.push(this._handler.getBufferLen()),this._videoBlockContinueList.push(this._handler.getVideoContinueBuffer()))}resume(){this.calc(!0)}calc(t){if(this._pauseTs>0){let e=y.a.now(),i=e-this._pauseTs;i>=200&&(this._cnt++,this._aiCnt++,this._aiAutoCnt++,this._duration+=i,this._aiDuration+=i,this._aiAutoDuration+=i,this._blockBadDurationList.push(i),this._blockBadContinueBufferList.push(this._handler.getBufferLen())),i>=P.a.blockBadCfg[0]&&this.setBlockBad(i),t?this._pauseTs=0:(this._pauseTs=e,this.getAutoReportProps())}}resetAiStat(){this._aiCnt=0,this._aiDuration=0}resetAutoAiStat(){this._aiAutoCnt=0,this._aiAutoDuration=0,this._blockBadDurationList.length=0,this._blockBadContinueBufferList.length=0}getAiStat(){let t={aiCnt:this._aiCnt,aiDuration:this._aiDuration};return this.resetAiStat(),t}getAiAutoStat(){let t={aiAutoCnt:this._aiAutoCnt,aiAutoDuration:this._aiAutoDuration,aiAutoBlockBadDurationList:[...this._blockBadDurationList],aiAutoBlockBadContinueBufferList:[...this._blockBadContinueBufferList]};return this.resetAutoAiStat(),t}record(t){this.calc(!1),t.setCore(L.a.CORE.VIDEO_BLOCK_COUNT,this._cnt),t.setCore(L.a.CORE.VIDEO_BLOCK_DURATION,this._duration),this.performanceCalc(t),this.resetStat()}performanceCalc(t){let e=P.a.perfBlockCfg[0],i=0,s=0;this._videoBlockBufferList.map((t,r)=>{let a=this._videoBlockContinueList[r];t>e?(a>e&&s++,i++):a>P.a.perfBlockCfg[1]&&(i++,s++)}),f.a.log(`PauseStat.performanceCalc, continueBufferCnt=${s},bufferCnt=${i},perfBlockCnt=${this._handler.perfBlockCnt}`),this._handler.perfBlockCnt>0&&(s+=this._handler.perfBlockCnt,i+=this._handler.perfBlockCnt),t.setCore(L.a.CORE.VIDEO_PERFPAUSE_CONTINUE_CNT,s),t.setCore(L.a.CORE.VIDEO_PERFPAUSE_CNT,i),this._handler.resetPerfBlockCnt()}recordSam(t){let e=t.length,i=[];if(e>0){i.push("size:"+e);for(let s=0;s<e;s++)i.push(`k${e-s}:${t[s]}`)}return i.join(",")}getAutoReportProps(){this._handler.handler&&this._handler.handler.getAutoProps&&(this._autoReportProps=this._handler.handler.getAutoProps())}setBlockBad(t){let e=Math.floor(100*P.a.blockBadCfg[1]);if(Math.floor(100*Math.random())>e)return;let i=this._handler.handler._hyPlayer.stat,s=this._handler.handler._hyPlayer.tsdbUtil;const r=this._autoReportProps;if(!r)return;let a=[t],o=["",r.videoBuffers,"",r.blockDurationSample,r.continueBufferSample,r.realKbpsSample,"",r.recvFps],n=i.createAct(L.a.ACT.BLOCK_BAD,{value:a,str:o});f.a.log("PauseStat.setBlockBad getAutoProps metric=",n),s.sendMetrics([n])}};const Ci=[95,112,101,114,102];var Pi=class{constructor(){this.bitrate=4e3,this.blockCount=1,this.continueBuffer=2e3,this.map=new Map,this.key="",this._initKey(),this._initLocal()}_initKey(){for(let t=0;t<Ci.length;t++)this.key+=String.fromCharCode(Ci[t])}setConfig(t){this.bitrate=t.perfBitrate||4e3,this.blockCount=t.perfCnt||1,this.continueBuffer=t.perfBuf||2e3}_initLocal(){if(localStorage.hasOwnProperty(this.key)){let t=localStorage[this.key].split(","),e="",i=!0;for(let s=0;s<t.length;s++){let r=Number(t[s]);if(isNaN(r)){i=!1;break}e+=String.fromCharCode(Number(t[s]))}i&&e.length>0&&this._parseLocal(e)}}_parseLocal(t){let e=t.split("|");for(let t=0;t<e.length;t++){let i=e[t].split(":"),s=Number(i[0]),r=i[1].split(",");this.map.set(s,r)}}checkLocal(t,e){if(t=Number(t),this.map.has(t)){let i=this.map.get(t);return this._hasBitrate(i,e)}return!1}checkLive(t,e,i,s){if(t=Number(t),e>=this.bitrate&&i>this.blockCount&&s>this.continueBuffer){let i=this.map.get(t);if(i||(i=[],this.map.set(t,i)),!this._hasBitrate(i,e))return i.push(e),this._saveMap(),f.a.log(`PausePerformance.checkLive pid=${t} bitrate=${e}`),!0}return!1}_hasBitrate(t,e){for(let i=0;i<t.length;i++)if(Number(e)===Number(t[i]))return!0;return!1}_saveMap(){let t=[];for(let[e,i]of this.map.entries())t.push(e+":"+i.join(","));if(t.length>0){let e=t.join("|"),i=[];for(let t=0;t<e.length;t++)i.push(e.charCodeAt(t));localStorage[this.key]=i.join(",")}}};var Di=class{constructor(){this.startDts=0,this.endDts=0,this.endFrameId=0}isDisconnectDts(t){return this.endDts>0&&t-this.endDts>200}isDisconnectFrame(t){return this.endFrameId>0&&t-this.endFrameId!=1}getContinueBuffer(t){return t>=this.startDts&&t<=this.endDts?this.endDts-t:0}addBuffer(t,e){0===this.startDts&&(this.startDts=e),this.endDts=e,this.endFrameId=t}},Ii={timer:"timer",frame:"frame",record:"record",resume:"resume",push:"push"};class Ai{constructor(){this._frameId=0,this._lastFrameId=0,this._startFrameId=0}reset(){this._frameId=0,this._lastFrameId=0,this._startFrameId=0}setStartFrameId(t){this._startFrameId=t,this._lastFrameId=this._frameId}getFrameId(t,e){return 0===t?(this._frameId++,e>0&&this._frameId++):(e>0&&this._lastFrameId++,this._frameId=this._lastFrameId+(t-this._startFrameId+1)),this._frameId}}var Ri=class{constructor(){this._mse=null,this._list=[],this._dtsList=[],this._tsList=[],this._currentBuffered=null,this._continueBuffer=-1,this._lastFrameTs=0,this._startTs=0,this._started=!1,this._lastRemoveTs=0,this._deltaStart=Number(P.a.continueBufferDeltaStart)||6e3,this._deltaEnd=Number(P.a.continueBufferDeltaEnd)||3e3,this._localFrameId=new Ai,this._printContinueBuffer=1==localStorage._printContinueBuffer}get continueBuffer(){return this._continueBuffer}set continueBuffer(t){this._continueBuffer=t}setMse(t){this._mse=t}stop(){f.a.log("VideoBufferedList.stop"),this._startTs=0,this._list.length=0,this._dtsList.length=0,this._continueBuffer=-1,this._currentBuffered=null,this._localFrameId.reset(),q.remove(this.onCheckFastTimer,this)}printInfo(t){let e=[];this._list.forEach(t=>{e.push(`[${t.startDts}, ${t.endDts}]`)}),f.a.log(`VideoBufferedList.print dts=${t} buffered=${e.join(" ")}`)}record(t){this._calc(y.a.now(),Ii.record),t.setCore(L.a.CORE.VIDEO_CONTINUE_BUFFER,this.getVideoContinueBuffer()),this._continueBuffer=-1}start(){0===this._startTs&&(f.a.log("VideoBufferList.start"),this._startTs=y.a.now(),q.add(this.onCheckFastTimer,this,50))}onCheckFastTimer(t){if(0===this._lastRemoveTs)this._lastRemoveTs=t;else if(this._lastRemoveTs>0&&t-this._lastRemoveTs>5e3){this._lastRemoveTs=t;let e=this._mse.getCurrentDts()-2e4;for(let t=this._dtsList.length-1;t>=0;t--)if(this._dtsList[t]<e){this._dtsList=this._dtsList.slice(t),this._tsList=this._tsList.slice(t);break}}let e=t-this._lastFrameTs;this._lastFrameTs>0&&e>100&&(this._calc(t,Ii.timer),this._lastFrameTs=t)}addSample(t,e,i,s){let r=y.a.now();this._tsList.push(r),this._dtsList.push(e),(0===this._lastFrameTs||i)&&this._localFrameId.setStartFrameId(t),this._lastFrameTs=r;let a=this._localFrameId.getFrameId(t,s);if((!this._currentBuffered||this._currentBuffered.isDisconnectFrame(a))&&(this._currentBuffered=new Di,this._list.push(this._currentBuffered),this._list.length>10)){e-this._list[0].endDts>3e5&&this._list.shift()}this._currentBuffered.addBuffer(a,e)}_calc(t,e){let i=t-this._deltaStart,s=t-this._deltaEnd;if((e===Ii.record||e===Ii.resume)&&-1===this._continueBuffer)return this._continueBuffer=this._getContinueBuffer(this._mse.getCurrentDts()),void(this._printContinueBuffer&&this.printInfo(this._mse.getCurrentDts()+` continueBuffer=${this._continueBuffer} from=${e} `));if(0===this._startTs||i<this._startTs)return;let{startDts:r,endDts:a}=this._getDtsBound(i,s),o=Number.MAX_SAFE_INTEGER,n=this._dtsList.length;for(let t=0;t<n;t++){let e=this._dtsList[t];if(e>a)break;if(e>=r&&e<=a&&(o=Math.min(o,this._getContinueBuffer(e))),0===o)break}o===Number.MAX_SAFE_INTEGER&&(o=0),(-1===this._continueBuffer||this._continueBuffer>o)&&(this._continueBuffer=o,this._printContinueBuffer&&this.printInfo(this._mse.getCurrentDts()+` now=${t} startDts=${r} endDts=${a} continueBuffer=${o} from=${e}`))}_getDtsBound(t,e){let i=this._tsList.length,s=Number.MAX_SAFE_INTEGER,r=0;for(let a=0;a<i;a++){let i=this._tsList[a];if(i>=t&&i<=e){let t=this._dtsList[a];t<s&&(s=t),t>r&&(r=t)}else if(i>e)break}return{startDts:s,endDts:r}}_getContinueBuffer(t){let e=0;for(let i=0;i<this._list.length;i++){if(e=this._list[i].getContinueBuffer(t),0!==e)break}return e}getVideoContinueBuffer(){let t=0;if(this._mse&&this._mse.getCurrentDts){let e=this._mse.getCurrentDts();t=this._getContinueBuffer(e)}return t}};var Oi=class{constructor(t){this.seiList=[],this.player=t,this.lastTs=-1,this.internal=10,this.timerStart=!1}add(t,e){let i=this.seiList.length;if(this.seiList.length>0)for(i=this.seiList.length-1;i>0&&!(t>this.seiList[i].timeStamp);i--);this.seiList.splice(i+1,0,{timeStamp:t,data:e}),this.timerStart||(this.timerStart=!0,setTimeout(this.checkDispatchSei.bind(this),this.internal))}checkDispatchSei(){if(this.timerStart){let t=this.player.getCurrentRealTime(),e=0,i=null;for(;e<this.seiList.length-2;){if(t>=this.seiList[e].timeStamp&&this.seiList[e+1].timeStamp>t){i=this.seiList[e+1].data,this.player.onH264Sei(i,this.seiList[e+1].timeStamp),this.seiList.splice(0,e+1);break}e++}setTimeout(this.checkDispatchSei.bind(this),this.internal)}}reset(){this.seiList=[],this.player=null,this.lastTs=-1,this.timerStart=!1}};var wi=class{constructor(t){this.volumeList=[],this.player=t,this.lastTs=-1,this.internal=100,this.timerStart=!1,this.dispatchMap=new Map}addMixAudio(t,e){if(t.length>0){let i=t.split(",");for(let t=0;t<i.length;t++)this.add(e,i[t])}}add(t,e){let i=this.volumeList.length;if(this.volumeList.length>0)for(i=this.volumeList.length-1;i>0&&!(t>this.volumeList[i].timeStamp);i--);this.volumeList.splice(i+1,0,{timeStamp:t,data:e}),this.timerStart||(this.timerStart=!0,setTimeout(this.checkDispatchVolume.bind(this),this.internal))}checkDispatchVolume(){if(this.timerStart){let e=this.player.getCurrentRealTime(),i=0,s=null;for(this.dispatchMap.clear();this.volumeList[i]&&this.volumeList[i].timeStamp<e;){s=this.volumeList[i].data;var t=s.split("_");t.length>1&&this.dispatchMap.set(t[0],t[1]),i++}this.dispatchMap.forEach((t,e,i)=>{this.player.onScriptVolumeInfo(e,t)}),this.dispatchMap.clear(),this.volumeList.splice(0,i),this.volumeList.length>0?setTimeout(this.checkDispatchVolume.bind(this),this.internal):this.timerStart=!1}}reset(){this.volumeList=[],this.player=null,this.lastTs=-1,this.timerStart=!1}};class Li{constructor(){this.type=-1,this.sn=0,this.samples=[],this.playDts=-1,this.firstDts=-1e4,this.lastSampleDts=0,this.setPlayDtsCallback=null}getInfo(){return`size=${this.samples.length}=[${this.samples.length>0?this.samples[0].ts:0}, ${this.samples.length>0?this.samples[this.samples.length-1].ts:0}]`}destroy(){this.samples=[]}clear(){this.samples.length>0&&f.a.log(`BufferFrame.clear type=${this.type} size=${this.samples.length}=[${this.samples[0].ts}, ${this.samples[this.samples.length-1].ts}]`),this.samples=[],this.firstDts=-1e4,this.playDts=-1,this.lastSampleDts=0}addSample(t,e){if(this.lastSampleDts>0){let i=t.ts-this.lastSampleDts;(i>100||i<-100)&&f.a.warn(`BufferFrame.addSample type=${this.type} isShield=${e} dis=${i} lastDts=${this.lastSampleDts} curDts=${t.ts}`)}return this.lastSampleDts=t.ts,this.samples.push(t),this._setFirstDts(t.ts),t.ts-this.playDts}_setFirstDts(t){-1e4===this.firstDts&&(this.firstDts=t,this.playDts=t,this.setPlayDtsCallback&&this.setPlayDtsCallback())}_createTrack(t){return{type:t,id:t===Li.TYPES.video?1:2,sn:0,samples:[],len:0,duration:0,startDts:-1,endDts:0,naluCnt:0}}getTrack(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._createTrack(this.type),s=this._fillTrack(i,t,e);return s>0&&this.samples.splice(0,s),i.endDts>0&&(i.playDts=this.playDts,i.sn=this.sn,this.sn++),i}_fillTrack(t,e,i){return 0}_addTrack(t,e){t.samples.push(e),-1===t.startDts&&(t.startDts=e.ts),t.endDts=e.ts,e.av1Bytes&&(t.bytes=e.av1Bytes)}getBufferLen(){let t=this.samples.length;if(t>1){let e=this.samples[0];return this.samples[t-1].ts-e.ts}return 0}getSize(){return this.samples.length}removeExpireBuffer(t,e){this.samples=this.samples.filter(i=>{if(i.ts>=t-this.aacTimeLen)return i;1===Number(localStorage._printAVTrack)&&e==oe&&f.a.log(`BufferFrame.removeExpireBuffer, sample.ts=${i.ts}, videoDts=${t}`)}),this.samples.length>0&&(this.playDts=this.samples[0].ts)}recoverBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length<=0||(this.playDts=t[0].ts,this.samples.splice(0,0,...t))}}Li.TYPES={video:"video",audio:"audio"};var Mi=Li;var Vi=class extends Mi{constructor(){super(),this.type=Mi.TYPES.video}_setFirstDts(t){-1e4===this.firstDts&&f.a.log("BufferFrameVideo._setFirstDts="+t),super._setFirstDts(t)}_fillTrack(t,e,i){let s=0,r=this.samples.length,a=this.playDts+e;for(let e=0;e<r;e++){let i=this.samples[e];if(i.ts>=a){t.endDts=i.ts;break}s++,this._addTrack(t,i)}return t.endDts>0&&(this.playDts=t.endDts),s}_addTrack(t,e){super._addTrack(t,e),t.naluCnt+=e.units.length,t.len+=e.len}};var bi=class extends Mi{constructor(t,e){super(),this.shieldType=t,this.type=Mi.TYPES.audio,this.needEmptyAudioFrame=!0,this.isPureAudio=!1,this.lastAacTs=0,this.webcodecType=e,this.webcodecsEmptyFrameInited=!1,this.audioObjectType=5,this.audioChannelCount=1,this.audioSampleRate=22050,this.aacTimeLen=1024e3/this.audioSampleRate,this.aacEmptyDuration=0,this.emptyDuration=0}resetAudioDts(){this.clear()}addSample(t,e){return this.webcodecType!=D.a.PLAYER_CORE_TYPE.WEBCODECS||this.webcodecsEmptyFrameInited||(this.webcodecsEmptyFrameInited=!0,Qe.setWebcodeccEmptyFrame(t.unit)),t.empty=0,super.addSample(t,e)}_setFirstDts(t){-1e4===this.firstDts&&f.a.log("BufferFrameAudio._setFirstDts="+t),this.playDts>0&&-1e4===this.firstDts&&t>this.playDts&&t-this.playDts<this.aacTimeLen&&(f.a.log(`BufferFrameAudio._setFirstDts resetPlayDts ${this.playDts} to ${t}`),this.playDts=t),super._setFirstDts(t)}alignPlayDts(t){if(0===this.playDts)f.a.log("BufferFrameAudio.alignPlayDts videoPlayDts="+t),this.playDts=t;else if(t>this.playDts){let e=this.playDts;this.playDts=t;let i=0;for(;this.samples.length>0&&this.samples[0].ts<t;)i++,this.samples.shift();f.a.log(`BufferFrameAudio.alignPlayDts audioPlayDts=${e} to ${t}, clear samples=${i}`)}}_fillTrack(t,e,i){if(-1===this.playDts)return 0;let s=e,r=this.playDts+this.aacTimeLen,a=r,o=0,n=0,h=0,d=0,l=this.samples.length,u=0,c={startDts:0,endDts:0};for(;r<s;){let e=this.samples[o];if(u=Math.round(r),P.a.dtsJumpOpen&&e){let t=u-e.ts;if(t<0&&(t=-t),t>P.a.dtsJumpThreshold){r=e.ts;break}}if(e&&e.ts<=u)0===c.startDts&&(c.startDts=e.ts),c.endDts=e.ts,o++,d++,this._fixDts(e,u),this._addTrack(t,e),this._recordEmptyDuration(h),h=0;else if(!this.isPureAudio&&this.needEmptyAudioFrame){if(n++,1==P.a.isAudioEmptyLimit&&n>=200)break;let e={unit:null,pts:0,dts:0,ts:0,empty:1};this.webcodecType==D.a.PLAYER_CORE_TYPE.WEBCODECS&&null!=Qe.webcodeccEmptyFrame?e.unit=new Uint8Array(Qe.webcodeccEmptyFrame):22050===this.audioSampleRate&&2===this.audioObjectType?e.unit=new Uint8Array(Qe.emptyAacFrame):e.unit=Qe.getSilentFrame(this.audioObjectType,this.audioChannelCount),this._fixDts(e,u),this._addTrack(t,e),this.aacEmptyDuration+=this.aacTimeLen,h+=this.aacTimeLen}if(!i&&l>1&&o>=l||r+this.aacTimeLen>=s)break;r+=this.aacTimeLen}return this._recordEmptyDuration(h),t.emptyFrames=n,this.playDts=r,n>0&&f.a.log(`BufferFrameAudio add empty frames ${n}, objectType=${this.audioObjectType} channelCount=${this.audioChannelCount} shieldType=${this.shieldType} playDts=${this.playDts} sampleTs=${this.samples[o-1]?this.samples[o-1].ts:0} pick=[${c.startDts},${c.endDts}] play=[${a}, ${s}]`),d}_recordEmptyDuration(t){t>=P.a.audioEmptyDur&&(this.emptyDuration+=t)}hasPushBuffer(t){return!(t-this.playDts>P.a.shieldAudioCfg[4])}_fixDts(t,e){t.pts=t.dts=90*e,t.ts=e}_addTrack(t,e){e.unit&&(super._addTrack(t,e),t.len+=e.unit.length)}getEmptyeDuration(){const t=this.aacEmptyDuration;return this.aacEmptyDuration=0,t}getEmptyDurationHeart(){const t=this.emptyDuration;return this.emptyDuration=0,Math.floor(t)}};class Ni{constructor(t,e,i){this.popSize=t.bufferSize+t.popDuration,this.waitSize=t.waitSize||2e3,this.popDuration=t.popDuration,this.timescale=t.timescale,this.isPureAudio=t.isPureAudio,this.isPureVideo=t.isPureVideo,this.webcodecType=t.webcodecType,this.remuxCb=e,this.ctrlBuffer=i,this.popMode=0,this.dtsChecker=new Le,this.avcChange=!1,this.inited=!0,this.hasOriginIFrame=!1,this.hasRemux=!1,this.gop=P.a.maxGop,this.lastKeyFrameDts=0,this.paused=!1,this.switchedShieldAudio=!1,this.isShieldAudio=!1,this.isAShieldFirstPop=!1,this.shieldAudioWaitSize=200,this.startShieldTs=0,this.firstVideoTs=0,this.firstAudioTs=0,this.firstShieldAudioTs=0,this.isShieldFastToAlign=0,this.firstPrintVideo=!1,this.firstPrintAudio=!1,this.isSwitchShieldFailed=!1,this.videoConfig={isHevc:!1,vps:null,sps:null,pps:null,codec:"",width:0,height:0},this.audioConfig={config:null,codec:"mp4a.40.5",audioSampleRate:22050,aacTimeLen:1024e3/22050,audioObjectType:5,audioChannelCount:1},this.shieldAudioConfig={config:null,codec:"mp4a.40.5",audioSampleRate:22050,aacTimeLen:1024e3/22050,audioObjectType:5,audioChannelCount:1},this.vBuffer=new Vi,this.vBuffer.setPlayDtsCallback=this.setVideoPlayDts.bind(this),this.aBuffer=new bi(ae,this.webcodecType),this.aShieldBuffer=new bi(oe,this.webcodecType),this.aBuffer.isPureAudio=this.isPureAudio,this.aShieldBuffer.isPureAudio=this.isPureAudio,this._switchShieldTimeoutBind=this._switchShieldTimout.bind(this)}resetAudioDts(){this.aBuffer.resetAudioDts()}_updateGop(t){!t.key||this.hasOriginIFrame&&!t.origin_iframe||(this.lastKeyFrameDts>0&&(this.gop=Math.min(P.a.maxGop,t.ts-this.lastKeyFrameDts),1==localStorage._printGop&&f.a.log("BufferAV._updateGop webcodecs",this.gop)),this.lastKeyFrameDts=t.ts)}updateVideoConfig(t,e){f.a.log(`BufferAV.updateVideoConfig, oldAvcChange=${this.avcChange} curAvcChange=${e}`),this.videoConfig=t,this.avcChange||(this.avcChange=e),this.firstPrintVideo=!1,this.firstPrintAudio=!1}updateAudioConfig(t,e,i){e==ae?(f.a.log("BufferAV.updateAudioConfig.common, first="+i,JSON.stringify(t)),this.audioConfig=t,this.aBuffer.audioSampleRate=t.audiosamplerate,this.aBuffer.aacTimeLen=t.aacTimeLen,this.aBuffer.audioObjectType=t.audioObjectType,this.aBuffer.audioChannelCount=t.audioChannelCount):(e=oe)&&(f.a.log("BufferAV.updateAudioConfig.shield, first="+i,JSON.stringify(t)),this.shieldAudioConfig=t,this.aShieldBuffer.audioSampleRate=t.audiosamplerate,this.aShieldBuffer.aacTimeLen=t.aacTimeLen,this.aShieldBuffer.audioObjectType=t.audioObjectType,this.aShieldBuffer.audioChannelCount=t.audioChannelCount)}destroy(){this.firstVideoTs=0,this.firstAudioTs=0,this.firstShieldAudioTs=0,this.remuxCb=null,this.hasRemux=!1,this.switchedShieldAudio=!1,this.isAShieldFirstPop=!1,this.isShieldFastToAlign=!1,this.vBuffer.destroy(),this.aBuffer.destroy(),this.aShieldBuffer.destroy(),q.remove(this._switchShieldTimeoutBind,this)}clearShieldAudio(){this.aShieldBuffer.clear(),this.switchedShieldAudio=!1}addSample(t){this.inited=!1,t.type===Ni.TYPES.avc||t.type===Ni.TYPES.av01?(this.dtsChecker.isVideoDtsDiffLarge(t.ts),this._addSampleVideo(t)):t.type===Ni.TYPES.aac&&(this.dtsChecker.isAudioDtsDiffLarge(t.ts),this._addSmapleAudio(t))}switchShieldAudio(t){f.a.log("BufferAV.switchShieldAudio, yes="+t),this.isShieldAudio=t,t?(this.isStartShieldAudio=!1,this.startShieldTs=0,this.isFirstShieldAvc=!1,this.isFirstDelteShieldAac=!1,this.isAShieldFirstPop=!1,this.isShieldFastToAlign=!1,this.isSwitchShieldFailed=!1,q.once(this._switchShieldTimeoutBind,this,P.a.shieldAudioCfg[2])):(q.remove(this._switchShieldTimeoutBind,this),this.switchedShieldAudio&&this.clearShieldAudio())}_switchShieldTimout(){this._switchShieldAudioFailed(ne);const t=this.aShieldBuffer.samples.length,e=this.vBuffer.samples.length;f.a.warn(`BufferAv._switchShieldTimout, shieldBuffelen=${t}, vBufferLen=${e}, firstVideoTs=${this.firstVideoTs}, firstAudioTs=${this.firstAudioTs}, firstShieldAudioTs=${this.firstShieldAudioTs}`),t>0&&f.a.warn(`BufferAv._switchShieldTimout, aStart=${this.aShieldBuffer.samples[0].ts}, aEnd=${this.aShieldBuffer.samples[t-1].ts}`),e>0&&f.a.warn(`BufferAv._switchShieldTimout, vStart=${this.vBuffer.samples[0].ts}, vEnd=${this.vBuffer.samples[e-1].ts}`)}_getFirstShieldAVDelta(){let t=this.firstVideoTs,e=this.firstShieldAudioTs,i=0;return 0!=t&&0!=this.firstAudioTs&&(i=t-e),i}_switchShieldAudioFailed(t){f.a.warn(`BufferAv._switchShieldAudioFailed switch shield audio failed, reason=${t}, firstVideoTs=${this.firstVideoTs}, firstAudioTs=${this.firstAudioTs}, firstShieldAudioTs=${this.firstShieldAudioTs}`),this.isSwitchShieldFailed=!0,this.switchedShieldAudio&&this.clearShieldAudio();const e=Math.abs(this._getFirstShieldAVDelta());this.ctrlBuffer.onSwitchShieldAudioFail(t,e)}_switchShieldAudioSuc(){if(this.isSwitchShieldFailed)return;f.a.log(`BufferAv._switchShieldAudioSuc switch shield audio successfully, firstVideoTs=${this.firstVideoTs}, firstAudioTs=${this.firstAudioTs}, firstShieldAudioTs=${this.firstShieldAudioTs}`);const t=this._getFirstShieldAVDelta();this.ctrlBuffer.onSwitchShieldAudioSuc(t)}_shieldAuidoMute(t,e){this.ctrlBuffer.shieldAuidoMute(t,e)}_setShieldBuffer(t){if(!this.isFirstShieldAvc){f.a.log("BufferAv.popBuffer.firstShieldBuffer.length",this.aShieldBuffer.samples&&this.aShieldBuffer.samples.length),this.isFirstShieldAvc=!0;let e=this.aShieldBuffer.samples[0].ts,i=t,s=t-e;if(f.a.log(`BufferAv.popBuffer.shield.firstDts avcFirstTs=${i} aacFirstTs=${e} delta=${t-e}`),s<0&&s>-P.a.shieldAudioCfg[3])return this._switchShieldAudioSuc(),this.switchedShieldAudio=!0,!0;if(s<-P.a.shieldAudioCfg[3])return f.a.log("BufferAv.popBuffer.shield audio to fast"),this._switchShieldAudioFailed(he),!1}return!0}_addSampleVideo(t){0==this.firstVideoTs&&(this.firstVideoTs=t.ts),this.firstPrintVideo||(this.firstPrintVideo=!0,f.a.log(`BufferAv.addSampleVideo firstPrint dts=${t.ts} isKey=${t.key}`)),t.key&&t.origin_iframe&&!this.hasOriginIFrame&&(f.a.log("BufferAv.addSampleVideo find origin_iframe! isIframe="+t.key),this.hasOriginIFrame=!0),!t.key&&t.origin_iframe&&f.a.warn("BufferAv.addSampleVideo find origin_iframe sei not in iframe"),this._updateGop(t);let e=this.vBuffer.addSample(t,!1);if(this.isShieldAudio){const t=this.vBuffer.samples.length;0!=this.firstAudioTs&&0!=this.firstVideoTs&&this.firstVideoTs-this.firstAudioTs>=P.a.shieldAudioCfg[4]&&this._switchShieldAudioFailed(de),!this.isFirstDelteShieldAac&&t>0&&this.aShieldBuffer.removeExpireBuffer(this.vBuffer.samples[0].ts,oe);let i=this.aShieldBuffer.getBufferLen();!this.paused&&e>=this.popSize&&i>=this.popSize&&(this.popBuffer(this.popDuration),this.isFirstDelteShieldAac=!0)}else!this.paused&&e>this.popSize&&(0===this.popMode?this.aBuffer.getBufferLen()>this.popSize?this.popBuffer(this.popDuration):e>this.waitSize&&(this.popBuffer(this.waitSize),t.ts-this.firstVideoTs>1e4&&0===this.aBuffer.firstDts&&(this.popMode=1)):1===this.popMode&&this.popBuffer(this.popDuration))}setVideoPlayDts(){this.aBuffer.alignPlayDts(this.vBuffer.playDts)}_addSmapleAudio(t){0==this.firstAudioTs&&(this.firstAudioTs=t.ts),this.firstPrintAudio||(this.firstPrintAudio=!0,f.a.log("BufferAv._addSmapleAudio firstPrint dts="+t.ts));let e=this.aBuffer.addSample(t,!1);this.isShieldAudio||!this.isShieldAudio&&!this.paused&&this.isPureAudio&&e>this.popSize&&this.popBuffer(this.popDuration)}addShieldAudioSample(t){0==this.firstShieldAudioTs&&(this.firstShieldAudioTs=t.ts);const e=this.aShieldBuffer.addSample(t,!0);this.isShieldAudio&&!this.paused&&this.isPureAudio&&e>this.popSize&&this.popBuffer(this.popDuration)}getShieldWait(){if(this.isShieldAudio){const t=this.aShieldBuffer.getSize();if(t<=0)return!1;let e=this.aShieldBuffer.samples[0].ts,i=this.aShieldBuffer.samples[t-1].ts;if(!this.isAShieldFirstPop){if(i-e<P.a.shieldAudioCfg[5])return f.a.log("BufferAv.popBuffer.waitShield",i-e),!1;f.a.log("BufferAv.popBuffer.waitShield success",i-e),this.isAShieldFirstPop=!0}}return!0}popBuffer(t){let e=0,i=0;if(this.isStartShieldAudio||(this.startShieldTs=y.a.now(),this.isStartShieldAudio=!0),!this.getShieldWait())return;0!=this.startShieldTs&&(e=y.a.now()-this.startShieldTs);let s=null,r=null,a=!1;r=this.vBuffer.getTrack(t),r.timescale=this.timescale,r.duration=Math.round((r.endDts-r.startDts)*(this.timescale/1e3));const o=0==r.sn;r&&(o||this.avcChange)&&(this.avcChange=!1,Object.assign(r,this.videoConfig),f.a.log("BufferAV.popBuffer avcChange cur="+JSON.stringify(this.videoConfig)));let n=this.dtsChecker.isSync(),h=this.isPureAudio?this.aBuffer.playDts+t:r.endDts;if(n||(h=this.aBuffer.playDts+this.aBuffer.getBufferLen()),this.isShieldAudio){let t=this._setShieldBuffer(this.vBuffer.firstDts),e=this.firstVideoTs,i=this.firstShieldAudioTs,o=e-i;if(t)if(o<0&&o>-P.a.shieldAudioCfg[3]&&!this.isShieldFastToAlign)if(h<=i+this.popSize)s=this.aBuffer.getTrack(h),a=!1;else{const t=this.aShieldBuffer.samples[0].ts;this.aShieldBuffer.removeExpireBuffer(r.startDts,oe),this.aShieldBuffer.samples.length>0&&f.a.log(`BufferAv.popBuffer.shield to align, aRemoveShieldFirstTs=${t}, vshieldAlignTs=${r.startDts},ashieldAlignTs=${this.aShieldBuffer.samples[0].ts}, removeDelta=${this.aShieldBuffer.samples[0].ts-t}`),s=this.aShieldBuffer.getTrack(h),a=!0,this.aBuffer.removeExpireBuffer(h,ae),this.isShieldFastToAlign=!0}else this.isSwitchShieldFailed?(s=this.aBuffer.getTrack(h),a=!1):this.switchedShieldAudio?(a=!0,s=this.aShieldBuffer.getTrack(h),this.aBuffer.removeExpireBuffer(h,ae)):(this.switchedShieldAudio=!0,this.aShieldBuffer.removeExpireBuffer(r.startDts,oe),this.aShieldBuffer.hasPushBuffer(h)?(s=this.aShieldBuffer.getTrack(h),a=!0,this.aBuffer.removeExpireBuffer(h,ae),this._switchShieldAudioSuc()):0==this.aShieldBuffer.playDts?f.a.log(`BufferAv.popBuffer.shield audio curDts=${this.aShieldBuffer.playDts}, dts = 0, switch failed`):(this._switchShieldAudioFailed(de),f.a.warn(`BufferAv.popBuffer.shield audio curDts=${this.aShieldBuffer.playDts} far less than curDts=${h}, delta = ${h-this.aShieldBuffer.playDts}, switch failed`),s=this.aBuffer.getTrack(h)));else s=this.aBuffer.getTrack(h),a=!1;1===Number(localStorage._printShield)&&f.a.log(`BufferAv.popBuffer.shield: aac startDts=${s.startDts} endDts=${s.endDts} avc startDts=${r.startDts} endDts=${r.endDts}`,"gap:",r.endDts-s.endDts),q.remove(this._switchShieldTimeoutBind,this)}else a=!1,s=this.aBuffer.getTrack(h,t===Number.MAX_SAFE_INTEGER||t===this.waitSize),this.switchedShieldAudio&&this.clearShieldAudio();0!=this.startShieldTs&&(i=y.a.now()-this.startShieldTs,f.a.log(`BufferAv.popBuffer.shield: waitTime1 = ${e} waitTime2=${i}`),this.startShieldTs=0),a?(s.config=this.shieldAudioConfig.config,s.audiosamplerate=this.shieldAudioConfig.audiosamplerate,s.channelCount=this.shieldAudioConfig.channelCount,s.codec=this.shieldAudioConfig.codec):(s.config=this.audioConfig.config,s.audiosamplerate=this.audioConfig.audiosamplerate,s.channelCount=this.audioConfig.channelCount,s.codec=this.audioConfig.codec),s.isSync=n,s.timescale=this.timescale,s.duration=Math.round((s.endDts-s.startDts)*(this.timescale/1e3)),t===Number.MAX_SAFE_INTEGER&&f.a.log(`BufferAV.popAllBuffer video=[${r.startDts}, ${r.endDts}] audio=[${s.startDts}, ${s.endDts}] audioNum=${this.aBuffer.getSize()} audioEndDts=${this.aBuffer.lastSampleDts}`),1===Number(localStorage._printAVTrack)&&f.a.log(`BufferAV.popBuffer.shield vaStartDelta=${r.startDts-s.startDts},vaEndDelta=${r.endDts-s.endDts},avcDelta=${r.endDts-r.startDts},aacDelta=${s.endDts-s.startDts},avcStartDts= ${r.startDts},aacStartDts=${s.startDts},avcEndDts=${r.endDts},aacEndDts=${s.endDts}`),this.hasRemux=!0,this.remuxCb&&this.remuxCb(r,s)}clearBuffer(){this.vBuffer.clear(),this.aBuffer.clear(),this.aShieldBuffer.clear()}setNeedEmptyAudioFrame(t){this.aBuffer.needEmptyAudioFrame=t}getBufferLen(){return this.isPureAudio?this.aBuffer.getBufferLen():this.vBuffer.getBufferLen()}getSize(){return this.vBuffer.getSize()}}Ni.TYPES={avc:"avc",av01:"av01",aac:"aac"};var Fi=Ni;var Bi=class{constructor(){this.list=[],this.switchIFrameDts=0,this.switchIFramePts=0,this.lastIFrameDts=0,this.lastIFRamePts=0}getDts(){return this.switchIFrameDts||this.lastIFrameDts}getPts(){return this.switchIFramePts||this.lastIFRamePts}setSwitchTs(t,e){this.switchIFrameDts=t,this.switchIFramePts=e}setLastTs(t,e){this.lastIFrameDts=t,this.lastIFRamePts=e}resetPtsSample(){this.list=[]}addPtsSample(t,e,i,s,r,a){this.list.push({dts:t,pts:e,dtsGap:i,ptsGap:s,hasOrigin:r,isOrigin:a})}getMetric(){let t=[0,0,0],e=[0,0];if(this.list.length>0){let i=this.list[0],s=this.list[this.list.length-1];t[0]=i.dtsGap,t[1]=i.ptsGap,t[2]=this.list.length,t[3]=0,t[4]=s.ptsGap,e[0]=s.hasOrigin?1:2,e[1]=s.isOrigin?1:2,e[2]=0}return{values:t,strs:e}}};let Ui=null;const ki=0,xi=1,Hi=2;let Gi=0;var Wi=class{constructor(t,e,i){this.config=t,this.remuxCb=e,this.mse=i,this.hasVideoConfig=!1,this.needEmptyAudioFrame=!0,this.timescale=9e4,this.hasFrame=!1,this.state=ki,this.switchTs=new Bi,this.avBuffer=this._createBuffer(),this.evalBw=null,this.callbacks=null,this._buffered=null,this.id=Gi++,f.a.log(`CtrlBuffer.constructor(${this.id})`),this._curFrameId=0,this.avcChangeTime=0}setCurFrameId(t){this._curFrameId=t}setBuffered(t){this._buffered=t}addBuffered(t,e,i){(t.type===Fi.TYPES.avc||t.type===Fi.TYPES.av01&&this._buffered)&&this._buffered.addSample(this._curFrameId,t.ts,e,i)}destroy(){this.remuxCb=null,this.callbacks=null,this._destroyBuffer()}_destroyBuffer(){this.avBuffer&&(this.avBuffer.destroy(),this.avBuffer=null)}_createBuffer(){this._destroyBuffer();let t=new Fi(this.config,this.remuxCb,this);return t.timescale=this.timescale,t.setNeedEmptyAudioFrame(this.needEmptyAudioFrame),t}pause(){this.avBuffer.paused=!0}play(){this.avBuffer.paused=!1}isPaused(){return this.avBuffer.paused}isWaitForIFrame(){return this.state===xi}switchBitrate(t,e,i){f.a.log(`CtrlBuffer(${this.id}).switchBitrate isDown=${t}`),this._lastBitrate=e,this._curBitrate=i,this.state=xi}switchBack(){f.a.log(`CtrlBuffer(${this.id}).switchBack switchIFramePts=${this.switchTs.getDts()} lastIFramePts=${this.switchTs.getPts()}`),this.state=Hi,this.avBuffer=this._createBuffer(),this.callbacks&&this.callbacks.start(this.switchTs.getDts(),this.switchTs.getPts())}switchShieldAudio(t){this.avBuffer&&this.avBuffer.switchShieldAudio&&this.avBuffer.switchShieldAudio(t)}setEval(t){this.evalBw=t}resetAudioDts(){this.avBuffer&&this.avBuffer.resetAudioDts()}addSample(t){if(!this.avBuffer)return;let e=t.key&&(!this.avBuffer.hasOriginIFrame||t.origin_iframe);if(e&&this.switchTs.setLastTs(t.ts,t.ts+t.cts),t.type!==Fi.TYPES.avc&&t.type!==Fi.TYPES.av01||this.evalBw&&this.evalBw.addSample(t),this.state===Hi&&(this.hasFrame||t.type!==Fi.TYPES.avc&&t.type!==Fi.TYPES.av01||(f.a.log(`CtrlBuffer(${this.id}).addSample first sample dts=${t.ts} pts=${t.ts+t.cts}`),Ui&&Ui.recordPts("firstMap",this._lastBitrate,this._curBitrate,t.ts+t.cts!==this.switchTs.getPts()),this.hasFrame=!0,this.callbacks&&this.callbacks.first())),t.type!==Fi.TYPES.avc&&t.type!==Fi.TYPES.av01||this.hasVideoConfig)if(this.state===Hi){if(t.key){let e=t.ts+t.cts,i=t.ts-this.switchTs.getDts(),s=e-this.switchTs.getPts();f.a.log(`CtrlBuffer(${this.id}).addSample find IFrame origin_iframe=${t.origin_iframe} dts=${t.ts} pts=${e} switchDts=${this.switchTs.switchIFrameDts} switchPts=${this.switchTs.switchIFramePts} dtsGap=${i} ptsGap=${s} iFrameGap=${this.avBuffer.gop}`),Ui&&Ui.recordPts("useMap",this._lastBitrate,this._curBitrate,0!==s),this.switchTs.addPtsSample(t.ts,e,i,s,this.avBuffer.hasOriginIFrame,t.origin_iframe),e>=this.switchTs.switchIFramePts&&(f.a.log(`CtrlBuffer(${this.id}).addSample find new IFrame, switch done`),this.state=ki,this.switchTs.setSwitchTs(0,0),this.avBuffer.addSample(t),this.addBuffered(t,!0,s),this.callbacks&&this.callbacks.done(i,t.ts,s))}}else this.state===xi?e?(this._popAllBuffer(),this.avBuffer.hasOriginIFrame=!1,this.hasVideoConfig=!1,this.hasFrame=!1,this.state=Hi,this.switchTs.setSwitchTs(t.ts,t.ts+t.cts),this.switchTs.resetPtsSample(),f.a.log(`CtrlBuffer(${this.id}).addSample find next IFrame origin_iframe=${t.origin_iframe} dts=${this.switchTs.switchIFrameDts} pts=${this.switchTs.switchIFramePts} iFrameGap=${this.avBuffer.gop}, switch start!`),this.callbacks&&this.callbacks.start(this.switchTs.switchIFrameDts,this.switchTs.switchIFramePts)):(t.key&&f.a.log(`CtrlBuffer(${this.id}).addSample find next IFrame fail, origin_iframe=${t.origin_iframe} dts=${t.ts} pts=${t.ts+t.cts}`),this.avBuffer.addSample(t),this.addBuffered(t,!1,0)):(1===Number(localStorage._printIFramePts)&&t.key&&f.a.log(`CtrlBuffer(${this.id}).addSample find next IFrame fail, origin_iframe=${t.origin_iframe} dts=${t.ts} pts=${t.ts+t.cts}`),this.avBuffer.addSample(t),this.addBuffered(t,!1,0))}addShieldAudioSample(t){this.avBuffer.addShieldAudioSample(t),this.addBuffered(t,!1,0)}_popAllBuffer(){this.avBuffer&&(this.avBuffer.getBufferLen()>0&&this.avBuffer.popBuffer(Number.MAX_SAFE_INTEGER),this.avBuffer.clearBuffer())}updateVideoConfig(t,e){e&&(this.avcChangeTime=y.a.now(),this._popAllBuffer()),this.hasVideoConfig=!0,this.avBuffer&&this.avBuffer.updateVideoConfig(t,e)}updateAudioConfig(t,e,i,s){e&&this._popAllBuffer(),this.avBuffer&&this.avBuffer.updateAudioConfig&&this.avBuffer.updateAudioConfig(t,i,s)}setNeedEmptyAudioFrame(t){this.needEmptyAudioFrame=t,this.avBuffer.setNeedEmptyAudioFrame(t)}isInAvcChangeTime(t){let e=y.a.now();return this.avcChangeTime+t<e}getBufferLen(){return this.avBuffer.getBufferLen()}getVideoBufferLen(){return this.mse.getBufferLen()}getLastIFrameDts(){return this.switchTs.lastIFrameDts}getSize(){return this.avBuffer.getSize()}onSwitchShieldAudioFail(t,e){this.mse&&this.mse.onSwitchShieldAudioFail(t,e)}onSwitchShieldAudioSuc(t){this.mse&&this.mse.onSwitchShieldAudioSuc(t)}shieldAuidoMute(t,e){this.mse&&this.mse.shieldAuidoMute(t,e)}getIframePts(){return this.switchTs.getPts()||0}};var $i=class{constructor(){this.avDifTotal=0,this.avDifCnt=0,this.avDifMax=0,this.emptyFrames=0}checkSync(t,e){if(t&&0!=t.samples.length)if(this.emptyFrames+=e.emptyFrames,!e.hasOwnProperty("isSync")||e.isSync)if(t.endDts>0&&e.endDts>0){let i=t.endDts-e.endDts;this.avDifTotal+=i,this.avDifCnt++,this.avDifMax<i&&(this.avDifMax=i),i>200&&0===e.emptyFrames&&f.a.warn(`AVSyncStat.checkSync avDif=${i} video=[${t.startDts}, ${t.endDts}] videoPlayDts=${t.playDts} audio=[${e.startDts}, ${e.endDts}] audioPlayDts=${e.playDts}`)}else f.a.log(`AVSyncStat.checkSync video=[${t.startDts}, ${t.endDts}] videoPlayDts=${t.playDts} audio=[${e.startDts}, ${e.endDts}] audioPlayDts=${e.playDts}`);else e.emptyFrames>0&&f.a.log(`AVSyncStat.checkSync isSync=${e.isSync} video=[${t.startDts}, ${t.endDts}] videoPlayDts=${t.playDts} audio=[${e.startDts}, ${e.endDts}] audioPlayDts=${e.playDts}`)}record(t){if(this.avDifCnt>0){let e=Math.round(this.avDifTotal/this.avDifCnt);t.setCore(L.a.DIM_CORE.AVSDA,e),t.setCore(L.a.DIM_CORE.AVSDM,this.avDifMax),t.setCore(L.a.DIM_CORE.AVEFS,this.emptyFrames)}this.avDifCnt=0,this.avDifTotal=0,this.avDifMax=0,this.emptyFrames=0}};var Yi=class{constructor(t){this.mse=t,this.eventEmitter=this.mse.handler.eventEmitter,this.stat=this.mse.handler.stat,this.lastTs=0,this.renderNum=0,this.fpsTotal=0,this.fpsNum=0,this.recordTotal=0,this.recordNum=0,this.lastEachTs=0,this.renderBadQuality=0,this.isFirstRender=!0,this.prePageRenderTs=0,this.pageRecordTotal=0,this.pageRecordNum=0,this.pageRenderNum=0,this.pageFpsTotal=0,this.pageFpsNum=0,this.pageFpsMax=0,this.pageFpsMin=0,this._onVisibilityChangeBind=this._onVisibilityChange.bind(this),this.eventEmitter&&this.eventEmitter.on(m.VISIBILITY_CHANGE,this._onVisibilityChangeBind)}reset(){this.fpsNum=0,this.fpsTotal=0,this.renderNum=0,this.recordTotal=0,this.recordNum=0,this.lastEachTs=0,this.renderBadQuality=0,this.isFirstRender=!0,this.prePageRenderTs=0,this.pageRecordTotal=0,this.pageRecordNum=0,this.pageRenderNum=0,this.pageFpsTotal=0,this.pageFpsNum=0,this.pageFpsMax=0,this.pageFpsMin=0}getRecordFps(){let t=this.fpsTotal-this.recordTotal,e=this.fpsNum-this.recordNum;return e>0?(this.recordTotal=this.fpsTotal,this.recordNum=this.fpsNum,Math.round(t/e)):0}addRender(){let t=y.a.now();if(this.renderNum++,0===this.lastTs)this.lastTs=t;else{let e=t-this.lastTs;if(e>=1e3){this.lastTs=t;let i=Math.floor(this.renderNum/(e/1e3));this.fpsNum++,this.fpsTotal+=i,this.renderNum=0}}this._checkRenderQuality(t)}getPageRecordFps(){const t=this.pageFpsTotal-this.pageRecordTotal,e=this.pageFpsNum-this.pageRecordNum;let i=0,s=this.pageFpsMax,r=this.pageFpsMin;e>0&&(this.pageRecordTotal=this.pageFpsTotal,this.pageRecordNum=this.pageFpsNum,i=Math.round(t/e));let a={pfps:i,pfpsMax:s,pfpsMin:r};return this.pageFpsMax=0,this.pageFpsMin=0,a}addPageRender(){let t=y.a.now();if(this.pageRenderNum++,0===this.prePageRenderTs)this.prePageRenderTs=t;else{let e=t-this.prePageRenderTs;if(e>=1e3){this.prePageRenderTs=t;let i=Math.round(this.pageRenderNum/(e/1e3));if(this.pageFpsNum++,this.pageFpsTotal+=i,this.pageRenderNum=0,this.pageFpsMax=Math.max(i,this.pageFpsMax),0!=i)return 0==this.pageFpsMin?this.pageFpsMin=i:this.pageFpsMin=Math.min(i,this.pageFpsMin),i}}return 0}_checkRenderQuality(t){if(0===this.lastEachTs)this.lastEachTs=t;else{let e=t-this.lastEachTs;!this.isFirstRender&&e>200&&(this.renderBadQuality=100,this.stat.addCore(L.a.DIM_CORE.VRBQC,1),this.stat.addCore(L.a.DIM_CORE.VRBQD,e),f.a.warn("RenderFps._checkRenderQuality render bad quality time=",e)),this.isFirstRender=!1,this.lastEachTs=t}}statRenderQuality(){const t=this.renderBadQuality;return this.renderBadQuality=0,t}_onVisibilityChange(){(document.hidden||document.webkitHidden||document.mozHidden||document.msHidden)&&(this._checkRenderQuality(y.a.now()),this.lastTs=0,this.lastEachTs=0,this.renderNum=0)}};var Ki=class{constructor(t){this.mse=t,this.eventEmitter=this.mse.handler.eventEmitter,this.recvFrameDataList=[],this.remuxFrameDataList=[],this.pushedVideoDataList=[],this.frameRecvToPushConSumingMax=0,this.frameRecvToPushConSumingFrames=0,this.frameRecvToPushConSumingTotalTime=0,this.framePushToRenderedConSumingMax=0,this.framePushToRenderedConSumingFrames=0,this.framePushToRenderedConSumingTotalTime=0,this.frameRecvToRenderMax=0,this.frameRecvToRenderConSumingFrames=0,this.frameRecvToRenderConSumingTotalTime=0,this._onVisibilityChangeBind=this._onVisibilityChange.bind(this),this.eventEmitter&&this.eventEmitter.on(m.VISIBILITY_CHANGE,this._onVisibilityChangeBind)}clearConsuming(){this.recvFrameDataList=[],this.remuxFrameDataList=[],this.pushedVideoDataList=[],this.frameRecvToPushConSumingMax=0,this.frameRecvToPushConSumingFrames=0,this.frameRecvToPushConSumingTotalTime=0,this.framePushToRenderedConSumingMax=0,this.framePushToRenderedConSumingFrames=0,this.framePushToRenderedConSumingTotalTime=0,this.frameRecvToRenderMax=0,this.frameRecvToRenderConSumingFrames=0,this.frameRecvToRenderConSumingTotalTime=0}addRecvFrameData(t,e,i){P.a.renderStat[0]&&this.recvFrameDataList.push({ts:t,pts:e,time:i})}addRemuxFrameData(t,e,i){P.a.renderStat[0]&&this.remuxFrameDataList.push({ts:t,pts:e,time:i})}pushRemuxedVideoFrameData(t){if(P.a.renderStat[0]){for(let e=0;e<this.remuxFrameDataList.length;e++){let i=this.recvFrameDataList.find(t=>t.ts===this.remuxFrameDataList[e].ts);if(i){let e=t-i.time;this.frameRecvToPushConSumingTotalTime+=e,this.frameRecvToPushConSumingFrames++,this.frameRecvToPushConSumingMax=Math.max(e,this.frameRecvToPushConSumingMax)}this.pushedVideoDataList.push({ts:this.remuxFrameDataList[e].ts,pts:this.remuxFrameDataList[e].pts,time:t})}this.remuxFrameDataList=[]}}addRenderFrameData(t,e){if(P.a.renderStat[0]){for(let i=0;i<this.recvFrameDataList.length;i++)for(;this.recvFrameDataList.length>0&&this.recvFrameDataList[0].pts<t;){let t=e-this.recvFrameDataList[0].time;this.frameRecvToRenderMax=Math.max(t,this.frameRecvToRenderMax),this.frameRecvToRenderConSumingFrames++,this.frameRecvToRenderConSumingTotalTime+=t,this.recvFrameDataList.shift()}for(let i=0;i<this.pushedVideoDataList.length;i++)for(;this.pushedVideoDataList.length>0&&this.pushedVideoDataList[0].pts<t;){let t=e-this.pushedVideoDataList[0].time;this.framePushToRenderedConSumingMax=Math.max(t,this.framePushToRenderedConSumingMax),this.framePushToRenderedConSumingFrames++,this.framePushToRenderedConSumingTotalTime+=t,this.pushedVideoDataList.shift()}}}getRecvToPushConsuming(){return{max:this.frameRecvToPushConSumingMax,avg:this.frameRecvToPushConSumingFrames>0?this.frameRecvToPushConSumingTotalTime/this.frameRecvToPushConSumingFrames:0}}getPushToRenderedConSuming(){return{max:this.framePushToRenderedConSumingMax,avg:this.framePushToRenderedConSumingFrames>0?this.framePushToRenderedConSumingTotalTime/this.framePushToRenderedConSumingFrames:0}}getRecvToRenderConsuming(){return{max:this.frameRecvToRenderMax,avg:this.frameRecvToRenderConSumingFrames>0?this.frameRecvToRenderConSumingTotalTime/this.frameRecvToRenderConSumingFrames:0}}_onVisibilityChange(){this.clearConsuming()}destroy(){this.eventEmitter&&this.eventEmitter.off(m.VISIBILITY_CHANGE,this._onVisibilityChangeBind)}};let ji=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,qi=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;var zi=!1,Ji=[],Qi=0,Xi=null;const Zi=1,ts=2;let es=0,is=0,ss=0;function rs(){ji(rs),function(){let t=y.a.now();if(es++,0===is)is=t;else{let e=t-is;if(e>=1e3){is=t;let i=Math.round(es/(e/1e3));es=0,ss=Math.max(i,ss)}}}()}function as(t,e){for(var i=0,s=Ji.length;i<s;i++){var r=Ji[i];if(r.callback==t&&r.thisObj==e)return r}return null}function os(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if((i=0|(Number(i)||0))<10||i%10!=0||!t)return f.a.error("Timer.add Invalide interval value or callback function."),!1;var a=as(t,e);return a||(a={callback:t,thisObj:e,bindCallback:e?t.bind(e):t,param:s},Ji.push(a)),a.times=r,a.tickCount=0,a.interval=i/10,a.delayDel=!1,ns(),!0}function ns(){Xi?Xi.postMessage("start"):!Qi&&Ji.length>0&&(Qi=setInterval(hs,10))}function hs(){if(0!=Ji.length){zi=!0;for(var t=y.a.now(),e=Ji.length-1;e>=0;e--){var i=Ji[e];if(i&&!i.delayDel){if(++i.tickCount%i.interval==0){var s=i.bindCallback,r=i.tickCount/i.interval;s(t,r,i.param),i.times>0&&i.times<=r&&i.tickCount>0&&Ji.splice(e,1)}}else Ji.splice(e,1)}zi=!1}else 1==Xi?Xi.postMessage("stop"):(clearInterval(Qi),Qi=0)}var ds={initWorker:function(){(Xi=N()(24))?(Xi.addEventListener("message",t=>{t.data.type==Zi?hs():t.data.type==ts&&(ss=t.data.data)}),Xi.addEventListener("error",t=>{f.a.error("TimerWorker.error:",t.lineno+","+t.colno,t.message),Xi.terminate(),Xi=null,f.a.warn("[ TimerWorker terminate ]"),ns()})):ji(rs)},has:function(t,e){return!!as(t,e)},add:os,remove:function(t,e){for(var i=0,s=Ji.length;i<s;i++){var r=Ji[i];if(r.callback==t&&r.thisObj==e)return zi?r.delayDel=!0:Ji.splice(i,1),!0}return!1},once:function(t,e,i,s){os(t,e,i+10,s,1)},getSize:()=>Ji.length,getPageFpsMax:()=>ss},ls=i(16);class us{constructor(){this.buffer=null,this.view=null,this.size=0,this.pos=0}destroy(){this.buffer=null,this.view=null,this.size=0,this.pos=0}appendBuffer(t){t=new Uint8Array(t);let e=new Uint8Array(this.size+t.length);this.buffer&&e.set(this.buffer,0),e.set(t,this.size),this.size=e.byteLength,this.buffer=e,this.view=new DataView(e.buffer)}peekString(t,e){let i=this.pos+t,s="";for(let t=0;t<e;t++)s+=String.fromCharCode(this.view.getUint8(i+t));return s}peekBuffer(t,e){return t=this.pos+t,new Uint8Array(this.view.buffer.slice(t,Math.min(t+e,this.size)))}peekAnyInt(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=0;if(this.pos+t<=this.size){switch(t){case 1:i=e?this.view.getInt8(this.pos):this.view.getUint8(this.pos);break;case 2:i=e?this.view.getInt16(this.pos):this.view.getUint16(this.pos);break;case 3:if(e)throw"peekAnyInt signed 24 bits values wrong";i=this.view.getUint8(this.pos)<<16,i|=this.view.getUint8(this.pos+1)<<8,i|=this.view.getUint8(this.pos+2);break;case 4:i=e?this.view.getInt32(this.pos):this.view.getUint32(this.pos);break;case 8:if(e)throw"peekAnyInt signed 64 bits values wrong";i=this.view.getUint32(this.pos)*us.MAX_UINT+this.view.getUint32(this.pos+4);break;default:throw"peekAnyInt not implemented for size: "+t}return i}throw"Not enough bytes in buffer"}readUint8(){let t=this.peekAnyInt(1);return this.pos++,t}readUint16(){let t=this.peekAnyInt(2);return this.pos+=2,t}readUint24(){let t=this.peekAnyInt(3);return this.pos+=3,t}readUint32(){let t=this.peekAnyInt(4);return this.pos+=4,t}readInt32(){let t=this.peekAnyInt(4,!0);return this.pos+=4,t}readUint64(){let t=this.peekAnyInt(8);return this.pos+=8,t}readStr(t){let e=this.peekString(0,t);return this.pos+=t,e}skip(t){this.pos+=t}getPos(){return this.pos}isCanRead(t){return this.size-this.pos>=t}static writeUint64(t,e,i){let s=Math.floor(i/us.MAX_UINT),r=4294967295&i;t.setUint32(e,s),t.setUint32(e+4,r)}}us.MAX_UINT=Math.pow(2,32);var cs=us;var ps=class{constructor(){this.startOffset=0,this.size=0,this.type=""}destroy(){}read(t){this.startOffset=t.getPos(),this.size=t.readUint32(),this.type=t.readStr(4)}readContainer(t){let e=this.size+t.getPos()-8;for(;t.getPos()<e;){let e=t.peekString(4,4),i=Fs.createBox(e);i.read(t),this.onReadBox(i)}}onReadBox(t){}remux(){return null}fillHeader(t,e,i,s){e.setUint32(0,s),t.set(Fs.getCharCode(i),4)}getSize(){return 8}};var ms=class extends ps{constructor(){super(),this.major_brand="",this.minor_version=0,this.compatible_brands=""}getSize(){return super.getSize()+4+4+this.compatible_brands.length}read(t){super.read(t),this.major_brand=t.readStr(4),this.minor_version=t.readUint32(),this.compatible_brands=t.readStr(this.size-16)}remux(){let t=this.getSize(),e=new Uint8Array(t),i=new DataView(e.buffer);this.fillHeader(e,i,Fs.STYP,t);let s=8;return this.fillStr(e,s,this.major_brand),s+=4,i.setUint32(s,this.minor_version),s+=4,this.fillStr(e,s,this.compatible_brands),e}fillStr(t,e,i){for(let s=0;s<i.length;s++)t[e+s]=i.charCodeAt(s)}};var fs=class extends ps{constructor(){super(),this.version=0,this.flags=0}read(t){super.read(t),this.version=t.readUint8(),this.flags=t.readUint24()}fillHeader(t,e,i,s){super.fillHeader(t,e,i,s),t[8]=this.version,t[9]=this.flags>>16&255,t[10]=this.flags>>8&255,t[11]=255&this.flags}getSize(){return super.getSize()+4}};var _s=class extends fs{constructor(){super(),this.reference_id=0,this.time_scale=0,this.earliest_presentation_time=0,this.first_offset=0,this.reserved=0,this.reference_count=0,this.reference_list=[],this.reference_data=[],this.earliest_presentation_time_offset=0}destroy(){this.reference_list=[],this.reference_data=[],super.destroy()}updateReference(t){if(this.reference_count>0){let e=t.trun.getRemuxSampleCnt(),i=this.reference_list[0];i.referenced_size=t.trun.getMdatSize(),i.subsegment_duration=e*t.tfhd.default_sample_duration}}updateEarliestPresentationTime(t){let e=t.trun.getRemuxSampleCnt();this.earliest_presentation_time_offset=e*t.tfhd.default_sample_duration}read(t){super.read(t),this.reference_id=t.readUint32(),this.time_scale=t.readUint32(),0===this.version?(this.earliest_presentation_time=t.readUint32(),this.first_offset=t.readUint32()):(this.earliest_presentation_time=t.readUint64(),this.first_offset=t.readUint64()),this.reserved=t.readUint16(),this.reference_count=t.readUint16();for(let e=0;e<this.reference_count;e++){let e={},i=t.readUint32();this.reference_data.push(i),e.reference_type=i>>31&1,e.referenced_size=2147483647&i,e.subsegment_duration=t.readUint32(),this.reference_data.push(e.subsegment_duration),i=t.readUint32(),this.reference_data.push(i),e.starts_with_SAP=i>>31&1,e.SAP_type=i>>28&7,e.SAP_delta_time=268435455&i,this.reference_list.push(e)}}getSize(){let t=super.getSize();return t+=4,t+=4,t+=0===this.version?8:16,t+=2,t+=2,t+=12*this.reference_count,t}remux(){let t=this.getSize(),e=new Uint8Array(t),i=new DataView(e.buffer);this.fillHeader(e,i,Fs.SIDX,t);let s=12;i.setUint32(s,this.reference_id),s+=4,i.setUint32(s,this.time_scale),s+=4,0===this.version?(i.setUint32(s,this.earliest_presentation_time+this.earliest_presentation_time_offset),s+=4,i.setUint32(s,this.first_offset),s+=4):(cs.writeUint64(i,s,this.earliest_presentation_time+this.earliest_presentation_time_offset),s+=8,cs.writeUint64(i,s,this.first_offset),s+=8),i.setUint16(s,this.reserved),s+=2,i.setUint16(s,this.reference_count),s+=2;for(let t=0;t<this.reference_data.length;t++)i.setUint32(s,this.reference_data[t]),s+=4;return e}};var gs=class extends ps{constructor(){super(),this.mfhd=null,this.trafVideo=null,this.trafAudio=null}destroy(){this.mfhd.destroy(),this.trafVideo.destroy(),this.trafAudio.destroy(),this.mfhd=null,this.trafVideo=null,this.trafAudio=null,super.destroy()}read(t){super.read(t),this.readContainer(t),this.trafVideo&&this.trafAudio&&(this.trafVideo.trun.data_offset>this.trafAudio.trun.data_offset?(this.trafAudio.calcSampleMdatDataOffset(0),this.trafVideo.calcSampleMdatDataOffset(this.trafAudio.getSampleDataSize())):(this.trafVideo.calcSampleMdatDataOffset(0),this.trafAudio.calcSampleMdatDataOffset(this.trafVideo.getSampleDataSize())))}onReadBox(t){t.type===Fs.MFHD?this.mfhd=t:t.type===Fs.TRAF&&(t.isVideo()?this.trafVideo=t:this.trafAudio=t)}readMdat(t){this.trafVideo&&this.trafVideo.readMdat(t),this.trafAudio&&this.trafAudio.readMdat(t)}getSize(){let t=super.getSize()+this.mfhd.getSize();return this.trafVideo&&(t+=this.trafVideo.getSize()),this.trafAudio&&(t+=this.trafAudio.getSize()),t}remux(){let t=this.mfhd.remux(),e=null;this.trafVideo&&(e=this.trafVideo.remux());let i=null;this.trafAudio&&(i=this.trafAudio.remux());let s=this.getSize(),r=new Uint8Array(s),a=new DataView(r.buffer);this.fillHeader(r,a,Fs.MOOF,s);let o=8;return r.set(t,o),o+=t.length,e&&(r.set(e,o),o+=e.length),i&&(r.set(i,o),o+=i.length),r}updateMdatDataOffset(){let t=this.getSize();t+=8,this.trafVideo&&this.trafAudio?(this.trafVideo.trun.remux_data_offset=t,this.trafAudio.trun.remux_data_offset=t+this.trafVideo.trun.getMdatSize()):this.trafVideo?this.trafVideo.trun.remux_data_offset=t:this.trafAudio&&(this.trafAudio.trun.remux_data_offset=t)}updateBaseMediaDecodeTime(){this.trafVideo&&this.trafVideo.updateBaseMediaDecodeTime(),this.trafAudio&&this.trafAudio.updateBaseMediaDecodeTime()}};var Ss=class extends fs{constructor(){super(),this.sequence_number=0}read(t){super.read(t),this.sequence_number=t.readUint32()}getSize(){return super.getSize()+4}remux(){let t=this.getSize(),e=new Uint8Array(t),i=new DataView(e.buffer);return this.fillHeader(e,i,Fs.MFHD,t),i.setUint32(12,this.sequence_number),e}};var Ts=class extends ps{constructor(){super(),this.tfhd=null,this.tfdt=null,this.trun=null}destroy(){this.tfhd.destroy(),this.tfdt.destroy(),this.trun.destroy(),this.tfhd=null,this.tfdt=null,this.trun=null,super.destroy()}isVideo(){return 1===this.tfhd.track_id}getDuration(){return this.trun.sampleMdatIndex*this.tfhd.default_sample_duration}getSampleDataSize(){return this.trun?this.trun.getSampleDataSize(this.tfhd):0}calcSampleMdatDataOffset(t){this.trun.calcSampleMdatDataOffset(t,this.tfhd)}readMdat(t){this.trun&&this.trun.readMdat(t,this.tfhd)}read(t){super.read(t),this.readContainer(t)}onReadBox(t){t.type===Fs.TFHD?this.tfhd=t:t.type===Fs.TFDT?this.tfdt=t:t.type===Fs.TRUN&&(this.trun=t)}getBound(){return{start:this.trun.remuxSampleStart,end:this.trun.remuxSampleEnd}}getSize(){return super.getSize()+this.tfhd.getSize()+this.tfdt.getSize()+this.trun.getSize()}remux(){let t=this.getSize(),e=new Uint8Array(t),i=new DataView(e.buffer);this.fillHeader(e,i,Fs.TRAF,t);let s=this.tfhd.remux(),r=this.tfdt.remux(),a=this.trun.remux(),o=8;return e.set(s,o),o+=s.length,e.set(r,o),o+=r.length,e.set(a,o),o+=a.length,e}updateBaseMediaDecodeTime(){let t=this.trun.getRemuxSampleCnt();this.tfdt.base_media_decode_time_offset=t*this.tfhd.default_sample_duration}};class ys extends fs{constructor(){super(),this.track_id=0,this.base_data_offset=0,this.sample_description_index=0,this.default_sample_duration=0,this.default_sample_size=0,this.default_sample_flags=0}read(t){super.read(t),this.track_id=t.readUint32(),this.flags&ys.FLAG_BASE_DATA_OFFSET&&(this.base_data_offset=t.readUint64()),this.flags&ys.FLAG_SAMPLE_DESC&&(this.sample_description_index=t.readUint32()),this.flags&ys.FLAG_SAMPLE_DUR&&(this.default_sample_duration=t.readUint32()),this.flags&ys.FLAG_SAMPLE_SIZE&&(this.default_sample_size=t.readUint32()),this.flags&ys.FLAG_SAMPLE_FLAGS&&(this.default_sample_flags=t.readUint32())}getSize(){let t=super.getSize();return t+=4,this.flags&ys.FLAG_BASE_DATA_OFFSET&&(t+=8),this.flags&ys.FLAG_SAMPLE_DESC&&(t+=4),this.flags&ys.FLAG_SAMPLE_DUR&&(t+=4),this.flags&ys.FLAG_SAMPLE_SIZE&&(t+=4),this.flags&ys.FLAG_SAMPLE_FLAGS&&(t+=4),t}remux(){let t=this.getSize(),e=new Uint8Array(t),i=new DataView(e.buffer);this.fillHeader(e,i,Fs.TFHD,t),i.setUint32(12,this.track_id);let s=16;return this.flags&ys.FLAG_BASE_DATA_OFFSET&&(cs.writeUint64(i,s,this.base_data_offset),s+=8),this.flags&ys.FLAG_SAMPLE_DESC&&(i.setUint32(s,this.sample_description_index),s+=4),this.flags&ys.FLAG_SAMPLE_DUR&&(i.setUint32(s,this.default_sample_duration),s+=4),this.flags&ys.FLAG_SAMPLE_SIZE&&(i.setUint32(s,this.default_sample_size),s+=4),this.flags&ys.FLAG_SAMPLE_FLAGS&&(i.setUint32(s,this.default_sample_flags),s+=4),e}}ys.FLAG_BASE_DATA_OFFSET=1,ys.FLAG_SAMPLE_DESC=2,ys.FLAG_SAMPLE_DUR=8,ys.FLAG_SAMPLE_SIZE=16,ys.FLAG_SAMPLE_FLAGS=32,ys.FLAG_DUR_EMPTY=65536,ys.FLAG_DEFAULT_BASE_IS_MOOF=131072;var Es=ys;var vs=class extends fs{constructor(){super(),this.base_media_decode_time=0,this.base_media_decode_time_offset=0}read(t){super.read(t),1===this.version?this.base_media_decode_time=t.readUint64():this.base_media_decode_time=t.readUint32()}getSize(){let t=super.getSize();return t+=1===this.version?8:4,t}remux(){let t=this.getSize(),e=new Uint8Array(t),i=new DataView(e.buffer);return this.fillHeader(e,i,Fs.TFDT,t),1===this.version?cs.writeUint64(i,12,this.base_media_decode_time+this.base_media_decode_time_offset):i.setUint32(12,this.base_media_decode_time+this.base_media_decode_time_offset),e}};var Cs=class{constructor(){this.sample_duration=0,this.sample_size=0,this.sample_flags=0,this.sample_composition_time_offset=0,this.dataOffset=0,this.units=null}destroy(){this.units=null}};class Ps extends fs{constructor(){super(),this.sample_count=0,this.data_offset=0,this.first_sample_flags=0,this.samples=[],this.sampleMdatIndex=0,this.sampleMdatSize=0,this.remuxSampleStart=0,this.remuxSampleEnd=0,this.remux_data_offset=0}destroy(){this.samples.forEach(t=>{t.destroy()}),this.samples=[],super.destroy()}createEmptySamples(t){this.remuxSampleEnd=t;for(let e=0;e<t;e++){let t=this.samples[e];t.units=new Uint8Array(Qe.emptyAacFrame),t.sample_size=t.units.length}this.sampleMdatIndex=t}readMdat(t,e){for(;this.sampleMdatIndex<this.sample_count;){let i=this.samples[this.sampleMdatIndex];if(!t.readSample(i,e))break;this.sampleMdatIndex++}}read(t){super.read(t),this.sample_count=t.readUint32(),this.flags&Ps.FLAGS_DATA_OFFSET&&(this.data_offset=t.readUint32()),this.flags&Ps.FLAGS_FIRST_FLAG&&(this.first_sample_flags=t.readUint32());for(let e=0;e<this.sample_count;e++){let e=new Cs(this.flags);this.flags&Ps.FLAGS_DURATION&&(e.sample_duration=t.readUint32()),this.flags&Ps.FLAGS_SIZE&&(e.sample_size=t.readUint32()),this.flags&Ps.FLAGS_FLAGS&&(e.sample_flags=t.readUint32()),this.flags&Ps.FLAGS_CTS_OFFSET&&(0===this.version?e.sample_composition_time_offset=t.readUint32():e.sample_composition_time_offset=t.readInt32()),this.sampleMdatSize+=e.sample_size,this.samples.push(e)}}calcSampleMdatDataOffset(t,e){for(let i=0;i<this.sample_count;i++){let s=this.samples[i];s.dataOffset=t,0===s.sample_size?t+=e.default_sample_size:t+=s.sample_size}}getRemuxSampleCnt(){return this.remuxSampleEnd-this.remuxSampleStart}getSize(){let t=super.getSize();return t+=4,this.flags&Ps.FLAGS_DATA_OFFSET&&(t+=4),this.flags&Ps.FLAGS_FIRST_FLAG&&(t+=4),t+=(this.remuxSampleEnd-this.remuxSampleStart)*this.getSampleSize(),t}getSampleDataSize(t){let e=0;for(let i=0;i<this.sample_count;i++){let s=this.samples[i];0===s.sample_size?e+=t.default_sample_size:e+=s.sample_size}return e}getSampleSize(){let t=0;return this.flags&Ps.FLAGS_DURATION&&(t+=4),this.flags&Ps.FLAGS_SIZE&&(t+=4),this.flags&Ps.FLAGS_FLAGS&&(t+=4),this.flags&Ps.FLAGS_CTS_OFFSET&&(t+=4),t}getMdatSize(){let t=0;for(let e=this.remuxSampleStart;e<this.remuxSampleEnd;e++){t+=this.samples[e].units.length}return t}getMdat(){let t=this.getMdatSize(),e=0,i=new Uint8Array(t);for(let t=this.remuxSampleStart;t<this.remuxSampleEnd;t++){let s=this.samples[t];i.set(s.units,e),e+=s.units.length}return i}remux(){let t=this.getSize(),e=new Uint8Array(t),i=new DataView(e.buffer);this.fillHeader(e,i,Fs.TRUN,t),i.setUint32(12,this.remuxSampleEnd-this.remuxSampleStart);let s=16;this.flags&Ps.FLAGS_DATA_OFFSET&&(i.setUint32(s,this.remux_data_offset),s+=4),this.flags&Ps.FLAGS_FIRST_FLAG&&(i.setUint32(s,this.first_sample_flags),s+=4);for(let t=this.remuxSampleStart;t<this.remuxSampleEnd;t++){let e=this.samples[t];this.flags&Ps.FLAGS_DURATION&&(i.setUint32(s,e.sample_duration),s+=4),this.flags&Ps.FLAGS_SIZE&&(i.setUint32(s,e.sample_size),s+=4),this.flags&Ps.FLAGS_FLAGS&&(i.setUint32(s,e.sample_flags),s+=4),this.flags&Ps.FLAGS_CTS_OFFSET&&(0===this.version?i.setUint32(s,e.sample_composition_time_offset):i.setInt32(s,e.sample_composition_time_offset),s+=4)}return e}}Ps.FLAGS_DATA_OFFSET=1,Ps.FLAGS_FIRST_FLAG=4,Ps.FLAGS_DURATION=256,Ps.FLAGS_SIZE=512,Ps.FLAGS_FLAGS=1024,Ps.FLAGS_CTS_OFFSET=2048;var Ds=Ps;var Is=class extends ps{constructor(t){super(),this.data_len=0,this.data_size=t-8,this.data=new Uint8Array(this.data_size)}isRecvFull(){return this.data_len>=this.data_size}destroy(){this.data=null,super.destroy()}read(t){super.read(t),t.skip(this.data_size)}appendData(t){let e=t.peekBuffer(8,this.data_size);this.data_len=e.length,this.data.set(e,0)}readSample(t,e){let i=t.sample_size;return 0===i&&(i=e.default_sample_size),this.data_len-t.dataOffset>=i&&(t.units=this.data.slice(t.dataOffset,t.dataOffset+i),!0)}remux(){let t=8+this.data_len,e=new Uint8Array(t),i=new DataView(e.buffer);return this.fillHeader(e,i,Fs.MDAT,t),e.set(this.data,8),e}};var As=class extends ps{constructor(){super()}read(t){super.read(t),t.skip(this.size-8)}};var Rs=class extends ps{constructor(){super(),this.mvhd=null,this.videoTrack=null,this.audioTrack=null,this.mvex=null,this.udta=null}destroy(){this.mvhd.destroy(),this.mvhd=null,super.destroy()}read(t){super.read(t),this.readContainer(t)}onReadBox(t){t.type===Fs.MVHD?this.mvhd=t:t.type===Fs.TRAK?t.isVideo()?this.videoTrack=t:this.audioTrack=t:t.type===Fs.MVEX?this.mvex=t:t.type===Fs.UDTA&&(this.udta=t)}readMdat(t){this.trafVideo&&this.trafVideo.readMdat(t),this.trafAudio&&this.trafAudio.readMdat(t)}getSize(){return super.getSize()+this.mvhd.getSize()+this.videoTrack.getSize()+this.audioTrack.getSize()+this.mvex.getSize()+this.udta.getSize()}};var Os=class extends ps{constructor(){super(),this.tkhd=null,this.edts=null,this.mdia=null}destroy(){this.tkhd.destroy(),this.edts.destroy(),this.mdia.destroy(),this.tkhd=null,this.edts=null,this.mdia=null,super.destroy()}isVideo(){return 1===this.tkhd.track_id}readMdat(t){this.trun&&this.trun.readMdat(t,this.tfhd)}read(t){super.read(t),this.readContainer(t)}onReadBox(t){t.type===Fs.TKHD?this.tkhd=t:t.type===Fs.EDTS?this.edts=t:t.type===Fs.MDIA&&(this.mdia=t)}getSize(){return super.getSize()+this.tkhd.getSize()+this.edts.getSize()+this.mdia.getSize()}};var ws=class extends fs{constructor(){super(),this.track_id=0}read(t){super.read(t);t.readUint32(),t.readUint32();this.track_id=t.readUint32(),t.skip(this.size-12-12)}getSize(){let t=super.getSize();return t+=this.size,t}};var Ls=class extends ps{constructor(){super(),this.mdhd=null,this.hdlr=null,this.minf=null}destroy(){this.mdhd.destroy(),this.hdlr.destroy(),this.minf.destroy(),this.mdhd=null,this.hdlr=null,this.minf=null,super.destroy()}readMdat(t){this.trun&&this.trun.readMdat(t,this.tfhd)}read(t){super.read(t),this.readContainer(t)}onReadBox(t){t.type===Fs.MDHD?this.mdhd=t:t.HDLR===Fs.HDLR?this.hdlr=t:t.type===Fs.MINF&&(this.minf=t)}getSize(){return super.getSize()+this.mdhd.getSize()+this.hdlr.getSize()+this.minf.getSize()}};var Ms=class extends ps{constructor(){super(),this.vmhd=null,this.dinf=null,this.stbl=null}destroy(){this.vmhd.destroy(),this.dinf.destroy(),this.stbl.destroy(),this.vmhd=null,this.dinf=null,this.stbl=null,super.destroy()}readMdat(t){this.trun&&this.trun.readMdat(t,this.tfhd)}read(t){super.read(t),this.readContainer(t)}onReadBox(t){t.type===Fs.VMHD?this.vmhd=t:t.type===Fs.DINF?this.dinf=t:t.type===Fs.STBL&&(this.stbl=t)}getSize(){return super.getSize()+this.vmhd.getSize()+this.dinf.getSize()+this.minf.getSize()}};var Vs=class extends ps{constructor(){super(),this.stsd=null,this.stts=null,this.stsc=null,this.stsz=null,this.stco=null}destroy(){this.stsd.destroy(),this.stts.destroy(),this.stsc.destroy(),this.stsz.destroy(),this.stco.destroy(),this.stsd=null,this.stts=null,this.stsc=null,this.stsz=null,this.stco=null,super.destroy()}readMdat(t){this.trun&&this.trun.readMdat(t,this.tfhd)}read(t){super.read(t),this.readContainer(t)}onReadBox(t){t.type===Fs.STSD?this.stsd=t:t.type===Fs.STTS?this.stts=t:t.type===Fs.STSC?this.stsc=t:t.type===Fs.STSZ?this.stsz=t:t.type===Fs.STCO&&(this.stco=t)}getSize(){return super.getSize()+this.stsd.getSize()+this.stts.getSize()+this.stsc.getSize()+this.stsz.getSize()}};var bs=class extends fs{constructor(){super(),this.headerBox=null,this.headerProps=null}destroy(){this.headerBox.destroy(),this.headerBox=null,super.destroy()}read(t){super.read(t);t.readUint32(),t.readUint32();const e=t.readStr(4);if("av01"==e){t.skip(6),t.skip(2),t.skip(2),t.skip(2),t.skip(12);const a=t.readUint16(),o=t.readUint16();t.readUint32(),t.readUint32();t.skip(4);t.readUint16(),t.readStr(32),t.readUint16();t.skip(2);const n=t.readUint32();t.readStr(4);let h=t.readUint8();h=t.readUint8();const d=h>>5&7,l=31&h;h=t.readUint8();const u=h>>7&1,c=h>>6&1,p=h>>5&1;h=t.readUint8();if(0!==(h>>5&7))return void console.error("av1C reserved_1 parsing problem");let m=0,f=0;if(1===(h>>4&1))m=15&h;else if(f=15&h,0!==f)return;var i=n-12;const _=t.buffer.slice(t.pos-4,t.pos+i);var s,r=l;r<10&&(r="0"+r),2===d&&1===c?s=1===p?"12":"10":d<=2&&(s=1===c?"10":"08");const g=e+"."+d+"."+r+(u?"H":"M")+"."+s;this.headerProps={type:e,width:a,height:o,codec:g,configOBUs:_},t.skip(this.size-12-4-86-12)}else if("mp4a"==e){t.skip(6),t.skip(2),t.skip(8);const i=t.readUint16(),s=t.readUint16();t.skip(2),t.skip(2);const r=t.readUint32()/65536;t.skip(this.size-12-4-36),this.headerProps={type:e,channel_count:i,samplesize:s,samplerate:r}}}getSize(){return super.getSize()+this.size}};const Ns=new Map;var Fs={STYP:"styp",SIDX:"sidx",MOOF:"moof",MFHD:"mfhd",TRAF:"traf",TFHD:"tfhd",TFDT:"tfdt",TRUN:"trun",MDAT:"mdat",MOOV:"moov",MVHD:"mvhd",TRAK:"trak",TKHD:"tkhd",EDTS:"edts",MDIA:"mdia",MDHD:"mdhd",HDLR:"hdlr",MINF:"minf",VMHD:"vmhd",DINF:"dinf",STBL:"stbl",STSD:"stsd",STTS:"stts",STSC:"stsc",STSZ:"stsz",STCO:"stco",AV01:"av01",MVEX:"mvex",UDTA:"udta",createBox:function(t){return 0===Ns.size&&(Ns.set(this.STYP,ms),Ns.set(this.SIDX,_s),Ns.set(this.MOOF,gs),Ns.set(this.MFHD,Ss),Ns.set(this.TRAF,Ts),Ns.set(this.TFHD,Es),Ns.set(this.TFDT,vs),Ns.set(this.TRUN,Ds),Ns.set(this.MDAT,Is),Ns.set(this.MOOV,Rs),Ns.set(this.TRAK,Os),Ns.set(this.TKHD,ws),Ns.set(this.MDIA,Ls),Ns.set(this.MINF,Ms),Ns.set(this.STBL,Vs),Ns.set(this.STSD,bs)),new(Ns.get(t)||As)},getCharCode:function(t){let e=[];for(let i=0;i<t.length;i++)e.push(t.charCodeAt(i));return e}};var Bs=class{constructor(t){this.buffer=new cs,this.styp=null,this.sidxVideo=null,this.sidxAudio=null,this.moof=null,this.mdat=null,this.moov=null,this.step=0,this.type=t}destroy(){this.buffer&&this.buffer.destroy(),this.styp&&this.styp.destroy(),this.sidxVideo&&this.sidxVideo.destroy(),this.sidxAudio&&this.sidxAudio.destroy(),this.moof&&this.moof.destroy(),this.mdat&&this.mdat.destroy()}getVideoFps(){if(!this.hasMedia()||!this.hasVideo())return 0;const t=this.moof.trafVideo.trun.sample_count,e=this.moof.trafVideo.tfhd.default_sample_duration,i=this.sidxVideo.time_scale;return Math.ceil(t/(t*e/i))}getBoundAV(){let t={video:{start:-1,end:-1},audio:{start:-1,end:-1}};return this.moof&&(this.moof.trafVideo&&(t.video=this.moof.trafVideo.getBound()),this.moof.trafAudio&&(t.audio=this.moof.trafAudio.getBound())),t}hasMedia(){return this.moof}hasVideo(){return this.sidxVideo}hasAudio(){return this.sidxAudio}isRecvFull(){return this.mdat&&this.mdat.isRecvFull()}setFullRemux(){this.moof&&(this.sidxVideo&&this.moof.trafVideo&&(this.moof.trafVideo.trun.remuxSampleStart=0,this.moof.trafVideo.trun.remuxSampleEnd=this.moof.trafVideo.trun.sample_count,this.sidxVideo.earliest_presentation_time_offset=0,this.moof.trafVideo.tfdt.base_media_decode_time_offset=0),this.sidxAudio&&this.moof.trafAudio&&(this.moof.trafAudio.trun.remuxSampleStart=0,this.moof.trafAudio.trun.remuxSampleEnd=this.moof.trafAudio.trun.sample_count,this.sidxAudio.earliest_presentation_time_offset=0,this.moof.trafAudio.tfdt.base_media_decode_time_offset=0))}setRemuxAll(){this.moof&&(this.moof.trafVideo&&(this.moof.trafVideo.trun.remuxSampleStart=this.moof.trafVideo.trun.remuxSampleEnd,this.moof.trafVideo.trun.remuxSampleEnd=this.moof.trafVideo.trun.sample_count),this.moof.trafAudio&&(this.moof.trafAudio.trun.remuxSampleStart=this.moof.trafAudio.trun.remuxSampleEnd,this.moof.trafAudio.trun.remuxSampleEnd=this.moof.trafAudio.trun.sample_count))}isCanSecOpen(t){if(this.moof&&this.sidxVideo&&this.moof.trafVideo){let e=1e3*this.moof.trafVideo.getDuration()/this.sidxVideo.time_scale;if(e>=t){if(this.moof.trafVideo.trun.remuxSampleEnd=this.moof.trafVideo.trun.sampleMdatIndex,this.sidxAudio&&this.moof.trafAudio){let t=Math.ceil(e*this.sidxAudio.time_scale/1e3/this.moof.trafAudio.tfhd.default_sample_duration);t=Math.min(t,this.moof.trafAudio.trun.sample_count),this.moof.trafAudio.trun.createEmptySamples(t)}return!0}}return!1}appendBuffer(t){this.buffer.appendBuffer(t),this.parse()}parse(){for(;this.buffer.isCanRead(8);){let t=this.buffer.peekAnyInt(4),e=this.buffer.peekString(4,4);if(e===Fs.MDAT){if(this.mdat||(this.mdat=new Is(t)),this.mdat.appendData(this.buffer),this.moof&&this.moof.readMdat(this.mdat),!this.buffer.isCanRead(t))break;this.mdat.read(this.buffer)}else{if(!this.buffer.isCanRead(t))break;{let t=Fs.createBox(e);t.read(this.buffer),e===Fs.STYP?this.styp=t:e===Fs.SIDX?1===t.reference_id?this.sidxVideo=t:this.sidxAudio=t:e===Fs.MOOF?this.moof=t:e===Fs.MOOV&&(this.moov=t)}}}}remux(){this.moof.updateMdatDataOffset();let t=this.styp.remux(),e=null,i=null;this.sidxVideo&&this.moof.trafVideo&&(this.sidxVideo.updateReference(this.moof.trafVideo),e=this.sidxVideo.remux()),this.sidxAudio&&this.moof.trafAudio&&(this.sidxAudio.updateReference(this.moof.trafAudio),i=this.sidxAudio.remux());let s=this.moof.remux(),r=null;this.moof.trafVideo&&(r=this.moof.trafVideo.trun.getMdat());let a=null;this.moof.trafAudio&&(a=this.moof.trafAudio.trun.getMdat());let o=8;r&&(o+=r.length),a&&(o+=a.length);let n=t.length+o+s.length;e&&(n+=e.length),i&&(n+=i.length);let h=new Uint8Array(n),d=0;return h.set(t,d),d+=t.length,i&&(h.set(i,d),d+=i.length),e&&(h.set(e,d),d+=e.length),h.set(s,d),d+=s.length,h[d]=o>>24&255,h[d+1]=o>>16&255,h[d+2]=o>>8&255,h[d+3]=255&o,d+=4,h.set(Fs.getCharCode(Fs.MDAT),d),d+=4,r&&(h.set(r,d),d+=r.length),a&&h.set(a,d),this.sidxVideo&&this.moof.trafVideo&&this.sidxVideo.updateEarliestPresentationTime(this.moof.trafVideo),this.sidxAudio&&this.moof.trafAudio&&this.sidxAudio.updateEarliestPresentationTime(this.moof.trafAudio),this.moof.updateBaseMediaDecodeTime(),h}};const Us=0,ks=1,xs=2,Hs=3;var Gs=class{constructor(t){this.mse=t,this.mediaSource=null,this.buffer=null,this.segments=[],this.initSegment=null,this.initUrl="",this.config=null,this.initPhase=Us,this.initLoader=null,this.onUpdateendBind=this.onUpdateend.bind(this),this.onErrorBind=this.onError.bind(this),this.loadOpenBind=this.loadOpen.bind(this),this.loadChunkBind=this.loadChunk.bind(this),this.loadSuccessBind=this.loadSuccess.bind(this),this.loadErrorBind=this.loadError.bind(this),this.loadTimeoutBind=this.loadTimeout.bind(this),this.onInitOpenCb=null,this.onInitCallback=null,this.onFirstBufCb=null,this.mp4=null,this.firstPlay=!0,this.checkCurrentTime=!1,this.initMp4=null}reset(){f.a.log("Av1Player.reset"),this.buffer&&(this.buffer.removeEventListener("updateend",this.onUpdateendBind),this.buffer.removeEventListener("error",this.onErrorBind),this.buffer=null),this.initLoader&&this.initLoader.abort(),this.onInitOpenCb=null,this.onInitCallback=null,this.mediaSource=null,this.segments=[]}destroy(){f.a.log("Av1Player.destroy"),this.reset(),this.initSegment=null,this.initPhase=Us,this.tryCnt=5,this.initUrl="",this.config=null,this.mse=null,this.onFirstBufCb=null}isPlaying(){return null!=this.buffer}isInitLoaded(){return this.initPhase===xs}initError(){this.initPhase!==Hs&&(this.initPhase=Hs,this.onError({message:"load init.mp4=404"}))}loadInit(t,e,i){let{initCb:s,openCb:r}=i;if(this.initPhase===Us){f.a.log("M4sPlayer.loadInit"),this.initPhase=ks,this.initUrl=t,this.config=e,this.onInitCallback=s,this.onInitOpenCb=r;let i=new T(e);this.initLoader=i,i.loadBuffer(t,this.loadOpenBind,this.loadChunkBind,this.loadSuccessBind,this.loadErrorBind,this.loadTimeoutBind,2e3,e.fragLoadingMaxRetry,e.fragLoadingRetryDelay)}}loadOpen(t){this.onInitOpenCb&&(this.onInitOpenCb(),this.onInitOpenCb=null)}loadChunk(t){}loadSuccess(t){this.initMp4=new Bs(2),f.a.log("M4sPlayer.loadSuccess init"),this.initPhase=xs,this.initSegment=t,this._initCodecs(),this._appendInit(),this.onInitCallback&&(this.onInitCallback(),this.onInitCallback=null),this.initMp4.appendBuffer(t),console.log("initMp4",this.initMp4);const e=this.initMp4.moov.videoTrack.mdia.minf.stbl.stsd.headerProps,i=this.initMp4.moov.audioTrack.mdia.minf.stbl.stsd.headerProps;this.mse.initSegmentSuc(e,i)}loadError(t){let{code:e,currentTarget:i,msg:s}=t;this.initError()}loadTimeout(t){this.initError()}onMediaSourceOpen(t){this.mediaSource=t,this._initCodecs(),this._appendInit()}createMp4(){this.mp4&&(this.mp4.destroy(),this.mp4=null),this.mp4=new Bs(1)}appendSegment(t,e){let i=this.mp4;if(i.appendBuffer(t),this.mse.webcodecType==D.a.PLAYER_CORE_TYPE.WEBCODECS)i.isRecvFull()&&this.mse.remuxAv1(i,e);else{let e=!1;if(this.firstPlay?i.isCanSecOpen(200)&&(i.step=1,this.firstPlay=!1,e=!0):i.isRecvFull()&&(1==i.step&&(i.step=2),e=!0,i.setFullRemux()),e){const e=i.getBoundAV();f.a.log(`M4sPlayer.appendSegment video=[${e.video.start}, ${e.video.end}] audio=[${e.audio.start}, ${e.audio.end}]`),t=i.remux(),this.segments.push({segment:t,step:i.step}),this._appendBuffer()}}}_appendInit(){this.initSegment&&this.buffer&&this.buffer.appendBuffer(this.initSegment)}_appendBuffer(){if(this.initSegment&&this.segments.length>0&&this.buffer&&!this.buffer.updating){this.onFirstBufCb&&this.onFirstBufCb();let t=this.segments.shift(),e=t.segment;this.checkCurrentTime=2===t.step,this.buffer.appendBuffer(e)}}_initCodecs(){!this.buffer&&this.mediaSource&&this.initPhase===xs&&(f.a.log("M4sPlayer._initCodecs"),this.buffer=this.mediaSource.addSourceBuffer("video/mp4;codecs="+ls.a.AV01),this.buffer.addEventListener("updateend",this.onUpdateendBind),this.buffer.addEventListener("error",this.onErrorBind))}onUpdateend(){this.mse.checkSeek(),this.checkCurrentTime&&(f.a.log("M4sPlayer.onUpdateend checkCurrentTime"),this.checkCurrentTime=!1,this.mse.checkCurrentTime()),this._appendBuffer()}onError(t){f.a.log("M4sPlayer.onError "+t.message),this.mse&&this.mse.onM4sError()}hasVideo(){return!!this.buffer}},Ws=i(13),$s=1,Ys=2,Ks=3,js=5;var qs=class{constructor(t){this.seiList=[],this.player=t,this.lastTs=-1,this.internal=10,this.timerStart=!1,this.timer=0}add(t,e,i,s){let r=this.seiList.length;if(this.seiList.length>0)for(r=this.seiList.length-1;r>0&&!(t>this.seiList[r].timeStamp);r--);this.seiList.splice(r+1,0,{timeStamp:t,data:i,port:e}),this.timerStart||(this.timerStart=!0,clearTimeout(this.timer),this.timer=setTimeout(this.checkDispatchSei.bind(this),this.internal))}checkDispatchSei(){if(this.timerStart){let t=this.player.getCurrentRealTime(),e=-1;if(this.seiList.length>0)for(let i=0;i<this.seiList.length&&t>this.seiList[i].timeStamp;i++)e=i;if(e>=0){let i=this.seiList[e];this.player.onSeiDataChannel(this.seiList[e].port,this.seiList[e]),this.seiList.splice(0,e+1),f.a.log(`ts=${t},port=${i.port},content=${i.content},data=${i.data}, list=${this.seiList}`)}this.seiList.length>0?setTimeout(this.checkDispatchSei.bind(this),this.internal):this.timerStart=!1}}reset(){this.seiList=[],this.player=null,this.lastTs=-1,this.timerStart=!1}};let zs=[43,138,8,0],Js=0;var Qs=class{constructor(t,e,i){this._num_=++Js;let{videoType:s="flv",isLive:r=!0,isPureAudio:a=!1,isPureVideo:o=!1,isH265Mode:n,videoElement:h=null}=e;this.videoElement=h,this.isH265Mode=n,this.handler=t,this.videoType=s,this.isLive=r,this.isPureAudio=a,this.isPureVideo=o,this.parser=null,this.metadata={},this.bufStat=new Ei,this.pauseStat=new vi(this),this.pausePerf=new Pi,this.buffered=new Ri,this.buffered.setMse(this),this.h264SeiInfos=new Oi(this),this.seiDataChannelInfos=new qs(this),this.scriptVolumeInfos=new wi(this),this.onVideoResizeBind=this.onVideoResize.bind(this),this.pid=0,this.bitrate=0,this.JITTER_BUFMIN=1e3,this.JITTER_BUFLEN=4e3,this.JITTER_BUFMAX=8e3,this.webcodecType=i,this.width=1280,this.height=720,this.widthCfg=1280,this.heightCfg=720,this.realtimeWidth=0,this.realtimeHeight=0,this.mediaElement=null,this.hasRemuxed=!1,this.m4sPlayer=new Gs(this),this.remuxer=new ze(this),this.avSyncStat=new $i(this),this.ctrlBuffer=new Wi({bufferSize:0,popDuration:Number(P.a.popDuration)||200,timescale:this.remuxer.timescale,isPureAudio:this.isPureAudio,isPureVideo:this.isPureVideo,webcodecType:this.webcodecType},this._remux.bind(this),this),this.renderFps=new Yi(this),this.onPageRenderCbkBind=this.onPageRenderCbk.bind(this),window.requestAnimationFrame&&P.a.renderStat[0]&&window.requestAnimationFrame(this.onPageRenderCbkBind),this.videoPlayConsuming=new Ki(this),this.audioPlayConsuming=new Ki(this),this.audioConfig=zs.slice();this.updateAudioConfig({audioConfig:this.audioConfig,codec:"mp4a.40.5",audioSampleRate:22050,aacTimeLen:1024e3/22050,audioObjectType:5,audioChannelCount:1},!0),this.perfBlockCnt=0,this.remuxVideoCnt=0,this.audioEmptyDuration=0,this.audioEmptyList4Sec=[],this.lastSecNow=y.a.now(),this.isNoAudio=!0,ds.add(this.onCheckFastWorkerTimer,this,100),this.shildAudioStartTs=0,this.isShieldAudio=!1,this.isRevFastOver=!1,this.videoCallBackLargeCnt=0,this.isOnFragParsed=!1,this.onFragParsedTime=0,this.audioSampleNums=0,this.videoSampleNums=0,this.isOnEnded=!1,"visible"==document.visibilityState?this.initTime=y.a.now():this.initTime=0,this.checkScreenTs=0,this.singleColorCnt=0,this.isSingleErr=!1,this.isSingleTest=!1,this.canvas=null,this.context=null,this.isPlayVideo=!1,this.isMuffeled=!1,this.muffleTs=0,this.muffleDuration=0,this.muffleCnt=0,this.videoFirstFrameDecodeCost=0}setSeiDataChannelPortListers(t){this.seiDataChannl=t}onAudioAnalyserInit(t){this.handler&&this.handler.onAudioAnalyserInit&&this.handler.onAudioAnalyserInit(t)}onVisibilitychange(){f.a.log("BaseController.onVisibilitychange",document.visibilityState),"visible"==document.visibilityState?this.initTime=y.a.now():(this.initTime=0,this.singleColorCnt=0)}printAVInfos(){this.parser&&(this.parser.printVideoInfo&&this.parser.printVideoInfo(),this.parser.printAudioInfo&&this.parser.printAudioInfo())}resetHls(){this.parser.reset&&this.parser.reset(),this.remuxer.reset(),this.remuxer.resetInitDts&&this.remuxer.resetInitDts()}onFastOver(){}setParams(t,e){if(this.pid=t,this.bitrate=e,this._initPerf(),this.parser.dropFrameDts){let e=!1;(1===P.a.dropFrameUids[0]||-1!==P.a.dropFrameUids.indexOf(parseInt(t)))&&(e=!0),this.parser.dropFrameDts.open=e}this.parser.dropFrameDts.start()}_initPerf(){"ts"!==this.videoType&&this.pausePerf.checkLocal(this.pid,this.bitrate)&&this.parser.dropFrameCtrl.start()}getDelayStat(){return"ts"!==this.videoType?this.parser.sei.getStat():null}onRestart(){f.a.log(`BaseController(${this._num_}).onRestart`),this.reset()}onVideoParseInvalid(){this.handler&&this.handler.onVideoParseInvalid&&this.handler.onVideoParseInvalid()}onGop(t){this.handler.onGop&&this.handler.onGop(t),t>this.maxGop&&(this.maxGop=t,f.a.log(`BaseController(${this._num_}).onGop update maxGop=`+this.maxGop))}onCheckTimer(t,e){this.parser&&this.parser.fps&&(this.metadata.fps=this.parser.fps.getFps(),this.metadata.recvVideoFps=this.parser.fps.getRecvFps()),this.parser&&this.parser.audioFps&&(this.metadata.audioFps=this.parser.audioFps.getFps(),this.metadata.recvAudioFps=this.parser.audioFps.getRecvFps())}onCheckFastTimer(t,e){1===Number(P.a.isMute)&&this.muffledVoice(),this._getEmptyAudioDuration(t)}getCodecType(){return this.m4sPlayer.isInitLoaded()?ve:this.getControllerCodecType()}reset(){this.m4sPlayer.reset()}onEnded(){this.isOnEnded=!0}onCheckFastWorkerTimer(){this.checkSolidColor()}destroy(){ds.remove(this.onCheckFastWorkerTimer,this),this.metadata={},this.JITTER_BUFMIN=1e3,this.JITTER_BUFLEN=4e3,this.JITTER_BUFMAX=8e3,this.remuxer.destroy(),this.ctrlBuffer&&this.ctrlBuffer.destroy&&this.ctrlBuffer.destroy(),this.m4sPlayer&&(this.m4sPlayer.destroy(),this.m4sPlayer=null),this.hasRemuxed=!1,this.resetPerfBlockCnt(),this.renderFps.reset(),this.audioEmptyList4Sec.length=0,this.isNoAudio=!0,this.shildAudioStartTs=0,this.isShieldAudio=!1,this.videoPlayConsuming&&this.videoPlayConsuming.destroy(),this.audioPlayConsuming&&this.audioPlayConsuming.destroy(),this.initTime=0,this.checkScreenTs=0,this.singleColorCnt=0,this.isSingleErr=!1,this.isSingleTest=!1,this.canvas=null,this.context=null,this.isPlayVideo=!1,this.isMuffeled=!1,this.muffleTs=0,this.muffleDuration=0,this.muffleCnt=0,this.seiDataChannl=null}getControllerCodecType(){return this.parser.getCodecType()}setPushGop(t){this.parser.setPushGop(t)}saveH264SeiData(t,e){this.h264SeiInfos.add(t,e)}saveSeiDataChannel(t,e,i,s){this.seiDataChannelInfos.add(t,e,i,s)}saveSeiInfo(t,e,i){1===Number(localStorage._printSeiInfo)&&f.a.log(`BaseController.saveSeiInfo, timestamp=${t}, type=${i}`),this.handler&&this.handler.eventEmitter.trigger(m.SEI_INFO,{timestamp:t,data:e})}setPlaybackrateAccess(t){this.playbackrateChangeAccess=t}getDelayInfo(){return f.a.log("MSEPlayer.getDelayInfo: delay: ",this.mediaDelay),this.mediaDelay}setSeiDelay(t){if(this.seiAnchorDelay!==t||!this.mediaDelay){let e=this.getBufferLen();this.isShieldAudio&&(e+=this.getFrameBufferLen()),this.seiAnchorDelay=t,this.mediaDelay={total_delay:this.seiAnchorDelay+e,buffer_delay:e,status:0},0===this.seiAnchorDelay&&(this.mediaDelay.status=1)}}getRealFps(){return this.parser.getRealFps?this.parser.getRealFps():0}getIsDownEnough(){return!this.parser.isDownEnough||this.parser.isDownEnough()}getRealBitrate(){let t=0;return this.parser.fps&&(t=this.parser.fps.getRealBitrate()),t}setDeleteH264Aud(t){this.parser.setDeleteH264Aud(t)}setNeedEmptyAudioFrame(t){this.parser.setNeedEmptyAudioFrame(t)}setJitter(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;this.JITTER_BUFLEN=t,this.JITTER_BUFMIN=e,this.JITTER_BUFMAX=i,f.a.info(`${this._getTag()} BaseController.setJitter bufMin=${e} bufLen=${t} bufMax=${i}`)}setResolution(t,e){f.a.log(`BaseController(${this._num_}).setResolution w/h=`+t+"/"+e),this.width&&this.height&&(this.width!==t||this.height!==e)&&this.handler.eventEmitter&&this.handler.eventEmitter.trigger(m.VIDEO_RESOLUTION_CHANGE),this.width=t,this.height=e}getWidth(){return this.width}getHeight(){return this.height}setExceptionStat(t,e){this.handler&&this.handler.exceptionStat&&this.handler.exceptionStat.setStat(t,e)}cacheBlockReason(t,e){this.handler&&this.handler.cacheBlockReason&&this.handler.cacheBlockReason(t,e)}getPlayStat(){return this.parser.getPlayStat()}getCaptureStats(t){return this.parser&&this.parser.vCaptureJitterStat?{video:this.parser.vCaptureJitterStat.getStats(t),audio:this.parser.aCaptureJitterStat.getStats(t)}:null}getPlayVideo(){return this.video?this.video.video:null}getFrameReadyed(){return this.parser&&this.parser.getFrameReadyed?this.parser.getFrameReadyed():0}getFramePlayDelays(){return this.parser.getCalculateVideoFramePlayDelay?this.parser.getCalculateVideoFramePlayDelay():0}getVideoDecodeDelaySmooth(){return 0}getFrameBufferLen(){return this.parser.getFrameBufferLen?this.parser.getFrameBufferLen():0}getContinueBuffer(){return this.buffered.continueBuffer}getVideoContinueBuffer(){return this.buffered.getVideoContinueBuffer()}getParserBufLen(){return this.parser.getParserBufLen()}setSensitivePause(t){this.sensitivePause=t}getInitDts(){return void 0===this.remuxer.getInitDts()?0:this.remuxer.getInitDts()}getCurrentSeiOffsetDts(){return this.offsetDts||0}appendFlv(t){this.parser.parseFlv(t)}appendFlvTag(t,e){this.parser.parseTag(t,this.isPureAudio,e)}_getTag(){let t=this.handler.constructor.name;return this._num_+" "+t}recvDataFull(){this.handler&&this.handler.recvDataFull&&this.handler.recvDataFull()}getVideoFrames(){return this.parser&&this.parser.getVideoFrames?this.parser.getVideoFrames():0}getAudioFrames(){return this.parser&&this.parser.getAudioFrames?this.parser.getAudioFrames():0}setVolume(t){this.webcodecType==D.a.PLAYER_CORE_TYPE.MSE?this.video.setVolume(t):this.webcodecType==D.a.PLAYER_CORE_TYPE.WEBCODECS&&this.startMuteRender(t)}muffledVoice(){if(!this.handler||!this.handler.getMuffleCacheData)return;const t=y.a.now();let e=this.handler.voiceEliminationData||[],i=!1,s={play:!1,percent:0},r=this.getCurrentDts(),a=this.getBufferLen(),o=0,n=0,h=null,d=[...e],l=this.handler.getMuffleCacheData();const u=l.length;if(0!=l.length){const t=l[0].begin,e=l[u-1].end,d=r-t,c=r-l[0].end,p=r-l[u-1].begin,m=r-e;1==Number(localStorage._printMuteInfo)&&f.a.log(`MSEPlayer.muffledVoice nowDts=${r},buffer=${a},cacheBegin=${t},cacheEnd=${e},firstBeginDetla=${d},firstEndDelta=${c},lastBeginDelta=${p},lastEndDelta=${m},cacheLen=${u}`),l.map((t,e)=>{o=t.begin,n=t.end,h=t.muteStyle,0==t.type&&(o+=this.offsetDts,n+=this.offsetDts),r>=o&&r<=n&&(i=!0,P.a.useMuteBiAudio&&h&&1==h.style&&(s={play:!0,percent:h.percent?h.percent:0}),1==Number(localStorage._printMuteInfo)&&f.a.log("MSEPlayer.muffledVoicecache data",JSON.stringify(t)))})}d.map((t,e)=>{o=t.begin,n=t.end,0==t.type&&(o+=this.offsetDts,n+=this.offsetDts),r>n&&this.handler.voiceEliminationData.splice(e,1)}),this.setMuffledVolume(i),!this.isMuffeled&&i&&0==this.muffleTs?(this.muffleTs=t,s&&s.play&&this.handler.setMuffled(!0,s)):!i&&this.isMuffeled&&(this.muffleDuration+=t-this.muffleTs,this.muffleCnt++,this.muffleTs=0,this.handler.setMuffled(!1)),this.isMuffeled=i}setMuffledVolume(t){}disableHardAcc(){f.a.log("BaseController.disableHardAcc")}setDisableHardAcc(){f.a.log("BaseController.setDisableHardAcc")}pushAvcSample(t){this.isPureAudio||this.ctrlBuffer.addSample(t)}pushAacSample(t,e){e==oe?this.ctrlBuffer.addShieldAudioSample(t):this.ctrlBuffer.addSample(t)}appendShieldAudioFlv(t){this.parser2.parseFlv(t,!0)}updateAudioConfig(t,e,i){let{audioConfig:s,codec:r,audioSampleRate:a,aacTimeLen:o,audioObjectType:n,audioChannelCount:h}=t;if(e)this.ctrlBuffer.updateAudioConfig({config:s,codec:r,audiosamplerate:a,aacTimeLen:o,audioObjectType:n,audioChannelCount:h},!1,ae,e);else{let t=!1,d=s;d.toString(16)!==this.audioConfig.toString(16)&&(this.audioConfig.toString(16)===zs.toString(16)&&this.remuxer.videoISGenerated&&(t=!0),f.a.warn(`MSEPlayer.parseAudio adts changed old='${this.audioConfig}, new='${d}, needReplay=${t}`)),this.audioConfig=s,this.ctrlBuffer.updateAudioConfig({config:s,codec:r,audiosamplerate:a,aacTimeLen:o,audioObjectType:n,audioChannelCount:h},t,i,e),this.remuxer.switchLevel(!1,t),this.setExceptionStat(L.a.DIM_LINK_STA.AUDIO_CONFIG,1)}}updateVideoConfig(t,e){this.isPureAudio||this.ctrlBuffer.updateVideoConfig(t,e)}getLastIFrameDts(){return this.ctrlBuffer.getLastIFrameDts()}getFrameBufferLen(){return this.ctrlBuffer.getBufferLen()}getFrameReadyed(){return this.ctrlBuffer.getSize()}setNeedEmptyAudioFrame(t){this.ctrlBuffer.setNeedEmptyAudioFrame(t),f.a.log("FlvParser.setNeedEmptyAudioFrame "+t)}getParserBufLen(){return this.ctrlBuffer.getBufferLen()}_remux(t,e){this._setRemuxed(),this.remuxVideoCnt+=t.samples.length,this.avSyncStat.checkSync(t,e),this.webcodecType==D.a.PLAYER_CORE_TYPE.WEBCODECS?(this.appendAvcTrack(t),this.appendAacSample(e)):this.remuxer&&this.remuxer.remux(e,t,0,!1)}initSegmentSuc(t,e){this.webcodecType!=D.a.PLAYER_CORE_TYPE.MSE&&(f.a.log("BaseController.initSegmentSuc",t,e),this._initSegmentSuc(t),this.updateM4sAudioConfig({codec:"mp4a.40.5",audioSampleRate:e.samplerate,audioChannelCount:e.channel_count}),this.updateAVCConfig({width:t.width,height:t.height}))}_setRemuxed(){this.hasRemuxed||(this.hasRemuxed=!0,this.recvDataFull&&this.recvDataFull())}setPerfCntPlus(){this.perfBlockCnt++}resetPerfBlockCnt(){this.perfBlockCnt=0}getRealFpsAudio(){return this.parser.getRealFpsAudio?this.parser.getRealFpsAudio():0}onVideoResize(t){this.checkResolution()}getVideoWidth(){return 0}getVideoHeight(){return 0}checkResolution(){if(this.h265Proxy&&this.h265Proxy.isReady&&!this.h265Proxy.isH265MseCodec)return;let t=this.getVideoWidth(),e=this.getVideoHeight();f.a.log(`MSEPlayer(${this._num_}).checkResolution o_w/o_h=`+this.width+"/"+this.height,"n_w/nh",t,"/",e),this.width&&this.height&&(this.realtimeWidth!==t||this.realtimeHeight!==e)&&this.handler.eventEmitter&&this.handler.eventEmitter.trigger(m.VIDEO_RESOLUTION_CHANGE,{width:t,height:e}),this.realtimeWidth=t,this.realtimeHeight=e,this.width=t,this.height=e}setAvcCfg(t,e){t==this.widthCfg&&e==this.heightCfg||(f.a.log("BaseController.setAvcCfg o_w/o_h="+this.widthCfg+"/"+this.heightCfg,"n_w/nh",t,"/",e),this.handler.eventEmitter&&this.handler.eventEmitter.trigger(m.VIDEO_AVCCFG_CHANGE,{width:t,height:e})),this.widthCfg=t,this.heightCfg=e}getMseAvcCfgWidth(){return this.widthCfg}getMseAvcCfgHeight(){return this.heightCfg}onPageRenderCbk(){window.requestAnimationFrame&&window.requestAnimationFrame(this.onPageRenderCbkBind);let t=this.renderFps.addPageRender();t>0&&this.handler&&this.handler.updateCurrentPageRenderFps&&this.handler.updateCurrentPageRenderFps(t)}onScriptVolumeInfo(t,e){this.handler.onSendScriptVolumeInfo(t,e)}onSeiDataChannel(t,e){this.seiDataChannl&&this.seiDataChannl.checkDataChannelPortListener(t)&&(this.handler&&this.handler.eventEmitter.trigger(m.SEI_DATACHANNEL_INFO,e),f.a.log("onSeiDataChannel",t,e))}_getEmptyAudioDuration(t){const e=this.ctrlBuffer.avBuffer.aBuffer.getEmptyeDuration();this.audioEmptyDuration+=e,t-this.lastSecNow>=4e3&&(this.audioEmptyList4Sec.push(Math.floor(this.audioEmptyDuration>4e3?4e3:this.audioEmptyDuration)),this.audioEmptyDuration=0,this.lastSecNow=t)}getEmptyAudioDurationHeart(){return this.ctrlBuffer.avBuffer.aBuffer.getEmptyDurationHeart()}hasAudioCfg(){return this.parser&&this.parser.recvAudioConfig}getEmptyAudioRecord(){const t=[...this.audioEmptyList4Sec];return this.audioEmptyList4Sec.length=0,t}setRealFps(){}setNoAuido(t){this.isNoAudio=t}setStreamFormat(t){this.handler&&this.handler.setStreamFormat&&this.handler.setStreamFormat(t)}switchShieldAudio(t){this.ctrlBuffer.switchShieldAudio(t)}stopShieldAudio(){this.switchShieldAudio(!1),this.isShieldAudio=!1}onSwitchShieldAudioFail(t,e){this.isShieldAudio=!1,this.handler.onSwitchShieldAudioFail&&this.handler.onSwitchShieldAudioFail(t,e)}onSwitchShieldAudioSuc(t){this.isShieldAudio=!0,this.handler.onSwitchShieldAudioSuc&&this.handler.onSwitchShieldAudioSuc(t)}shieldAuidoMute(t,e){f.a.log("MSEPlayer.shieldAudioMute",t,e),this.shildAudioStartTs=e,this.webcodecType==D.a.PLAYER_CORE_TYPE.WEBCODECS?this.setMuted(!0):this.video&&this.video.video&&(this.video.video.muted=!0)}resetPlayer(){this.handler.resetPlayer()}resetAudioDts(){f.a.log("BaseContrller.resetAudioDts curDts="+this.getCurrentDts()),this.ctrlBuffer.resetAudioDts()}getRenderElement(){}getIframePts(){return this.ctrlBuffer&&this.ctrlBuffer.getIframePts?this.ctrlBuffer.getIframePts():0}setIFrameAvcChageStat(){this.handler.setIFrameAvcChageStat()}onRevFastOver(){f.a.log("BaseController.onRevFastOver mse webcodecs jump buffer!"),this.isRevFastOver=!0}getVideoCBLargeCnt(){const t=this.videoCallBackLargeCnt;return this.videoCallBackLargeCnt=0,t}getVideoFrameCallBackNums(){return this.frameCallBackNums||0}isM4sInitLoaded(){return this.m4sPlayer.isInitLoaded()}loadM4sInit(t,e,i){this.m4sPlayer.loadInit(t,e,i)}setFragParsedTime(){this.isOnFragParsed||(this.onFragParsedTime=y.a.now(),f.a.log("MSEPlayer.onFragParsed",this.onFragParsedTime),this.isOnFragParsed=!0)}appendM4sSegment(t,e){this.setFragParsedTime(),this.m4sPlayer.appendSegment(t,e)}onM4sError(){this._onErrorEvent(100),this._onPlayerError(!0)}checkSolidColor(){if(!this.isLive)return;if(-1==P.a.testRenderCfg[3].indexOf(qe.a.version.major))return;if(0==P.a.testRenderSwitchCfg[0])return;if(!this.isPlayVideo)return;if(this.isSingleErr)return;if(this.isSingleTest)return;if(this.webcodecType!=D.a.PLAYER_CORE_TYPE.WEBCODECS&&!this.getIsMseHevc())return;const t=y.a.now();if(0==this.initTime)return;if(t-this.initTime>=P.a.testRenderCfg[1])return void(this.isSingleTest=!0);if(0!=this.checkScreenTs&&t-this.checkScreenTs<P.a.testRenderCfg[2])return;this.checkScreenTs=t;const e=this.getRenderElement();this.checkForScreen(e)}checkForScreen(t){if(!t)return;let e=null,i=null;if(this.canvas)e=this.canvas,i=this.context;else{let t=!1;try{e=document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0})}catch(e){t=!0,f.a.error("BaseController.checkForWhiteScreen context 2d error",e)}if(t)return}if(!e&&!i)return;this.canvas=e,this.context=i,e.width=100,e.height=50,i.drawImage(t,0,0,e.width,e.height);let s=Math.floor(e.width/2),r=Math.floor(e.height/2),a=e.width-10,o=e.height-10;const n=[{x:s,y:0,w:10,h:10},{x:a,y:0,w:10,h:10},{x:0,y:r,w:10,h:10},{x:s,y:r,w:10,h:10},{x:a,y:r,w:10,h:10},{x:0,y:o,w:10,h:10},{x:s,y:o,w:10,h:10},{x:a,y:o,w:10,h:10}],h=i.getImageData(n[0].x,n[0].y,n[0].w,n[0].h).data,d=n.every((t,e)=>{const s=i.getImageData(t.x,t.y,t.w,t.h).data;return this.isImageDataSame(h,s)});d?this.singleColorCnt++:this.singleColorCnt=0;const l=h.length;let u=!0;for(let t=0;t<l;t+=4)if(0!=h[t+3]){u=!1;break}f.a.log(`BaseController.checkForWhiteScreen,isSingleColor=${d},isTransparent=${u}`,h.slice(0,24).toString()),(u||1!=P.a.testRenderSwitchCfg[1])&&this.singleColorCnt>=P.a.testRenderCfg[0]&&this.singleColorErrHand(h)}isImageDataSame(t,e){const i=t.length;for(let s=0;s<i;s+=4)if(t[s]!=e[s]||t[s+1]!=e[s+1]||t[s+2]!=e[s+2])return!1;return!0}singleColorErrHand(t){const e=t.slice(0,24).toString();f.a.log("BaseController.singleColorErrHand",e),this.isSingleErr=!0,this.webcodecType==D.a.PLAYER_CORE_TYPE.WEBCODECS?(this.handler&&this.handler.wcsRenderErr&&this.handler.wcsRenderErr(e),localStorage._nextWcsRenderErrTime=Date.now()+2592e5,this.onWebcodecsError(Ws.a.SCREEN_COLOR)):this.getIsMseHevc()&&(this.handler&&this.handler.mseHevcRenderErr&&this.handler.mseHevcRenderErr(e),localStorage._nextMseHevcRenderErrTime=Date.now()+2592e5,this.handler.onMseHevcError(js))}getMuffleStat(){const t={muffleCnt:this.muffleCnt,muffleDuration:this.muffleDuration};return f.a.log(`BaseController.getMuffleStat,muffleCnt=${this.muffleCnt},muffleDuration=${this.muffleDuration}`),this.muffleCnt=0,this.muffleDuration=0,t}};var Xs=class{constructor(t,e){this._mse=t,this._callbacks=e,this._paused=!1,this._playedTime=0,this._pausedTs=0,this._lastPausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}get paused(){return this._paused}get pausedTs(){return this._pausedTs}reset(){this._paused=!1,this._playedTime=0,this._pausedTs=0,this._lastPausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0}check(){let t=y.a.now(),e=this._mse.video.video;if(!(0!=this._lastCheckTime&&t-this._lastCheckTime<50)&&(this._mse.isLive||!(e.currentTime<=1))&&(this._mse.isLive||!this._mse.handler||this._mse.handler.started)){if(0!==this._playedTime){e.currentTime===this._playedTime?this._paused||this._setPaused(t,e):this._paused&&this._setResume(t,e);const i=t-this._lastCheck500Time,s=Math.round(1e3*e.currentTime-this._lastCheck500CurrntTime);(0==this._lastCheck500Time||i>=500)&&(0!=this._lastCheck500Time&&i-s>=P.a.pause500Cfg[0]&&(f.a.log(`MSEPauseWorker.check.500ms check500Delta=${i}, check500CurrentTimeDelta=${s}, pauseDelta=${i-s}`),this._mse.check500Pause()),this._lastCheck500CurrntTime=1e3*e.currentTime,this._lastCheck500Time=t)}this._playedTime=e.currentTime,this._lastCheckTime=t}}_setPaused(t,e){this._paused=!0,this._pausedTs=t,this._lastPausedTs=t,this._log("_setPaused",e),this._callbacks.pause(t)}_setResume(t,e){let i=t-this._pausedTs;this._paused=!1,this._pausedTs=0,this._lastPausedTs=0,this._log("_setResume",e),this._callbacks.resume(t,i)}_log(t,e,i){this._mse.video.printBuffered(),f.a.log(`MSEPauseWorker(${this._mse._num_}).${t} readyState=${e.readyState} currentTime=${e.currentTime} buf=${this._mse.getBufferLen()} dts=${this._mse.getCurrentDts()} ${i||""}`)}},Zs=i(18);let tr=0;const er=1,ir=2;var sr=class extends Qs{constructor(t,e){super(t,e,D.a.PLAYER_CORE_TYPE.MSE);let{videoType:i="flv",videoElement:s=null,h265Proxy:r,ignoreSei:o=!1,closeFetch:n=!1,continuousTimeStamp:h=!1}=e;this.MediaSource=Zs.a.getMediaSource(P.a.mmsOpen),this.pushVideoStartRenderTime=0,this.h265Proxy=r,this.requestAnimationId=-1,this.isMMS=Zs.a.isManagedMediaSource(this.MediaSource),this._num_=++tr,f.a.log(`MSEPlayer(${this._num_}).constructor`),"ts"===i?(this.parser=new pi(this,this.remuxer),this.parser.ignoreSei=o,this.parser.closeFetch=n,this.parser.continuousTimeStamp=h):(this.parser=new We(this,this.remuxer,ae),this.parser.setCorrentDtsOpen(!0),this.parser.repairSameDts=1==P.a.repairSameDts,this.ctrlBuffer.setBuffered(this.buffered),this.parser.dropFrameCtrl.setConfig({dropTime:P.a.dropTime,minFps:P.a.minFps}),this.parser2=new We(this,this.remuxer,oe)),this.JITTER_BUFMIN=1e3,this.JITTER_BUFLEN=4e3,this.JITTER_BUFMAX=8e3,this.latencySeek=0,this.userPaused=!1,this._triggerPlay=!1,this.hasData=!1,this.playing=!1,this.lastPlayTime=0,this.lastCheckPlayTime=0,this.maxGop=0,this.playStartTime=0,this.delayReset=!1,this.isPlayerError=!1,this.isErrorEvent=!1,this.startPlayBackRate=.9,this.pausedByBrowser=!1,this.tryPlayAgainTimout=0,this.onUpdateErrorBind=this.onUpdateError.bind(this),this.onAudioUpdateEndBind=this.onAudioUpdateEnd.bind(this),this.onVideoUpdateEndBind=this.onVideoUpdateEnd.bind(this),this.onMediaSourceOpenBind=this.onMediaSourceOpen.bind(this),this.onVideoErrorBind=this.onVideoError.bind(this),this.onVideoPauseBind=this.onVideoPause.bind(this),this.onVideoPlayBind=this.onVideoPlay.bind(this),this.onVideoLoadedBind=this.onVideoLoaded.bind(this),this.onLoadedMetadataBind=this.onLoadedMetadata.bind(this),this.checkVideoPlayingBind=this.checkVideoPlaying.bind(this),this.onVideoPlayingBind=this.onVideoPlaying.bind(this),this.onVideoTimeUpdateBind=this.onVideoTimeupdate.bind(this),this.mediaSource=new this.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onMediaSourceOpenBind),this.video=this.createVideo(),this.msePause=new yi(this,{pause:this._msePaused.bind(this),resume:this._mseResume.bind(this)}),this.msePauseWorker=new Xs(this,{pause:this._msePausedWorker.bind(this),resume:this._mseResumeWorker.bind(this)}),this.audioSourceBuffer=null,this.videoSourceBuffer=null,this.audioCodec=null,this.videoCodec=null,this.audioSegments=[],this.videoSegments=[],this.autoJitter=!0,this.autoBitrateJitter=!1,this.playbackrateChangeAccess=!0,this.enableLowLatency=!1,this.sensitivePause=!0,this.waitSwapToPcdn=!1,this.printJitter=!!Number(localStorage._printJitter);let d=navigator.userAgent.toLowerCase();this.isAndroid=-1!==d.indexOf("Android"),-1==f.a.getLevel()&&window.chrome&&(window.chrome.mse=this),this.videoDataAppended=!1,this.avcchangeCheckTimer=0,this.offsetDts=0,this.curVideoDts=0,this.curAudioDts=0,this.isH265Play=!1,this.playRateIncrease=0,this.playRateDecrease=0,this.startPlayTime=0,this.isStartBuffer=!0,this.bufferCd=1e3*P.a.jumpBufferCfg[0],this.startCd=P.a.jumpBufferCfg[3],this.startCdMax=1e3*P.a.jumpBufferCfg[5],this.setVideoCurrentTime=0,this.startMoreBufferTime=0,this.bufferMoreContinueTime=1e4,this.maxJumpWaitNow=0,this.lastJumpBufferTs=0,this.mediaDelay=null,this.seiAnchorDelay=-1,this.discontinuityAudio=!1,this.discontinuityVideo=!1,this.isPlaybackRateNormal=!0,this.discontinuityTimeOffset=0,this.frameCallBackNums=0,this.lastFrameCallBackNums=0,this.mseRenderList=[],r&&r.initRender&&r.initRender(this),this.renderList=[],this.renderHiddenTs=0,this.renderListFirst=!0,this.onInitSegmentCb=null,this.videoCallBackTs=0,this.onVisibilityChangedBind=this.onVisibilitychange.bind(this),this.handler&&this.handler.eventEmitter&&this.handler.eventEmitter.on(a.VISIBILITY_CHANGE,this.onVisibilityChangedBind),this.isMseRCErrorCnt=0}getVideoWidth(){return this.video.getVideoWidth()}getVideoHeight(){return this.video.getVideoHeight()}onVisibilitychange(){super.onVisibilitychange(),"hidden"==document.visibilityState&&(this.videoCallBackTs=0,this.isMseRCErrorCnt=0)}setParams(t,e){if(this.pid=t,this.bitrate=e,this._initPerf(),this.parser.dropFrameDts){let e=!1;(1===P.a.dropFrameUids[0]||-1!==P.a.dropFrameUids.indexOf(parseInt(t)))&&(e=!0),this.parser.dropFrameDts.open=e}this.parser.dropFrameDts.start()}_initPerf(){"ts"!==this.videoType&&this.pausePerf.checkLocal(this.pid,this.bitrate)&&this.parser.dropFrameCtrl.start()}getDelayStat(){return"ts"!==this.videoType?this.parser.sei.getStat():null}getVideoDecodeDelaySmooth(){return(this.parser.ctsMax||0)+100}getDelayInfo(){return f.a.log("MSEPlayer.getDelayInfo: delay: ",this.mediaDelay),this.mediaDelay}getRealFps(){return this.parser.getRealFps?this.parser.getRealFps():0}getIsDownEnough(){return!this.parser.isDownEnough||this.parser.isDownEnough()}getRealBitrate(){let t=0;return this.parser.fps&&(t=this.parser.fps.getRealBitrate()),t}destroy(){if(super.destroy(),f.a.log(`MSEPlayer(${this._num_}).destroy`),this.onMediaSourceOpenCallback=null,this.buffered.stop(),this.h265Proxy&&this.h265Proxy.stop(),this.playing=!1,this.lastPlayTime=0,this.playStartTime=0,this.lastCheckPlayTime=0,this.hasData=!1,this.handler&&this.handler.eventEmitter&&this.handler.eventEmitter.off(a.VISIBILITY_CHANGE,this.onVisibilityChangedBind),this.parser.destroy(),this.audioCodec=null,this.videoCodec=null,this.audioSegments=[],this.videoSegments=[],this.onInitSegmentCb=null,this.audioSourceBuffer&&(this.audioSourceBuffer.removeEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.audioSourceBuffer=null),this.videoSourceBuffer&&(this.videoSourceBuffer.removeEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.videoSourceBuffer=null),this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind);let t=this.mediaSource.sourceBuffers;for(;t.length;)this.mediaSource.removeSourceBuffer(t[0]);this.mediaSource=this.onMediaSourceOpenBind=null}this.onAudioUpdateEndBind=this.onVideoUpdateEndBind=this.onUpdateErrorBind=null,this.video&&(this.video.destroy(),this.video=null),this.videoElement=null,this.pushVideoStartRenderTime=0,this.playbackrateChangeAccess=!0,-1!==this.requestAnimationId&&(cancelAnimationFrame(this.requestAnimationId),this.requestAnimationId=-1),this.onFragParsedTime=0,q.remove(this.triggerPlayVideo,this)}clearSourceBuffer(){const t=this.video.video;let e=0;if(t){const i=t.buffered.length;e=i>0?t.buffered.end(i-1):e}this.audioSourceBuffer&&!this.audioSourceBuffer.updating&&e>0&&this.audioSourceBuffer.remove(0,e),this.videoSourceBuffer&&!this.videoSourceBuffer.updating&&e>0&&this.videoSourceBuffer.remove(0,e)}reset(){if(super.reset(),f.a.log(`MSEPlayer(${this._num_}).reset`),this.handler.onVideoStop(this.video.video,!!this.videoSourceBuffer),this.userPaused=!1,this.playing=!1,this.lastPlayTime=0,this.playStartTime=0,this.lastCheckPlayTime=0,this.hasData=!1,this.audioCodec=null,this.videoCodec=null,this.audioSegments=[],this.videoSegments=[],this.discontinuityAudio=!1,this.discontinuityVideo=!1,this.msePause.paused&&this.handler.onPlayResume(y.a.now()),this.pauseStat.reset(),this.bufStat.reset(),this.msePause.reset(),this.msePauseWorker.reset(),this.maxGop=0,this.isPlaybackRateNormal=!0,clearTimeout(this.tryPlayAgainTimout),this.audioSourceBuffer&&(this.audioSourceBuffer.removeEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.audioSourceBuffer=null),this.videoSourceBuffer&&(this.videoSourceBuffer.removeEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.videoSourceBuffer=null),this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind);let t=this.mediaSource.sourceBuffers;for(;t.length;)this.mediaSource.removeSourceBuffer(t[0])}this.mediaSource=new this.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onMediaSourceOpenBind),this.video&&(this.video.destroy(),this.video=null),this.video=this.createVideo(),this.playbackrateChangeAccess=!0,this.videoDataAppended=!1,this.onFragParsedTime=0,this.startPlayTime=0,this.isStartBuffer=!0,this.setVideoCurrentTime=0,this.startMoreBufferTime=0,this.maxJumpWaitNow=0,this.frameCallBackNums=0,this.lastFrameCallBackNums=0,this.mseRenderList.length=0}resetVideo(){if(this.audioSourceBuffer&&(this.audioSourceBuffer.removeEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.audioSourceBuffer=null),this.videoSourceBuffer&&(this.videoSourceBuffer.removeEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.videoSourceBuffer=null),this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind);let t=this.mediaSource.sourceBuffers;for(;t.length;)this.mediaSource.removeSourceBuffer(t[0])}this.mediaSource=new this.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onMediaSourceOpenBind),this.video&&(this.video.destroy(),this.video=null),this.video=this.createVideo(),this.videoCodec=null,this.audioCodec=null,this.lastPlayTime=0}createVideo(){this._triggerPlay=!1;let t=this.videoElement;t||(t=document.createElement("video"),t.id="mse"+this._num_,t.autoplay="safari"!==qe.a.name,t.setAttribute("playsinline",!0),t.setAttribute("webkit-playsinline",!0),t.muted=!1);let e=URL.createObjectURL(this.mediaSource);return Zs.a.isManagedMediaSource(this.MediaSource)?(t.disableRemotePlayback=!0,this.addSource(t,e),this.mediaSource.addEventListener("startstreaming",this._onStartStreaming.bind(this)),this.mediaSource.addEventListener("endstreaming",this._onEndStreaming.bind(this)),t.load()):t.src=e,new Ti(this,t,!!this.videoElement)}_onStartStreaming(){f.a.log("event _onStartStreaming")}_onEndStreaming(){f.a.log("event _onEndStreaming")}addSource(t,e){const i=document.createElement("source");i.type="video/mp4",i.src=e,t.appendChild(i)}insertDiscontinuity(t){if(this.discontinuityAudio=!0,this.discontinuityVideo=!0,this.discontinuityTimeOffset=t,this.discontinuityTimeOffset>0){let e=ai;this.cacheBlockReason(e,t)}}getBufferLen(){return this.video?this.video.getBufferLen():0}getSegmentsBufferLen(){return 200*this.videoSegments.length}getCurrentDts(){if(P.a.dtsJumpOpen){if(this.isPureAudio&&this.parser.timelineAudio)return this.parser.timelineAudio.getRealDtsByCurrentTime(this.getCurrentTime());if(this.parser.timelineVideo)return this.parser.timelineVideo.getRealDtsByCurrentTime(this.getCurrentTime())}return this.getCurrentTime()+this.getInitDts()}getCorrentCurrentDts(){return this.isPureAudio&&this.parser.timelineAudio?this.parser.timelineAudio.getCorrentDtsByCurrentTime(this.getCurrentTime()):this.parser.timelineVideo?this.parser.timelineVideo.getCorrentDtsByCurrentTime(this.getCurrentTime()):this.getCurrentTime()+this.getInitDts()}getCurrentTime(){return this.video?this.video.getCurrentTime():0}getCurrentRealTime(){return this.getCurrentDts()}get isMediaSourceOpen(){return this.mediaSource&&"open"===this.mediaSource.readyState}appendFlv(t){this.addPlayEvent(),this.parser.parseFlv(t,this.isPureAudio)}addPlayEvent(){this.hasData||(this.hasData=!0,this.videoElement&&(this.videoElement.addEventListener("loadeddata",this.onVideoLoadedBind),"safari"!==qe.a.name||this.isLive||this.videoElement.addEventListener("loadedmetadata",this.onLoadedMetadataBind),this.requestAnimationId=requestAnimationFrame(this.checkVideoPlayingBind)))}appendTs(t){this.addPlayEvent(),this.parser.parseTs(t)}checkBuffer(){if(this.video.video.paused||this.video.seeking)return;let t=y.a.now(),e=this.video.video.buffered,i=e.length,s=this.getBufferLen();if(this.bufStat.checkBuffer(t,s),0===this.video.video.currentTime&&0!==this.lastPlayTime)return f.a.warn("MSEPlayer.checkBuffer onPlayerError(true) lastPlayTime="+this.lastPlayTime+" bufLen="+s),this._onPlayerError(!0),this._onErrorEvent(9),void(this.lastPlayTime=0);if(this.lastPlayTime=this.video.video.currentTime,t>this.playStartTime+3e3&&s>4e3&&0==this.video.currentTime&&(i>0&&e.start(0)<=4&&(f.a.log("MSEPlayer.checkBuffer buffer full but can not play"),this.video.currentTime=Math.round(e.start(0)+1)),this.video.play()),0!==this.playStartTime&&t>this.playStartTime+5e3&&(s>5e3||0===s))if(0==this.video.video.currentTime&&s>2e3)f.a.log(`MSEPlayer(${this._num_}) ####### currentTime=0 ++ bufLen=${s} paused=${this.video.video.paused}`),this.video.play();else if(this.playStartTime=0,0===this.video.video.currentTime&&!this.isAndroid)return f.a.warn(`MSEPlayer(${this._num_}).checkBuffer onPlayerError(true) playTime=`+this.video.video.currentTime+" bufLen="+s),this._onErrorEvent(6),void this._onPlayerError(!0);null==this.videoElement&&i&&this.video.video.currentTime-e.start(0)>20&&(this.audioSourceBuffer&&!this.audioSourceBuffer.updating&&this.audioSourceBuffer.remove(0,this.video.video.currentTime-10),this.videoSourceBuffer&&!this.videoSourceBuffer.updating&&this.videoSourceBuffer.remove(0,this.video.video.currentTime-10))}_onPlayerError(t){!this.isPlayerError&&this.handler&&(this.isPlayerError=!0,this.handler.onPlayerError(t))}_onErrorEvent(t){this.isErrorEvent||(this.isErrorEvent=!0,this.handler&&this.handler.onErrorEvent&&this.handler.onErrorEvent({type:t}))}onParseError(t){this._onErrorEvent(t)}onAvcCfgChange(){return f.a.log(`MSEPlayer(${this._num_}).onAvcCfgChange`),this.getBufferLen()<500?(f.a.log(`MSEPlayer(${this._num_}).onAvcCfgChange reset player`),this.remuxer.reset(),this.parser.setPaused(!1),!1):(this.delayReset=!0,!0)}getMaxGop(){return this.maxGop}setEnableLowLatency(t){this.enableLowLatency=t}getVolume(){return this.video?this.video.getVolume():-1}setMuted(t){this.video&&(this.video.setMuted(t),f.a.log(`MSEPlayer.setMuted ${t} hasVideo=${this._hasVideo()} hasAudio=${this._hasAudio()}`))}getMuted(){return this.video?this.video.getMuted():-1}setExceptionStat(t,e){this.handler&&this.handler.exceptionStat&&this.handler.exceptionStat.setStat(t,e)}cacheBlockReason(t,e){this.handler&&this.handler.cacheBlockReason&&this.handler.cacheBlockReason(t,e)}turnToH264(t){this.h265Proxy&&this.h265Proxy.stop(),this.handler&&this.handler.turnToH264(t)}on265StartCodeError(){this.h265Proxy&&this.h265Proxy.on265StartCodeError()}h265Retry(){this.h265Proxy&&this.h265Proxy.stop(),this.handler.h265Retry()}onInitSegment(t){this.onInitSegmentCb&&this.onInitSegmentCb(),t.audioCodec&&(this.audioCodec=t.audioCodec),t.videoCodec&&(this.videoCodec=t.videoCodec,this.getVideoCapabilities(t),this.handler&&this.handler.onInitSegment&&this.handler.onInitSegment()),this.isMediaSourceOpen&&this.initSourceBuffer(),t.audioMoov&&this.audioSegments.push(t.audioMoov),t.videoMoov&&this.videoSegments.push(t.videoMoov),this.playStartTime=0}onFragParsing(t){"audio"===t.type?this.audioSegments.push(t.data):"video"===t.type&&this.videoSegments.push(t.data)}onFragParsed(){this.audioSourceBuffer&&this.appendBuffer("audio"),this.videoSourceBuffer&&this.appendBuffer("video"),null==this.videoElement&&this.isLive&&(this.setFragParsedTime(),this.triggerPlay())}checkVideoPlaying(){0==this.pushVideoStartRenderTime&&this.video&&this.video.video&&this.video.video.videoWidth>0&&this.video.video.videoHeight>0?this.pushVideoStartRenderTime=y.a.now():this.requestAnimationId=requestAnimationFrame(this.checkVideoPlayingBind)}onLoadedMetadata(t){f.a.log("MSEPlayer.onLoadedMetadata"),this.onVideoLoaded(),this.handler.eventEmitter&&this.handler.eventEmitter.trigger(a.VIDEO_PAUSE,{video:this.videoElement,event:t})}onVideoLoaded(){f.a.log("MSEPlayer.onVideoLoaded"),this.triggerPlay()}reloadInError(){this.handler.reloadInError&&this.handler.reloadInError()}initSourceBuffer(){if(localStorage._localVideoCodec&&""!=localStorage._localVideoCodec&&(this.videoCodec=localStorage._localVideoCodec),this.audioCodec&&!this.audioSourceBuffer){f.a.log(`MSEPlayer(${this._num_}).initSourceBuffer audio codec=`+this.audioCodec);try{this.audioSourceBuffer=this.mediaSource.addSourceBuffer("video/mp4;codecs="+this.audioCodec),this.audioSourceBuffer.addEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.addEventListener("error",this.onUpdateErrorBind)}catch(t){return f.a.warn("MSEPlayer.initSourceBuffer audio err="+t.message),t.message&&-1!=t.message.indexOf("No additional SourceBuffer objects may be added")&&(f.a.log("MSEPlayer.initSourceBuffer resetMediasource in audio"),this.handler.resetMediasource)?void this.handler.resetMediasource():(this._onErrorEvent(4),void this._onPlayerError(!0))}}else this.audioCodec&&this.audioSourceBuffer&&this.discontinuityAudio&&(f.a.log(`MSEPlayer(${this._num_}).initSourceBuffer reset audio codec=`+this.audioCodec),this.audioSourceBuffer.changeType("video/mp4;codecs="+this.audioCodec));if(this.videoCodec&&!this.videoSourceBuffer){f.a.log(`MSEPlayer(${this._num_}).initSourceBuffer video codec=`+this.videoCodec);try{this.videoSourceBuffer=this.mediaSource.addSourceBuffer("video/mp4;codecs="+this.videoCodec),this.videoSourceBuffer.addEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.addEventListener("error",this.onUpdateErrorBind)}catch(t){if(t.message&&-1!=t.message.indexOf("No additional SourceBuffer objects may be added")&&(f.a.log("MSEPlayer.initSourceBuffer resetMediasource in video"),this.handler.resetMediasource))return void this.handler.resetMediasource();f.a.warn(`MSEPlayer(${this._num_}).initSourceBuffer video err=`+t.message),this.getIsMseHevc()?this.handler.onMseHevcError($s):(this._onErrorEvent(5),this._onPlayerError(!0))}}else this.videoCodec&&this.videoSourceBuffer&&this.discontinuityVideo&&(f.a.log(`MSEPlayer(${this._num_}).initSourceBuffer reset video codec=`+this.videoCodec),this.videoSourceBuffer.changeType("video/mp4;codecs="+this.videoCodec));this.discontinuityVideo=!1,this.discontinuityAudio=!1}appendBuffer(t){const e=y.a.now();if(0!=this.mediaSource.sourceBuffers.length&&!this.isPlayerError)if("audio"==t){if(this.audioSegments.length>0&&this.audioSourceBuffer&&!this.audioSourceBuffer.updating){let t=this.audioSegments.shift();try{this.audioSourceBuffer.appendBuffer(t),this.videoDataAppended=!0,this.audioPlayConsuming.pushRemuxedVideoFrameData(e)}catch(t){f.a.warn(`MSEPlayer(${this._num_}).appendBuffer audio err=`+t.message),this._onErrorEvent(7),this._onPlayerError(!0)}}}else{if("video"!=t)throw new Error(`MSEPlayer(${this._num_}).appendBuffer type error! Valide type is audio or video.`);if(this.videoSegments.length>0&&this.videoSourceBuffer&&!this.videoSourceBuffer.updating){let t=this.videoSegments.shift();try{this.videoSourceBuffer.appendBuffer(t),this.videoDataAppended=!0,this.videoPlayConsuming.pushRemuxedVideoFrameData(e)}catch(t){f.a.warn(`MSEPlayer(${this._num_}).appendBuffer video err=`+t.message),this._onErrorEvent(8),this._onPlayerError(!0)}}}}triggerH265Play(t,e){this.isH265Play||(f.a.log("MSEPlayer.triggerH265Play"),this.isH265Play=!0,this.h265Proxy&&this.h265Proxy.reportDecodeRenderTime(t,e)),!this.videoElement&&this.isLive||(f.a.log("MSEPlayer.triggerH265Play.triggerPlay"),this.triggerPlay())}triggerPlay(){if(!this.playing&&this.isMediaSourceOpen){if(this.playing=!0,this.playStartTime=y.a.now(),this.videoElement&&!this.videoElement.autoplay||this.video.play(),P.a.platform===D.a.PLATFORM_TYPE_NAME.wap&&null!=this.videoElement)return;"safari"===qe.a.name?(P.a.safariFirstLoad?(P.a.safariFirstLoad=!1,this.triggerPlayVideo()):q.once(this.triggerPlayVideo,this,P.a.safariPlayDelay),this.video.triggerPlay()):this.triggerPlayVideo()}}triggerPlayVideo(){let t=!!this.videoSourceBuffer,e=this.getCodecType();const i=this.h265Proxy&&this.h265Proxy.isH265MseCodec;f.a.log(`MSEPlayer.onPlayVideo codec: ${e}${i?" (mse)":""}`),0==this.parser.decodeIFRTime&&1==Number(P.a.isNoVideoReport)&&this.handler.eventEmitter&&this.handler.eventEmitter.trigger(a.P2P_REPORT);let s=null;e===Ee&&this.h265Proxy&&this.h265Proxy.isReady&&(s=this.h265Proxy.canvas),e===Ee&&this.h265Proxy&&this.h265Proxy.isReady?this.h265Proxy.isVideoTrack?this.handler.onPlayVideo(this.h265Proxy.canvas,this.widthCfg,this.heightCfg,t,null,this.onFragParsedTime,e):this.handler.onPlayVideo(this.video.video,this.widthCfg,this.heightCfg,t,this.h265Proxy.canvas,this.onFragParsedTime,e):this.handler.onPlayVideo(this.video.video,this.widthCfg,this.heightCfg,t,null,this.onFragParsedTime,e),this.startPlayTime=y.a.now(),this.isPlayVideo=!0}triggerH5PlayVideo(){if(f.a.log("trigger h5 video play"),this.pausedByBrowser)return void(this.pausedByBrowser=!1);this.startPlayTime=y.a.now();const t=this._hasVideo();this.handler.onPlayVideo(this.video.video,this.widthCfg,this.heightCfg,t,null,this.onFragParsedTime)}onH264Sei(t,e){this.handler.onSendSeiData(t,e,this.video.video.currentTime)}onMediaSourceOpen(){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind),f.a.log("MSEPlayer.onMediaSourceOpen"),this.m4sPlayer.onMediaSourceOpen(this.mediaSource),(this.audioSegments.length>0||this.videoSegments.length>0)&&(this.initSourceBuffer(),this.appendBuffer("audio"),this.appendBuffer("video"),0==this.onFragParsedTime&&(this.onFragParsedTime=y.a.now()),null==this.videoElement&&this.triggerPlay())}onAudioUpdateEnd(){this.checkSeek(),this.appendBuffer("audio"),this.checkAppendOver()}onVideoUpdateEnd(){this.checkSeek(),this.appendBuffer("video"),this.checkAppendOver()}checkSeek(){this.video.realSeek()}checkCurrentTime(){this.video.checkCurrentTime()}checkAppendOver(){0===this.videoSegments.length&&0===this.audioSegments.length&&(this.videoSourceBuffer&&this.videoSourceBuffer.updating||this.audioSourceBuffer&&this.audioSourceBuffer.updating||this.handler&&this.handler.onSBUpdateEnd&&this.handler.onSBUpdateEnd())}onUpdateError(t){f.a.warn("MSEPlayer.onUpdateError",t)}onVideoPause(t){f.a.log("MSEPlayer.onVideoPause"),this.userPaused=!0,this.h265Proxy&&this.h265Proxy.isReady&&this.h265Proxy.onVideoPause&&this.h265Proxy.onVideoPause()}onPauseByBrowser(){if(this.userPaused=!0,f.a.log("MSEPlayer.onPauseByBrowser"),this.handler){this.handler.onPauseByBrowser&&this.handler.onPauseByBrowser(),this.handler.updateStatus&&this.handler.updateStatus(u),this.pausedByBrowser=!0;let t=this.video.video,e=this._hasVideo();this.handler.eventEmitter&&this.handler.eventEmitter.trigger(a.BROWSER_PAUSE,{video:t}),1===P.a.h5FirstPlay&&this.handler&&this.handler.onVideoStop&&this.handler.onVideoStop(t,e)}this.h265Proxy&&this.h265Proxy.isReady&&this.h265Proxy.onVideoPause&&this.h265Proxy.onVideoPause()}onVideoTimeupdate(){this.handler&&this.handler.onVideoTimeupdate&&this.handler.onVideoTimeupdate()}onVideoPlaying(){if(this.handler&&this.handler.updateStatus){if(this.video&&this.video.video&&this.video.video.paused)return void f.a.log("video is playing, video.paused=",this.video.video.paused);f.a.log("video is playing",this.isPureAudio);const t=this.isPureAudio?p:h;this.handler.updateStatus(t)}}onVideoPlay(t){f.a.log("MSEPlayer.onVideoPlay"),this.userPaused=!1,this.h265Proxy&&this.h265Proxy.isReady&&this.h265Proxy.onVideoPlay&&this.h265Proxy.onVideoPlay()}onVideoError(t){let e="";if(this.video.video.error){let t=this.video.video.error.code;e=" errCode="+t+" "+["Unknow","用户终止","网络错误","解码错误","格式不支持"][t],3!=t&&4!=t||(this.getIsMseHevc()?this.handler.onMseHevcError(Ys):(this._onErrorEvent(3==t?1:2),this._onPlayerError(!0)),localStorage.decodeabnormal="abnormal_"+(new Date).getTime(),3==t&&this.handler.decoderDecodeError())}f.a.warn(`MSEPlayer(${this._num_}).onVideoError id=${t.currentTarget.id}`+e,t),this.isLive||wt.getFirstFragStatus()===Ct&&wt.setFirstFragStatus(At)}pause(){f.a.info("MSEPlayer.pause"),this.userPaused=!0,this.video&&this.video.pause()}play(){f.a.info("MSEPlayer.play"),this.userPaused=!1,this.video&&this.video.play()}resetHls(){this.parser.pushAllData&&this.parser.pushAllData(),super.resetHls(),this.clearSourceBuffer()}seek(t){this.lastPlayTime=t,f.a.info("MSEPlayer.seek seekTime="+t,"currentTime="+this.video.video.currentTime),this.video&&this.video.seek(t)}onCheckTimer(t,e){if(!this.playing||!this.isMediaSourceOpen)return void(this.parser&&this.parser.printPlayFrameInfo&&this.parser.printPlayFrameInfo());if(super.onCheckTimer(t,e),0!=this.shildAudioStartTs&&this.video&&this.video.video){let t=this.getCurrentDts();this.video.video.muted&&t>=this.shildAudioStartTs&&(f.a.log("MSEPlayer.shieldAudioMute recover"),this.video.video.muted=!1,this.shildAudioStartTs=0)}let i=this.getBufferLen(),s=Number(localStorage._printBufferLen);if(-1==s||s>0&&s==this._num_){let t=Math.max(0,i/100);f.a.debug(this._getTag(),"bufLen","-".repeat(t),i)}if(Number(localStorage._printMseLog)&&this.audioSegments&&this.videoSegments&&f.a.debug(`MSE aSegments=${this.audioSegments.length} vSegments=${this.videoSegments.length} bufLen=${this.getBufferLen()}`),this.video.video.paused||this.userPaused)return;if(this.checkVideoRenderFrames(),null==this.videoElement&&this.isLive&&e%4==0&&i>P.a.jitJump[0]&&!Number(localStorage._localFlvTest)){let t=.001*(P.a.jitJump[0]-P.a.jitJump[1]);this.video.video.currentTime+=t,f.a.warn(`MSEPlayer.onCheckTimer jumpTs=${t} bufLen=${this.getBufferLen()}`)}this.checkBuffer();let r=(this.handler?this.handler.lastEmptySliceTs:0)||0,a=r>0&&t-r<3e3,o=this._hasVideo();this.isLive&&o&&this.msePause.pausedTs>0&&t-this.msePause.pausedTs>5e3&&!a&&this.sensitivePause&&(f.a.warn("MSEPlayer.onCheckTimer paused 5 sec."),this._onErrorEvent(3),this._onPlayerError(!0),this.handler&&this.handler.onPause5Sec&&this.handler.onPause5Sec())}checkVideoRenderFrames(){let t=this.frameCallBackNums-this.lastFrameCallBackNums;if(this.parser&&this.parser.fps){this.parser.fps.getRecvFps()>=25&&0==t&&"visble"==document.visibilityState?this.isMseRCErrorCnt++:this.isMseRCErrorCnt=0;this.getIsMseHevc()&&this.video&&this.video.isSupportRVCB&&1==P.a.isMseCheckRcRd&&this.isMseRCErrorCnt>=10&&(f.a.log("MSEPlayer.checkVideoRenderFrames, close mse hevc!"),this.handler.onMseHevcError(Ks))}const e=y.a.now();this.renderList.length>=5&&this.renderList.shift(),"hidden"==document.visibilityState?(this.renderList.length=0,this.renderHiddenTs=e):(e-this.renderHiddenTs>=1e3||0==this.renderHiddenTs)&&!this.renderListFirst&&this.renderList.push(t),1==Number(localStorage._printVideoCallBackFps)&&f.a.log(`MSEPlayer.checkVideoRenderFrames,isHevc=${isHevc},rfps=${t},vs=${document.visibilityState},rl=${this.renderList.toString()},ecECnt=${this.isMseRCErrorCnt}`),this.mseRenderList.push(t),this.renderListFirst=!1,this.lastFrameCallBackNums=this.frameCallBackNums}getMseRenderList(){let t=[...this.mseRenderList];return this.mseRenderList.length=0,f.a.log("MSEPlayer.renderList",t.toString()),t}onCheckFastTimer(t,e){if(super.onCheckFastTimer(t),!this.playing||!this.isMediaSourceOpen||this.video.video.paused||this.userPaused)return;this.checkEmptyFrames(),this.checkDelayReset(),this.onJitterTimer(),this.msePause.check(t);let i=(this.handler?this.handler.lastEmptySliceTs:0)||0,s=i>0&&t-i<3e3,r=this._hasVideo();if(null==this.videoElement&&!this.pause500checked&&r&&this.msePause.pausedTs>0&&t-this.msePause.pausedTs>500&&!s){this.pause500checked=!0;let t=this.bufferedInfo(),e=t.bufferLen.toFixed(2),i=(t.nextStart-t.end).toFixed(2);if(f.a.info(`MSEPlayer(${this._num_}).onCheckFastTimer paused`,"bufferLen="+e,"hole="+i,"nextStart="+t.nextStart.toFixed(2),"currentTime="+this.video.video.currentTime,`audioSegments=${this.audioSegments.length} videoSegments=${this.videoSegments.length} videoSamples=${this.ctrlBuffer.avBuffer.vBuffer.getInfo()} audioSamples=${this.ctrlBuffer.avBuffer.aBuffer.getInfo()}`),this.isLive&&"ts"!=this.videoType){this.video.printBuffered();let e=Number(t.nextStart);this.video.video&&e&&i>0&&i<3&&e-this.video.video.currentTime>.5&&(this.video.video.currentTime=e,f.a.log(`MSEPlayer(${this._num_}).onCheckFastTimer try jump currentTime=`+this.video.video.currentTime))}}}onCheckFastWorkerTimer(t){super.onCheckFastWorkerTimer(t),this.playing&&this.isMediaSourceOpen&&!this.video.video.paused&&!this.userPaused&&this.msePauseWorker.check(t)}checkEmptyFrames(){this.handler.setEmptyFrames&&this.parser.hasEmptyFrames&&this.handler.setEmptyFrames(this.parser.hasEmptyFrames)}checkDelayReset(){this.delayReset&&this.getBufferLen()<500&&(f.a.log(`MSEPlayer(${this._num_}).checkDelayReset reset player`),this.remuxer.reset(),this.parser.setPaused(!1),this.delayReset=!1)}_hasAudio(){return!!this.audioSourceBuffer||this.m4sPlayer&&this.m4sPlayer.hasVideo()}_hasVideo(){return!!this.videoSourceBuffer||this.m4sPlayer&&this.m4sPlayer.hasVideo()}_msePaused(t){this.pauseStat.pause(),this.handler.onPlayPause(t,this._hasVideo())}_mseResume(t,e){this.pauseStat.resume(),this.pause500checked=!1,this.handler.onPlayResume(t,this._hasVideo())}_msePausedWorker(t){this.handler.onPlayPauseWorker&&this.handler.onPlayPauseWorker(t,this._hasVideo())}_mseResumeWorker(t,e){this.parser.dropFrameCtrl&&this.pausePerf.checkLive(this.pid,this.bitrate,this.pauseStat.getCnt(),this.buffered.continueBuffer)&&(this.parser.dropFrameCtrl.start(),this.parser.dropFrameDts.start()),this.handler.onPlayResumeWorker&&this.handler.onPlayResumeWorker(t,this._hasVideo())}bufferedInfo(){let t,e,i,s,r,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2,o=[],n=[],h=this.video.video.buffered;for(r=0;r<h.length;r++)o.push({start:h.start(r),end:h.end(r)});for(o.sort((t,e)=>{let i=t.start-e.start;return i||e.end-t.end}),r=0;r<o.length;r++){let t=n.length;if(t){let e=n[t-1].end;o[r].start-e<a?o[r].end>e&&(n[t-1].end=o[r].end):n.push(o[r])}else n.push(o[r])}let d=this.video.video.currentTime;for(r=0,t=0,e=i=d;r<n.length;r++){let o=n[r].start,h=n[r].end;if(d+a>=o&&d<h)e=o,i=h,t=i-d;else if(d+a<o){s=o;break}}return s||(s=i),{bufferLen:t,start:e,end:i,nextStart:s}}printBuffer(t){if(this.video.video){let e=this.video.video.buffered,i="buffered=["+(1e3*e.start(0)|0)+","+(1e3*e.end(0)|0)+"]",s=1e3*this.video.video.currentTime>>0,r=this.getBufferLen();f.a.log(`MSEPlayer(${this._num_}).printBuffer ${t} currentTime=${s} bufLen=${r} ${i}`)}}playbackRateSet(t){const e=this.getPlayVideo();if(!e)return;const i=t=>{if(this.playRateIncrease%2!=0)return;let i=t<1&&t+.02>1?1:t+.02;i>P.a.playbackrateMax&&(i=P.a.playbackrateMax),this.playRateDecrease=0,e.playbackRate=i},s=t=>{if(this.playRateDecrease%2!=0)return;let i=t>1&&t-.02<1?1:t-.02;i<P.a.playbackrateMin&&(i=P.a.playbackrateMin),this.playRateIncrease=0,e.playbackRate=i},r=this.getBufferLen();let a=e.playbackRate;t<0?s(a):t>0?i(a):1!==a&&(a<1&&r<this.JITTER_BUFLEN?s(a):a>1&&r>this.JITTER_BUFLEN?i(a):e.playbackRate=1),this.playRateDecrease++,this.playRateIncrease++}setMuffledVolume(t){this.video.setMuffledVolume(t)}setPlaybackRate(t){if(this.handler&&this.handler._hyPlayer&&this.handler._hyPlayer.getSupportAuto&&!this.handler._hyPlayer.getSupportAuto())return;let e=this.getPlayVideo();e&&(e.playbackRate=t)}onJitterTimer(t,e){if(!this.playing)return;if("ts"==this.videoType&&!this.isLive)return;if(!this.autoJitter)return;if(this.autoBitrateJitter)return;let i=this.getPlayVideo();if(!i)return;let s=this.getBufferLen();if(P.a.getEnableJumpBuffer()||this.isShieldAudio){let t=y.a.now();if(this.latencySeek>0&&s>4e3)return void(i.currentTime+=s-this.latencySeek);if(this.enableLowLatency&&s>Number(P.a.jitLowLatency))i.currentTime+=s-P.a.jitLowLatency;else{let e=this.getFrameBufferLen();1==P.a.jumpBufferCfg2[0]&&(s+=e);let i=s-this.JITTER_BUFLEN;if(t-this.startPlayTime<this.startCd)return;if(this.isShieldAudio){let t=e+s;const r=this.JITTER_BUFLEN+P.a.shieldAudioCfg[1],a=this.JITTER_BUFLEN;if(this.printJitter&&f.a.log(`MSEPlayer.onJitterTimer.shield bufLen=${s},frameBufLen=${e},minusBuffer=${i},newBuf=${t-i}`),i=t-r,i<=0)return;if(s-i<a&&(i=s-a),i<0)return}if(this.isStartBuffer)i>=P.a.jumpBufferCfg[1]&&(this.isRevFastOver||t-this.startPlayTime>=this.startCdMax)&&this.setJumpBufferCurrentTime(i,s,er,t);else if(t-this.setVideoCurrentTime>=this.bufferCd||0==this.setVideoCurrentTime){if(t-this.startMoreBufferTime>=this.bufferMoreContinueTime&&0!=this.startMoreBufferTime)return void this.setJumpBufferCurrentTime(i,s,ir,t);i>=P.a.jumpBufferCfg[1]?0==this.startMoreBufferTime&&(this.startMoreBufferTime=t):this.startMoreBufferTime=0}}}else if(this.latencySeek>0&&s>4e3)i.currentTime+=s-this.latencySeek;else try{let t=0;if(s<this.JITTER_BUFMIN?t=s-this.JITTER_BUFLEN:s>this.JITTER_BUFMAX&&(t=s-this.JITTER_BUFMAX),this.enableLowLatency&&s>Number(P.a.jitLowLatency))i.playbackRate=1.1;else if(this.playbackrateChangeAccess){const e=Number(localStorage.ab_adjust);t=e||t,1!=i.playbackRate&&this.isPlaybackRateNormal&&f.a.log("MSEPlayer.onJitterTimer.playbackRate=",i.playbackRate),1!=i.playbackRate?this.isPlaybackRateNormal=!1:this.isPlaybackRateNormal=!0,this.playbackRateSet(t)}else i.playbackRate=1;-1===Number(localStorage._print_ab_log)&&f.a.log("BUFMIN: %d, BUFMAX: %d, BUFLEN:%d, bufLen: %d, adjust: %d, playbackRate: %f",this.JITTER_BUFMIN,this.JITTER_BUFMAX,this.JITTER_BUFLEN,s,t,i.playbackRate)}catch(t){f.a.error("MSEPlayer.onJitterTimer set playbackRateSet error",t)}}setJumpBufferCurrentTime(t,e,i,s){this.lastJumpBufferTs=s||y.a.now(),this.h265Proxy&&this.h265Proxy.isReady&&!this.h265Proxy.isH265MseCodec?(-1==localStorage._printWasmJump&&f.a.log("MSEPlayer.setJumpBufferCurrentTime",t,e,i,s),this.h265Proxy.jumpBuffer(t,e,i,s)):this.setVideoCurrentTimeHand(t,e,i,s)}setVideoCurrentTimeHand(t,e,i,s){let r=this.getPlayVideo();if(!r)return;let a="";i===er?(this.isStartBuffer=!1,a="fiveJump"):i===ir&&(a="ContinueJudgeJump",this.startMoreBufferTime=0),f.a.log(`MSEPlayer.onJitterTimer.jumpBuffer ${a} video.currentTime before=${r.currentTime} bufLen=${e} minusBuffer=${t} curDts=${this.getCurrentDts()}`),r.currentTime+=t/1e3,this.setVideoCurrentTime=s,f.a.log(`MSEPlayer.onJitterTimer.jumpBuffer ${a} video.currentTime now=${r.currentTime} curDts=${this.getCurrentDts()} bufLen=${this.getBufferLen()} frameBufLen=${this.getFrameBufferLen()}`)}onWasmRenderCallback(){this.video._renderCallback()}requestVideoFrameCallback(){if(this.frameCallBackNums++,P.a.renderStat[0]){this.renderFps.addRender();const t=y.a.now(),e=t-this.videoCallBackTs;0!=this.videoCallBackTs&&e>=200&&(f.a.log("MSEPlayer.requestVideoFrameCallback dis="+e),this.videoCallBackLargeCnt++);const i=this.getCurrentRealTime();this.audioPlayConsuming.addRenderFrameData(i,t),this.videoPlayConsuming.addRenderFrameData(i,t),this.videoCallBackTs=t}}getOsDiscardConfig(){let t=pe.a.os||"",e=pe.a.osVersion||"";return!("windows"!=t.toLocaleLowerCase()||7!=Number(e))||1==Number(localStorage._enableOsDiscardFrame)}getIsMseHevc(){return this.videoCodec&&(-1!=this.videoCodec.indexOf("hev")||-1!=this.videoCodec.indexOf("hvc"))}getVideoCapabilities(t){navigator&&navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo({type:"media-source",video:{contentType:`video/mp4;codecs="${t.videoCodec}"`,width:t.videoWidth,height:t.videoHeight,bitrate:1e4,framerate:60}}).then(t=>{t&&t.supported&&f.a.log("MSEPlayer.getVideoCapabilities",JSON.stringify(t))})}switchShieldAudio(t){this.ctrlBuffer.switchShieldAudio(t)}check500Pause(){this.handler.check500Pause&&this.handler.check500Pause()}isSupportRequestVideoFrameCallback(){return this.video&&this.video.isSupportRequestVideoFrameCallback()}getRenderElement(){return this.getCodecType()===Ee&&this.h265Proxy&&this.h265Proxy.isReady?this.h265Proxy.getRenderElement():this.video.video}};var rr=class{static isSupported(){if(1==localStorage._noFetch)return!1;try{let t=qe.a.msedge&&qe.a.version.minor>=15048,e=!qe.a.msedge||t;return fetch&&ReadableStream&&e}catch(t){return!1}}constructor(t){this._config=t,this._receivedLength=0,this._status=0,this.fromByte=0,this.toByte=0}destroy(){this.fromByte=0,this.toByte=0,this.onChunk=null,this.onSuccess=null,this.onError=null,this.onTimeout=null,this._status=0,this._clearTimeout(),this.abort()}loadBuffer(t,e,i,s,r,a,o,n,h){this.url=t,this.onOpen=e,this.onChunk=i,this.onSuccess=s,this.onError=r,this.onTimeout=a,this.stats={trequest:performance.now(),retry:0},this.timeout=o,this.maxRetry=n,this.retryDelay=h,this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),o),this.loadInternal()}loadInternal(){this._requestAbort=!1;let t=new self.Headers;this.fromByte>0&&t.append("Range",`bytes=${this.fromByte}-${this.toByte>0?this.toByte:""}`);let e={method:"GET",headers:t,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};fetch(this.url,e).then(t=>{if(!this._requestAbort)return t.ok&&t.status>=200&&t.status<=299?(this._status=t.status,this._onopen({code:this._status}),this._pump.call(this,t.body.getReader())):(this._status=t.status,void this._onerror({code:t.status,msg:t.statusText}));this._requestAbort=!1})}abort(){this._requestAbort=!0}_clearTimeout(){let t=this.timeoutHandle;t&&(clearTimeout(t),this.timeoutHandle=null)}_pump(t){return t.read().then(e=>{if(this._clearTimeout(),e.done)this._onsuccess();else{if(!0===this._requestAbort)return this._requestAbort=!1,t.cancel();let i=e.value.buffer;this.onChunk&&this.onChunk(i),this._pump(t)}})}_onopen(t){this.onOpen&&this.onOpen(t)}_onerror(t){0!==t.code&&404!==t.code?this.stats.retry<this.maxRetry?(f.a.warn(`FetchLoader.loaderror url=${this.url} retryDelay=${this.retryDelay} error: `,t),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++,this.abort()):(this._clearTimeout(),f.a.warn(`FetchLoader.loaderror reach max retry url=${this.url} error: `,t),this.onError&&this.onError(t)):this.onError&&this.onError(t)}_onsuccess(t){this._clearTimeout(),this.onSuccess&&this.onSuccess(t)}loadtimeout(){this._status=-2,this.stats.retry<this.maxRetry?(f.a.warn("FetchLoader.loadtimeout url="+this.url+" retryDelay="+this.retryDelay),this.abort(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++):(this._clearTimeout(),f.a.warn("FetchLoader.loadtimeout max retry url="+this.url),this.onTimeout&&this.onTimeout())}};let ar=!1,or=!1;class nr{constructor(t){let{eventEmiter:e,stat:i,statVod:s}=t;this.eventEmiter=e,this.stat=i,this.statVod=s,this.isSendLoadTime=!1,this.isSendHlsLoadTime=!1,this.isSendH265=!1,this.hasP2P=0,this.restartReason=-1,this.restartTimes=0,this.turnToFlvReason=-1,this.turnToFlvTimes=0,this.httpError=!1,this.busiSource="",this.isSendM3u8LoadTime=!1,this.isSendVodLoadTime=!1,this.isSendVodM3u8LoadTime=!1,this.isClosedSendVodLoadTime=!1}closeSendVodLoadTime(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isClosedSendVodLoadTime=t}sendCdnTime(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,n=arguments.length>7?arguments[7]:void 0;if(e){let e=Math.max(0,t.connectVideoTime-t.startTime),h=t.firstVideoPkgTime-t.connectVideoTime,d=t.firstIFrameTime1-t.connectVideoTime,l=t.firstIFrameTime2-t.firstIFrameTime1,u=t.firstRenderTime-t.firstIFrameTime2,c=t.onPlayTime-t.firstRenderTime,p=t.recvDataTime-t.startTime,m=(t.onPlayTime,t.startTime,t.firstP2POnDataTime-t.startTime);m=m<0?0:m;let _=0;t.firstP2PIframeTime>0&&(_=t.firstP2PIframeTime-t.startTime,_=_<0?0:_);let g=0;r&&(g+=1),s&&(g+=2),this.stat.setComDim(L.a.DIM_COM.ACT_LOAD_TYPE,g);let S=[t.hyPlayerLoadTs,p,e,s,r,i,a,o,0,m,_];Z.getLocalRetry(S);let T=[this.stat.createAct(L.a.ACT.CONNECT_VIDEO_TS,{value:[e]}),this.stat.createAct(L.a.ACT.FIRST_VIDEO_PKG_TS,{value:[h]}),this.stat.createAct(L.a.ACT.FIRST_VIDEO_IFRAME_TS,{value:[d]}),this.stat.createAct(L.a.ACT.VIDEO_IFRAME_TS,{value:[l]}),this.stat.createAct(L.a.ACT.FIRST_VIDEO_RENDER_TS,{value:[u]}),this.stat.createAct(L.a.ACT.VIDEO_PLAYED_TS,{value:[c]}),this.stat.createAct(L.a.ACT.VIDEO_LOAD_TS,{value:S,str:[n]})];if(f.a.log(`TsdbUtils.sendCdnTime, loadTime=${t.hyPlayerLoadTs}, connectTime=${e}, recvDataTime=${p}`),this.sendMetrics([this.stat.createAct(L.a.ACT.VIDEO_LOAD_TS_V2,{value:S,str:[n,this.isSendLoadTime?0:1]})]),t.hyPlayerLoadTs>=P.a.autoReportTime&&this.autoReport(),this.isSendLoadTime)return;this.isSendLoadTime=!0,this.sendMetrics(T)}else{let e=t.getVPTime-t.startTime,i=Math.max(0,t.connectVideoTime-t.getVPTime),s=t.loginTime-t.connectVideoTime,r=t.firstVideoPkgTime-t.loginTime,a=t.firstIFrameTime-t.firstVideoPkgTime,o=t.firstRenderTime-t.firstIFrameTime,n=t.onPlayTime-t.firstRenderTime,h=t.onPlayTime-t.startTime,d=[this.stat.createAct(L.a.ACT.VIDEO_GET_VP_TS,{value:[e]}),this.stat.createAct(L.a.ACT.CONNECT_VIDEO_TS,{value:[i]}),this.stat.createAct(L.a.ACT.VIDEO_LOGIN_TS,{value:[s]}),this.stat.createAct(L.a.ACT.FIRST_VIDEO_PKG_TS,{value:[r]}),this.stat.createAct(L.a.ACT.FIRST_VIDEO_IFRAME_TS,{value:[a]}),this.stat.createAct(L.a.ACT.FIRST_VIDEO_RENDER_TS,{value:[o]}),this.stat.createAct(L.a.ACT.VIDEO_PLAYED_TS,{value:[n]}),this.stat.createAct(L.a.ACT.VIDEO_LOAD_TS,{value:[h]})];this.sendMetrics(d)}}sendFlvTime(t,e,i,s){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,c=arguments.length>12?arguments[12]:void 0,p=0;o&&(p+=1),a&&(p+=2),this.stat.setComDim(L.a.DIM_COM.ACT_LOAD_TYPE,p);let m=[t,i,e,a,o,n,l,u,0,h,d];Z.getLocalRetry(m);let _=[this.stat.createAct(L.a.ACT.VIDEO_LOAD_TS,{value:m,str:[c]}),this.stat.createAct(L.a.ACT.CONNECT_VIDEO_TS,{value:[e]}),this.stat.createAct(L.a.ACT.RECV_VIDEO_TS,{value:[i,s]})];t>1e4||e>1e4||(f.a.log(`TsdbUtils.sendCdnTime, loadTime=${t}, connectTime=${e}, recvDataTime=${i}`),this.sendMetrics([this.stat.createAct(L.a.ACT.VIDEO_LOAD_TS_V2,{value:m,str:[c,this.isSendLoadTime?0:1]})]),t>=P.a.autoReportTime&&this.autoReport(),this.isSendLoadTime&&!r||(this.isSendLoadTime=!0,this.sendMetrics(_)))}sendWebRtcTime(t,e,i,s,r){this.isSendLoadTime=!0,this.stat.setActDim("p2p","3");let a=[this.stat.createAct(L.a.ACT.VIDEO_LOAD_TS,{value:[t,0,0,0,0,e,i,s,r]})];this.sendMetrics(a)}sendHlsTime(t,e,i,s,r,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,d=arguments.length>9?arguments[9]:void 0;if(this.isSendHlsLoadTime)return;let l=0;if(n&&(l+=1),o&&(l+=2),this.stat.setComDim(L.a.DIM_COM.ACT_LOAD_TYPE,l),this.isSendHlsLoadTime=!0,e>1e4||i>1e4||r>1e4)return;let u=[this.stat.createAct(L.a.ACT.VIDEO_LOAD_TS,{value:[e,t,0,o,n,r,h],str:[this.busiSource]}),this.stat.createAct(L.a.ACT.VIDEO_LOAD_SEG,{value:d}),this.stat.createAct(L.a.ACT.FIRST_FRAG_LOAD_TS,{value:[s,t]}),this.stat.createAct(L.a.ACT.FIRST_FRAG_LOADED_TS,{value:[r,t,h]}),this.stat.createAct(L.a.ACT.FIRST_FRAG_SIZE,{value:[a,t]})];i>0&&!this.isSendM3u8LoadTime&&(u.push(this.stat.createAct(L.a.ACT.LOAD_M3U8_TS,{value:[i,t]})),this.isSendM3u8LoadTime=!0),this.sendMetrics(u)}sendM3u8LoadedTime(t,e){if(this.isSendM3u8LoadTime)return;if(e>1e4)return;this.isSendM3u8LoadTime=!0;let i=[this.stat.createAct(L.a.ACT.LOAD_M3U8_TS,{value:[e,t]})];this.sendMetrics(i)}sendVodHlsTime(t){let{loadType:e,loadTime:i,loadM3u8Time:s,firstFragLoadTs:r,firstFragLoadedTs:a,firstFragSize:o,businessCost:n=0,UICost:h=0,firstFragParsedTs:d=0,playTs:l,startTs:u,m3u8Status:c,firstTsStatus:p,costTimes:m}=t;if(this.isClosedSendVodLoadTime)return;if(this.isSendVodLoadTime)return;if(this.isSendVodLoadTime=!0,i>1e4&&99999!=i)return;const f=[i,e,c,p,s,a,d,n,h,u,l];let _=[this.statVod.createAct(L.a.ACT.VIDEO_LOAD_TS,{value:f,str:["",ar?0:1]}),this.statVod.createAct(L.a.ACT.VIDEO_LOAD_SEG,{value:m})];i<1e4&&(_=_.concat([this.statVod.createAct(L.a.ACT.FIRST_FRAG_LOAD_TS,{value:[r,e]}),this.statVod.createAct(L.a.ACT.FIRST_FRAG_LOADED_TS,{value:[a,e,d]}),this.statVod.createAct(L.a.ACT.FIRST_FRAG_SIZE,{value:[o,e]})])),s>0&&!this.isSendVodM3u8LoadTime&&(_.push(this.statVod.createAct(L.a.ACT.LOAD_M3U8_TS,{value:[s,e]})),this.isSendVodM3u8LoadTime=!0),this.sendMetrics(_),ar=!0}sendVodM3u8LoadedTime(t,e){if(this.isSendVodM3u8LoadTime)return;if(e>1e4)return;this.isSendVodM3u8LoadTime=!0;let i=[this.statVod.createAct(L.a.ACT.LOAD_M3U8_TS,{value:[e,t]})];this.sendMetrics(i)}sendNoPictureTime(t,e,i,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";const a=y.a.now();let o=[t,i=i>0?i:0,e=e>0?e:0];const n=a-this.stat.create_time;f.a.log(`TsdbUtils.sendNoPictureTime, loadTime=${t}, connectTime=${e}, recvDataTime=${i}, type=${s}, now=${a}, create_time=${this.stat.create_time}, timeDelta=${n}`);let h=[this.stat.createAct(L.a.ACT.VIDEO_LOAD_TS,{value:o,str:[r,s]})];this.sendMetrics(h)}sendNoPictureTimeAll(t,e,i,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5?arguments[5]:void 0;const o=y.a.now();let n=[t,i=i>0?i:0,e=e>0?e:0,0,0,0,0,0,0,0,0];Z.getLocalRetry(n);const h=o-this.stat.create_time;f.a.log(`TsdbUtils.sendNoPictureTimeAll, loadTime=${t}, connectTime=${e}, recvDataTime=${i}, type=${s}, now=${o}, create_time=${this.stat.create_time}, timeDelta=${h}`),this.stat.setActDim(L.a.DIM_LINK_STA.name,a);let d=[this.stat.createAct(L.a.ACT.VIDEO_LOAD_TS_V2,{value:n,str:[r,s,a]})];localStorage[Z.AUTO_VIEW_LOG]=1,Lt.addFail(this.stat,{loadTime:t,connectTime:e,recvDataTime:i}),this.autoReport(),this.sendMetrics(d)}autoReport(){(1===Number(X.getItem(Z.AUTO_VIEW_REPORT))||P.a.isAutoReport(M.a.uid))&&this.eventEmiter.trigger(m.P2P_REPORT)}sendAutoTestResult(t){f.a.log("TsdbUtils.sendAutoTestResult, result="+t);let e=[this.stat.createAct(L.a.ACT.AUTO_TEST_RESULT,{str:[t]})];this.sendMetrics(e)}sendAutoTestAct(t,e,i){f.a.log(`TsdbUtils.sendAutoTestAct, actType=${t}, values=${e}, strs=${i}`);let s=[this.stat.createAct(t,{value:e,str:i})];this.sendMetrics(s)}setBusiSource(t){this.busiSource=t}sendMP4Time(){const t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).loadTime;if(t>1e4)return;const e=[this.stat.createAct(L.a.ACT.VIDEO_LOAD_TS,{value:[t],str:[this.busiSource]})];this.sendMetrics(e)}sendVodMP4Time(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=t.loadTime,i=t.errorLoadTime,s=t.errorMessage,r=[this.statVod.createAct(L.a.ACT.VIDEO_LOAD_TS,{value:[e,0,0,i],str:[this.busiSource,or?0:1,s||""]})];this.sendMetrics(r),or=!0}sendMetrics(t){this.stat.checkFilter(t),this.eventEmiter.trigger(m.DATA_METRIC2,t)}sendOldMetrics(t){this.eventEmiter.trigger(m.DATA_METRIC,t)}}nr.METRIC={VIDEO_FLOW_LINE:"video.flow.line",VIDEO_FLOW_P2P:"video.flow.p2p",VIDEO_BAD_QUALITY_RATIO:"video.video_bad_quality_ratio",WEB_HLS_PLAY_VIDEO_RATIO:"web.hls.play_video_ratio",WEB_HLS_PLAY_SUC_RATIO:"web.hls.play_suc_ratio",WEB_P2P_PLAY_RATIO:"web.p2p.play_ratio",WEB_P2P_PUNCH:"web.p2p.punch",WEB_P2P_BW_P2P_VALID:"web.p2p.bw_p2p_valid",WEB_P2P_BW_P2P_REPEAT:"web.p2p.bw_p2p_repeat",WEB_P2P_BW_P2P_TOTAL:"web.p2p.bw_p2p_total",WEB_P2P_BW_CDN_VALID:"web.p2p.bw_cdn_valid",WEB_P2P_BW_CDN_REPEAT:"web.p2p.bw_cdn_repeat",WEB_P2P_BW_CDN_TOTAL:"web.p2p.bw_cdn_total",WEB_P2P_BW_RANGE_VALID:"web.p2p.bw_range_valid",WEB_P2P_BW_RANGE_TOTAL:"web.p2p.bw_range_total",WEB_P2P_PLAY_FAIL:"web.p2p.play_fail",WEB_P2P_LOAD_RATIO:"web.p2p.load_ratio",WEB_P2P_CDN_RESTART:"web.p2p.cdn_restart",WEB_P2P_TCP_NO_SLICE:"web.p2p.tcp_no_slice",WEB_P2P_TCP_OPEN_TIME:"web.p2p.tcp_open_time",WEB_P2P_HTTP_CODE:"web.p2p.http_code_",WEB_P2P_TCP_TIMEOUT:"web.p2p.tcp_timeout",WEB_H265:"web.h265",SDK_P2P_TCP:"sdk.p2p.tcp",SDK_VIDEO_LOGIN_SUC:"sdk.video.login_suc",SDK_P2P_COOLING:"sdk.p2p.cooling",SDK_P2P_SERVER_OPEN:"sdk.p2p.server_open",SDK_P2P_USER_PROPERTY:"sdk.p2p.user_property",VIDEO_VIDEO_BAD_QUALITY_5M_RATIO:"video.video_bad_quality_5m_ratio",VIDEO_VIDEO_LOAD_ERROR:"video_load_error",RECV_DANMU_CARTON:"recv_danmu_carton",SDK_P2P_DETAILS:"sdk.p2p.details",SDK_P2P_FORCE_REASON:"sdk.p2p.force_reason",SDK_P2P_DEFAULT_REASON:"sdk.p2p.default_reason",SDK_P2P_VALID_RET:"sdk.p2p.valid_ret",SDK_P2P_GET_NODE:"sdk.p2p.get_node",WEB_USER:"web.user"},nr.INTERVAL={SDK_VIDEO_QUALITY:"sdk.video.quality",SDK_VIDEO_QUALITY_5M:"sdk.video.quality_5m",SDK_CALC_FLOW:"sdk.calc.flow",SDK_P2P_TCP:"sdk.p2p.tcp",SDK_P2P_FLOW:"sdk.p2p.flow",SDK_P2P_PUNCH:"sdk.p2p.punch",SDK_P2P_SUB:"sdk.p2p.sub",SDK_P2P_RESEND:"sdk.p2p.resend",SDK_P2P_DELAY:"sdk.p2p.resend",SDK_P2P_OTHER:"sdk.p2p.other"},nr.TRIGGER={SDK_HLS_PLAY:"sdk.hls.play",SDK_HLS_LOAD:"sdk.hls.load",SDK_MSE_ERROR:"sdk.mse.error",SDK_P2P_LOAD:"sdk.p2p.load",SDK_P2P_LOAD_SAMPLE:"sdk.p2p.load_sample",SDK_P2P_RESTART:"sdk.p2p.restart",SDK_WEB_H265:"sdk.web.h265"};var hr=nr;var dr=class{constructor(){this.hlsPlayer=null,this.cachedVodBlock={},this.vodBlockReasons=[]}setHlsPlayer(t){this.hlsPlayer=t}cacheBlockReason(t,e){!t||e<=0||(f.a.log("VodBlockHelper.checkInBufBlock: reason=",t,e),this.cachedVodBlock[t.CODE]=e)}checkInBufBlock(){if(!this.hlsPlayer)return;let t=Xe;const e=this.hlsPlayer.getCurrentTime();for(let i in this.cachedVodBlock){const s=this.cachedVodBlock[i];if(Math.abs(s-e)<1){if(i===oi.CODE){t=oi,delete this.cachedVodBlock[i];break}if(t===ai.CODE){t=ai,delete this.cachedVodBlock[i];break}if(t===si.CODE){t=si,delete this.cachedVodBlock[i];break}}}if(t===Xe){this.hlsPlayer.getBufferLen()>1e3&&(t=ri)}f.a.log("VodBlockHelper.checkInBufBlock: reason code =",t.CODE),this.vodBlockReasons.push(t)}checkNoBufBlock(){if(!this.hlsPlayer)return;let t=Xe;const e=this.hlsPlayer.playlist.currFrag;if(!e)return;const i=Ze,s=ti;t=e.isPcdn?i:s;const r=this.vodBlockReasons.find(t=>t.code===i.CODE),a=this.vodBlockReasons.find(t=>t.code===s.CODE);r&&a&&(t=ei);const o=Ze,n=ti;e.isLoadError&&(t=e.isPcdn?o:n);const h=this.vodBlockReasons.find(t=>t.code===i.CODE),d=this.vodBlockReasons.find(t=>t.code===s.CODE);h&&d&&(t=ii),f.a.log("VodBlockHelper.checkNoBufBlock: reason code =",t.CODE),this.vodBlockReasons.push(t)}checkVodBlock(){if(!this.hlsPlayer)return;this.checkInBufBlock();this.hlsPlayer.getBufferLen()<1e3&&this.checkNoBufBlock()}getBlockReason(){return this.vodBlockReasons.length<=0?0:(this.vodBlockReasons=this.vodBlockReasons.sort((t,e)=>t.PRIORITY-e.PRIORITY),this.vodBlockReasons[0].CODE)}resetBlockReason(){this.vodBlockReasons=[]}};var lr=class{constructor(t){let{presenterUid:e,lineType:i}=t;this.heartMode=R.b.getCfgValue(P.a.heartMode,e,i,1),this.heartQpsOpen=R.b.isOpen(P.a.heartQpsPids,e,i,!1),this.heartQps=R.b.getCfgValue(P.a.heartQps,e,i,0),this.batch_id=0,this.heartList=[]}sendQps(t,e,i){let s=Math.floor(Date.now()/1e3);0===this.batch_id&&(this.batch_id=s);let r=[];e.forEach(t=>{if(t.vDimension[L.a.DIM_CORE.REPROT_TIME]=s,2===this.heartMode&&this.heartQpsOpen)t.vDimension[L.a.DIM_CORE.BATCH_ID]=this.batch_id,t.vDimension[L.a.DIM_CORE.REPORT_TYPE]=1;else if(3===this.heartMode){let e={sMetricName:t.sMetricName,vDimension:{},vField:{},vExLog:{}};Object.assign(e.vDimension,t.vDimension),Object.assign(e.vField,t.vField),Object.assign(e.vExLog,t.vExLog),e.vDimension[L.a.DIM_CORE.BATCH_ID]=this.batch_id,e.vDimension[L.a.DIM_CORE.REPORT_TYPE]=1,r.push(e)}}),1===this.heartMode?t.sendMetrics(e):2===this.heartMode?this.heartQpsOpen?this.storeAndSend(t,e,i):t.sendMetrics(e):3===this.heartMode&&(t.sendMetrics(e,i),this.storeAndSend(t,r,i))}storeAndSend(t,e,i){if(this.heartList.push(e),this.heartList.length>=this.heartQps||i){let e=[];for(let t=0;t<this.heartList.length;t++)e=e.concat(this.heartList[t]);this.heartList=[],this.batch_id=0,t.sendMetrics(e)}}};var ur=new class{constructor(){this._signalRtt=new V.SignalRttImpl(z)}getStats(){return this._signalRtt.getStats()}start(t,e){if(!this._start){this._start=!0;let i=R.b.isOpen(P.a.signalRttPids,t,-1,!1);!i&&P.a.isSignalRttOpen(e)&&(i=!0),i?(f.a.log("SignalRtt.start","pid",t,"uid",e,"open"),q.add(this._onTimer,this,100)):f.a.log("SignalRtt.start","pid",t,"uid",e,"not open")}}_onTimer(t){this._signalRtt.onTimer(t)}};var cr=class{constructor(t){this.handlerPlayer=t,this.stat=t.stat,this.tsdb=t.tsdb,this.statVod=t.statVod,this._statQps=null}get statQps(){return this._statQps||(this._statQps=new lr({presenterUid:this.handlerPlayer.info.presenterUid,lineType:this.handlerPlayer.info.lineType})),this._statQps}recordMpsStat(t){if(this.stat.setCore(L.a.CORE.MPS_SUBS,t),window.mpsApi){let t=window.mpsApi.getHeartStats();t&&(this.stat.setComDim(L.a.DIM_COM.MPS_STATUS,t.mps_status),this.stat.setComDim(L.a.DIM_COM.NAT,t.nat),this.stat.setComDim(L.a.DIM_COM.IP_STACK_TYPE,t.ipStackType),this.stat.setCore(L.a.CORE.MPS_SRC,t.mps_src),this.stat.setCore(L.a.CORE.MPS_UP,t.mps_up),this.stat.setCore(L.a.CORE.MPS_SRC_BW,t.mps_src_bw),this.stat.setCore(L.a.CORE.MPS_UP_BW,t.mps_up_bw))}}recordBaseStat(){let t=null;if(this.handlerPlayer.mse&&this.handlerPlayer.mse.getWebCodecsStats&&(t=this.handlerPlayer.mse.getWebCodecsStats()),this.handlerPlayer&&this.handlerPlayer.mse){const{pfps:t,pfpsMax:e,pfpsMin:i}=this.handlerPlayer.mse.renderFps.getPageRecordFps();this.stat.setCore(L.a.DIM_CORE.PFPS,t),this.stat.setCore(L.a.DIM_CORE.PFPSMAX,e),this.stat.setCore(L.a.DIM_CORE.PFPSMIN,i),this.handlerPlayer._hyPlayer&&this.handlerPlayer._hyPlayer.roomRecordStat&&this.handlerPlayer._hyPlayer.roomRecordStat.setPageFps({pfps:t,pfpsMax:e,pfpsMin:i}),f.a.log(`BaseQAStat.recordBaseStat pfps=${t}, pfpsMax=${e}, pfpsMin=${i}`)}if(this.handlerPlayer&&this.handlerPlayer.mse&&this.handlerPlayer.mse.getRealFps){let t=this.handlerPlayer.mse.getRealFps();t>30&&t<=33&&(t=30),t>24&&t<27&&(t=24),this.stat.setCoreDim(L.a.DIM_COM.FRAMERATE,t)}if(this.handlerPlayer&&!this.handlerPlayer.isLive&&this.handlerPlayer.getFps){let t=this.handlerPlayer.getFps();t>30&&t<=33&&(t=30),t>24&&t<27&&(t=24),this.stat.setCoreDim(L.a.DIM_COM.FRAMERATE,t),this.statVod&&this.statVod.setComDim(L.a.VOD_DIM_COM.FRAMERATE,t)}t&&this.recordWebCodecsStat(t),this.recordEnhanceStat(t),this.recordSignalRtt()}recordWebCodecsStat(t){for(let e in t)"decodedList"==e?this.recordFrameInfo(t[e],L.a.DIM_COM.V_DECODE_FRAME):"renderList"==e?this.recordFrameInfo(t[e],L.a.DIM_COM.V_PLAY_FRAME):"videoToDecodeList"==e?this.recordFrameInfo(t[e],L.a.DIM_COM.V_TO_DECODE_FRAMES):"delayList"==e?this.recordFrameInfo(t[e],L.a.DIM_COM.V_TO_PLAY_FRAME):"deltaList"==e&&this.recordFrameInfo(t[e],L.a.DIM_COM.AV_DELTA)}recordFrameInfo(t,e){this.stat.setComp(e,"size",t.length),t.map((t,i)=>{this.stat.setComp(e,"k"+(i+1),t),this.stat.setCompFormat(e,":",",")}),this.handlerPlayer&&!this.handlerPlayer.isLive&&this.statVod&&(this.statVod.setComp(e,"size",t.length),t.map((t,i)=>{this.statVod.setComp(e,"k"+(i+1),t),this.statVod.setCompFormat(e,":",",")}))}recordSignalRtt(){let t=ur.getStats();this.recordFrameInfo(t.rttSamples,L.a.DIM_COM.SIGNAL_RTT),this.stat.setCore(L.a.DIM_COM.SIGNAL_RTT_MAX,t.rttMax)}recordHeart(){this.stat.setComDim(L.a.DIM_COM.USER_UUID,M.a.uuid),this.recordAudioEmpty()}recordAudioEmpty(){const t=this.handlerPlayer.getEmptyAudioRecord(),e=L.a.DIM_COM.A_RENDER_SILENCE_TIME,i=t.length;t.reverse(),this.stat.setComp(e,"size",i),t.map((t,s)=>{this.stat.setComp(e,"k"+4*(i-s),t),this.stat.setCompFormat(e,":",",")});const s=this.handlerPlayer.getVoiceStats();this.stat.setCore(L.a.CORE.A_VOL,this.handlerPlayer.getVolume()),this.stat.setCore(L.a.CORE.A_E_DUR,s.noVoiceDur),this.stat.setCore(L.a.CORE.A_E_CNT,s.noVoiceCnt),this.stat.setCoreDim(L.a.DIM_COM.A_CFG,this.handlerPlayer.hasAudioCfg()?1:0)}sendRecordMetrics(){this.recordMosaicData(),this.recordMuffleData()}recordMosaicData(){if(this.handlerPlayer._hyPlayer.getMosaicStat){const{data:t}=this.handlerPlayer._hyPlayer.getMosaicStat();if(null==t)return;let e=t.statDatas.length,i=0,s=0,r=0,a=[],o={};t.statDatas.map((t,n)=>{e-n<=3&&a.push(t.pixelateKey),0==t.suc?i++:1==t.suc?s++:2==t.suc&&r++,o.dts_type=t.dtsType}),o.success_cnt=i,o.fail_cnt=s,o.partial_success_cnt=r,o.req_keys=a.join(","),o.buss="video_pixelate",o=JSON.stringify(o),f.a.log("BaseQaStat.recordMosaicData",o),e>0&&this.stat.setCoreDim(L.a.DIM_COM.MOSAIC_DATA,o),this.stat.setCore(L.a.CORE.MOSAIC_COUNT,t.mosaicCnt),this.stat.setCore(L.a.CORE.MOSAIC_DURATION,t.mosaicDuration)}if(this.handlerPlayer._hyPlayer.getMosaicGrassMode){let t=this.handlerPlayer._hyPlayer.getMosaicGrassMode();this.stat.setCore(L.a.CORE.USED_XP2P,t)}}recordMuffleData(){if(this.handlerPlayer&&this.handlerPlayer.mse&&this.handlerPlayer.mse.getMuffleStat){const{muffleCnt:t,muffleDuration:e}=this.handlerPlayer.mse.getMuffleStat();this.stat.setCore(L.a.CORE.MUTE_COUNT,t),this.stat.setCore(L.a.CORE.MUTE_DURATION,e)}}recordEnhanceStat(t){let e={v_frames:0,v_enhance_delay:-1};const i=this.handlerPlayer.getEnhanceStats(),{width:s,height:r}=this.handlerPlayer.getDpi();i&&(e.v_enhance=i.vEnhanceType,e.v_support=i.vSupport,e.v_gameId=i.vGameId,e.v_errorCode=i.vErrorCode,e.v_width=s,e.v_height=r);const a=this.handlerPlayer.getRefreshRate();if(e.v_refreshRate=a,t){let i=[],s=[],r=0,a=0,o=0,n=0,h=0;for(let e in t){const d=t[e];"videoEnhanceList"==e?i=d:"videoEnhanceCostList"==e?s=d:"ehLess30Nums"==e?r=d:"ehLess150Nums"==e?a=d:"ehLess200Nums"==e?o=d:"ehLarge200Nums"==e?n=d:"ehTotal"==e&&(h=d)}if(this.stat.setCore(L.a.DIM_CORE.ENHACNE_LESS_30,r),this.stat.setCore(L.a.DIM_CORE.ENHACNE_LESS_150,a),this.stat.setCore(L.a.DIM_CORE.ENHACNE_LESS_200,o),this.stat.setCore(L.a.DIM_CORE.ENHACNE_LARGE_200,n),this.stat.setCore(L.a.DIM_CORE.ENHANCE_TOTAL,h),this.handlerPlayer&&!this.handlerPlayer.isLive&&this.statVod&&(this.statVod.setCore(L.a.VOD_DIM_CORE.ENHACNE_LESS_30,r),this.statVod.setCore(L.a.VOD_DIM_CORE.ENHACNE_LESS_150,a),this.statVod.setCore(L.a.VOD_DIM_CORE.ENHACNE_LESS_200,o),this.statVod.setCore(L.a.VOD_DIM_CORE.ENHACNE_LARGE_200,n),this.statVod.setCore(L.a.VOD_DIM_CORE.ENHANCE_TOTAL,h)),i.length>0){const t=i.reduce((t,e)=>t+e);e.v_frames=~~(t/i.length)}if(s.length>0){const t=s.reduce((t,e)=>t+e);e.v_enhance_delay=~~(t/s.length)}}this.stat.setCoreDim(L.a.DIM_COM.FEATURE_STATUS,JSON.stringify(e)),this.handlerPlayer&&!this.handlerPlayer.isLive&&this.statVod&&this.statVod.setCoreDim(L.a.VOD_DIM_COM.FEATURE_STATUS,JSON.stringify(e))}reportVideoBadQuality(t,e,i,s,r,a){f.a.log(`QAStat.reportVideoBadQuality, isPaused=${t}, pauseCnt=${e}, pauseWorkerCnt=${s}, isFramePaused=${a}`);const o=this.handlerPlayer.getPause500Cnt();if(this.handlerPlayer.h265Proxy&&this.handlerPlayer.h265Proxy.rendering)this.reportH265(t,e,i,o,s,r);else{let i=document.visibilityState;const n=t||e>0?100:0,h=this.handlerPlayer.mse&&this.handlerPlayer.mse.getVideoCBLargeCnt(),d=this.handlerPlayer.mse&&this.handlerPlayer.mse.getVideoFrameCallBackNums();1==P.a.isFilterMsePause&&this.handlerPlayer.isMse&&"visible"==i&&d>0?(t||e>0)&&h>0?this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_BAD_QUALITY,100):(this.stat.setCore(L.a.CORE.VIDEO_BLOCK_COUNT,0),this.stat.setCore(L.a.CORE.VIDEO_BLOCK_DURATION,0)):this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_BAD_QUALITY,n),this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_BAD_QUALITY_OLD,t?100:0),this.handlerPlayer.mse&&this.handlerPlayer.mse.getMseRenderList&&this.recordFrameInfo(this.handlerPlayer.mse.getMseRenderList(),L.a.DIM_COM.V_PLAY_FRAME),this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_H265_BAD_QUALITY,o>0||r||s>0?100:0),this.handlerPlayer&&(this.handlerPlayer.isWebCodec?this.stat.setCoreDim(L.a.DIM_COM.MP_EXPERIMENT,a?100:0):this.stat.setCoreDim(L.a.DIM_COM.MP_EXPERIMENT,t||e>0?100:0)),100===n&&this.tsdb.autoReport()}}reportH265(t,e,i,s,r,a){const{h265PauseCnt:o,videoPauseCnt:n,videoPauseTime:h,isVideoPaused:d,hiddenTime:l,statProps:u,pause500CntH265:c,isFramePaused:p}=this.handlerPlayer.h265Proxy.getStats(i);f.a.log(`QAStat.reportH265, videoPauseCnt=${n}, pause500CntH265=${c}, isFramePaused=${p}`);let m=o>0?100:0,_=t||e>0?100:0,g=d||n>0?100:0;this.handlerPlayer.h265Proxy.render.isHidden&&l>=2e4?(this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_H265_BAD_QUALITY,s>0||a||r>0?100:0),this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_BAD_QUALITY,_)):(this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_H265_BAD_QUALITY,c>0&&g?100:0),this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_BAD_QUALITY,g),this.stat.setCore(L.a.CORE.VIDEO_BLOCK_COUNT,n),this.stat.setCore(L.a.CORE.VIDEO_BLOCK_DURATION,h)),this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_BAD_QUALITY_OLD,m),this.stat.setComDim(L.a.DIM_COM.MP_EXPERIMENT,p?100:0);for(let t in u)"toDecode"==t?this.recordFrameInfo(u[t],L.a.DIM_COM.V_TO_DECODE_FRAMES):"decoded"==t?this.recordFrameInfo(u[t],L.a.DIM_COM.V_DECODE_FRAME):"render"==t?this.recordFrameInfo(u[t],L.a.DIM_COM.V_PLAY_FRAME):"rawList"==t||("frameList"==t?this.recordFrameInfo(u[t],L.a.DIM_COM.V_TO_PLAY_FRAME):this.stat.setComp(L.a.DIM_H265_SAM.name,t,u[t].join("|")));100===_&&this.tsdb.autoReport()}rcordCaptureJitter(t){if(t)for(let e in t){let i=t[e];for(let t in i)this.stat.setCore(t,i[t])}}};var pr=class extends cr{constructor(t){super(t),this.handlerPlayer=t,this.stat=this.handlerPlayer.stat,this.statVod=this.handlerPlayer.statVod,this.tsdbUtil=this.handlerPlayer.tsdb,this.isPaused=!1,this.tsOpens=[],this.tsLoadeds=[],this.tsSpeeds=[],this.tsSizes=[],this._statQps=null}get statQps(){return this._statQps||(this._statQps=new lr({presenterUid:this.handlerPlayer.info.presenterUid,lineType:this.handlerPlayer.info.lineType})),this._statQps}setPause(){this.isPaused=!0,this.stat.setCore(L.a.DIM_CORE.VIDEO_BAD_QUALITY,100)}start(){this.stop(),q.once(this.checkSuc,this,1e4),q.once(this.checkVideo,this,2e4)}stop(){this.tsOpens=[],this.tsLoadeds=[],this.tsSpeeds=[],this.tsSizes=[],q.remove(this.checkSuc,this),q.remove(this.checkVideo,this)}checkSuc(){let{_loaderType:t,hasVideo:e,url:i,playTs:s}=this.handlerPlayer,r=e?100:0,a=[];a.push(this.stat.createAct(L.a.ACT.HLS_PLAY_SUCC,{value:[r,t],str:[i,""+s]})),this.tsdbUtil.sendMetrics(a)}checkVideo(){let t=this.handlerPlayer.hasVideo?100:0,e=[];e.push(this.stat.createAct(L.a.ACT.HLS_LOAD_SUCC,{value:[t]})),this.tsdbUtil.sendMetrics(e)}report(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=[];if(0===P.a.statLv[15]&&e.push({sMetricName:hr.METRIC.VIDEO_BAD_QUALITY_RATIO,vField:{value:this.isPaused?100:0},vDimension:{p2p:2}}),this.handlerPlayer.mse.metadata.recvAudioFps&&this.stat.setComp(L.a.DIM_LINK_SAM.name,L.a.DIM_LINK_SAM.AUDIO_RATE,this.handlerPlayer.mse.metadata.recvAudioFps),this.handlerPlayer.mse.metadata.recvVideoFps&&this.stat.setComp(L.a.DIM_LINK_SAM.name,L.a.DIM_LINK_SAM.VIDEO_RATE,this.handlerPlayer.mse.metadata.recvVideoFps),this.stat.setComp(L.a.DIM_LINK_SAM.name,L.a.DIM_LINK_SAM.SPEED,this.handlerPlayer.getSpeed()),this.stat.setComp(L.a.DIM_LINK_SAM.name,L.a.DIM_LINK_SAM.VIDEO_DTS,this.handlerPlayer.mse.curVideoDts),this.stat.setComp(L.a.DIM_LINK_SAM.name,L.a.DIM_LINK_SAM.AUDIO_DTS,this.handlerPlayer.mse.curAudioDts),this.stat.setCompFormat(L.a.DIM_LINK_SAM.name,":",","),this.stat.setCore(L.a.CORE.PLAY_DELAY,this.handlerPlayer.getBufferLen()),this.stat.setCore(L.a.CORE.FRAME_BUFFER_DELAY,this.handlerPlayer.getFrameBufferLen()),this.handlerPlayer.h265Proxy.rendering&&(this.h265PauseProps=this.handlerPlayer.h265Proxy.getStats(t)),this.recordBaseStat(),this.reportVideoBadQuality(this.isPaused,t),this.isPaused){let t=this.handlerPlayer.blockHelper;if(t){const e=t.getBlockReason();this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_BAD_REASON,e)}}this.stat.setComp(L.a.HLS_INFO.name,L.a.HLS_INFO.TS_OPEN_AVG,this.getAvg(this.tsOpens)),this.stat.setComp(L.a.HLS_INFO.name,L.a.HLS_INFO.TS_LOADED_AVG,this.getAvg(this.tsLoadeds)),this.stat.setComp(L.a.HLS_INFO.name,L.a.HLS_INFO.TS_SPEED_AVG,this.getAvg(this.tsSpeeds)),this.stat.setComp(L.a.HLS_INFO.name,L.a.HLS_INFO.TS_SIZE_AVG,this.getAvg(this.tsSizes)),this.stat.fill(e,t),this.handlerPlayer&&!this.handlerPlayer.isLive&&this.reportVod(e,t),this.statQps.sendQps(this.tsdbUtil,e,t),this.isPaused=!1,this.handlerPlayer&&(this.handlerPlayer.blockHelper&&this.handlerPlayer.blockHelper.resetBlockReason(),this.handlerPlayer.resetHeartTsTime()),this.tsOpens=[],this.tsLoadeds=[],this.tsSpeeds=[],this.tsSizes=[]}reportVideoBadQuality(t,e){this.handlerPlayer.h265Proxy&&this.handlerPlayer.h265Proxy.rendering?this.reportH265(t,e):this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_BAD_QUALITY,t?100:0)}reportH265(t,e){const{videoPauseCnt:i,isVideoPaused:s,hiddenTime:r,statProps:a}=this.h265PauseProps;let o=t?100:0,n=s||i>0?100:0;this.handlerPlayer.h265Proxy.render.isHidden&&r>=2e4?(this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_H265_BAD_QUALITY,n),this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_BAD_QUALITY,o)):(this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_H265_BAD_QUALITY,o),this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_BAD_QUALITY,n));for(let t in a)"toDecode"==t?this.recordH265Frame(a[t],L.a.DIM_COM.V_TO_DECODE_FRAMES):"decoded"==t?this.recordH265Frame(a[t],L.a.DIM_COM.V_DECODE_FRAME):"render"==t?this.recordH265Frame(a[t],L.a.DIM_COM.V_PLAY_FRAME):"rawList"==t?this.recordH265Frame(a[t],L.a.DIM_COM.V_RECV_FRAME):"frameList"==t||this.stat.setComp(L.a.DIM_H265_SAM.name,t,a[t].join("|"))}recordH265Frame(t,e){this.stat.setComp(e,"size",t.length),t.map((t,i)=>{this.stat.setComp(e,"k"+(i+1),t),this.stat.setCompFormat(e,":",",")}),this.handlerPlayer&&!this.handlerPlayer.isLive&&(this.statVod.setComp(e,"size",t.length),t.map((t,i)=>{this.statVod.setComp(e,"k"+(i+1),t),this.statVod.setCompFormat(e,":",",")}))}reportVod(t,e){if(this.handlerPlayer.mse.metadata.recvAudioFps&&this.statVod.setComp(L.a.DIM_LINK_SAM.name,L.a.DIM_LINK_SAM.AUDIO_RATE,this.handlerPlayer.mse.metadata.recvAudioFps),this.handlerPlayer.mse.metadata.recvVideoFps&&this.statVod.setComp(L.a.DIM_LINK_SAM.name,L.a.DIM_LINK_SAM.VIDEO_RATE,this.handlerPlayer.mse.metadata.recvVideoFps),this.statVod.setComp(L.a.DIM_LINK_SAM.name,L.a.DIM_LINK_SAM.SPEED,this.handlerPlayer.getSpeed()),this.statVod.setComp(L.a.DIM_LINK_SAM.name,L.a.DIM_LINK_SAM.VIDEO_DTS,this.handlerPlayer.mse.curVideoDts),this.statVod.setComp(L.a.DIM_LINK_SAM.name,L.a.DIM_LINK_SAM.AUDIO_DTS,this.handlerPlayer.mse.curAudioDts),this.statVod.setCompFormat(L.a.DIM_LINK_SAM.name,":",","),this.statVod.setComp(L.a.HLS_INFO.name,L.a.HLS_INFO.TS_OPEN_AVG,this.getAvg(this.tsOpens)),this.statVod.setComp(L.a.HLS_INFO.name,L.a.HLS_INFO.TS_LOADED_AVG,this.getAvg(this.tsLoadeds)),this.statVod.setComp(L.a.HLS_INFO.name,L.a.HLS_INFO.TS_SPEED_AVG,this.getAvg(this.tsSpeeds)),this.statVod.setComp(L.a.HLS_INFO.name,L.a.HLS_INFO.TS_SIZE_AVG,this.getAvg(this.tsSizes)),this.statVod.setCoreDim(L.a.VOD_DIM_CORE.TS_START_TIME,this.handlerPlayer.heartTsStartTime),this.statVod.setCoreDim(L.a.VOD_DIM_CORE.TS_END_TIME,this.handlerPlayer.heartTsEndTime),this.handlerPlayer.h265Proxy.rendering){const{videoPauseCnt:t,isVideoPaused:e,hiddenTime:i}=this.h265PauseProps;let s=this.isPaused?100:0,r=e||t>0?100:0;this.handlerPlayer.h265Proxy.render.isHidden&&i>=2e4?(this.statVod.setCoreDim(L.a.VOD_CORE.VIDEO_H265_BAD_QUALITY,r),this.statVod.setCore(L.a.VOD_CORE.VOD_BAD_QUALITY,s)):(this.statVod.setCoreDim(L.a.VOD_CORE.VIDEO_H265_BAD_QUALITY,s),this.statVod.setCore(L.a.VOD_CORE.VOD_BAD_QUALITY,r))}else this.statVod.setCore(L.a.VOD_CORE.VOD_BAD_QUALITY,this.isPaused?100:0);if(this.isPaused){let t=this.handlerPlayer.blockHelper;if(t){const e=t.getBlockReason();this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_BAD_REASON,e)}}this.statVod.fill(t,e)}getAvg(t){let e=t.length;if(0===e)return 0;let i=0;for(let s=0;s<e;s++)i+=t[s];return Math.floor(i/e)}},mr=3,fr=6,_r=1,gr=2;var Sr=class{constructor(t){this._hlsPlayer=t,this._seekTime=0}seek(t){this._seekTime=t}check(){this._seekTime>0&&(this._seek()?this._seekTime=0:this._reseek())}_seek(){let t=this._seekTime,e=!1;if(this._hlsPlayer&&this._hlsPlayer.playerCoreType==D.a.PLAYER_CORE_TYPE.MSE){let i=this._hlsPlayer.mse.video.video.buffered,s=[];for(let r=0;r<i.length;r++){let a=i.start(r),o=i.end(r);if(s.push(`[${a}, ${o}]`),a-.5<=t&&t<o+1){e=!0;break}if(t<a){this._seekTime=a;break}}e&&(this._hlsPlayer.onVideoSeek(t),!this._hlsPlayer.userPaused&&this._hlsPlayer.play()),f.a.log("HlsSeek.buffered",s.join(" "))}return e}_reseek(){if(this._hlsPlayer&&this._hlsPlayer.playerCoreType==D.a.PLAYER_CORE_TYPE.MSE){f.a.log("HlsSeek._reseek");let t=this._hlsPlayer.playlist.currDetails;t&&t.fragments&&(t.fragIdx>1&&t.fragIdx--,this._hlsPlayer.mse.seek(this._seekTime),this._hlsPlayer.mse.resetHls(),this._hlsPlayer.seekTime=this._seekTime,f.a.log("HlsSeek._reseek",t.fragIdx))}}_findIdxFront(t,e,i){let s=e.length,r=null;for(let a=i;a<s;a++)if(r=e[a],(t+=r.duration)>=this._seekTime)return r.seeking=!0,a;return s-1}_findIdxBack(t,e,i){let s=null;for(let r=i;r>0;r--)if(s=e[r],(t-=s.duration)<this._seekTime)return s.seeking=!0,r;return 0}};function Tr(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function yr(t,e,i,s,r,a){return Tr((o=Tr(Tr(e,t),Tr(s,a)))<<(n=r)|o>>>32-n,i);var o,n}function Er(t,e,i,s,r,a,o){return yr(e&i|~e&s,t,e,r,a,o)}function vr(t,e,i,s,r,a,o){return yr(e&s|i&~s,t,e,r,a,o)}function Cr(t,e,i,s,r,a,o){return yr(e^i^s,t,e,r,a,o)}function Pr(t,e,i,s,r,a,o){return yr(i^(e|~s),t,e,r,a,o)}function Dr(t,e){var i,s,r,a,o;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var n=1732584193,h=-271733879,d=-1732584194,l=271733878;for(i=0;i<t.length;i+=16)s=n,r=h,a=d,o=l,n=Er(n,h,d,l,t[i],7,-680876936),l=Er(l,n,h,d,t[i+1],12,-389564586),d=Er(d,l,n,h,t[i+2],17,606105819),h=Er(h,d,l,n,t[i+3],22,-1044525330),n=Er(n,h,d,l,t[i+4],7,-176418897),l=Er(l,n,h,d,t[i+5],12,1200080426),d=Er(d,l,n,h,t[i+6],17,-1473231341),h=Er(h,d,l,n,t[i+7],22,-45705983),n=Er(n,h,d,l,t[i+8],7,1770035416),l=Er(l,n,h,d,t[i+9],12,-1958414417),d=Er(d,l,n,h,t[i+10],17,-42063),h=Er(h,d,l,n,t[i+11],22,-1990404162),n=Er(n,h,d,l,t[i+12],7,1804603682),l=Er(l,n,h,d,t[i+13],12,-40341101),d=Er(d,l,n,h,t[i+14],17,-1502002290),n=vr(n,h=Er(h,d,l,n,t[i+15],22,1236535329),d,l,t[i+1],5,-165796510),l=vr(l,n,h,d,t[i+6],9,-1069501632),d=vr(d,l,n,h,t[i+11],14,643717713),h=vr(h,d,l,n,t[i],20,-373897302),n=vr(n,h,d,l,t[i+5],5,-701558691),l=vr(l,n,h,d,t[i+10],9,38016083),d=vr(d,l,n,h,t[i+15],14,-660478335),h=vr(h,d,l,n,t[i+4],20,-405537848),n=vr(n,h,d,l,t[i+9],5,568446438),l=vr(l,n,h,d,t[i+14],9,-1019803690),d=vr(d,l,n,h,t[i+3],14,-187363961),h=vr(h,d,l,n,t[i+8],20,1163531501),n=vr(n,h,d,l,t[i+13],5,-1444681467),l=vr(l,n,h,d,t[i+2],9,-51403784),d=vr(d,l,n,h,t[i+7],14,1735328473),n=Cr(n,h=vr(h,d,l,n,t[i+12],20,-1926607734),d,l,t[i+5],4,-378558),l=Cr(l,n,h,d,t[i+8],11,-2022574463),d=Cr(d,l,n,h,t[i+11],16,1839030562),h=Cr(h,d,l,n,t[i+14],23,-35309556),n=Cr(n,h,d,l,t[i+1],4,-1530992060),l=Cr(l,n,h,d,t[i+4],11,1272893353),d=Cr(d,l,n,h,t[i+7],16,-155497632),h=Cr(h,d,l,n,t[i+10],23,-1094730640),n=Cr(n,h,d,l,t[i+13],4,681279174),l=Cr(l,n,h,d,t[i],11,-358537222),d=Cr(d,l,n,h,t[i+3],16,-722521979),h=Cr(h,d,l,n,t[i+6],23,76029189),n=Cr(n,h,d,l,t[i+9],4,-640364487),l=Cr(l,n,h,d,t[i+12],11,-421815835),d=Cr(d,l,n,h,t[i+15],16,530742520),n=Pr(n,h=Cr(h,d,l,n,t[i+2],23,-995338651),d,l,t[i],6,-198630844),l=Pr(l,n,h,d,t[i+7],10,1126891415),d=Pr(d,l,n,h,t[i+14],15,-1416354905),h=Pr(h,d,l,n,t[i+5],21,-57434055),n=Pr(n,h,d,l,t[i+12],6,1700485571),l=Pr(l,n,h,d,t[i+3],10,-1894986606),d=Pr(d,l,n,h,t[i+10],15,-1051523),h=Pr(h,d,l,n,t[i+1],21,-2054922799),n=Pr(n,h,d,l,t[i+8],6,1873313359),l=Pr(l,n,h,d,t[i+15],10,-30611744),d=Pr(d,l,n,h,t[i+6],15,-1560198380),h=Pr(h,d,l,n,t[i+13],21,1309151649),n=Pr(n,h,d,l,t[i+4],6,-145523070),l=Pr(l,n,h,d,t[i+11],10,-1120210379),d=Pr(d,l,n,h,t[i+2],15,718787259),h=Pr(h,d,l,n,t[i+9],21,-343485551),n=Tr(n,s),h=Tr(h,r),d=Tr(d,a),l=Tr(l,o);return[n,h,d,l]}function Ir(t){var e,i="",s=32*t.length;for(e=0;e<s;e+=8)i+=String.fromCharCode(t[e>>5]>>>e%32&255);return i}function Ar(t){var e,i=[];for(i[(t.length>>2)-1]=void 0,e=0;e<i.length;e+=1)i[e]=0;var s=8*t.length;for(e=0;e<s;e+=8)i[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return i}function Rr(t){var e,i,s="";for(i=0;i<t.length;i+=1)e=t.charCodeAt(i),s+="0123456789abcdef".charAt(e>>>4&15)+"0123456789abcdef".charAt(15&e);return s}function Or(t){return unescape(encodeURIComponent(t))}function wr(t){return function(t){return Ir(Dr(Ar(t),8*t.length))}(Or(t))}function Lr(t,e){return function(t,e){var i,s,r=Ar(t),a=[],o=[];for(a[15]=o[15]=void 0,r.length>16&&(r=Dr(r,8*t.length)),i=0;i<16;i+=1)a[i]=909522486^r[i],o[i]=1549556828^r[i];return s=Dr(a.concat(Ar(e)),512+8*e.length),Ir(Dr(o.concat(s),640))}(Or(t),Or(e))}var Mr=function(t,e,i){return e?i?Lr(e,t):Rr(Lr(e,t)):i?wr(t):Rr(wr(t))};const Vr=Object(R.a)("X2Zt"),br=Object(R.a)("Zm0="),Nr=Object(R.a)("X3dzVGltZQ=="),Fr=Object(R.a)("d3NUaW1l"),Br=Object(R.a)("X2ludmFsaWRUaW1l"),Ur=Object(R.a)("X25leHRSZWZyZXNoVGltZQ=="),kr=Object(R.a)("X2N0eXBl"),xr=Object(R.a)("Y3R5cGU="),Hr=Object(R.a)("d3NTZWNyZXQ="),Gr=Object(R.a)("X3BhcmFtcw=="),Wr=Object(R.a)("X3NGbHZBbnRpY29kZQ=="),$r=Object(R.a)("X3NGbHZVcmw="),Yr=Object(R.a)("X3NTdHJlYW1OYW1l"),Kr=Object(R.a)("X3JlcQ=="),jr=Object(R.a)("c2VxaWQ="),qr=Object(R.a)("X3NlcWlk"),zr=Object(R.a)("X3BjZG4="),Jr=Object(R.a)("JDA="),Qr=Object(R.a)("JDE="),Xr=Object(R.a)("JDI="),Zr=Object(R.a)("JDM="),ta=Object(R.a)("aW5pdA=="),ea=Object(R.a)("aXNJbnZhbGlk"),ia=Object(R.a)("Z2V0QW50aWNvZGU="),sa=Object(R.a)("cGFyc2VBbnRpY29kZQ=="),ra=Object(R.a)("aGFzQW50aWNvZGU="),aa=Object(R.a)("b25DaGVja1RpbWVy"),oa=Object(R.a)("X29uUmVmcmVzaA=="),na=Object(R.a)("X29uUmVmcmVzaEJpbmQ="),ha=Object(R.a)("dmFsaWQ="),da=Object(R.a)("Z2V0VG9rZW4="),la=Object(R.a)("X2dldFRva2Vu"),ua=Object(R.a)("bGl2ZXVp"),ca=Object(R.a)("Z2V0Q2RuVG9rZW5JbmZvRXg="),pa=(Object(R.a)("MTAw"),Object(R.a)("dmVyPTE=")),ma=Object(R.a)("Jg=="),fa=Object(R.a)("PQ=="),_a=Object(R.a)("UkVGUkVTSA=="),ga=Object(R.a)("cmVmcmVzaA=="),Sa=(Object(R.a)("ZGVjb2RlVVJJ"),Object(R.a)("dW5lc2NhcGU="),Object(R.a)("Z2V0U2VxaWQ=")),Ta=(Object(R.a)("bWVkaWF1aXNlYQ=="),Object(R.a)("Z2V0QW50aUNvZGVGb3JTdHJlYW0="),Object(R.a)("X25pbW9UaWQ="));class ya extends qt{constructor(){super(),this[Nr]="",this[Vr]="",this[kr]="",this[Gr]=[],this[Wr]="",this[$r]="",this[Yr]="",this[qr]="",this[Br]=Number.MAX_SAFE_INTEGER,this[Ur]=Number.MAX_SAFE_INTEGER,this[Ta]=null,this[na]=this[oa].bind(this)}[ra](){return""!==this[Wr]}[ta](t,e,i,s){this[$r]=t,this[Yr]=e,this[sa](i),this[Ta]=s}[sa](t){this[Vr]="",this[Nr]="",this[kr]="",this[Gr]=[],this[Wr]=t,t.split(ma).forEach(t=>{let[e,i]=t.split(fa);if(e===br)i=decodeURI(i),i=unescape(i),i=atob(i),this[Vr]=i;else if(e===Fr){this[Nr]=i;let t=1e3*parseInt(i,16)+3e5;this[Br]=y.a.now()+(t-Date.now()),this[Ur]=this[Br]-3e4}else e==xr?this[kr]=i:e!==Hr&&this[Gr].push(t)})}[ea](t){return t>this[Br]}[ia](t){if(""===this[Vr])return this[Wr];const e=P.a.platform,i=D.a.PLATFORM_TYPE[e]||D.a.PLATFORM_TYPE.web;this[qr]=Number(M.a.uid)+Date.now();const s=Mr(`${this[qr]}|${this[kr]}|${i}`),r=e===D.a.PLATFORM_TYPE_NAME.wap?M.a.uid:M.a.convertUid;let a=this[Vr].replace(Jr,r).replace(Qr,this[Yr]).replace(Xr,s).replace(Zr,this[Nr]);t&&(a+=zr);let o=this[kr];!o&&Lt.isOpen()&&(o="huya_webh5");let n=`${Hr}${fa}${Mr(a)}${ma}${Fr}${fa}${this[Nr]}${ma}${jr}${fa}${this[qr]}${ma}${xr}${fa}${o}${ma}${pa}`;return this[Gr].length>0&&(n+=ma+this[Gr].join(ma)),n}[Sa](){return this[qr]}[aa](t,e){t>=this[Ur]&&this[da]().then(this[na])}[oa](){this.trigger(ya.Events[_a])}[ha](){return new Promise(t=>{this[ea](y.a.now())?this[da]().then(t):t()})}[da](){return new Promise(t=>{z.connected?this[la](t):z.on(z.TAFLINK_INITED,()=>{this[la](t)})})}[la](t){this[Kr]||(this[Kr]=new V.HUYA.GetCdnTokenExReq),this[Kr].sFlvUrl=this._sFlvUrl,this[Kr].sStreamName=this._sStreamName,this[Kr].tId=z.getUserId(),this[Kr].iAppId=M.a.appid,f.a.log(`${ya.name}.${da}.req=`,this._req),this[Ur]=Number.MAX_SAFE_INTEGER;let e=ua,i=ca;z.sendWup(e,i,this._req,e=>{let i="";i=e.sFlvToken,f.a.log(`${ya.name}.${da} sAntiCode=${i}, rsp=`,e),this[sa](i),t()},!0,z.getRequestId())}}ya.Events={[_a]:ga};var Ea=ya;if(!Object.values){const t=Function.bind.call(Function.call,Array.prototype.reduce),e=Function.bind.call(Function.call,Object.prototype.propertyIsEnumerable),i=Function.bind.call(Function.call,Array.prototype.concat),s=Reflect.ownKeys;Object.values=function(r){return t(s(r),(t,s)=>i(t,"string"==typeof s&&e(r,s)?[r[s]]:[]),[])}}var va=class{constructor(t){this.player=t,this.recordMap=new Map,this.init(),this.reset()}init(){this.keys=Object.values(L.a.DIM_LINK_STA);let t=this.keys.indexOf(L.a.DIM_LINK_STA.name);-1!==t&&this.keys.splice(t,1)}setStat(t,e){this.recordMap.has(t)||(this.recordMap.set(t,1),this.exceptionStat[t]=e)}getStat(){this.player.getDurationTime&&this.player.getDurationTime()>2&&this.setStat(L.a.DIM_LINK_STA.DATA_ENOUGH,1);let t=[];return Object.keys(this.exceptionStat).forEach(e=>{t.push(`${e}:${this.exceptionStat[e]}`)}),t.join(",")}reset(){this.recordMap.clear(),this.exceptionStat={},this.keys.forEach(t=>{this.exceptionStat[t]=0})}},Ca={setCdnDomain:function(t,e,i){i=i||"";let s="cdndomain",r=(e=e||"").match(/\/\/(.+?)\//i);r&&r.length>1&&(s=r[1]),t.setComDim(L.a.DIM_COM.CDNDOMAIN,s),t.setComDim(L.a.DIM_COM.STREAM,i||"stream")},setVodCdnDomain:function(t,e){let i="cdndomain",s=(e=e||"").match(/\/\/(.+?)\//i);s&&s.length>1&&(i=s[1]),t.setComDim(L.a.DIM_COM.CDNDOMAIN,i)},recordComDim:function(t,e){t.setComDim(L.a.DIM_COM.SDK_VER,2412111629),t.setComDim(L.a.DIM_COM.UA,navigator&&navigator.userAgent),this.recordSystemInfo(t),this.recordStartInfo(t,e)},recordStartInfo:function(t,e){t.setComDim(L.a.DIM_COM.AD_BLOCK,1===Number(e.adBlock)?1:0)},recordSystemInfo:function(t){ls.a.isMseSupportedHevc()?(t.setComDim(L.a.DIM_COM.DECODE_SUPPORT,"mse_hevc"),t.setComDim(L.a.DIM_COM.DECODE_CAPABILITY,"mse_hevc")):R.b.isWebCodecsSupported()?(t.setComDim(L.a.DIM_COM.DECODE_SUPPORT,"webcodecs"),t.setComDim(L.a.DIM_COM.DECODE_CAPABILITY,"webcodecs")):ls.a.isMseSupportedH264()&&(t.setComDim(L.a.DIM_COM.DECODE_SUPPORT,"mse"),t.setComDim(L.a.DIM_COM.DECODE_CAPABILITY,"mse")),t.setComDim("backup_field1",R.b.isManagerMediaSourceSupported()?1:0),t.setComDim(L.a.DIM_COM.BROWSER_NAME,pe.a.browser),t.setComDim(L.a.DIM_COM.BROWSER_VERSION,pe.a.version.major),t.setComDim(L.a.DIM_COM.BROWSER_KERNEL,qe.a.name),t.setComDim(L.a.DIM_COM.BROWSER_KERNEL_VERSION,qe.a.version.major),t.setComDim(L.a.DIM_COM.OS_NAME,pe.a.os),t.setComDim(L.a.DIM_COM.OS_VERSION,pe.a.osVersion),t.setComDim(L.a.DIM_COM.HARDWARE_CONCURRENCY,Number(navigator.hardwareConcurrency)||0),t.setComDim(L.a.DIM_COM.I_GPU,navigator.gpu?1:0),ue()&&t.setComDim(L.a.DIM_COM.RENDER_INFO,ce())}},Pa={isClose:function(t,e){return this.isCloseSwiftshader(t,e)||this.isCloseCore(t)},isCloseSwiftshader:function(t,e){if(!e||""===e||-1!==e.indexOf("swiftshader")&&P.a.vodAv1CloseCfg[0]){let e=P.a.vodAv1CloseCfg[0],i=e.length;for(let s=0;s<i;s++){let i=e[s],r=i[0],a=i[1];if(t>=r)return navigator.hardwareConcurrency<=a}}return!1},isCloseCore:function(t){if(P.a.vodAv1CloseCfg[1]){let e=P.a.vodAv1CloseCfg[1];return t>=e[0]&&navigator.hardwareConcurrency<=e[1]}return!1}};var Da=class{constructor(){this.startTs=0,this.m3u8StartTs=0,this.m3u8OpenTs=0,this.m3u8EndTs=0,this.initStartTs=0,this.initOpenTs=0,this.initEndTs=0,this.firstStartTs=0,this.firstOpenTs=0,this.firstBufTs=0,this.playTs=0}setStart(){this.startTs=y.a.now(),this.m3u8StartTs=0,this.m3u8OpenTs=0,this.m3u8EndTs=0,this.initStartTs=0,this.initOpenTs=0,this.initEndTs=0,this.firstStartTs=0,this.firstOpenTs=0,this.firstBufTs=0,this.loadedDataTs=0}setM3u8Start(){0===this.m3u8StartTs&&(this.m3u8StartTs=y.a.now())}setM3u8Open(){0===this.m3u8OpenTs&&(this.m3u8OpenTs=y.a.now())}setM3u8End(){0===this.m3u8EndTs&&(this.m3u8EndTs=y.a.now())}setInitStart(){0===this.initStartTs&&(this.initStartTs=y.a.now())}setInitOpen(){0===this.initOpenTs&&(this.initOpenTs=y.a.now())}setInitEnd(){0===this.initEndTs&&(this.initEndTs=y.a.now())}setFirstStart(){0===this.firstStartTs&&(this.firstStartTs=y.a.now(),0===this.m3u8StartTs&&(this.m3u8StartTs=this.m3u8OpenTs=this.m3u8EndTs=this.firstStartTs),0===this.initStartTs&&(this.initStartTs=this.initOpenTs=this.initEndTs=this.firstStartTs))}setFirstOpen(){0===this.firstOpenTs&&(this.firstOpenTs=y.a.now())}setFirstBuf(){0===this.firstBufTs&&(this.firstBufTs=y.a.now())}setPlayTs(){0===this.playTs&&(this.playTs=y.a.now())}getCostTimes(){let t=99999,e=99999,i=99999,s=99999,r=99999,a=99999,o=99999,n=99999,h=99999,d=99999;return this.playTs>0&&(t=this.playTs-this.startTs),this.m3u8OpenTs>0&&(e=this.m3u8OpenTs-this.startTs),this.m3u8EndTs>0&&this.m3u8OpenTs>0&&(i=this.m3u8EndTs-this.m3u8OpenTs),this.initStartTs>0&&this.m3u8EndTs>0&&(s=this.initStartTs-this.m3u8EndTs),this.initOpenTs>0&&this.initStartTs>0&&(r=this.initOpenTs-this.initStartTs),this.initEndTs>0&&this.initOpenTs>0&&(a=this.initEndTs-this.initOpenTs),this.firstStartTs>0&&this.m3u8EndTs>0&&(o=this.firstStartTs-this.m3u8EndTs),this.firstOpenTs>0&&this.firstStartTs>0&&(n=this.firstOpenTs-this.firstStartTs),this.firstBufTs>0&&this.firstOpenTs>0&&(h=this.firstBufTs-this.firstOpenTs),this.playTs>0&&this.firstBufTs>0&&this.initEndTs>0&&(d=this.playTs-Math.max(this.firstBufTs,this.initEndTs)),[t,e,i,s,r,a,o,n,h,d]}};var Ia=class{constructor(t,e){let{resumeFunc:i,pauseFunc:s}=e;this._webCodecsPlayer=t,this._playResume=i,this._playPause=s,this._paused=!1,this._playedPts=0,this._pausedTs=0,this._lastCheckTime=0}get paused(){return this._paused}get pausedTs(){return this._pausedTs}reset(){this._paused=!1,this._playedPts=0,this._pausedTs=0}check(t){if(0!=this._lastCheckTime&&t-this._lastCheckTime<50)return;const e=this._webCodecsPlayer.isBrowserHidden?this._webCodecsPlayer.getCurrentAudioDts():this._webCodecsPlayer.getVideoPts();0!==this._playedPts&&(e===this._playedPts?this._paused||this._setPaused(t):this._paused&&this._setResume(t)),this._playedPts=e,this._lastCheckTime=t}_setPaused(t){this._paused=!0,this._pausedTs=t,f.a.log("WebCodecsPause._setPaused _pausedTs=",t),this._playPause(t)}_setResume(t){const e=t-this._pausedTs;f.a.log("WebCodecsPause._setResume pausedTime=",e,this._playedPts),this._playResume(t,e),this._paused=!1,this._pausedTs=0}};var Aa=class{constructor(t,e){let{resumeFunc:i,pauseFunc:s}=e;this._webCodecsPlayer=t,this._playResume=i,this._playPause=s,this._paused=!1,this._playedPts=0,this._pausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}get paused(){return this._paused}get pausedTs(){return this._pausedTs}reset(){this._paused=!1,this._playedPts=0,this._pausedTs=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}check(t){if(0!=this._lastCheckTime&&t-this._lastCheckTime<50)return;const e=this._webCodecsPlayer.isBrowserHidden?this._webCodecsPlayer.getCurrentAudioDts():this._webCodecsPlayer.getVideoPts();if(0!==this._playedPts){e===this._playedPts?this._paused||this._setPaused(t):this._paused&&this._setResume(t);const i=t-this._lastCheck500Time,s=Math.round(e-this._lastCheck500CurrntTime);(0==this._lastCheck500Time||i>=500)&&(0!=this._lastCheck500Time&&i-s>=P.a.pause500Cfg[0]&&(1==Number(localStorage._printPauseCheckWorker)&&f.a.log(`WebCodecsPauseWorker.check.500ms check500Delta=${i}, check500CurrentTimeDelta=${s}, pauseDelta=${i-s}`),this._webCodecsPlayer.check500Pause()),this._lastCheck500CurrntTime=e,this._lastCheck500Time=t)}this._playedPts=e,this._lastCheckTime=t}_setPaused(t){this._paused=!0,this._pausedTs=t,f.a.log("WebCodecsPauseWorker._setPaused _pausedTs=",t),this._playPause(t)}_setResume(t){const e=t-this._pausedTs;f.a.log("WebCodecsPauseWorker._setResume pausedTime=",e,this._playedPts),this._playResume(t,e),this._paused=!1,this._pausedTs=0}};var Ra=class{constructor(t){this._webCodecsPlayer=t,this.delayList=[],this.decodedList=[],this.renderList=[],this.deltaList=[],this.videoBufList=[],this.videoToDecodeList=[],this.audioToDecodeList=[],this.audioDecodedList=[],this.audioRenderList=[],this.videoDiscardList=[],this.videoThrowFpsList=[],this.videoRender5SecFpsList=[],this.videoEnhanceList=[],this.videoEnhanceCostList=[],this.lastEnhanceLess30Nums=0,this.lastEnhanceLess150Nums=0,this.lastEnhanceLess200Nums=0,this.lastEnhanceLarge200Nums=0,this.lastEnhanceTotal=0,this.checkTimes=0}onCheckTimer(t,e){let i=this._webCodecsPlayer.getDecodeFps(),s=i.decodedVideoFps,r=i.decodedAudioFps,a=this._webCodecsPlayer.getVideoRenderFps(),o=this._webCodecsPlayer.getAudioRenderFps(),n=this._webCodecsPlayer.getVideoThrowFps(),h=i.toDecodeAudioFps,d=i.toDecodeVideoFps,l=i.decodedVideoDelay,u=i.videoFrameLen,c=Math.floor(this._webCodecsPlayer.getCurrentAudioDts()-this._webCodecsPlayer.getCurrentDts()),p=this._webCodecsPlayer.getDecodedBuffer(),m=this._webCodecsPlayer.getDiscardVideoFrames(),_=this._webCodecsPlayer.getBufferLen(),g=this._webCodecsPlayer.getEnhanceVideoFrames();this.delayList.push(l),this.decodedList.push(s),this.renderList.push(a),this.videoEnhanceList.push(g),this.videoEnhanceCostList.push(i.videoEnhanceCost);this.videoRender5SecFpsList.length>=5&&this.videoRender5SecFpsList.shift(),this.videoRender5SecFpsList.push(a),this.deltaList.push(c),this.videoBufList.push(_),this.audioToDecodeList.push(r),this.videoToDecodeList.push(d),this.audioDecodedList.push(r),this.audioRenderList.push(o),this.videoDiscardList.push(m),this.videoThrowFpsList.push(n),this.checkTimes%5==0&&1==Number(localStorage._printWebCodecsStat)&&f.a.log("WebCodecsPlayer.getWebCodecsStats,",`videoDecodeDelay=${l}, audioToDecodeFps=${h}, audioDecodeFps=${r},`,`audioRenderFps=${o}, videoBufferLen=${this._webCodecsPlayer.getBufferLen()}, delta=${c}, videoToDecodeFps=${d},`,`videoDecodeFps=${s}, discardVideoFps=${m}, videoRenderFps=${a}, videoThrowFps=${n},`,`videoDecodedBuffer=${p}, videoFrameLen=${u}`),this.checkTimes++}getStats(){let t=[...this.delayList],e=[...this.decodedList],i=[...this.renderList],s=[...this.deltaList],r=[...this.audioToDecodeList],a=[...this.videoToDecodeList],o=[...this.audioDecodedList],n=[...this.audioRenderList],h=[...this.videoDiscardList],d=[...this.videoThrowFpsList],l=[...this.videoEnhanceList],u=[...this.videoEnhanceCostList];this.delayList.length=0,this.decodedList.length=0,this.renderList.length=0,this.deltaList.length=0,this.audioToDecodeList.length=0,this.videoToDecodeList.length=0,this.audioDecodedList.length=0,this.audioRenderList.length=0,this.videoDiscardList.length=0,this.videoThrowFpsList.length=0,this.videoEnhanceList.length=0,this.videoEnhanceCostList.length=0;let{enhanceLess30Nums:c,enhanceLess150Nums:p,enhanceLess200Nums:m,enhanceLarge200Nums:_,enhanceTotal:g}=this._webCodecsPlayer.getDecodeFps();const S=c-this.lastEnhanceLess30Nums,T=p-this.lastEnhanceLess150Nums,y=m-this.lastEnhanceLess200Nums,E=_-this.lastEnhanceLarge200Nums,v=g-this.lastEnhanceTotal;this.lastEnhanceLess30Nums=c,this.lastEnhanceLess150Nums=p,this.lastEnhanceLess200Nums=m,this.lastEnhanceLarge200Nums=_,this.lastEnhanceTotal=g;let C={delayList:t,decodedList:e,renderList:i,deltaList:s,videoToDecodeList:a,videoDiscardList:h,audioToDecodeList:r,auidoDecodedList:o,audioRenderList:n,videoThrowFpsList:d,videoEnhanceList:l,videoEnhanceCostList:u,ehLess30Nums:S,ehLess150Nums:T,ehLess200Nums:y,ehLarge200Nums:E,ehTotal:v},P="WebCodecsPlayer.getStats\n";for(let t in C)P+=`${t}: ${C[t].toString()}\n`;return P+=`bufferLen:${this.videoBufList.toString()}\n`,f.a.log(P),this.videoBufList.length=0,C}destroy(){this.videoRender5SecFpsList.length=0}};let Oa={};self||(self=window),function(){let t=self.navigator.userAgent.toLowerCase(),e=/(edge)\/([\w.]+)/.exec(t)||/(edg)\/([\w.]+)/.exec(t)||/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(iemobile)[\/]([\w.]+)/.exec(t)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(t)||[],i=/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(windows phone)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(android)/.exec(t)||/(windows)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||[],s={browser:e[5]||e[3]||e[1]||"",version:e[2]||e[4]||"0",majorVersion:e[4]||e[2]||"0",platform:i[0]||""},r={};if(s.browser){r[s.browser]=!0;let t=s.majorVersion.split(".");r.version={major:parseInt(s.majorVersion,10),string:s.version,majorVersion:s.majorVersion},t.length>1&&(r.version.minor=parseInt(t[1],10)),t.length>2&&(r.version.build=parseInt(t[2],10))}if(s.platform&&(r[s.platform]=!0),(r.chrome||r.opr||r.safari)&&(r.webkit=!0),r.rv||r.iemobile){r.rv&&delete r.rv;let t="msie";s.browser=t,r[t]=!0}if(r.edge){delete r.edge;let t="msedge";s.browser=t,r.chrome=!0}if(r.edg){delete r.edg;let t="msedge";s.browser=t,r.chrome=!0}if(r.opr){let t="opera";s.browser=t,r[t]=!0}if(r.safari&&r.android){let t="android";s.browser=t,r[t]=!0}r.name=s.browser,r.platform=s.platform;for(let t in Oa)Oa.hasOwnProperty(t)&&delete Oa[t];Object.assign(Oa,r)}(),Oa.version||(Oa.version={major:0,minor:0,build:0,string:"0.0.0"});var wa=Oa;function La(t,e){let i=t.toString().length,s=Math.max(0,e-i),r="";if(s>0)for(let t=0;t<s;t++)r+="0";return r+t}let Ma=0;var Va={now:function(){if(void 0!==window.performance){var t=window.performance;if(void 0!==t.now)return~~t.now();if(void 0!==t.webkitNow)return~~t.webkitNow();if(void 0!==t.mozNow)return~~t.mozNow();if(void 0!==t.msNow)return~~t.msNow()}0===Ma&&(Ma=Date.now()-1);let e=Date.now()-Ma;return e>4294967295?(Ma+=4294967295,e-4294967295):e},utc:function(){return Math.round(Date.now()/1e3)},getDateStr:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN;var e=null,i=(e=t?new Date(t):new Date).getFullYear(),s=La(e.getMonth()+1,2),r=La(e.getDate(),2);return`${i}-${s}-${r}`},getTimeStr:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i=null,s=La((i=t?new Date(t):new Date).getHours(),2),r=La(i.getMinutes(),2),a=La(i.getSeconds(),2),o=`${s}:${r}:${a}`;if(e){var n=La(i.getMilliseconds(),3);o+="."+n}return o},getDateTimeStr:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i=null,s=(i=t?new Date(t):new Date).getFullYear(),r=La(i.getMonth()+1,2),a=La(i.getDate(),2),o=La(i.getHours(),2),n=La(i.getMinutes(),2),h=La(i.getSeconds(),2),d=`${s}-${r}-${a} ${o}:${n}:${h}`;if(e){var l=La(i.getMilliseconds(),3);d+="."+l}return d}};var ba=99;function Na(){return Va.getDateTimeStr()+" "}var Fa=!1;let Ba={_data:[],_length:0,debug:function(){var t=Na(),e=Array.apply(null,arguments);e[0]=t+e[0],ba<=-1&&console.log.apply(console,e)},log:function(t){var e=Na(),i=Array.apply(null,arguments);i[0]=e+i[0],ba<=0&&console.log.apply(console,i),Ba.record(i,"log")},info:function(t){var e=Na(),i=Array.apply(null,arguments);i[0]=e+i[0],ba<=1&&console.info.apply(console,i),Ba.record(i,"info")},warn:function(t){var e=Na(),i=Array.apply(null,arguments);i[0]=e+i[0],ba<=2&&console.warn.apply(console,i),Ba.record(i,"warn")},error:function(t){var e=Na(),i=Array.apply(null,arguments);i[0]=e+i[0],ba<=3&&console.error.apply(console,i),Ba.record(i,"error")},group:function(t){var e=Na(),i=Array.apply(null,arguments);if(i[0]=e+i[0],ba<=1){var s=console.groupCollapsed||console.group||console.log;s.apply(console,i)}Ba.record(i,"group")},groupEnd:function(){console.groupEnd&&console.groupEnd.apply(console)},setLevel:function(t){t!=ba&&(console.log(Na()+" set log level from "+ba+" to "+t),ba=t)},getLevel:function(){return ba},record:function(t,e){1100===Ba._length&&(Ba._data.splice(0,100),Ba._length=1e3);var i=0,s=(t.shift()||"").toString();for(s=s.replace(/\%c/gi,(function(t,e){return i++,""}));i--&&t.length;)t.shift();for(var r=0,a=t.length;r<a;r++){"object"==typeof t[r]&&(t[r]="")}t.unshift(s);var o=t.join(" ");Ba._length++,Ba._data.push(`[${e}][HYLineTrans]${o}`)},getLog:function(){return Fa||(Fa=!0,Ba._data.unshift(wa.platform+" "+wa.name+" "+wa.version.string)),Ba._data},logcss:function(t,e,i){let s="font-weight:900";return t&&(s+=";color:"+t),e&&(s+=";background:"+e),i&&(s+=";border:3px solid "+i),s},padNum:function(t,e){let i=t.toString().length,s=Math.max(0,e-i);return"0".repeat(s)+t}};var Ua=Ba,ka={logger:null,TimeUtil:null,init:function(t){this.logger=t.logger||Ua,this.TimeUtil=t.TimeUtil||Va}},xa=i(5);class Ha{constructor(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,n=arguments.length>7?arguments[7]:void 0;this.data=i,this.timeStamp=e,this.type=t,this.startDecodeTime=0,this.decodedTime=0,this.discardAllow=s,this.isKeyFrame=r,this.compositionTime=a,this.naluType=o,this.isEmptyAudioFrame=!1,n&&n.spsUnit&&(this.sps=n.spsUnit),n&&n.vpsUnit&&(this.vps=n.vpsUnit),n&&n.ppsUnit&&(this.pps=n.ppsUnit),n&&n.videoCodec&&(this.codec=n.videoCodec),n&&n.videoWidth&&(this.width=n.videoWidth),n&&n.videoHeight&&(this.height=n.videoHeight)}setIsEmptyAudioFrame(t){this.isEmptyAudioFrame=t}}Ha.VIDEO=0,Ha.AUIDO=1;var Ga=Ha;var Wa=class{constructor(t){this._player=t,this._worker=t.getWorker(),this._workerErrorBind=this._workerError.bind(this),this._workerMessageBind=this._workerMessage.bind(this),this._worker.addEventListener("message",this._workerMessageBind)}postInitConfig(t){this._post(xa.c.INIT_CONFIG,t)}postAvcConfig(t){this._post(xa.c.AVCCONFIG,t)}postAv1InitSeg(t){this._post(xa.c.AV1_INIT_SEG,t)}postAVCPPS(t){this._post(xa.c.AVCPPS,t)}postAVCSPS(t){this._post(xa.c.AVCSPS,t)}postAVCVPS(t){this._post(xa.c.AVCVPS,t)}postVideoSamples(t){this._post(xa.c.VIDEOSAMPLES,t)}postAudioConfig(t){this._post(xa.c.AACCONFIG,t)}postAudioSamples(t){this._post(xa.c.AUDIOSAMPLES,t)}postFastOver(){this._post(xa.c.FAST_OVER,{})}postClose(){this._post(xa.c.CLOSE,{})}postLocalConfig(){this._post(xa.c.LOCAL_CONFIG,{_webcodecsNoRenderVideo:Number(localStorage._webcodecsNoRenderVideo),_useSoftAcceleration:Number(localStorage._useSoftAcceleration)})}postSetUseSoftAcceleration(){this._post(xa.c.SET_USE_SOFTACCELERATION,{})}postUpdateSoftAcceleration(){this._post(xa.c.UPDATE_SOFTACCELERATION,{})}postEnableDiscardVideo(t){this._post(xa.c.ENABLE_DISCARD_VIDEO,t)}postSetAudioWriter(t){this._post(xa.c.SET_AUDIO_WRITER,{writer:t},[t])}postSetPauseVideoDecode(t){this._post(xa.c.PAUSE_VIDEO_DECODE,t)}postSetPauseAudioDecode(t){this._post(xa.c.PAUSE_AUDIO_DECODE,t)}postUpdateCurBitrate(t){this._post(xa.c.UPDATE_CURBITRATE,t)}postSetJitter(t){this._post(xa.c.SET_JITTER,t)}postFrameInfo(t){this._post(xa.c.POSTFRAME,t)}postResize(t){this._post(xa.c.RESIZE,t)}postVisibilityChange(t){this._post(xa.c.VISIBILITYCHANGE,t)}postUpdateVideoFps(t){this._post(xa.c.UPDATE_VIDEOFPS,t)}postSetPlayMinBuffer(t){this._post(xa.c.SET_PLAY_MINBUFFER,t)}postVideoRenderStart(t,e){this._post(xa.c.START,t,e)}postAuidoTrack(t,e){this._post(xa.c.SET_AUDIO_WRITER,t,e)}postLogCfg(t){this._post(xa.c.LOG_CFG,t)}setEnhance(t){this._post(xa.c.SET_ENHANCE,t)}setSegmenttion(t){this._post(xa.c.SET_SEGMENTTION,t)}onRevFastOver(){this._post(xa.c.RECV_FAST_OVER)}seek(t){this._post(xa.c.SEEK_TIME,t)}postSetVodAv1(){this._post(xa.c.SET_VOD_AV1)}postPlayBackRate(t){this._post(xa.c.SET_PLAYBACKRATE,t)}_post(t,e,i){t!==xa.c.VIDEOSAMPLES&&t!==xa.c.AUDIOSAMPLES&&t!==xa.c.UPDATE_VIDEOFPS&&t!==xa.c.VISIBILITYCHANGE&&t!==xa.c.AVCPPS&&t!==xa.c.AVCSPS&&t!==xa.c.AVCVPS&&ka.logger.log("WokerHolder.post type="+t),i?this._worker&&this._worker.postMessage({type:t,data:e},i):this._worker&&this._worker.postMessage({type:t,data:e})}_workerError(t){this._player.onWebcodecsError(xa.d.WORKERERROR,t.message)}_workerMessage(t){let e=t.data;switch(e.type){case xa.b.WOREKR_READY:this._onWorkerReady();break;case xa.b.INTERVAL:this._player.onWorkerInterval(Va.now());break;case xa.b.TURN_TO_WEBCODECS_SOFT:this._player.turnToWebcodecsSoft();break;case xa.b.AUDIORENDERERROR:this._player.onWebcodecsError(xa.d.AUDIORENDERERROR);break;case xa.b.SOFT_TURN_TO_MSE:this._player.onWebcodecsError(xa.d.SOFT_TURN_TO_MSE);break;case xa.b.AUDIO_FRAME_DECODED:this._player.getAudioRender().appendFrame(e.data);break;case xa.b.WEBGLPLAY:this._player.triggerWebcodecsPlay();break;case xa.b.AUDIO_PLAY:this._player.triggerAudioPlay();break;case xa.b.STAT:this._player.getVideoStatData(e.data);break;case xa.b.PAUSE:case xa.b.WORKERSHAREBUFFER:break;case xa.b.RENDERERROR:this._player.onWebcodecsError(xa.d.VIDEORENDEERROR);break;case xa.b.LOG:ka.logger.log("webCodecs worker log:\n",e.data.join("\n"));break;case xa.b.VIDEODECODEERROR:ka.logger.log("webCodecs worker.onDecoderError, video decode error",e.data&&e.data.msg),this._player.onWebcodecsError(xa.d.VIDEODECODEERROR,e.data&&e.data.msg);break;case xa.b.AUDIODECODEERROR:ka.logger.log("webCodecs worker.onDecoderError, audio decode error",e.data&&e.data.msg),this._player.onWebcodecsError(xa.d.AUDIODECODEERROR,e.data&e.data.msg);break;case xa.b.DECODE_COST:ka.logger.log("webCodecs worker.onDecoderCostError, video decode_cost error"),this._player.onWebcodecsError(xa.d.DECODE_COST);break;case xa.b.DECODE_DTS:ka.logger.log("webCodecs worker.decodeByDts, video decode error"),this._player.onWebcodecsError(xa.d.DECODE_DTS);break;case xa.b.WAIT_KEY_FRAME:this._player.onWaitKeyFrame(e.data);break;case xa.b.SET_FRAME_PAUSE:this._player.setFramePause();break;case xa.b.SET_FRMAE_RESUME:this._player.setFrameRusume();break;case xa.b.RENDER_FPS_PAUSE:this._player.renderFpsPause();break;case xa.b.AUDIO_FORMAT_ERROR:this._player.onWebcodecsError(xa.d.AUDIO_FORMAT_ERROR);break;case xa.b.VIDEO_ENHANCE_ERROR:this._player.onVideoEnhanceError(e.data);break;case xa.b.VIDEO_ENHANCE_SUCCESS:this._player.onVideoEnhanceSuccess();break;case xa.b.ON_WCS_VIDEO_SEEK:this._player.onVideoSeek(e.data)}}_onWorkerReady(){this.postLocalConfig(),1===Number(localStorage._useSoftAcceleration)&&this._player.setUseSoftAcceleration()}};var $a=class{constructor(){this.framelist=[]}appendFrame(t){this.framelist.push(t)}appendFrames(t){for(;t.length>0;)this.framelist.push(t.shift())}dropFrames(t){let e=0;for(let i=0;i<this.framelist.length;i++){if(!(this.framelist[i].timeStamp<t))break;e++}e>0&&this.framelist.splice(0,e)}dropInvalidFrames(t,e){let i=-1,s=0;for(let r=0;r<this.framelist.length;r++){let a=this.framelist[r];if(!(a.timeStamp<t)){if(-1==i&&a.timeStamp>t&&(i=r),!(a.timeStamp<e))break;s++}}s>0&&this.framelist.splice(i,s)}close(){for(;this.framelist.length>0;){this.framelist.pop().frame.close()}this.framelist=null}};var Ya=class extends $a{constructor(t){super(),this.rafNow=0,this.renderedFrameNums=0,this.webCodecsPlayer=t,this.frameRenderFps=0,this.renderFpsList=[],this.canvas=null,this.pauseList=[],this.lastRenderNums=0,this.lastVideoThrowNums=0,this.lastFrameTimeStamp=0,this.lastToDecodeAudioNums=0,this.lastToDecodeVideoNums=0,this.lastDecodedAudioNums=0,this.lastDecodedVideoNums=0,this.lastDiscardVideoNums=0,this.lastEnhanceVideoNums=0,this.videoPlayerElement=null,this.agenerator=null,this.processedStream=null,this.isPlayVideo=!1,this.isLive=this.webCodecsPlayer.isLive}start(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;ka.logger.log("VideoRender.start, videoElement=",i),this.videoPlayerElement=i||document.createElement("video"),this.videoPlayerElement.muted=!0,this.agenerator=new MediaStreamTrackGenerator({kind:"video"}),this.processedStream=new MediaStream([this.agenerator]),this.videoPlayerElement.srcObject=this.processedStream,this.webCodecsPlayer.getWorkerHolder().postVideoRenderStart({agenerator:this.agenerator.writable,width:t,height:e,mainSharedArrayBuffer:this.webCodecsPlayer.getSharedArrayBufferHolder().getMainBuffer()},[this.agenerator.writable])}appendFrame(t){this.webCodecsPlayer.getWorkerHolder().postFrameInfo({frameInfo:t}),this.lastFrameTimeStamp=t.timeStamp,t.frame.close(),t=null}getVideoStatData(t){1==Number(localStorage._printVideoRenderStat)&&ka.logger.log("VideoRender.getVideoStatData",t)}getVideoElement(){return this.videoPlayerElement}onAudioPauseByBrowser(){this.videoPlayerElemen&&this.videoPlayerElement.pause(),ka.logger.log("VideoRender.onAudioPauseByBrowser")}play(){if((!this.isPlayVideo||!this.webCodecsPlayer.audioBrowserPaused)&&(this.isPlayVideo=!0,this.videoPlayerElement&&this.videoPlayerElement.paused)){let t=this.videoPlayerElement.play();t&&t.then(()=>{ka.logger.log("VideoRender.play success"),this.webCodecsPlayer.audioBrowserPaused&&(this.videoPlayerElement.pause(),this.webCodecsPlayer&&this.webCodecsPlayer.onPauseByBrowser())}).catch(t=>{const e=t.toString();Ua.warn("VideoRender.play error: "+e),this.webCodecsPlayer&&(e.indexOf("NotAllowedError")>=0||e.indexOf("request was interrupted")>=0)&&this.webCodecsPlayer&&this.webCodecsPlayer.onPauseByBrowser()})}}getPauseStatList(){let t=[].slice.call(this.pauseList);return this.pauseList.length=0,t}getRenderedFrameNums(){return this.renderedFrameNums}getVideoPts(){return this.webCodecsPlayer.getSharedArrayBufferHolder().getVideoPts()}getDecodedBuffer(){return this.webCodecsPlayer.getSharedArrayBufferHolder().getDecodedBuffer()}getRenderFps(){let t=this.webCodecsPlayer.getSharedArrayBufferHolder().getRenderNums(),e=t-this.lastRenderNums;return this.lastRenderNums=t,e<0&&(e=0),e}getVideoThrowFps(){let t=this.webCodecsPlayer.getSharedArrayBufferHolder().getVideoThrowNums(),e=t-this.lastVideoThrowNums;return this.lastVideoThrowNums=t,e<0&&(e=0),e}containerResize(t){}onVisibilitychange(){let t=document.visibilityState;this.webCodecsPlayer.getWorkerHolder().postVisibilityChange({state:t})}updateVideoFPS(t,e){this.webCodecsPlayer.getWorkerHolder().postUpdateVideoFps({fps:t,noReferFps:e})}setPlayMinBuffer(t){this.webCodecsPlayer.getWorkerHolder().postSetPlayMinBuffer({bufferLen:t})}getDecodeFps(){let t=this.webCodecsPlayer.getSharedArrayBufferHolder(),e=t.getAudioTodecodeNums(),i=t.getVideoTodecodeNums(),s=t.getAudioDecodedNums(),r=t.getVideoDecodedNums(),a=t.getDecodedVideoDelay(),o=t.getDecodedVideoDelaySmooth(),n=t.getVideoReadyToRenderListLen(),h=t.getVideoEnhanceCost(),d=e-this.lastToDecodeAudioNums,l=i-this.lastToDecodeVideoNums,u=s-this.lastDecodedAudioNums,c=r-this.lastDecodedVideoNums;return this.lastToDecodeAudioNums=e,this.lastToDecodeVideoNums=i,this.lastDecodedAudioNums=s,this.lastDecodedVideoNums=r,{toDecodeAudioFps:d,toDecodeVideoFps:l,decodedAudioFps:u,decodedVideoFps:c,decodedVideoDelay:a,decodedVideoDelaySmooth:o,videoFrameLen:n,videoEnhanceCost:h,enhanceLess30Nums:t.getEnhanceLess30Nums(),enhanceLess150Nums:t.getEnhanceLess150Nums(),enhanceLess200Nums:t.getEnhanceLess200Nums(),enhanceLarge200Nums:t.getEnhanceLarge200Nums(),enhanceTotal:t.getEnhanceTotal()}}getDiscardVideoFrames(){let t=this.webCodecsPlayer.getSharedArrayBufferHolder().getVideoDecodeDiscardNums(),e=t-this.lastDiscardVideoNums;return this.lastDiscardVideoNums=t,e}getEnhanceVideoFrames(){let t=this.webCodecsPlayer.getSharedArrayBufferHolder().getEnhanceVideoFrames(),e=t-this.lastEnhanceVideoNums;return this.lastEnhanceVideoNums=t,e}setAudioDecodedBuffer(t){this.webCodecsPlayer.getSharedArrayBufferHolder().storeMainBuffer(xa.a.AUDIO_DECODED_BUFFER,t)}getVideoBufferLen(){let t=0;if(this.videoPlayerElement){let e=this.videoPlayerElement.buffered;e.length>0&&(t=1e3*(e.end(e.length-1)-this.videoPlayerElement.currentTime)>>0)}return t}userPause(){ka.logger.log("VideoRenderWorker.userPause"),this.webCodecsPlayer.getSharedArrayBufferHolder().storeMainBuffer(xa.a.PAUSE_STATUS,1)}userPlay(){ka.logger.log("VideoRenderWorker.userPlay"),this.webCodecsPlayer.getSharedArrayBufferHolder().storeMainBuffer(xa.a.PAUSE_STATUS,0)}onVideoPause(){ka.logger.log("VideoRenderWorker.onVideoPause"),this.isLive||this.videoPlayerElement.pause()}onVideoPlay(){ka.logger.log("VideoRenderWorker.onVideoPlay")}setRealFps(t){this.webCodecsPlayer.getSharedArrayBufferHolder().storeMainBuffer(xa.a.VIDEO_REAL_FPS,t)}getVideoWidth(){return this.videoPlayerElement?this.videoPlayerElement.videoWidth:0}getVideoHeight(){return this.videoPlayerElement?this.videoPlayerElement.videoHeight:0}startMuteRender(){ka.logger.log("VideoRenderWorker.startMuteRender"),this.webCodecsPlayer.onVideoPlay(),this.videoPlayerElement.play()}setPlaybackRate(t){this.webCodecsPlayer.getWorkerHolder().postPlayBackRate(t)}close(){this.videoPlayerElement&&this.videoPlayerElement.pause(),super.close(),this.rafNow=0,this.renderedFrameNums=0,this.isBrowserHidden=!1,this.renderFpsList.length=0,this.canvas=null,this.lastRenderNums=0,this.lastVideoThrowNums=0,this.lastToDecodeAudioNums=0,this.lastToDecodeVideoNums=0,this.lastDecodedAudioNums=0,this.lastDecodedVideoNums=0,this.lastDiscardVideoNums=0,this.lastEnhanceVideoNums=0,this.videoPlayerElement&&this.videoPlayerElement.removeEventListener("resize",this.webCodecsPlayer.onVideoResizeBind),this.videoPlayerElement=null,this.agenerator=null,this.processedStream=null}};var Ka=class extends $a{constructor(t){super(t),this.audioDuration=0,this.ageneratorWriter=null,this.audioPlayerElement=null,this.processedStream=null,this.agenerator=null,this.renderTimer=0,this.frameTimeStamps=[],this.renderQueueLimit=5,this.audioSampleRate=44100,this.volume=1,this.paused=!1,this.renderNums=0,this.lastRenderNums=0,this.player=t,this.firstFrameRenderWriting=!1,this.firstFinshed=!1,this.isMuffled=!1,this.cacheVolume=1,this.isPlaying=!1,this.userPaused=!1,this.audioPlayerElement=document.createElement("audio"),this.audioPlayerElement.addEventListener("error",t.onVideoErrorBind),this.audioPlayerElement.addEventListener("play",t.onVideoPlayBind),this.audioPlayerElement.addEventListener("playing",t.onVideoPlayingBind),this.playing=!1}start(){"MediaStreamTrackProcessor"in window&&"MediaStreamTrackGenerator"in window?(this.agenerator=new MediaStreamTrackGenerator({kind:"audio"}),this.processedStream=new MediaStream([this.agenerator]),this.audioPlayerElement.srcObject=this.processedStream,this.player.getWorkerHolder().postAuidoTrack({ageneratorWriter:this.agenerator.writable},[this.agenerator.writable]),this.setVolume(this.volume)):this.player.onWebcodecsError(xa.d.NOT_SUPPORT_MEDIASRTREAMTRACK)}getCurrentDts(){return this.player.getSharedArrayBufferHolder().getAudioDts()}getCurrentTime(){return this.audioPlayerElement&&this.audioPlayerElement.currentTime?Math.round(1e3*this.audioPlayerElement.currentTime):0}setVolume(t){this.isMuffled?this.audioPlayerElement&&(this.audioPlayerElement.volume=0):this.audioPlayerElement&&(this.audioPlayerElement.volume=t),this.volume=t,this.cacheVolume=t}setMuffledVolume(t){this.isMuffled=t,this.isMuffled?this.audioPlayerElement&&(this.audioPlayerElement.volume=0):this.setVolume(this.cacheVolume)}setMuted(t){this.isMute=t,t?this.audioPlayerElement&&(this.audioPlayerElement.muted=!0):this.audioPlayerElement&&(this.audioPlayerElement.muted=!1)}getRenderFps(){let t=this.player.getSharedArrayBufferHolder().getAudioRenderNums(),e=t-this.lastRenderNums;return e<0&&(e=0),this.lastRenderNums=t,e}pause(){this.audioPlayerElement.pause()}play(){this._play()}_checkPlay(){Ua.log("AudioRender.checkPlay playing="+this.playing),this.playing?Timer.remove(this._checkPlay,this):this._play()}_play(){let t=this.audioPlayerElement.play();t?t.then(()=>{this.playing=!0,Ua.log("AudioRender.play success")}).catch(t=>{this.playing=!1;const e=t.toString();Ua.warn("AudioRender.play error: "+e),this.player&&(e.indexOf("NotAllowedError")>=0||e.indexOf("request was interrupted")>=0||this.audioPlayerElement.paused)&&this.player&&this.player.onPauseByBrowser(),this.userPaused=!0}):this.playing=!1}userPlay(){Ua.log("AudioRender.userPlay"),this.userPaused=!1,this.play()}userPause(){Ua.log("AudioRender.userPause"),this.userPaused=!0,this.pause(),this.player.onVideoPauseBind()}workerMessage(t){switch(t.data.type){case xa.b.WORKERSHAREBUFFER:break;case xa.b.AUDIODECODEERROR:Ua.log("webCodecs worker.onDecoderError, audio decode error"),this.player.onWebcodecsError(xa.d.AUDIODECODEERROR)}}getAudioBufferLen(){let t=0;if(this.audioPlayerElement){let e=this.audioPlayerElement.buffered;e.length>0&&(t=1e3*(e.end(e.length-1)-this.audioPlayerElement.currentTime)>>0)}return t}initAudio(){}onCheckFastTimer(){}close(){super.close(),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.audioPlayerElement.removeEventListener("pause",this.player.onVideoPauseBind),this.audioPlayerElement.removeEventListener("error",this.player.onVideoErrorBind),this.audioPlayerElement.removeEventListener("play",this.player.onVideoPlayBind),this.audioPlayerElement.removeEventListener("playing",this.player.onVideoPlayingBind),this.agenerator=null,this.ageneratorWriter=null,this.audioPlayerElement=null,this.processedStream=null,this.renderNums=0,this.lastRenderNums=0,this.firstFinshed=!1,this.frameTimeStamps.length=0,this.isPlaying=!1,this.userPaused=!1,this.playing=!1}};class ja{constructor(){}}ja.INIT="init",ja.INITED="inited",ja.STOP="stop",ja.PAUSE="pause",ja.RESUME="resume",ja.PLAY="play",ja.AUDIO_FRAME="audio_frame",ja.UPDATE_CURRENT_TIME="update_current_time",ja.TIME_STAMP="timestamp",ja.VOLUME="volume",ja.AUDIO_DATA_NAN="AUDIO_DATA_NAN",ja.AUDIO_DATA_MUTE="AUDIO_DATA_MUTE",ja.LOG_CFG="LOG_CFG",ja.UPDATE_PLAYBACKRATE="UPDATE_PLAYBACKRATE",ja.SEEK="SEEK",ja.ON_VIDEO_SEEK="ON_VIDEO_SEEK";var qa=ja,za=i(25),Ja=i.n(za);let Qa=window.AudioContext||window.webkitAudioContext,Xa=0;var Za=class{constructor(t){this._id=Xa++,this.player=t,this.audioCtx=null,this.outputAnalyser=null,this.oscillator=null,this.bypasser=null,this.outputChannelCount=2,this.sampleRate=44100,this.currentDts=0,this.isMuffled=!1,this.isMute=!1,this.cacheVolume=1,this.isPlaying=!1,this.userPaused=!1,this.renderNums=0,this.lastRenderNums=0,this.isFirstFrameTs=0,this.firstTimeStamp=0,this.gainNode=null,this.audioContextState="",this.isFirstPlay=!1,this.onAudioStateChangeBind=this.onAudioStateChange.bind(this),this.audioFrames=[],this._logCfg={},this._logTs=0,this.volume=1,this.playbackRate=1,this.player.isLive?this.playMode=0:this.playMode=1,this.sampleRate=44100,this.outputChannelCount=2,this.isInited=!1}isSuspended(){return"suspended"===this.audioContextState}start(){}initAudio(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:44100,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(44100==t){if(this.sampleRate=t,this.outputChannelCount=e,ka.logger.log("AudioWorkletNodeRenderer.initAudio"),this.audioCtx=new Qa({sampleRate:t}),"suspended"==this.audioCtx.state)return this.player.onAudioPauseByBrowser(),void(this.isAudioPause=!0);this.initAudioContext(e)}else this.player.onWebcodecsError(xa.d.NOT_SUPPORT_AUDIO_SAMPLERATE)}getAudioAnalyser(){return this.outputAnalyser}initAudioContext(t){ka.logger.log("AudioWorkletNodeRenderer.initAudioContext"),this.outputChannelCount=t,this.audioCtx.audioWorklet.addModule(Ja.a).then(()=>{this.audioCtx&&(this.outputAnalyser=this.audioCtx.createAnalyser(),this.bypasser=new AudioWorkletNode(this.audioCtx,"bypass-processor",{outputChannelCount:[t]}),this.bypasser.port.onmessage=this.onMessage.bind(this),this.bypasser.connect(this.outputAnalyser),this.outputAnalyser.connect(this.audioCtx.destination),this.player&&this.player.onAudioAnalyserInit(this.outputAnalyser))}),this.audioCtx.addEventListener("statechange",this.onAudioStateChangeBind)}setPlaybackRate(t){ka.logger.log("AudioWorkletNodeRenderer.setPlaybackRate",t),this.playbackRate!=t&&(this.playbackRate=t,this.postMessage(qa.UPDATE_PLAYBACKRATE,t))}muteRecoverInit(){ka.logger.log("AudioWorkletNodeRenderer.muteRecoverInit"),this.isAudioPause=!1,this.audioCtx=null,this.initAudio(this.sampleRate,this.outputChannelCount)}onAudioStateChange(){let t=this.audioCtx.state;ka.logger.log("AudioWorkletNodeRenderer.onAudioStateChange, state="+t),this.audioContextState=t,"suspended"==t?(this.player.onVideoPause(),this.isAudioPause=!0):"running"==t&&(this.player.onAudioPlay(),this.isAudioPause=!1)}seek(){this.isSeek=!0,this.postMessage(qa.SEEK)}onVideoSeek(){ka.logger.log("AudioWorkletNodeRenderer.onVideoSeek"),this.isSeek=!1,this.postMessage(qa.ON_VIDEO_SEEK)}appendFrame(t){-1!=t.format.indexOf("32")?this.isAudioPause?!this.isSeek&&this.audioFrames.push(t):this.isInited?this.postMessage(qa.AUDIO_FRAME,t):this.audioFrames.push(t):this.player.onWebcodecsError(xa.d.AUDIO_FORMAT_ERROR)}onWorkLetReady(){ka.logger.log("AudioWorkletNodeRenderer.onWorkLetReady, frameLen="+this.audioFrames.length),this.audioFramesClear(),this.audioFrames.length>=0&&(this.audioFrames.map(t=>{this.postMessage(qa.AUDIO_FRAME,t)}),this.audioFrames.length)}onCheckFastTimer(){if(this.audioFramesClear(),this.bypasser&&this.bypasser.port&&this.bypasser.port.postMessage){let t=Va.now();if(t-this._logTs>1e3){this._logTs=t;let e={printProcess:1==localStorage._printProcess,printAudioData:1==localStorage._printAudioData,printRenderSkipAudio:1==localStorage._printRenderSkipAudio};e.printProcess==this._logCfg.printProcess&&e.printAudioData===this._logCfg.printAudioData&&e.printRenderSkipAudio===this._logCfg.printRenderSkipAudio||(this._logCfg=e,this.postMessage(qa.LOG_CFG,e))}}}audioFramesClear(){const t=this.player.getVideoPts();for(;this.audioFrames.length>0;){let e=this.audioFrames[0];if(!(e.timeStamp<t))break;this.audioFrames.shift(),this.player.isLive||this.isAudioPause||this.player.getSharedArrayBufferHolder().storeMainBuffer(xa.e.AUDIO_DTS,e.timeStamp)}}onMessage(t){switch(t.data.type){case qa.INITED:ka.logger.log("AudioWorkletNodeRenderer.onMessage inited, playMode="+this.playMode),this.setVolume(this.volume),this.postMessage(qa.INIT,{outputChannelCount:this.outputChannelCount,id:this._id,playMode:this.playMode,playbackRate:this.playbackRate,mainSharedArrayBuffer:this.player.getSharedArrayBufferHolder().getMainBuffer()}),this.onWorkLetReady(),this.isSeek?this.postMessage(qa.SEEK):this.postMessage(qa.ON_VIDEO_SEEK),this.isInited=!0;break;case qa.TIME_STAMP:const e=Va.now();this.currentDts=t.data.data.timeStamp,this.renderNums=t.data.data.renderNums,this.isFirstPlay||(this.isFirstPlay=!0,this.player.triggerAudioPlay()),this.player.audioPlayConsuming&&this.player.audioPlayConsuming.addRenderFrameData&&this.player.audioPlayConsuming.addRenderFrameData(this.currentDts,e),0==this.isFirstFrameTs?(this.isFirstFrameTs=e,this.firstTimeStamp=this.currentDts):Number(1==localStorage._printWebcodecsWorkletDts)&&ka.logger.log(`AudioWorkLet, dts=${this.currentDts},localPast=${Va.now()-this.isFirstFrameTs},audioPast=${this.currentDts-this.firstTimeStamp}`);break;case qa.AUDIO_DATA_NAN:this.player.onWebcodecsError(xa.d.AUDIO_DATA_NAN);break;case qa.AUDIO_DATA_MUTE:}}postMessage(t,e){this.bypasser&&this.bypasser.port&&this.bypasser.port.postMessage&&this.bypasser.port.postMessage({type:t,data:e})}workerMessage(){}getCurrentDts(){let t=this.player.getSharedArrayBufferHolder().getAudioDts();return t||this.currentDts}getCurrentTime(){return this.audioCtx?Math.round(this.audioCtx.currentTime):0}setVolume(t){this.isMuffled||this.isMute?this.postMessage(qa.VOLUME,0):this.postMessage(qa.VOLUME,t),this.volume=t,this.cacheVolume=t}setMuffledVolume(t){this.isMuffled=t,this.isMuffled?this.postMessage(qa.VOLUME,0):this.setVolume(this.cacheVolume)}setMuted(t){this.isMute=t,t?this.postMessage(qa.VOLUME,0):this.setVolume(this.cacheVolume)}getRenderFps(){let t=this.renderNums,e=t-this.lastRenderNums;return e<0&&(e=0),this.lastRenderNums=t,e}pause(){ka.logger.log("AudioWorkletNodeRenderer.pause"),this.postMessage(qa.PAUSE)}play(){this._play(),this.postMessage(qa.PLAY)}_play(){if(!this.audioCtx)return;let t=this.audioCtx.resume();t?t.then(()=>{this.playing=!0,ka.logger.log("AudioRender.play success")}).catch(t=>{this.playing=!1;const e=t.toString();ka.logger.warn("AudioRender.play error: "+e),this.player&&this.player.onAudioPauseByBrowser(),this.userPaused=!0}):this.playing=!1}userPlay(){ka.logger.log("AudioRender.userPlay"),this.isAudioPause&&!this.player.isLive&&this.muteRecoverInit(),this.userPaused=!1,this.play()}userPause(){ka.logger.log("AudioRender.userPause"),this.userPaused=!0,this.pause(),this.player.onVideoPause()}workerMessage(t){switch(t.data.type){case xa.b.WORKERSHAREBUFFER:break;case xa.b.AUDIODECODEERROR:ka.logger.log("webCodecs worker.onDecoderError, audio decode error"),this.player.onWebcodecsError(xa.d.AUDIODECODEERROR)}}getAudioBufferLen(){return 0}close(){this.currentDts=0,this.audioCtx&&(this.postMessage(qa.STOP,null),ka.logger.log("AudioWorkletNodeRenderer.close"),this.bypasser&&(this.bypasser.port.close(),this.bypasser.disconnect(this.audioCtx),this.bypasser=null),this.audioCtx.removeEventListener("statechange",this.onAudioStateChangeBind),this.audioCtx.close(),this.audioCtx=null),this.renderNums=0,this.lastRenderNums=0,this.isFirstFrameTs=0,this.firstTimeStamp=0,this.isFirstPlay=!1}};var to=class{constructor(){let t=new SharedArrayBuffer(1024);this._mainBuffer=new Uint32Array(t),this._workerBufferAudio=null}getMainBuffer(){return this._mainBuffer}setWorkerBufferVideo(t){this._mainBuffer=t}setWorkerBufferAudio(t){this._workerBufferAudio=t}storeMainBuffer(t,e){this._mainBuffer&&Atomics.store(this._mainBuffer,t,e)}storeMainShieldAudio(t){this.storeMainBuffer(xa.a.IS_SHIELD_AUDIO,t)}storeFrameBuffer(t){this.storeMainBuffer(xa.a.FRAME_BUFFER_LEN,t)}storeRecvVideoTs(t){this.storeMainBuffer(xa.a.LAST_VIDEO_RCV_TS,t)}getBufferLen(){return this._loadWorker(xa.e.VIDEO_BUFFER_LEN,this._mainBuffer)}getVideoPts(){return this._loadWorker(xa.e.VIDEO_PTS,this._mainBuffer)}getDecodedBuffer(){return this._loadWorker(xa.e.VIDEO_NOT_RENDERD_BUFFER,this._mainBuffer)}getRenderNums(){return this._loadWorker(xa.e.VIDEO_RENDER_NUMS,this._mainBuffer)}getAudioRenderNums(){return this._loadWorker(xa.e.AUDIO_RENDER_NUMS,this._mainBuffer)}getVideoThrowNums(){return this._loadWorker(xa.e.VIDEO_THROW_FRAME_FPS,this._mainBuffer)}getAudioTodecodeNums(){return this._loadWorker(xa.e.AUDIO_TODECODE_NUMS,this._mainBuffer)}getVideoTodecodeNums(){return this._loadWorker(xa.e.VIDEO_TODECODE_NUMS,this._mainBuffer)}getAudioDecodedNums(){return this._loadWorker(xa.e.AUDIO_DECODE_NUMS,this._mainBuffer)}getVideoDecodedNums(){return this._loadWorker(xa.e.VIDEO_DECODE_NUMS,this._mainBuffer)}getDecodedVideoDelay(){return this._loadWorker(xa.e.VIDEO_DECODED_DELAY,this._mainBuffer)}getDecodedVideoDelaySmooth(){return this._loadWorker(xa.e.VIDEO_DECODED_DELAY_SMOOTH,this._mainBuffer)}getVideoReadyToRenderListLen(){return this._loadWorker(xa.e.VIDEO_READY_TO_RENDER_LIST_LEN,this._mainBuffer)}getVideoDecodeDiscardNums(){return this._loadWorker(xa.e.VIDEO_DECODE_DISCARD_NUMS,this._mainBuffer)}getEnhanceVideoFrames(){return this._loadWorker(xa.e.VIDEO_ENHANCE_NUMS,this._mainBuffer)}getVideoEnhanceCost(){return this._loadWorker(xa.e.VIDEO_ENAHNCE_COST,this._mainBuffer)}getEnhanceLess30Nums(){return this._loadWorker(xa.e.VIDEO_ENHANCE_LESS30_NUMS,this._mainBuffer)}getEnhanceLess150Nums(){return this._loadWorker(xa.e.VIDEO_ENHANCE_LESS150_NUMS,this._mainBuffer)}getEnhanceLess200Nums(){return this._loadWorker(xa.e.VIDEO_ENHANCE_LESS200_NUMS,this._mainBuffer)}getEnhanceLarge200Nums(){return this._loadWorker(xa.e.VIDEO_ENHANCE_LARGE200_NUMS,this._mainBuffer)}getEnhanceTotal(){return this._loadWorker(xa.e.VIDEO_ENHANCE_TOTAL,this._mainBuffer)}getAudioDts(){return this._loadWorker(xa.e.AUDIO_DTS,this._mainBuffer)}getVideoFirstFrameDecodeCost(){return this._loadWorker(xa.e.VIDEO_FIRST_FRAME_DECODEC_COST,this._mainBuffer)}getAudioFirstFrameDecodeCost(){return this._loadWorker(xa.e.AUDIO_FIRST_FRAME_DECODEC_COST,this._mainBuffer)}_loadWorker(t,e){return e?Atomics.load(e,t):0}};var eo=class{constructor(t,e){this._config=t,this.isLive=t.isLive,this.videoElement=t.videoElement,this._callbacks=e,this._worker=N()(27),this._workerHolder=new Wa(this),this._sharedArrayBufferHolder=new to,this._videoRender=new Ya(this),1==localStorage._enableAudioTrack?this._audioRender=new Ka(this):this._audioRender=new Za(this),this._isAudioPause=!1,this._isRenderStart=!1,this._logCfgCheckTs=0,this._logCfg={},this._initConfig()}_initConfig(){this._workerHolder.postInitConfig({config:JSON.stringify(this._config)}),this._checkLogCfg(Va.now())}setVodAv1(){this._workerHolder.postSetVodAv1()}getWorker(){return this._worker}getWorkerHolder(){return this._workerHolder}getSharedArrayBufferHolder(){return this._sharedArrayBufferHolder}getVideoRender(){return this._videoRender}getAudioRender(){return this._audioRender}getVideoElement(){return this._videoRender.getVideoElement()}getVideoPts(){return this._videoRender?this._videoRender.getVideoPts():0}getDecodeFps(){return this._videoRender.getDecodeFps()}getDecodedBuffer(){return this._videoRender.getDecodedBuffer()}getVideoRenderFps(){return this._videoRender.getRenderFps()}getAudioRenderFps(){return this._audioRender.getRenderFps()}getVideoThrowFps(){return this._videoRender.getVideoThrowFps()}getDiscardVideoFrames(){return this._videoRender.getDiscardVideoFrames()}getEnhanceVideoFrames(){return this._videoRender.getEnhanceVideoFrames()}getDecodedVideoDelaySmooth(){return this._sharedArrayBufferHolder.getDecodedVideoDelaySmooth()}getCurrentTime(){return this._audioRender.getCurrentTime()}getCurrentAudioDts(){return this._audioRender.getCurrentDts()}getBufferLen(){return this._sharedArrayBufferHolder.getBufferLen()}setRealFps(t){this._videoRender.setRealFps(t)}updateVideoFPS(t,e){this._videoRender.updateVideoFPS(t,e)}getAudioError(){return this._audioRender.audioPlayerElement.error}userPause(){this._audioRender.userPause(),this._videoRender.userPause()}userPlay(){this._audioRender.userPlay(),this._videoRender.userPlay()}setPlayMinBuffer(t){this._workerHolder.postSetPlayMinBuffer({bufferLen:t})}startMuteRender(t){this._audioRender.isAudioPause&&(ka.logger.log(`WebcodecsPlayer.startMuteRender.${0===t?"mute":"setVolume"} val=${t}`),0===t?(this._isAudioPause=!0,this.audioBrowserPaused=!1,this._videoRender.startMuteRender()):this._isAudioPause&&(this.onAudioPlay(),this._audioRender.muteRecoverInit())),this._audioRender.setVolume(t)}setMuffledVolume(t){this._audioRender.setMuffledVolume(t)}setPauseVideoDecode(t){this._workerHolder.postSetPauseVideoDecode({isPause:t})}setPauseAudioDecode(t){this._workerHolder.postSetPauseAudioDecode({isPause:t})}isAudioSuspended(){return this._audioRender.isSuspended()}onVisibilitychange(){this._videoRender.onVisibilitychange()}onAudioPauseByBrowser(){ka.logger.log("WebcodecsPlayer.onAudioPauseByBrowser"),this.getSharedArrayBufferHolder().storeMainBuffer(xa.a.BROWSER_PAUSE_STATUS,1),this.audioBrowserPaused=!0,this._videoRender.onAudioPauseByBrowser()}onAudioAnalyserInit(t){this._callbacks&&this._callbacks.onAudioAnalyserInit(t)}onPauseByBrowser(){this._callbacks&&this._callbacks.onPauseByBrowser()}onVideoPause(){this._videoRender.onVideoPause()}onVideoPlay(){this._videoRender.onVideoPlay(),this._callbacks.onVideoPlay&&this._callbacks.onVideoPlay()}onAudioPlay(){ka.logger.log("WebcodecsPlayer.onAudioPlay"),this.audioBrowserPaused=!1,this._videoRender.onVideoPlay(),this.getSharedArrayBufferHolder().storeMainBuffer(xa.a.BROWSER_PAUSE_STATUS,0)}triggerAudioPlay(){if(!this._audioRender)return;const t=this.getSharedArrayBufferHolder().getAudioFirstFrameDecodeCost();ka.logger.log("WebcodecsPlayer.triggerPlay audio",t),this._audioRender.play(),this.triggerPlay("audio")}triggerPlay(t){this._videoRender.play();const e=this.getSharedArrayBufferHolder().getVideoFirstFrameDecodeCost(),i=this.getSharedArrayBufferHolder().getAudioFirstFrameDecodeCost();this._callbacks&&this._callbacks.triggerPlay(e,i,t)}triggerWebcodecsPlay(){this.triggerPlay("video"),this._callbacks&&this._callbacks.triggerWebcodecsPlay()}setFramePause(){this._callbacks&&this._callbacks.setFramePause&&this._callbacks.setFramePause()}setFrameRusume(){this._callbacks&&this._callbacks.setFrameRusume&&this._callbacks.setFrameRusume()}renderFpsPause(){this._callbacks&&this._callbacks.renderFpsPause&&this._callbacks.renderFpsPause()}getVideoStatData(t){1==Number(localStorage._printVideoRenderStat)&&ka.logger.log("VideoRender.getVideoStatData",t)}onWorkerInterval(t){this._audioRender.onCheckFastTimer(),this._callbacks&&this._callbacks.onWorkerInterval(t),this._checkLogCfg(t)}_checkLogCfg(t){if(0===this._logCfgCheckTs||t-this._logCfgCheckTs>1e3){this._logCfgCheckTs=t;let e={printTodecodeVideo:1==localStorage._printTodecodeVideo,printToDecodeAudio:1==localStorage._printToDecodeAudio,printDecodedVideo:1==localStorage._printDecodedVideo,printDecodedAudio:1==localStorage._printDecodedAudio,printTorenderVideo:1==localStorage._printTorenderVideo,printTorenderAudio:1==localStorage._printTorenderAudio,printAppendVideo:1==localStorage._printAppendVideo,printAppendAudio:1==localStorage._printAppendAudio,printVideoDecodeFast:1==localStorage._printVideoDecodeFast,printRenderSkipFrame:1==localStorage._printRenderSkipFrame},i=!1;for(let t in e)if(this._logCfg[t]!==e[t]){i=!0;break}this._logCfg=e,i&&this._workerHolder.postLogCfg(e)}}onWebcodecsError(t,e){ka.logger.log("WebcodecsPlayer.onWebcodecsError type="+t,e),this._callbacks&&this._callbacks.onWebcodecsError(t,e)}containerResize(t){this._videoRender.containerResize(t)}setEnableDiscard(t){this._workerHolder.postEnableDiscardVideo({enableDiscard:t})}updateCurBitrate(t){this._workerHolder.postUpdateCurBitrate({curBitrate:t})}setJitter(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0;this._workerHolder.postSetJitter({bufLen:t,bufMin:e,bufMax:i,jumpBufferCfg:s,shieldAudioCfgBufLen:r,isRemuxBuf:1===a})}updateAVCConfig(t){let{width:e,height:i}=t;ka.logger.log(`WebcodecsPlayer.updateAVCConfig width=${e} height=${i}`),this._isRenderStart||(this._videoRender.start(e,i,this.videoElement),this._audioRender.start(),this._isRenderStart=!0),this._workerHolder.postAvcConfig(t)}initSegmentSuc(t){this._workerHolder.postAv1InitSeg(t)}updateAVCPPS(t,e){this._workerHolder.postAVCPPS({data:t,timestamp:e})}updateAVCSPS(t,e){this._workerHolder.postAVCSPS({data:t,timestamp:e})}updateAVCVPS(t,e){this._workerHolder.postAVCVPS({data:t,timestamp:e})}appendVideoSample(t){let e=Math.floor(t.ts),i=t.key,s=Math.floor(t.cts),r=t.units,a=0,o=0,n=0;r.map(t=>{o+=t.data.byteLength,n++});let h=new Uint8Array(o+4*n),d=new DataView(h.buffer);d.setUint32(0,h.byteLength);let l=!1,u=0;r.map((t,e)=>{let i=t,s=i.data.byteLength;u=i.naluType,l=i.discardAllow,d.setUint32(a,s),a+=4,h.set(i.data,a),a+=s});let c=new EncodedVideoChunk({type:i?"key":"delta",timestamp:e,duration:3e3,data:d.buffer}),p=new Ga(Ga.VIDEO,e,c,l,i,s,u,t);1!==Number(localStorage._dropVideoUnit)&&this._workerHolder.postVideoSamples({videoSamples:[p]})}appendAv1VideoSample(t){let e=Math.floor(t.ts),i=t.key,s=new EncodedVideoChunk({type:i?"key":"delta",timestamp:e,duration:3e3,data:t.data}),r=new Ga(Ga.VIDEO,e,s,!1,i,0,void 0,t);1!==Number(localStorage._dropVideoUnit)&&this._workerHolder.postVideoSamples({videoSamples:[r]})}updateAudioConfig(t){ka.logger.log("WebcodecsPlayer.updateAudioConfig "+JSON.stringify(t));const{codec:e,audioSampleRate:i,audioChannelCount:s,timeStamp:r}=t;this._audioRender&&(this._audioRender.initAudio(i,s),this._workerHolder.postAudioConfig({codec:e,sampleRate:i,numberOfChannels:s,timestamp:r}))}appendAudioSample(t){let e=t.unit,i=t.ts,s=new Uint8Array(e.byteLength+4);new DataView(s.buffer).setUint32(0,e.byteLength),s.set(e,4);let r=new EncodedAudioChunk({type:"key",timestamp:0,duration:3e3,data:e}),a=new Ga(Ga.AUIDO,i,r);1==t.empty&&a.setIsEmptyAudioFrame(!0),this._workerHolder.postAudioSamples({audioSamples:[a]})}onFastOver(){this._workerHolder.postFastOver()}turnToWebcodecsSoft(){this._callbacks&&this._callbacks.turnToWebcodecsSoft()}setUseSoftAcceleration(){this._workerHolder.postSetUseSoftAcceleration()}updateSoftAcceleration(){this._workerHolder.postUpdateSoftAcceleration()}onWaitKeyFrame(t){this._callbacks&&this._callbacks.onWaitKeyFrame(t)}storeMainShieldAudio(t){this._sharedArrayBufferHolder.storeMainShieldAudio(t)}storeFrameBuffer(t){this._sharedArrayBufferHolder.storeFrameBuffer(t)}storeRecvVideoTs(t){this._sharedArrayBufferHolder.storeRecvVideoTs(t)}setMuted(t){this._audioRender&&this._audioRender.setMuted(t)}setEnhance(t){this._workerHolder.setEnhance({data:t})}setSegmenttion(t){this._workerHolder.setSegmenttion({data:t})}onVideoEnhanceError(t){this._callbacks&&this._callbacks.onVideoEnhanceError&&this._callbacks.onVideoEnhanceError(t)}onVideoEnhanceSuccess(){this._callbacks&&this._callbacks.onVideoEnhanceSuccess&&this._callbacks.onVideoEnhanceSuccess()}onRevFastOver(){this._workerHolder.onRevFastOver()}seek(t,e){this._workerHolder.seek({seekTime:t,initDts:e}),this._audioRender&&this._audioRender.seek(t)}onVideoSeek(t){ka.logger.log("WebcodecsPlayer.onVideoSeek seekTime="+t),this._audioRender&&this._audioRender.onVideoSeek(t),this._callbacks&&this._callbacks.onVideoSeekBind&&this._callbacks.onVideoSeekBind(t)}setPlaybackRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._audioRender&&this._audioRender.setPlaybackRate&&this._audioRender.setPlaybackRate(t),this._videoRender&&this._videoRender.setPlaybackRate&&this._videoRender.setPlaybackRate(t)}destroy(){this._callbacks=null,this._worker&&(this._workerHolder.postClose(),this._worker.terminate(),this._worker=null),this._audioRender&&(this._audioRender.close(),this._audioRender=null),this._videoRender&&(this._videoRender.close(),this._videoRender=null)}};var io={setLogLevel:function(t){Ua.setLevel(t)},init:function(t){ka.init(t)},createIns:function(t,e){return new eo(t,e)},WebCodecsErrType:xa.d,MainSharedBufferType:xa.a};let so=0;var ro=class extends Qs{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e,D.a.PLAYER_CORE_TYPE.WEBCODECS),this._id=++so;let i=e.h265Proxy;this.h265Proxy=i;let{videoType:s="flv",videoElement:r=null,ignoreSei:a=!1,closeFetch:o=!1,continuousTimeStamp:n=!1}=e;this.lowlatencyCfg=e.lowlatencyCfg||{lowlatencyBuf:-1,lowlatencyMin:-1,lowlatencyMax:-1,lowlatencyJit:-1},this.lowlatency=-1!==this.lowlatencyCfg.lowlatencyBuf,this.pushAvcDts=0,io.init({logger:f.a,TimeUtil:y.a});let h={};this.handler&&this.handler.eventEmitter&&this.handler.eventEmitter.videoEnhance&&(h={isUseEnhance:this.handler.eventEmitter.isUseEnhance,modelRes:this.handler.eventEmitter.videoEnhance.getModelRes(),h5Root:this.handler.eventEmitter.videoEnhance.getH5Root()}),this._mediaWebcodecs=io.createIns({lowlatencyCfg:this.lowlatencyCfg,webcodecCfg:P.a.webCodecCfg,aiEnhanceCfg:h,dtsJumpOpen:P.a.dtsJumpOpen,dtsJumpThreshold:P.a.dtsJumpThreshold,isLive:this.isLive,videoElement:this.videoElement},{turnToWebcodecsSoft:this.turnToWebcodecsSoft.bind(this),onPauseByBrowser:this.onPauseByBrowser.bind(this),setUseSoftAcceleration:this.setUseSoftAcceleration.bind(this),onWebcodecsError:this.onWebcodecsError.bind(this),triggerWebcodecsPlay:this.triggerWebcodecsPlay.bind(this),triggerPlay:this.triggerPlay.bind(this),onAudioAnalyserInit:this.onAudioAnalyserInit.bind(this),onWorkerInterval:this.onWorkerInterval.bind(this),setFramePause:this.setFramePause.bind(this),setFrameRusume:this.setFrameRusume.bind(this),renderFpsPause:this.renderFpsPause.bind(this),onVideoEnhanceError:this.onVideoEnhanceError.bind(this),onVideoEnhanceSuccess:this.onVideoEnhanceSuccess.bind(this),onVideoSeekBind:this.onVideoSeek.bind(this),onVideoPlay:this.onVideoPlay.bind(this),onVideoPause:this.onVideoPause.bind(this)}),this.toDecodeVideoFrameNums=0,this.decodedVideoFrameNums=0,this.decodeNums=0,this.destroyed=!1,this.count=0,this.width=1280,this.height=720,this.playbackrateChangeAccess=!0,this.mediaDelay=null,this.seiAnchorDelay=-1,this.pushVideoStartRenderTime=0,this.offsetDts=0,this.curVideoDts=0,this.curAudioDts=0,this.playing=!1,this.pause500checked=!1,this.lastFrameTs=0,this.lastVideoDts=0,this.lastAudioDts=0,this.videoWebcodecsPauseTs=0,this.audioWebcodecsPauseTs=0,this.isVideoWebCodecsPaused=!1,this.isAudioWebCodecsPaused=!1,"ts"===s?(this.parser=new pi(this,this.remuxer),this.parser.ignoreSei=a,this.parser.closeFetch=o,this.parser.continuousTimeStamp=n):(this.parser=new We(this,this.remuxer,ae),this.parser2=new We(this,this.remuxer,oe)),this.ctrlBuffer.setBuffered(this.buffered),this.pauseHanlder=new Ia(this,{pauseFunc:this._playPause.bind(this),resumeFunc:this._playResume.bind(this)}),this.pauseWorkerHanlder=new Aa(this,{pauseFunc:this._playWorkerPause.bind(this),resumeFunc:this._playWorkerResume.bind(this)}),this.webCodecsStat=new Ra(this),i&&i.initRender&&i.initRender(this),this.isRenderStart=!1,this.onVisibilityChangedBind=this.onVisibilitychange.bind(this),this.addEvents(),this.checkQuickTime=0,this.firstGetCurrentTime=0,this.firstPerformentTime=0,this.lastToDecodeAudioTs=0,this.lastToDecodeVideoTs=0,this.startAudioFastTs=0,this.startVideoFastTs=0,this.quickTime=y.a.now(),this.userPaused=!1,this.onVideoErrorBind=this.onVideoError.bind(this),this.onVideoPauseBind=this.onVideoPause.bind(this),this.onVideoPlayBind=this.onVideoPlay.bind(this),this.onVideoPlayingBind=this.onVideoPlaying.bind(this),this.onVideoResizeBind=this.onVideoResize.bind(this),this.isWebcodecsError=!1,this.lastIFrameTs=0,this.audioBrowserPaused=!1,this.isBrowserCloseHardAcc=!1,this.isAudioMuted=!1,this.PES_TIMESCALE=9e4,this._initPTS=void 0,this._initDTS=void 0,this.seekTime=0,this.isSeek=!1,this._lastVideoTs=-1e4,this._lastAudioTs=-1e4,this.audioSampleDuration=1024e3/44100,this.videoFirstFrameDecodeCost=0,this.audioFirstFrameDecodeCost=0,this.triggerPlayType=0,this._videoEl=null}appendTs(t){this.parser.parseTs(t)}addEvents(){this.handler&&this.handler.eventEmitter&&this.handler.eventEmitter.on(a.VISIBILITY_CHANGE,this.onVisibilityChangedBind)}delEvents(){this.handler&&this.handler.eventEmitter&&this.handler.eventEmitter.off(a.VISIBILITY_CHANGE,this.onVisibilityChangedBind)}initTs(t,e,i){if(null!=this._initPTS)return;let s=t.samples,r=e.samples,a=s.length,o=r.length,n=this.PES_TIMESCALE;0===o?(this._initPTS=s[0].pts-n*i,this._initDTS=s[0].dts-n*i):0===a?(this._initPTS=r[0].pts-n*i,this._initDTS=r[0].dts-n*i):(this._initPTS=Math.min(r[0].pts,s[0].pts)-n*i,this._initDTS=Math.min(r[0].dts,s[0].dts)-n*i),f.a.log(`WebCodecsPlayer initDTS/initPTS=[${this._initDTS}, ${this._initPTS}]`),this.isSeek&&this.realSeek(this.seekTime)}getInitDts(){return this.isLive?super.getInitDts():this._initDTS/90}getCurrentTime(){const t=this.getVideoPts()-this.getInitDts();return Number.isNaN(t)?0:t}getCurrentAudioDts(){return this._mediaWebcodecs.getCurrentAudioDts()}setMuffledVolume(t){this._mediaWebcodecs.setMuffledVolume(t)}onWorkerInterval(t){this.destroyed||(t-this.quickTime>=1e3&&(this.quickTime=t,this.webCodecsStat.onCheckTimer(t)),(0==this.checkQuickTime||t-this.checkQuickTime>=2e4)&&(this.checkQuickTime=t,f.a.log(`WebCodecsPlayer(${this._id}).onCheckAudioQuickTimer aduio currentTime`,this.getCurrentAudioDts())))}setPlayMinBuffer(t){this._mediaWebcodecs.setPlayMinBuffer(t)}getBufferLen(){return this._mediaWebcodecs.getBufferLen()}getCurrentDts(){return this.getVideoPts()}getCurrentRealTime(){return this.getCurrentDts()}getCorrentCurrentDts(){return this.isPureAudio&&this.parser.timelineAudio?this.parser.timelineAudio.getCorrentDtsByCurrentTime(this.getCurrentTime()):this.parser.timelineVideo?this.parser.timelineVideo.getCorrentDtsByCurrentTime(this.getCurrentTime()):this.getCurrentTime()+this.getInitDts()}getVideoDecodeDelaySmooth(){return this._mediaWebcodecs.getDecodedVideoDelaySmooth()}triggerPlay(t,e,i){if(!this.playing){this.videoFirstFrameDecodeCost=t,this.audioFirstFrameDecodeCost=e,this.triggerPlayType="video"==i?1:2,f.a.log(`WebcodecsPlayer.triggerPlay, type=${i}, acost=${e}, vcost=${t}`);let s=this._mediaWebcodecs.getVideoElement();this.playing=!0,this.handler.onPlayVideo(s,this.widthCfg,this.heightCfg,!1,null,0,this.getCodecType()),this.isPlayVideo=!0}}triggerWebcodecsPlay(){if(this.handler._hyPlayer&&this.handler._hyPlayer.roomRecordStat&&this.handler._hyPlayer.roomRecordStat.renderCallback(),this.handler.setWebCodecsSuccess(),this.isLive&&P.a.renderStat[0]){const t=this.getVideoPts();this.videoPlayConsuming.addRenderFrameData(t,y.a.now()),this.renderFps.addRender()}}setFramePause(){this.handler.setFramePause()}setFrameRusume(){this.handler.setFrameRusume()}renderFpsPause(){1==P.a.mobVBlockCfg&&this.handler.renderFpsPause(!0)}onFastOver(){this._mediaWebcodecs.onFastOver()}onCheckTimer(t,e){if(this.playing){if(0!=this.shildAudioStartTs){let t=this.getCurrentAudioDts();this.isAudioMuted&&t>=this.shildAudioStartTs&&(f.a.log("WebCodecsPlayer.shieldAudioMute recover"),this.setMuted(!1),this.shildAudioStartTs=0)}if(super.onCheckTimer(t,e),this.parser.fps&&this.parser.fps.getNoReferFps){const t=this.parser.fps.getNoReferFps();this._mediaWebcodecs.updateVideoFPS(this.metadata.recvVideoFps,t)}}else this.parser&&this.parser.printPlayFrameInfo&&this.parser.printPlayFrameInfo()}getWebCodecsStats(){return this.webCodecsStat.getStats()}onCheckFastTimer(t,e){if(super.onCheckFastTimer(t,e),this.playing&&!this.userPaused){if(this.pauseHanlder.check(t),!this.pause500checked&&this.pauseHanlder.paused&&t-this.pauseHanlder.pausedTs>500){this.pause500checked=!0;const t=this.getBufferLen();f.a.log(`WebCodecsPlayer(${this._id}).onCheckFastTimer: play paused buf=${t}`)}this.isLive&&this.checkPause5Sec(t)}}onCheckFastWorkerTimer(t){super.onCheckFastWorkerTimer(t),this.playing&&!this.userPaused&&(this.pauseWorkerHanlder.check(t),this._mediaWebcodecs.storeMainShieldAudio(this.isShieldAudio?1:0),this._mediaWebcodecs.storeFrameBuffer(this.getFrameBufferLen()))}checkPause5Sec(t){let e=this.getCurrentDts(),i=this.getCurrentAudioDts(),s=!1,r=!1;0!=e&&0!=this.lastVideoDts&&e==this.lastVideoDts?this.isVideoWebCodecsPaused||(this.videoWebcodecsPauseTs=t,this.isVideoWebCodecsPaused=!0):(this.videoWebcodecsPauseTs=0,this.isVideoWebCodecsPaused=!1),0!=i&&0!=this.lastAudioDts&&i==this.lastAudioDts?this.isAudioWebCodecsPaused||(this.audioWebcodecsPauseTs=t,this.isAudioWebCodecsPaused=!0):(this.audioWebcodecsPauseTs=0,this.isAudioWebCodecsPaused=!1),0!=this.videoWebcodecsPauseTs&&t-this.videoWebcodecsPauseTs>=5e3&&(s=!0),0!=this.audioWebcodecsPauseTs&&t-this.audioWebcodecsPauseTs>=5e3&&(r=!0),s?f.a.warn("WebCodecsPlayer.onCheckTimer video paused 5 sec."):r&&f.a.warn("WebCodecsPlayer.onCheckTimer audio paused 5 sec."),(s||r)&&(this._onErrorEvent(3),this._onPlayerError(!0)),this.lastVideoDts=e,this.lastAudioDts=i}onWebcodecsError(t,e){if(this.isWebcodecsError)return;this.isWebcodecsError=!0,f.a.log("WebCodecsPlayer.onWebcodecsError, type="+t);let i=[t];e&&i.push(e),this.handler&&this.handler.onActWebCodecs&&this.handler.onActWebCodecs([22],i),this.turnToMse(t)}turnToMse(t){if(this.handler&&this.handler._hyPlayer){if(t===io.WebCodecsErrType.VIDEODECODEERROR)this.autoReport(),this.handler._hyPlayer.webcodecsErrCount++,this.handler.decoderDecodeError();else if(t===io.WebCodecsErrType.AUDIODECODEERROR)this.autoReport(),this.handler._hyPlayer.webcodecsErrCount++;else if(t===io.WebCodecsErrType.VIDEOFAST)this.handler._hyPlayer.webcodecsErrCount++;else if(t===io.WebCodecsErrType.AUDIOFAST)this.handler._hyPlayer.webcodecsErrCount++;else{if(t!==io.WebCodecsErrType.WORKERERROR)return this.handler._hyPlayer&&(this.handler._hyPlayer.turnMseType=t),t===io.WebCodecsErrType.DECODE_COST?localStorage.nextWcsTime=Date.now()+2592e5:t===io.WebCodecsErrType.DECODE_DTS&&(localStorage.nextWcsTime=Number.MAX_SAFE_INTEGER),void this.handler.turnToMse();this.handler._hyPlayer.webcodecsErrCount++}this.handler._hyPlayer&&this.handler._hyPlayer.webcodecsErrCount>=3?(this.handler._hyPlayer.turnMseType=io.WebCodecsErrType.RETRY_MAX_TIMES,this.handler.turnToMse()):this.handler.webcodecsRetry()}}initAv1M4sTs(t,e,i){if(null!=this._initPTS)return;let s=this.PES_TIMESCALE;this._initPTS=Math.min(t.pts,e.pts)-s*i,this._initDTS=Math.min(t.dts,e.dts)-s*i,f.a.log(`WebCodecsPlayer.initAv1M4sTs initDTS/initPTS=[${this._initDTS}, ${this._initPTS}]`),this.isSeek&&this.realSeek(this.seekTime)}setVodAv1(){this._mediaWebcodecs&&this._mediaWebcodecs.setVodAv1&&this._mediaWebcodecs.setVodAv1()}remuxAv1(t,e){const i=t.sidxAudio.time_scale,s=t.moof.trafAudio.tfdt.base_media_decode_time,r=t.moof.trafAudio.tfhd.default_sample_duration,a=t.moof.trafAudio.trun.samples,o=1e3*s/i,n=t.sidxVideo.time_scale,h=t.moof.trafVideo.tfdt.base_media_decode_time,d=t.moof.trafVideo.tfhd.default_sample_duration,l=t.moof.trafVideo.trun.samples,u=1e3*h/n;let c=1024e3/i;c<this.audioSampleDuration-1&&(c=this.audioSampleDuration);let p=1e3*d/n;this.audioSampleNums=0,this.videoSampleNums=0,this.audioNewSamples=[],this.videoNewSamples=[];const m=1e3*r/i;m<20&&f.a.log("WebCodecsPlayer.remuxAv1 audio sampleDuration",m),a.map((t,e)=>{if(!t.units)return;const i=Math.floor(o+e*c),s=90*i;let r={type:"aac",empty:0,sampleDuration:c,pts:s,dts:s,ts:i,unit:t.units};this.audioNewSamples.push(r)}),l.map((t,e)=>{if(!t.units)return;this.videoSampleNums++;const i=Math.floor(u+e*p),s=90*i;let r={pts:s,dts:s,ts:i,cts:0,key:0==e,data:t.units};this.videoNewSamples.push(r)}),this.audioNewSamples.length>0&&this.videoNewSamples.length>0&&this.initAv1M4sTs(this.audioNewSamples[0],this.videoNewSamples[0],e.timeOffset),this.audioNewSamples.forEach(t=>{this._appendAudioSample(t)}),this.videoNewSamples.forEach(t=>{this._appendAv1VideoSample(t)})}updateAVCConfig(t){this._mediaWebcodecs.updateAVCConfig(t),this._addResizeEvt()}_addResizeEvt(){if(this._delResizeEvt(),this._mediaWebcodecs){let t=this._mediaWebcodecs.getVideoElement();this._videoEl!==t&&(t.addEventListener("resize",this.onVideoResizeBind),this._videoEl=t)}}_delResizeEvt(){this._videoEl&&(this._videoEl.removeEventListener("resize",this.onVideoResizeBind),this._videoEl=null)}getVideoWidth(){return this._videoEl?this._videoEl.videoWidth:0}getVideoHeight(){return this._videoEl?this._videoEl.videoHeight:0}updateAudioConfig(t,e,i){(e||this.audioConfig&&t.audioConfig&&this.audioConfig.toString(16)!==t.audioConfig.toString(16))&&this._mediaWebcodecs&&this._mediaWebcodecs.updateAudioConfig(t),super.updateAudioConfig(t,e,i)}updateM4sAudioConfig(t){this._mediaWebcodecs&&this._mediaWebcodecs.updateAudioConfig(t)}updateAVCPPS(t,e){this._mediaWebcodecs.updateAVCPPS(t,e)}updateAVCSPS(t,e){this._mediaWebcodecs.updateAVCSPS(t,e)}updateAVCVPS(t,e){this._mediaWebcodecs.updateAVCVPS(t,e)}pushAvcSample(t){this._mediaWebcodecs&&this._mediaWebcodecs.storeRecvVideoTs&&this._mediaWebcodecs.storeRecvVideoTs(t.ts),this.lowlatency?(this.pushAvcDts=t.ts,this._appendVideoSample(t)):super.pushAvcSample(t)}pushAacSample(t,e){this.lowlatency?this._appendAudioSample(t):super.pushAacSample(t,e)}appendAvcTrack(t){t.samples.map(t=>{t&&this._appendVideoSample(t)}),t.samples.length=0}_appendVideoSample(t){if(this.isLive){const e=y.a.now();this.videoPlayConsuming.pushRemuxedVideoFrameData(e),this.videoPlayConsuming.addRemuxFrameData(t.ts,t.ts+t.cts,e)}this._mediaWebcodecs.appendVideoSample(t)}_appendAv1VideoSample(t){if(-1e4!=this._lastVideoTs){const e=t.ts-this._lastVideoTs;e>=200&&f.a.log("WebCodecsPlayer._appendAv1VideoSample ts delta=",e,t.ts,this._lastVideoTs)}if(this.isLive){const e=y.a.now();this.videoPlayConsuming.pushRemuxedVideoFrameData(e),this.videoPlayConsuming.addRemuxFrameData(t.ts,t.ts+t.cts,e)}this._lastVideoTs=t.ts,this._mediaWebcodecs.appendAv1VideoSample(t)}_initSegmentSuc(t){this._mediaWebcodecs&&this._mediaWebcodecs.initSegmentSuc(t)}appendAacSample(t){t.samples.map(t=>{t&&this._appendAudioSample(t)}),t.samples.length=0}_appendAudioSample(t){if(t&&t.ts){if(-1e4!=this._lastAudioTs){const e=t.ts-this._lastAudioTs;e>=200&&f.a.log("WebCodecsPlayer._appendAudioSample ts delta=",e,t.ts,this._lastAudioTs)}if(this._lastAudioTs=t.ts,this.isLive){const e=y.a.now();this.audioPlayConsuming.addRemuxFrameData(t.ts,t.ts,e),this.audioPlayConsuming.pushRemuxedVideoFrameData(e)}this._mediaWebcodecs.appendAudioSample(t)}}onVisibilitychange(){super.onVisibilitychange(),this._mediaWebcodecs.onVisibilitychange(),"hidden"==document.visibilityState?this.isBrowserHidden=!0:"visible"==document.visibilityState&&(this.isBrowserHidden=!1)}containerResize(t){this._mediaWebcodecs.containerResize(t)}getVideoPts(){if(P.a.dtsJumpOpen){if(this.isPureAudio&&this.parser.timelineAudio)return this.parser.timelineAudio.getRealDtsByPts(this._mediaWebcodecs.getVideoPts());if(this.parser.timelineVideo)return this.parser.timelineVideo.getRealDtsByPts(this._mediaWebcodecs.getVideoPts())}return this._mediaWebcodecs.getVideoPts()}reset(){super.reset()}destroy(){super.destroy(),this._delResizeEvt(),this._mediaWebcodecs.destroy(),this.destroyed=!0,this.isRenderStart=!1,this.playing=!1,this.pause500checked=!1,this.buffered.stop(),this.parser.destroy(),this.pauseStat.reset(),this.pauseHanlder.reset(),this.renderFps.reset(),qi(this.rafId),this.startAudioFastTs=0,this.startVideoFastTs=0,this.userPaused=!1,this.quickTime=0,this.delEvents(),this.lastVideoDts=0,this.lastAudioDts=0,this.videoWebcodecsPauseTs=0,this.audioWebcodecsPauseTs=0,this.isVideoWebCodecsPaused=!1,this.isAudioWebCodecsPaused=!1,this.isWebcodecsError=!1,this.lastIFrameTs=0,this.webCodecsStat.destroy(),this.isBrowserCloseHardAcc=!1,this.isAudioMuted=!1}_playPause(t){this.pauseStat.pause();const e=this.getVideoPts()>0;this.handler.onPlayPause(t,e)}_playResume(t,e){this.pauseStat.resume(),this.pause500checked=!1;const i=this.getVideoPts()>0;this.handler.onPlayResume(t,i)}_playWorkerPause(t){const e=this.getVideoPts()>0;this.handler.onPlayPauseWorker&&this.handler.onPlayPauseWorker(t,e)}_playWorkerResume(t,e){const i=this.getVideoPts()>0;this.handler.onPlayResumeWorker&&this.handler.onPlayResumeWorker(t,i)}check500Pause(){this.handler.check500Pause&&this.handler.check500Pause()}getDecodeFps(){return this._mediaWebcodecs.getDecodeFps()}getVideoRenderFps(){return this._mediaWebcodecs.getVideoRenderFps()}getAudioRenderFps(){return this._mediaWebcodecs.getAudioRenderFps()}getVideoThrowFps(){return this._mediaWebcodecs.getVideoThrowFps()}getDecodedBuffer(){return this._mediaWebcodecs.getDecodedBuffer()}getDiscardVideoFrames(){return this._mediaWebcodecs.getDiscardVideoFrames()}getEnhanceVideoFrames(){return this._mediaWebcodecs.getEnhanceVideoFrames&&this._mediaWebcodecs.getEnhanceVideoFrames()}setJitter(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;super.setJitter(t,e,i),this._mediaWebcodecs.setJitter(t,e,i,P.a.jumpBufferCfg,P.a.shieldAudioCfg[1],P.a.jumpBufferCfg2[0])}onVideoPause(t){f.a.log("WebCodecsPlayer.onVideoPause"),this.userPaused=!0}onVideoPlaying(){if(this.handler&&this.handler.updateStatus){if(this._mediaWebcodecs.isAudioSuspended())return;const t=h;this.handler.updateStatus(t)}}turnToWebcodecsSoft(){this.handler.turnToWebcodecsSoft()}onPauseByBrowser(){this.isBrowserPause||(this.isBrowserPause=!0,f.a.log("WebCodecsPlayer.onPauseByBrowser"),this.userPaused=!0,this._mediaWebcodecs.onVideoPause(),this.handler&&(this.handler.onPauseByBrowser&&this.handler.onPauseByBrowser(),this.handler.updateStatus&&this.handler.updateStatus(u),this.handler.eventEmitter&&this.handler.eventEmitter.trigger(a.BROWSER_PAUSE,{})))}onAudioPauseByBrowser(){this.audioBrowserPaused=!0}onVideoPlay(t){f.a.log("WebCodecsPlayer.onVideoPlay"),this.userPaused=!1,this.audioBrowserPaused=!1}onVideoError(t){let e="",i=this._mediaWebcodecs.getAudioError();if(i){let t=i.code;e=" errCode="+t+" "+["Unknow","用户终止","网络错误","解码错误","格式不支持"][t],3!=t&&4!=t||(this._onErrorEvent(3==t?1:2),this._onPlayerError(!0))}f.a.warn("WebCodecsPlayer.onVideoError"+e)}_onPlayerError(t){!this.isPlayerError&&this.handler&&(this.isPlayerError=!0,this.handler.onPlayerError(t))}_onErrorEvent(t){this.isErrorEvent||(this.isErrorEvent=!0,this.handler&&this.handler.onErrorEvent&&this.handler.onErrorEvent({type:t}))}pause(){f.a.info("WebCodecsPlayer.pause"),this.userPaused=!0,this._mediaWebcodecs.userPause()}play(){f.a.info("WebCodecsPlayer.play"),this.userPaused=!1,this._mediaWebcodecs.userPlay()}setUseSoftAcceleration(){this._mediaWebcodecs.setUseSoftAcceleration(),this.handler.setUseSoftAcceleration(!0)}setPauseVideoDecode(t){this._mediaWebcodecs.setPauseVideoDecode(t)}setPauseAudioDecode(t){this._mediaWebcodecs.setPauseVideoDecode(t)}disableHardAcc(){super.disableHardAcc(),this.onWebcodecsError(io.WebCodecsErrType.DISABLE_HARDWARE_ACCELERATION)}win7PerfInsufficient(){this.onWebcodecsError(io.WebCodecsErrType.WIN_PERF_INSUFFICIENT)}angelNullError(){this.onWebcodecsError(io.WebCodecsErrType.ANGLE_NULL)}chromeH265RenderEmptyError(){this.isH265Mode&&(localStorage.isChromeH265RenderInfoEmpty=1,this.onWebcodecsError(io.WebCodecsErrType.CHROME_H265_RENDER_INFO_EMPTY))}isNotSupportWebcodecsConfig(){this.onWebcodecsError(io.WebCodecsErrType.IS_NOT_SUPPORT_CONFIGURE)}setEnableDiscard(t){this._mediaWebcodecs.setEnableDiscard(t)}updateCurBitrate(t){this._mediaWebcodecs.updateCurBitrate(t)}setDisableHardAcc(){this.isBrowserCloseHardAcc=!0}autoReport(){qe.a.name.indexOf("chrome")>-1&&this.isH265Mode&&1e3*Math.random()<=100&&1==P.a.isAutoWcsReport&&this.handler.eventEmitter&&this.handler.eventEmitter.trigger(a.P2P_REPORT)}setRealFps(t){this._mediaWebcodecs.setRealFps(t)}startMuteRender(t){this._mediaWebcodecs.startMuteRender(t)}setMuted(t){this.isAudioMuted=t,this._mediaWebcodecs.setMuted(t)}on265StartCodeError(){this.h265Proxy&&this.h265Proxy.on265StartCodeError()}turnToH264(t){this.h265Proxy&&this.h265Proxy.stop(),this.handler&&this.handler.turnToH264(t)}setEnhance(t){this._mediaWebcodecs.setEnhance&&this._mediaWebcodecs.setEnhance(t)}setSegmenttion(t){this._mediaWebcodecs.setSegmenttion&&this._mediaWebcodecs.setSegmenttion(t)}onVideoEnhanceError(t){this.handler&&this.handler&&this.handler.onVideoEnhanceError(t)}onVideoEnhanceSuccess(){this.handler&&this.handler&&this.handler.onVideoEnhanceSuccess()}getRenderElement(){return this._mediaWebcodecs&&this._mediaWebcodecs.getVideoElement()}onRevFastOver(){this._mediaWebcodecs.onRevFastOver()}onVideoSeek(t){f.a.log("WebcodecsPlayer.onVideoSeek",t),this.handler&&this.handler.onVideoSeek&&this.handler.onVideoSeek(t)}seek(t){null==this._initPTS?(this.isSeek=!0,this.seekTime=t):this.realSeek(t)}realSeek(t){const e=this.getInitDts();f.a.log(`WebcodecsPlayer.realSeek, seekTime=${t}, initDts=${e}`),this._mediaWebcodecs&&this._mediaWebcodecs.seek&&this._mediaWebcodecs.seek(t,e),this.isSeek=!1}setPlaybackRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;f.a.log("WebcodecsPlayer.setPlaybackRate",t),this._mediaWebcodecs&&this._mediaWebcodecs.setPlaybackRate&&this._mediaWebcodecs.setPlaybackRate(t)}};const ao=1,oo=2;var no=class{constructor(t,e){let{stat:i,statVod:s,tsdb:r,videoElement:a,h265Proxy:n}=e;this.playerCoreType=e.playerCoreType,this.isSoftSolution=e.isSoftSolution,this.isPureAudio=!!e.isPureAudio,this.isPureVideo=!!e.isPureVideo,this.config={autoStartLoad:!0,maxBufferLength:30,minBufferLength:15,secondBufferLength:20,fragLoadingTimeOut:5e3,fragLoadingMaxRetry:a?3:1,fragLoadingRetryDelay:1e3,listLoadingTimeOut:a?15e3:8e3,listLoadingMaxRetry:a?0:3,listLoadingRetryDelay:1e3,appendErrorMaxRetry:200,minFragBufferNum:3,autoReconnect:!0,firstFragLoadTimeout:15e3},this.eventEmitter=t,this._hyPlayer=t,this.stat=i,this.statVod=s,this.tsdb=r,this.h265Proxy=n,this.statSwitch=e.statSwitch,this.isLive=!1,this.liveType=0,this.url=null,this.cdnName=null,this.seekTime=0,this.playlist=null,this.mse=null,this.m4sInitcb=this.onM4sInit.bind(this),this.m4sInitOpenCb=this.onM4sInitOpen.bind(this),this.onFirstBufCb=this.onFirstBuf.bind(this),this.userPaused=!1,this.targetDuration=0,this.isLoading=!1,this.fragStartTs=0,this.fragOpenTs=0,this.fragSize=0,this.startTs=0,this.pauseTs=0,this.pauseCnt=0,this.playTs=0,this.started=!1,this.isTryAgain=!1,this.fragLoader=null,this.tryTimer=null,this.hasVideo=!1,this.playStat=new pr(this),this.hlsSeek=new Sr(this),this.firstPlay=!0,this.firstFragLoadTs=0,this.firstFragLoadedTs=0,this.firstFragSize=0,this.videoStatus=o,this.flvLoadTimeSended=!1,this.sOrigUrl="",this.curAppendFrag=null,this.seeking=!1,this.skipStatForSeek=!1,this.playTriggered=!1;let{clz:h,type:d}=(()=>{let t=P.a.hlsUseFetch>Math.floor(100*Math.random())&&rr.isSupported(),{FETCH:e,XHR:i}=D.a.HLS_LOAD_TYPE;return"safari"===qe.a.name&&(t=!1),{clz:t?rr:T,type:t?e:i}})();this._loaderClz=h,this._loaderType=d,this.videoElement=a,this.loadHlsStatus=D.a.LoadVideoTimeoutReason.HLS_DISCONNECTED,this.needReset=!1,this.resetPlayTs=0,this.lastPlayTs=0,this.pauseInBufferFullTimes=0,this.sendPauseTimeout=0,this.businessStartCost=0,this.startTimeStamp=0,this.loadStartTs=0,this.anticode=new Ea,this.isSwitchSeamLessLine=!1,this.pausedByBrowser=!1,this._nextRefreshTime=Number.MAX_SAFE_INTEGER,this._pcdnFragStartTs=0,this._cdnFragStartTs=0,this.firstTsInfo=null,this._getPcdnDataTime=0,this._getCdnDataTime=0,this.forceUseCdn=!1,this.coolLoadFragment=!1,this.vodAbSwitch=!1,this.pcdnRepeatByteLen=0,this.lastSN=-1,this.errorPcdnSN=-1,this.needStatPcdnRepeatBW=!1,this.tsFileSize=0,this.heartTsStartTime=0,this.heartTsEndTime=0,this.videoLoadTimeSent=!1,this.videoLoadTime=0,this.loadM3u8Time=0,this.firstFragLoadTime=0,this.firstFragLoadedTime=0,this.firstFragParsedTime=0,this.uiLoadTime=0,this.businessLoadTime=0,this.firstTsHttpCode=0,this.avgSpeed=new bt(20),this.exceptionStat=new va(this),this.realStartBind=this.realStart.bind(this),this._clickEventBind=this._clickEvent.bind(this),this.refreshAnticodeBind=this.refreshAnticode.bind(this),this._sendVideoLoadTimeBind=this._sendVideoLoadTime.bind(this),this._sendVideoLoadTimer=null,this.anticode.on(Ea.Events.REFRESH,this.refreshAnticodeBind),this.playerType=ge,this.seekBeforeTime=0,this.endTs=0,this.nowEndTs=0,this.blockHelper=new dr,this.blockHelper.setHlsPlayer(this),wt.setHlsPlayer(this),this.vodSecHelper=new Da,this.codecType=ye,this.isAv1State=!1,this.stopLoadFragment=!1,this.playBackRate=1,this.continuousTimeStamp=!1}selectXhrLoader(){this._loaderClz=T,this._loaderType=D.a.HLS_LOAD_TYPE.XHR}selectFetchLoader(){this._loaderClz=rr,this._loaderType=D.a.HLS_LOAD_TYPE.FETCH}getSpeed(){let t=this.avgSpeed.average();return t===R.b.UintMax?0:t}destroy(){f.a.log("HlsPlayer.destroy"),this.started=!1,this.removeTimer(),this.tryTimer&&(clearTimeout(this.tryTimer),this.tryTimer=null),this.mse&&(this.mse.destroy(),this.mse=null),this.playlist&&(this.playlist.destroy(),this.playlist=null),this.releaseLoader(),this.isSwitchSeamLessLine=!1}reset(){f.a.log("HlsPlayer.reset"),this.exceptionStat.reset(),this.avgSpeed.reset(),this.removeTimer(),this.isLive=null,this.liveType=0,this.url=null,this.cdnName=null,this.seekTime=0,this.targetDuration=0,this.isLoading=!1,this.startTs=0,this.pauseTs=0,this.pauseCnt=0,this.playTs=0,this.hasVideo=!1,this.started=!1,this.userPaused=!1,this.isTryAgain=!1,this.playStat.stop(),this.firstFragLoadTs=0,this.firstFragLoadedTs=0,this.firstFragSize=0,this.curAppendFrag=null,this.seeking=!1,this.skipStatForSeek=!1,this.firstPlay=!0,this.playTriggered=!1,this.stat.clearFill(),this.statVod.clearFill(),this.isSwitchSeamLessLine=!1,this.pausedByBrowser=!1,this.sOrigUrl="",this._pcdnFragStartTs=0,this._cdnFragStartTs=0,this.firstTsInfo=null,this._getPcdnDataTime=0,this._getCdnDataTime=0,this.forceUseCdn=!1,this.coolLoadFragment=!1,this.vodAbSwitch=!1,this.pcdnRepeatByteLen=0,this.lastSN=-1,this.errorPcdnSN=-1,this.needStatPcdnRepeatBW=!1,this.seekBeforeTime=0,this.isSeekBefore=!1,this.tsFileSize=0,this.heartTsStartTime=0,this.heartTsEndTime=0,this.firstTsHttpCode=0,this.endTs=0,this.nowEndTs=0,this.isAv1State=!1,this.stopLoadFragment=!1}resetMediasource(){this.resetPlayTs=0,this.needReset=!0}reloadInError(){if(this.isLive){let t=this.playlist.currFrag;t&&(this.releaseLoader(),this.destroyMse(),this.mse=this.createMse(),this.isLoading=!1,f.a.log("HlsPlayer.reloadInError, seek"),this.seek(t.start+.5))}else if(this.info){const t=this.getCurrentTime();this.info.seekTime=t+1,this.start(this.info)}}destroyMse(){this.mse&&(this.mse.destroy(),this.mse=null)}createMse(){let t={isLive:this.isLive,videoType:"ts",videoElement:this.videoElement,h265Proxy:this.h265Proxy,ignoreSei:this.ignoreSei,closeFetch:this.closeFetch,continuousTimeStamp:this.continuousTimeStamp,isPureAudio:this.isPureAudio,isPureVideo:this.isPureVideo};if(1==localStorage._isPureAudio&&(t.isPureAudio=!0),1==localStorage._isPureVideo&&(t.isPureVideo=!0),this.playerCoreType==D.a.PLAYER_CORE_TYPE.WEBCODECS){let t=localStorage.hasOwnProperty("_minBuffer")?Number(localStorage._minBuffer):3e3;const e=new ro(this,{videoType:"ts",isLive:this.isLive,isPureAudio:this.isPureAudio,isPureVideo:this.isPureVideo,h265Proxy:this.h265Proxy,videoElement:this.videoElement,isH265Mode:this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec,lowlatencyCfg:{lowlatencyBuf:-1,lowlatencyMin:t+500,lowlatencyMax:t+1e3,openRenderSync:1}});return this.isAv1State&&e.setVodAv1&&e.setVodAv1(),e}{let e=new sr(this,t);return e.onInitSegmentCb=this.onFirstBuf.bind(this),e.m4sPlayer.onFirstBufCb=this.onFirstBufCb,e}}releaseLoader(){this.fragLoader&&(this.fragLoader.destroy(),this.fragLoader=null)}removeTimer(){q.remove(this.onCheckTimer,this),q.remove(this.onCheckFastTimer,this),q.remove(this.onCheckIfCanPCDN,this)}setConfig(t,e){}setVodPcdnConfig(t){const e=t.vid||R.b.getQueryString("vid",t.url),i=t.presenterUid;P.a.setVodPcdnConfig({vid:e,anchoruid:i,useVodPcdnAbCfg:this.vodAbSwitch}),f.a.log(`vodPcdnOpenBuffer=${P.a.vodPcdnOpenBuffer}, vodPcdnCloseBuffer=${P.a.vodPcdnCloseBuffer}, vodPcdnCoolTime=${P.a.vodPcdnCoolTime}`)}start(t){this.stop(),1==localStorage.continuousTimeStamp&&(t.continuousTimeStamp=!0),this.continuousTimeStamp=!!t.continuousTimeStamp;let e=this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec;this.stat.setComDim(L.a.DIM_COM.H265,e?1:0),this.stat.setComDim(L.a.DIM_COM.P2P,L.a.LIVE_TYPE.HLS),this.stat.setComDim(L.a.DIM_COM.STREAM_TYPE,mr),t.isLive&&(Lt.bindEvent(this.tsdb,t._sessionId,t.lineType,t.sDisplayName,t.iBitRate),this.statSwitch&&this.statSwitch.check(t,!1)),this.checkParams(t,this.realStartBind)}checkParams(t,e){if(f.a.log("HlsPlayer.checkParams",JSON.stringify(t),t),!t.isLive){this.vodAbSwitch=R.b.getSdkAbRandom(t,P.a.vodAbSwitch);const e=this.vodAbSwitch?ao:oo;this.stat.setComDim(L.a.VOD_DIM_COM.VOD_AB_SWITCH,e),this.statVod.setComDim(L.a.VOD_DIM_COM.VOD_AB_SWITCH,e),f.a.log("%cVOD_AB_SWITCH = "+e,"color:#A23400;background:#FFF5C2"),this.setVodPcdnConfig(t)}this.started=!0,t.isLive&&t.sHlsUrl&&t.sStreamName?(t.sHlsUrl=t.sHlsUrl.replace("http://","https://"),t.sHlsAntiCode?(this.anticode.init(t.sHlsUrl,t.sStreamName,t.sHlsAntiCode),this.anticode.valid().then(()=>{e(t)})):e(t)):t.url?e(t):f.a.warn("HlsPlayer.checkParams has no params(sHlsUrl,sStreamName,url)"),this.h265Proxy&&this.h265Proxy.onStarted&&this.h265Proxy.onStarted()}initInfo(t){let e=this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec;this.info=t;let i=t.url;1==t._av1State?i=t.av1Url:e&&(i=t.h265Url),t.sHlsUrl&&t.sStreamName&&(i=t.sHlsUrl+"/"+t.sStreamName+".m3u8"),i=this.replaceProtocl(i),this.sOrigUrl=i;let s=[];return this.anticode.hasAnticode()&&s.push(this.anticode.getAnticode()),t.iBitRate>0&&s.push("ratio="+t.iBitRate),s.length>0&&(i+=(-1!==i.indexOf("?")?"&":"?")+s.join("&")),this.lineType=t.lineType,this.liveType=t.liveType,i}realStart(t){let e=this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec;if(this.isAv1State=1==t._av1State,this.isH265=e,!this.started)return;this.url=this.initInfo(t),this.h265Proxy.isLive=!!t.isLive,this.h265Proxy.isH265Stream=!1,1==t._av1State?this.firstTsInfo=t.tsAv1Info:e?(this.firstTsInfo=t.tsH265Info,this.h265Proxy.isH265Stream=!0):this.firstTsInfo=t.tsInfo,this.firstTsInfo&&(this.firstTsInfo.sn=1e3);let i=(new Date).getTime();if(this.businessStartCost=0,this.UIStartCost=0,this.loadStartTs=0,this.startTimeStamp=Number(t.startTimeStamp)||0,t.noNeedSendVideoLoadTime?this.noNeedSendVideoLoadTime=!0:(this.businessStartCost=t.startTimeStamp?Math.floor(i-t.startTimeStamp):0,this.noNeedSendVideoLoadTime=!1),t.uistartTs&&t.uistartTs>0&&(this.UIStartCost=Math.floor(i-t.uistartTs)),f.a.log("HlsPlayer.start startTimeStamp="+t.startTimeStamp,"uistartTs="+t.uistartTs,"businessStartCost="+this.businessStartCost,"UIStartCost="+this.UIStartCost,"now="+i,"uistartTs="+t.uistartTs),!this.url)return void f.a.warn("HlsPlayer.start invalid argument, pls check the url.");this.loadHlsStatus=D.a.LoadVideoTimeoutReason.HLS_DISCONNECTED,this.isLive=t.isLive,this.closeFetch=Boolean(t.closeFetch),this.ignoreSei=Boolean(t.ignoreSei),this.cdnName=t.cdnName,this.liveType=t.liveType,this.closeFetch&&this.selectXhrLoader(),f.a.log(`HlsPlayer.start isLive=${this.isLive} url=${this.url}`),this.playlist=new Vt(this),this.playlist.setOrigUrl(this.url),this.destroyMse(),this.mse=this.createMse(),this.setPlaybackRate(this.playBackRate);let s=1;this.playerCoreType===D.a.PLAYER_CORE_TYPE.WEBCODECS&&(s=this.isSoftSolution?3:2),this.stat.setComDim(L.a.DIM_COM.MSE_PLAYER,s),this.isLive||this.statVod.setComDim(L.a.VOD_DIM_COM.MSE_PLAYER,s),this.playerCoreType===D.a.PLAYER_CORE_TYPE.WEBCODECS&&this.isSoftSolution&&this.mse.setUseSoftAcceleration(),-1!==this.url.indexOf("hyscence=vodadv")&&this.mse.setMuted(!0);const r=t.seekTime||this.seekTime;if(this.firstTsInfo&&r&&(this.firstTsInfo.tsDuration?r<=this.firstTsInfo.tsDuration?this.firstTsInfo.seeking=!0:r>this.firstTsInfo.tsDuration&&(this.firstTsInfo=null):this.firstTsInfo=null),this.startTs=y.a.now(),this.vodSecHelper.setStart(),this.updateStatus(n),this.firstTsInfo&&this.playlist.loadFirstFragment(this.firstTsInfo),this.playlist.loadManifest(this.url),Ca.setCdnDomain(this.stat,this.url,this.info.sStreamName),Ca.setVodCdnDomain(this.statVod,this.url),this.seek(t.seekTime||this.seekTime),this.playStat.start(),this.stat.setComDim(L.a.DIM_COM.STREAM_URL,this.url),this.stat.setComDim(L.a.DIM_COM.HLS_TYPE,t.isLhls?gr:_r),this.stat.setComDim(L.a.DIM_COM.V_DECODEC,1==t._av1State?2:e?1:0),this.statVod.setComDim(L.a.DIM_COM.STREAM_URL,this.url),this.statVod.setComDim(L.a.DIM_COM.STREAM_TYPE,mr),this.statVod.setComDim(L.a.DIM_COM.V_DECODEC,1==t._av1State?2:e?1:0),this.eventEmitter&&this.eventEmitter.roomRecordStat&&this.eventEmitter.roomRecordStat.startStream(t.presenterUid,t.lineType,t.curBitrate,e?"h265":"h264","hls"),e&&this.tsdb.sendMetrics([this.stat.createAct(L.a.ACT.H265_STATUS,{value:[0],str:[0]})]),!this.isLive){let i=t.vid||R.b.getQueryString("vid",this.url);this.stat.setComDim(L.a.VOD_DIM_COM.VOD_VIDEOSOURCEID,i||""),this.stat.setComDim(L.a.DIM_COM.CODERATE_BPS,1e3*(t.curBitrate||t.coderate)),this.stat.setComDim(L.a.DIM_COM.ANCHOR_UID,t.presenterUid||0),this.stat.setComDim(L.a.VOD_DIM_COM.VOD_DURATION,t.duration||0),this.statVod.setComDim(L.a.VOD_DIM_COM.VOD_CODERATE,t.curBitrate||t.coderate),this.statVod.setComDim(L.a.VOD_DIM_COM.VOD_VIDEOSOURCEID,i||""),this.statVod.setComDim(L.a.VOD_DIM_COM.VODANCHORID,t.presenterUid||0),this.statVod.setComDim(L.a.DIM_COM.H265,e?1:0),this.statVod.setComDim(L.a.VOD_DIM_COM.VOD_DURATION,t.duration||0)}this.isNotSupportWebcodecsConfigure()}onInitSegment(){let t=this.mse.getIsMseHevc()?1:0;this.stat.setComDim(L.a.DIM_COM.H265,t),this.statVod.setComDim(L.a.DIM_COM.H265,t)}onM3u8ContentError(){this.playlist.loadManifest(this.url)}refreshAnticode(){this.url=this.initInfo(this.info),this.playlist.refreshManifsetUrl(this.url)}setVideoPlayTimeSended(){this.flvLoadTimeSended=!0}setLoadStatus(t){if(this.loadHlsStatus!==t){if(t===D.a.LoadVideoTimeoutReason.HLS_LOADMANIFEST_SUCCESS){this.exceptionStat.setStat(L.a.DIM_LINK_STA.CONNECT_SUC,1);const t=this.playlist.manifestLoadedTs-this.startTs;this.tsdb.sendM3u8LoadedTime(this._loaderType,t),this.tsdb.sendVodM3u8LoadedTime(this._loaderType,t)}this.loadHlsStatus=t}}sendLoadVideoErrorStatus(){this.tsdb.sendMetrics([this.stat.createAct(hr.METRIC.VIDEO_VIDEO_LOAD_ERROR,{value:[this.loadHlsStatus]})])}getPlayVideo(){return this.mse.getPlayVideo()}stop(){this.started&&(f.a.log("HlsPlayer.stop"),this.playTriggered&&this.playStat.report(!0),this.destroy(),this.reset())}seek(t){if(this.isLive||null==t)return;if(this.playerCoreType==D.a.PLAYER_CORE_TYPE.MSE&&this.mse&&this.mse.getPlayVideo){const e=this.mse.getPlayVideo();if(e&&"number"==typeof t){const i=e.currentTime;this.seekBeforeTime=i,this.isSeekBefore=t<i}}this.h265Proxy&&this.h265Proxy.seek&&this.h265Proxy.seek(t);let e=!1;if(this.playerCoreType==D.a.PLAYER_CORE_TYPE.MSE){const i=this.mse&&this.mse.video&&this.mse.video.video;i&&i.buffered.length>0&&i.buffered.start(0)>1&&i.currentTime>0&&1*t==0&&(f.a.log("%cHlsPlayer.seek first buffered fixed","color:#A23400;background:#FFF5C2"),this.releaseLoader(),this.destroyMse(),this.mse=this.createMse(),this.isLoading=!1,e=!0)}this.pauseTs=0,this.endTs=0,this.nowEndTs=0,this.seeking=!0,this.skipStatForSeek=!0,this.seekTime=t,this.hlsSeek.seek(0);const i=this.getCurrentTime();if(f.a.log(`HlsPlayer.seek curTime=${i}, seekTime=${t}`),0==t){if(this.firstPlay=!1,!this.mse)return;if(this.playerCoreType==D.a.PLAYER_CORE_TYPE.WEBCODECS){if(i<1)return}else if(0==i&&!e)return}if(this.playlist){f.a.log("HlsPlayer.seek playlist "+t),t=Math.max(0,Number(t)),this.playlist.seek(t)?(this.mse.seek(t),this.mse.resetHls(),this.releaseLoader(),this.isLoading=!1,this.loadFragment(),this.hlsSeek.seek(this.seekTime)):this.playlist.m3u8Parsered&&this.playlist.firstLevelLoaded&&(f.a.warn(`HlsPlayer.seek out of range.time=${t}, duration=${this.getFixedDurationTime()}`),this.stop(),this.onAnchorStop())}}pause(){this.started&&(f.a.info("HlsPlayer.pause"),this.userPaused=!0,this.mse&&this.mse.pause())}play(){this.started&&(f.a.info("HlsPlayer.play"),this.userPaused=!1,this.mse&&this.mse.play())}setVolume(t){this.videoElement&&(this.videoElement.volume=t),this.mse&&this.mse.setVolume(t)}getVolume(){return this.mse?this.mse.getVolume():-1}getBufferLen(){if(this.playerCoreType==D.a.PLAYER_CORE_TYPE.WEBCODECS)return this.mse?this.mse.getBufferLen():0;if(this.isLive)return this.mse?this.mse.getBufferLen():0;{if(!this.mse)return 0;this.mse.getPlayVideo();let t=0;return t=this.mse&&this.mse.isNoAudio&&this.h265Proxy.isReady?this.h265Proxy.getVideoBufferLen():this.mse.getBufferLen(),t}}getFrameBufferLen(){return this.mse.getFrameBufferLen()}getCurrentTime(){return this.mse&&this.mse.isNoAudio&&this.h265Proxy.renderInited?this.lastPlayTs=this.h265Proxy.getCurrentVideoTime()/1e3:this.mse&&(this.lastPlayTs=this.mse.getCurrentTime()/1e3),this.lastPlayTs>this.getDurationTime()?this.getDurationTime():this.lastPlayTs}getCurrentRealTime(){return this.mse&&this.mse.video&&this.mse.video.getCurrentTime()||0}getCurrentDts(){return this.mse.getCurrentDts()}getCurrentSeiOffsetDts(){return this.mse.getCurrentSeiOffsetDts()}getDurationTime(){return Math.floor(this.playlist&&this.playlist.totalDuration?this.playlist.totalDuration:0)}getFixedDurationTime(){return this.playlist&&this.playlist.totalDuration?this.playlist.totalDuration:0}getAnticodeHandler(){return this.anticode}updateFlvConfig(){this.mse&&this.mse.setJitter(P.a.hlsJitCfg[0],P.a.hlsJitCfg[1],P.a.hlsJitCfg[2])}updateLiveVodUrl(t,e){e!==this.cdnName?this.eventEmitter.trigger(a.PLAYBACK_DIF_CDN):this.playlist.updateLiveVodUrl(t)}setMuted(t){this.mse&&this.mse.setMuted(t)}getMuted(){return this.mse?this.mse.getMuted():-1}addNoPictureReason(){const t=wt.getHlsNoPictureReason();this.stat.setActDim(L.a.VOD_DIM_COM.VOD_NO_PICTURE_REASON,t),this.statVod.setActDim(L.a.VOD_DIM_COM.VOD_NO_PICTURE_REASON,t)}reconnectLive(){if(f.a.log("HlsPlayer.reconnectLive"),this.isLive)Lt.addRetryStream(this.stat),this.destroy(),this.reset(),this.start(this.info);else{Lt.addRetryStreamVod(this.url);let t=this.playlist.currFrag;t.tryCnt>0?(t.tryCnt--,this.loadFragment(!0)):this.loadFragment(!1)}}setTargetDuration(t){this.targetDuration=t*this.config.minFragBufferNum}setStopLoadFragment(){this.stopLoadFragment=!0}loadFragment(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1?arguments[1]:void 0;if(this.stopLoadFragment)return;if(this.playlist.fragHelper.isM4s()&&!this.mse.isM4sInitLoaded()){this.vodSecHelper.setInitStart();let t=this.playlist.fragHelper.getInitUrl();t=R.b.checkDMod(t,this.info._dMod,this.info._sMod),t=this.replaceProtocl(t),this.mse.loadM4sInit(t,this.config,{initCb:this.m4sInitcb,openCb:this.m4sInitOpenCb})}if(this.vodSecHelper.setFirstStart(),this.isLoading)return;if(null===this.playlist.currDetails&&!e)return;if(this.hlsSeek.check(),!this.started)return;let i=this.getCurrentTime(),s=void 0,r=this.mse.getPlayVideo();if(s=this.mse&&this.mse.isNoAudio&&this.h265Proxy.renderInited?this.h265Proxy.getVideoBufferLen():this.playerCoreType==D.a.PLAYER_CORE_TYPE.WEBCODECS?this.mse.getBufferLen()/1e3:this.bufferedInfo(i,r.buffered).len,0==this.seekTime){let t=this.config.maxBufferLength,e=this.config.secondBufferLength;if(this.playerCoreType==D.a.PLAYER_CORE_TYPE.WEBCODECS){if(!(this.isSeekBefore&&i<this.seekBeforeTime)){if(this.coolLoadFragment){if(s>=e)return;this.coolLoadFragment=!1}if(s>=t)return void(this.coolLoadFragment=!0);this.seekBeforeTime=0,this.isSeekBefore=!1}}else if(!(this.h265Proxy.renderInited&&this.isSeekBefore&&i<this.seekBeforeTime)){if(this.coolLoadFragment){if(s>=e)return;this.coolLoadFragment=!1}if(s>=t)return void(this.coolLoadFragment=!0);this.seekBeforeTime=0,this.isSeekBefore=!1}}let a=null;if(e)a=new A,a.sn=Number(e.sn)||1e3,a.setUrl(e.tsUrl),a.start=~~e.tsStartTime,a.discontinuity=!!e.discontinuity,a.seeking=!!this.firstTsInfo.seeking,a.byteRangeStartOffset=e.byteRangeStartOffset,a.byteRangeEndOffset=e.byteRangeEndOffset,this.playlist.currFrag=a;else if(a=t?this.playlist.currFrag:this.playlist.nextFrag,!this.seeking&&a&&this.firstTsInfo){const t=R.b.removeUrlAllParam(this.firstTsInfo.tsUrl),e=R.b.removeUrlAllParam(a.url);a.byteRangeEndOffset&&t===e?a=a.byteRangeEndOffset===this.firstTsInfo.byteRangeEndOffset?this.playlist.nextFrag:a:t===e&&(a=this.playlist.nextFrag)}if(this.mse.parser.parseAllData()&&this.mse.parser.pushAllData(),a){a.loadStartTs=y.a.now(),!this.isLive&&P.a.vodDtsFixCfg[0]&&this._ptsJumpTest(),!this.isLive&&this.loadVodPcdnProxy();let t=this.config,e=P.a.vodBs2Delay+this.targetDuration/3*1e3,i=a.getUrl({bufferLen:this.getBufferLen(),useCdn:this.forceUseCdn});this.playlist.fragHelper.isPcdnProxyOpen||(a.pcdnStatus=I.PCDN_NOT_OPEN),this.playlist.fragHelper.isPcdnClientOpen||(a.pcdnStatus=I.PCDN_CLIENT_NOT_OPEN);(P.a.vodPcdnStatCfg[0]?a.hasPcdn():a.pcdnStatus!==I.PCDN_NOT_OPEN&&a.pcdnStatus!==I.PCDN_CLIENT_NOT_OPEN)&&this.getBufferLen()<P.a.vodPcdnOpenBuffer&&!this.forceUseCdn?(a.pcdnStatus!==I.OPEN_BUFFER_NOT_REACHED&&a.pcdnStatus!==I.BUFFER_LACK_TO_CDN&&(a.pcdnStatusBk1=a.pcdnStatus),a.pcdnStatus=I.OPEN_BUFFER_NOT_REACHED):this.forceUseCdn&&(a.pcdnStatus!==I.OPEN_BUFFER_NOT_REACHED&&a.pcdnStatus!==I.BUFFER_LACK_TO_CDN&&(a.pcdnStatusBk2=a.pcdnStatus),a.pcdnStatus=I.BUFFER_LACK_TO_CDN),0==this.firstFragLoadTs&&(this.firstFragLoadTs=y.a.now(),a.pcdnStatus=I.FIRST_TS,a.isFirstLoad=!0,0===wt.getFirstFragStatus()&&wt.setFirstFragStatus(yt)),a.isPcdn?(this.statVod.addCore(L.a.CORE.GET_STREAM_CNT,1),this._pcdnFragStartTs=y.a.now()):this._cdnFragStartTs=y.a.now(),this.playlist.m3u8Parsered||(e=this.config.firstFragLoadTimeout),this.isLoading=!0,this.releaseLoader();let s=null;s=new this._loaderClz(t),this.fragLoader=s,a.byteRangeEndOffset&&(s.fromByte=a.byteRangeStartOffset,s.toByte=a.byteRangeEndOffset-1),f.a.log("HlsPlayer.loadFragment sn="+a.sn,i),this.fragStartTs=y.a.now(),this.fragSize=0,this.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.TS_CNT,1),i=R.b.checkDMod(i,this.info._dMod,this.info._sMod),i=this.replaceProtocl(i),s.loadBuffer(i,this.loadOpen.bind(this),this.loadChunk.bind(this),this.loadSuccess.bind(this),this.loadError.bind(this),this.loadTimeout.bind(this),e,a.isPcdn?0:t.fragLoadingMaxRetry,a.isPcdn?0:t.fragLoadingRetryDelay)}else if(null!=s&&s<=2){let t=y.a.now();if(0===this.endTs&&(this.endTs=t+1e3*s+300),t>=this.endTs&&!this.isLive){f.a.log("HlsPlayer.loadFragment ANCHOR_STOP bufferedLen="+s.toFixed(2));let t=0;const e=this.mse.getPlayVideo();t=this.mse&&this.mse.isNoAudio&&this.h265Proxy.renderInited?this.h265Proxy.getCurrentVideoTime()/1e3:this.mse.getCurrentTime()/1e3;const i=this.getFixedDurationTime();i-t-s<=2&&(2===Number(this.liveType)?(this.stop(),this.onAnchorStop()):(f.a.log(`HlsPlayer.loadFragment.onEnded currentTime=${t} duration=${i} bufferedLen=${s}`),this.playerCoreType==D.a.PLAYER_CORE_TYPE.MSE&&(e.currentTime=i),this.onEnded()))}}else if(this.seekTime>0)if(f.a.warn("HlsPlayer.loadFragment out of range."),this.isLive)this.stop(),this.onAnchorStop();else{const t=this.mse.getCurrentTime()/1e3,e=this.getFixedDurationTime();e-t<=2&&this.seek(e)}}_isEnded(){if(!this.started||1===this.liveType)return;const t=this.getFixedDurationTime(),e=this.getCurrentTime(),i=t-e,s=y.a.now();if(i<1)if(0==this.nowEndTs)this.nowEndTs=s+1e3*(t-e)+300;else if(s>=this.nowEndTs)return f.a.log(`HlsPlayer._isEnded,duration=${t},currentTime=${e},delta=${i}`),!0;return!1}loadVodPcdnProxy(){P.a.platform!==D.a.PLATFORM_TYPE_NAME.wap&&this.playlist.m3u8Parsered&&this.playTriggered&&!this.forceUseCdn&&this.playlist.fragHelper.getVodPcdnProxyCursor()}loadOpen(t){this.vodSecHelper.setFirstOpen(),this.fragOpenTs=y.a.now();let e=this.fragOpenTs-this.fragStartTs;e<5e3&&this.playStat.tsOpens.push(e);const i=this.playlist&&this.playlist.currFrag;i&&i.isFirstLoad&&(t&&(this.firstTsHttpCode=t.code),wt.getFirstFragStatus()===yt&&wt.setFirstFragStatus(Et))}loadChunk(t){this.pushData(t)}loadSuccess(){let t=this.playlist.currFrag;t&&(t.loadEndTs=y.a.now(),f.a.log(`HlsPlayer.loadSuccess sn=${t.sn} costTime=${t.loadEndTs-t.loadStartTs} duration=${t.duration}`)),this.isLoading=!1;let e=y.a.now()-this.fragOpenTs;e<1e4&&(this.playStat.tsLoadeds.push(e),this.playStat.tsSpeeds.push(this.fragSize/e),this.playStat.tsSizes.push(this.fragSize)),this.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.TS_SUC_CNT,1),this.fragSize=0}pushData(t){if(!t)return;this._loaderType===D.a.HLS_LOAD_TYPE.XHR&&f.a.log("HlsPlayer.pushData payload.length="+t.byteLength);let e=this.playlist.currLevel||{},i=this.playlist.currFrag,s=this.playlist.lastFrag,r=this.playlist.totalDuration;if(this.exceptionStat.setStat(L.a.DIM_LINK_STA.HAS_DATA,1),this.avgSpeed.addCur(t.byteLength),this.fragSize+=t.byteLength,this.statFragData(t),!(t=this.discardPcdnRepeatData(t)))return;0==this.firstFragLoadedTs&&(this.firstFragLoadedTs=y.a.now(),this.firstFragSize=t.byteLength/1024|0);let a=i.discontinuity;this.curAppendFrag&&this.curAppendFrag.sn===i.sn?a=!1:this.curAppendFrag&&this.curAppendFrag.sn!==i.sn&&(this.curAppendFrag=i),this.curAppendFrag||(this.curAppendFrag=i),this.lastSN!==i.sn&&(this.lastSN=i.sn);const o={timeOffset:i.start,duration:r,level:i.level,sn:i.sn,seeking:i.seeking};if(this.playlist.fragHelper.isM4s()?this.mse.appendM4sSegment(t,o):this.mse.appendTs({data:t,audioCodec:e.audioCodec,videoCodec:e.videoCodec,timeOffset:i.start,duration:r,discontinuity:a,_discontinuity:i.seeking&&s&&i.discontinuityCnt!==s.discontinuityCnt,level:i.level,sn:i.sn,seeking:i.seeking,hlsDT:i.hlsDT,tsDT:i.tsDT}),i&&i.seeking){if(i.seeking=!1,this.firstPlay){this.firstPlay=!1;let t=i.start;this.info.secUseSeekTime&&(t=this.seekTime),this.mse.seek(t),this.playerCoreType==D.a.PLAYER_CORE_TYPE.MSE&&(this.onVideoSeek(t),this.play())}this.seekTime=0}q.has(this.onCheckTimer,this)||(q.add(this.onCheckTimer,this,1e3),q.add(this.onCheckFastTimer,this,100)),this.setLoadStatus(D.a.LoadVideoTimeoutReason.HLS_LOADFRAMENT_SUCCESS)}onM4sInit(){this.vodSecHelper.setInitEnd(),this.loadFragment()}onM4sInitOpen(){this.vodSecHelper.setInitOpen()}onFirstBuf(){this.vodSecHelper.setFirstBuf()}loadError(t){let{code:e,currentTarget:i,msg:s}=t;const r=this.playlist&&this.playlist.currFrag;r&&(r.isPcdn&&(this.errorPcdnSN=this.playlist.currFrag.sn,this.needStatPcdnRepeatBW=!0,this.statVod.addCore(L.a.CORE.GET_STREAM_LINK_ERROR_CNT,1),this.statVod.addCore(L.a.CORE.GET_STREAM_ERROR_CNT,1),r.pcdnStatus=I.TS_LOAD_ERROR),r.isFirstLoad&&wt.getFirstFragStatus()===yt&&wt.setFirstFragStatus(Pt),r.isFirstLoad&&(this.firstTsHttpCode=e)),this.playlist&&this.playlist.currFrag&&this.playlist.currFrag.loadError(),this.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.TS_FAIL_CNT,1),f.a.warn(`HlsPlayer.loadError load fragment error:${e||i&&i.status} ${s||""}`),this.isLoading=!1,this.config.autoReconnect&&this.reconnectLive(),this.setLoadStatus(D.a.LoadVideoTimeoutReason.HLS_LOADFRAMENT_ERROR)}loadTimeout(t){const e=this.playlist&&this.playlist.currFrag;e&&(e.loadError(),e.isPcdn&&(this.statVod.addCore(L.a.CORE.GET_STREAM_LINK_TIMEOUT_CNT,1),this.statVod.addCore(L.a.CORE.GET_STREAM_ERROR_CNT,1),e.pcdnStatus=I.TS_LOAD_ERROR),e.isFirstLoad&&wt.getFirstFragStatus()===yt&&wt.setFirstFragStatus(Dt),e.isFirstLoad&&(this.firstTsHttpCode=code)),this.stat.addComp(L.a.HLS_INFO.name,L.a.HLS_INFO.TS_TIMEOUT_CNT,1),f.a.warn("load fragment timeout",t),this.isLoading=!1,this.config.autoReconnect&&this.reconnectLive()}discardPcdnRepeatData(t){let e=this.playlist.currFrag;if(this.lastSN!==e.sn&&(this.pcdnRepeatByteLen=0,this.playlist.fragHelper.isM4s()&&this.mse.m4sPlayer.createMp4()),!e.isPcdn&&this.errorPcdnSN===e.sn&&this.pcdnRepeatByteLen>0){if(this.needStatPcdnRepeatBW&&(this.statVod.setCore(L.a.PCDN_DATA.PCDN_REPEAT_BW,this.pcdnRepeatByteLen),this.needStatPcdnRepeatBW=!1),this.pcdnRepeatByteLen>t.byteLength)return this.pcdnRepeatByteLen-=t.byteLength,null;{let e=t.slice(this.pcdnRepeatByteLen,t.byteLength);this.pcdnRepeatByteLen=0,t=e}}return e.isPcdn&&(this.pcdnRepeatByteLen+=t.byteLength),t}statFragData(t){let e=this.playlist.currFrag;if(e.isFirstLoad&&wt.getFirstFragStatus()===Et&&wt.setFirstFragStatus(vt),this.tsFileSize+=t.byteLength,0===this.heartTsStartTime&&(this.heartTsStartTime=e.start,this.heartTsEndTime=this.heartTsStartTime),this.lastSN>0&&this.lastSN!==e.sn&&(this.heartTsEndTime+=e.duration,this.statVod.addCore(L.a.VOD_CORE.TS_PLAY_TIME,e.duration),this.statVod.addCore(L.a.VOD_CORE.TS_SIZE,this.tsFileSize),this.tsFileSize=0),this.lastSN!==e.sn&&(this._getPcdnDataTime>0&&(this.statVod.addCore(L.a.PCDN_DATA.GET_PCDN_DATA_TIME,this._getPcdnDataTime),this.statVod.addCore(L.a.PCDN_DATA.GET_PCDN_DATA_TIME_CNT,1),this._getPcdnDataTime=0),this._getCdnDataTime>0&&(this.statVod.addCore(L.a.PCDN_DATA.GET_CDN_DATA_TIME,this._getCdnDataTime),this.statVod.addCore(L.a.PCDN_DATA.GET_CDN_DATA_TIME_CNT,1),this._getCdnDataTime=0)),this.statVod.addKeyvalCoreDim(L.a.VOD_CORE.VOD_PCDN_STATE,`${e.pcdnStatus}:${t.byteLength}`),this.statBackupPcdnState(t),e.isPcdn){const i=e.pcdnFreetime?L.a.CORE.PCDN_FREETIME_BW:L.a.CORE.PCDN_REALTIME_BW;this.statVod.addCore(i,t.byteLength),this.stat.addCore(L.a.CORE.PCDN_TOTAL_BW,t.byteLength),this._pcdnFragStartTs>0&&(this._getPcdnDataTime+=y.a.now()-this._pcdnFragStartTs,this._pcdnFragStartTs=y.a.now())}else this.statVod.addCore(L.a.CORE.CDN_TOTAL_BW,t.byteLength),this.stat.addCore(L.a.CORE.CDN_TOTAL_BW,t.byteLength),this._cdnFragStartTs>0&&(this._getCdnDataTime+=y.a.now()-this._cdnFragStartTs,this._cdnFragStartTs=y.a.now())}statBackupPcdnState(t){let e=this.playlist.currFrag;if(!e||!t)return;let i="";P.a.vodUseBackupField[2]&&this.statVod.setCoreDim(L.a.VOD_DIM_COM.BACKUP_FIELD3,String(P.a.vodUseBackupField[6])),e.pcdnStatus===I.OPEN_BUFFER_NOT_REACHED?(P.a.vodUseBackupField[0]&&this.statVod.addKeyvalCoreDim(L.a.VOD_DIM_COM.BACKUP_FIELD1,`${e.pcdnStatusBk1}:${t.byteLength}`),i=0===P.a.vodUseBackupField[6]&&e.pcdnStatusBk1):e.pcdnStatus===I.BUFFER_LACK_TO_CDN&&(P.a.vodUseBackupField[1]&&this.statVod.addKeyvalCoreDim(L.a.VOD_DIM_COM.BACKUP_FIELD2,`${e.pcdnStatusBk2}:${t.byteLength}`),i=1===P.a.vodUseBackupField[6]&&e.pcdnStatusBk2);const s=0===P.a.vodUseBackupField[6]?I.REALTIME_OVER_RUN:I.NOT_SEND_REQ;if(i)switch(i){case I.PCDN_REALTIME:case I.PCDN_FREETIME:P.a.vodUseBackupField[3]&&this.statVod.addCoreDim(L.a.VOD_DIM_COM.BACKUP_FIELD4,t.byteLength);break;case I.REALTIME_NOT_REACHED:P.a.vodUseBackupField[4]&&this.statVod.addCoreDim(L.a.VOD_DIM_COM.BACKUP_FIELD5,t.byteLength);break;case s:P.a.vodUseBackupField[5]&&this.statVod.addCoreDim(L.a.VOD_DIM_COM.BACKUP_FIELD6,t.byteLength)}}bufferedInfo(t,e){let i,s,r,a,o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3,h=[],d=[];for(o=0;o<e.length;o++)h.push({start:e.start(o),end:e.end(o)});for(h.sort((t,e)=>{let i=t.start-e.start;return i||e.end-t.end}),o=0;o<h.length;o++){let t=d.length;if(t){let e=d[t-1].end;h[o].start-e<n?h[o].end>e&&(d[t-1].end=h[o].end):d.push(h[o])}else d.push(h[o])}for(o=0,i=0,s=r=t;o<d.length;o++){let e=d[o].start,h=d[o].end;if(t+n>=e&&t<h)s=e,r=h,i=r-t;else if(t+n<e){a=e;break}}return{len:i,start:s,end:r,nextStart:a}}checkCatonError(){if(this.playerCoreType!=D.a.PLAYER_CORE_TYPE.WEBCODECS&&this.mse&&this.mse.getBufferLen&&this.mse.getBufferLen()>8e3&&!this.mse.video.paused&&Math.floor(this.mse.getCurrentTime()/1e3)<5){if(Math.floor(this.lastPlayTs)==Math.floor(this.mse.getCurrentTime()/1e3)&&this.pauseInBufferFullTimes++,this.playTriggered)return;if(this.pauseInBufferFullTimes>=5){let t=this.playlist.getNearFragStart(this.lastPlayTs+1);f.a.log("HlsPlayer.checkCatonError, seek"),this.seek(t),this.pauseInBufferFullTimes=0}}}fixedByBuffered(){if(this.isLive&&this.playerCoreType==D.a.PLAYER_CORE_TYPE.MSE)return;const t=this.mse&&this.mse.video&&this.mse.video.video,e=this.playlist&&this.playlist.currFrag&&this.playlist.currFrag.duration;if(t&&e)for(let i=0;i<t.buffered.length;i++){const s=t.buffered.start(i);if(i>=1){if(t.buffered.end(i-1)-t.currentTime<=1&&s>t.currentTime&&s<=t.currentTime+e){f.a.log(`%cHlsPlayer.fixedByBuffered currentTime=${t.currentTime} fixed time=${s}`,"color:#A23400;background:#FFF5C2"),t.currentTime=s;break}}}}onCheckTimer(t,e){if(this.anticode.onCheckTimer(t,e),this.avgSpeed.calculate(),this.started&&this.mse&&!this.needReset&&this.mse&&!this.mse.userPaused){if(this.mse&&this.mse.onCheckTimer(t,e),this.playlist&&this.playlist.onCheckTimer(e),this.playTs>0){let i=t-this.pauseTs;this.playStat&&(this.pauseTs>0&&i>200&&!this.skipStatForSeek&&0==this.pauseCnt&&(this.playStat.setPause(),Lt.addBadQuality(this.stat)),this.pauseCnt>0&&(this.pauseCnt=0,this.playStat.setPause()),e%20==0&&this.playStat.report()),this.pauseTs>0&&i>P.a.vodRetryTime&&(f.a.warn(`HlsPlayer.onCheckTimer pauseTime=${i}, bufferLen=${this.getBufferLen()}`),this.isLive||(this.triggerH5PlayError(),this.pauseTs=0))}this.checkCatonError(),this.updateTime()}}onVideoTimeupdate(){this.updateTime()}updateTime(){const t=this.getCurrentTime(),e=this.getDurationTime();-1==localStorage._printVodTimer&&f.a.log("HlsPlayer.PlayTimeUpdate",t,e),this.eventEmitter.trigger(a.PLAY_TIME_STATUS,{current:t,total:e}),this.eventEmitter.trigger(a.PLAY_FRAME_BUFFER,{frameStorage:this.mse&&this.mse.getFrameReadyed(),jitterBuffer:this.mse&&this.mse.getBufferLen()})}onCheckFastTimer(t,e){if(this.needReset)return 0===this.resetPlayTs&&(this.resetPlayTs=t+this.mse.getBufferLen()-500),void((this.mse&&this.mse.getBufferLen()<500||t>this.resetPlayTs)&&(this.reloadInError(),this.needReset=!1,this.resetPlayTs=0));if(!this.started||!this.mse||this.mse.userPaused)return;let i=this.getBufferLen(),s=this.playlist.currFrag;-1===Number(localStorage._print_pcdn_buf)&&f.a.log(`%cHlsPlayer.onCheckTimer isPcdn=${s.isPcdn} sn=${s.sn} bufferlen=${this.getBufferLen()} forceUseCdn=${this.forceUseCdn}`,"color:green"),s.isPcdn&&i<P.a.vodPcdnCloseBuffer&&!this.forceUseCdn?(f.a.log("%cHlsPlayer.onCheckTimer: pcdn close","color:#A23400;background:#FFF5C2"),this.fragLoader.abort(),this.forceUseCdn=!0,this.isLoading=!1,this.errorPcdnSN=s.sn,this.needStatPcdnRepeatBW=!0,s.pcdnStatusBk2=s.pcdnStatus,s.pcdnStatus=I.BUFFER_LACK_TO_CDN,this.loadFragment(!0),this.statVod.addCore(L.a.CORE.GET_STREAM_LOW_DATA_CNT,1),q.once(this.onCheckIfCanPCDN,this,P.a.vodPcdnCoolTime)):this.loadFragment(),this.mse&&this.mse.onCheckFastTimer(t,e);let r=t-this.pauseTs;if(this.pauseTs>0&&r>200&&this.fixedByBuffered(),this.info&&this.info.type===Te&&this.playerCoreType==D.a.PLAYER_CORE_TYPE.MSE){let t=this.getBufferLen();if(this.pauseTs>0&&r>=1e3&&t>2e3){let t=this.mse.video.video;t.currentTime+=1,f.a.log(`HlsPlayer.onCheckFastTimer.playback pauseTime=${r}, currentTime + 1, currentTime=${t.currentTime}`),this.play()}}this._isEnded()&&3===Number(this.liveType)&&(f.a.log(`HlsPlayer.check onEnded, curTime=${this.getCurrentTime()}, duration=${this.getFixedDurationTime()}`),this.onEnded())}onCheckIfCanPCDN(t,e){f.a.log("%cHlsPlayer.onCheckIfCanPCDN: pcdn open","color:#A23400;background:#FFF5C2"),this.forceUseCdn=!1,q.remove(this.onCheckIfCanPCDN,this)}sendNoPicture(t){this._sendVideoLoadTime(t),this._sendVideoNoPictureAll()}_sendVideoNoPictureAll(){if(this.isLive&&!this.hasPicture){const t=99999,e=this.getCostTimes();let i=e[0],s=e[2];this.tsdb.sendNoPictureTimeAll(t,i,s,"hls","","")}}_sendVideoLoadTime(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.videoLoadTimeSent||this.isLive)return;this.videoLoadTimeSent=!0,t=t||y.a.now()-this.startTs,this.isLive||this.statVod.setActDim(L.a.VOD_DIM_COM.CREATE_TIME,t);let e=this.videoLoadTime,i=this.loadM3u8Time,s=this.firstFragLoadTime,r=this.firstFragLoadedTime,a=this.firstFragParsedTime;if(!this.hasPicture){e=99999;const t=this.getCostTimes();i=t[0],s=t[1],r=t[2],a=t[3]}let o=0;this.mse&&(o=this.mse.isMediaSourceOpen?1:2);const n=R.b.getBrowserHidden();n&&2==o?f.a.log(`HlsPlayer._sendVideoLoadTime browserHidden=${n}, isMediaSourceOpen=${o}`):(99999===e?(Lt.addVodFail(this.url),this.tsdb.autoReport()):Lt.delVodFail(this.url),this.tsdb.sendVodHlsTime({loadType:this._loaderType,loadTime:e,loadM3u8Time:i,firstFragLoadTs:s,firstFragLoadedTs:r,firstFragParsedTs:a,firstFragSize:this.firstFragSize,businessCost:this.businessLoadTime,UICost:this.uiLoadTime,playTs:this.playTs,startTs:this.startTs,m3u8Status:this.playlist.loadM3u8HttpCode,firstTsStatus:this.firstTsHttpCode,costTimes:this.vodSecHelper.getCostTimes()}))}updateStatus(t){this.videoStatus!==t&&(this.videoStatus=t,this.eventEmitter.trigger(a.PLAY_STATUS,{status:t}))}cacheBlockReason(t,e){this.blockHelper.cacheBlockReason(t,e)}resetHeartTsTime(){this.heartTsStartTime=0,this.heartTsEndTime=0}onStartVideo(){this.loadStartTs=y.a.now()}onPlayVideo(t,e,i,s,r,o,n){this.isLive&&Lt.delFail(this.stat);let d=y.a.now();this.pauseTs=0,this.playTs=d,this.hasVideo=s,this.vodSecHelper.setPlayTs(),0!==this.startTs&&(this.videoLoadTime=d-this.startTs,this.loadM3u8Time=this.playlist.manifestLoadedTs-this.startTs,this.firstFragLoadTime=this.firstFragLoadTs-this.playlist.manifestLoadedTs,this.firstTsInfo&&(this.firstFragLoadTime=this.firstFragLoadTs-this.startTs),this.firstFragLoadedTime=this.firstFragLoadedTs-this.firstFragLoadTs,this.firstFragParsedTime=d-this.firstFragLoadedTs,this.uiLoadTime=this.UIStartCost>0?this.videoLoadTime+this.UIStartCost:0,this.businessLoadTime=0,this.startTimeStamp>1?this.businessLoadTime=this.videoLoadTime+this.businessStartCost:1===this.startTimeStamp&&(this.businessLoadTime=d-this.loadStartTs),this.tsdb.sendHlsTime(this._loaderType,this.videoLoadTime,this.loadM3u8Time,this.firstFragLoadTime,this.firstFragLoadedTime,this.firstFragSize,this.businessLoadTime,this.uiLoadTime,this.firstFragParsedTime,this.vodSecHelper.getCostTimes()),!this.isLive&&!this.videoLoadTimeSent&&this.videoLoadTime<=1e4&&this._sendVideoLoadTime(),f.a.log("%cHlsPlayer.onPlayVideo loadTime="+this.videoLoadTime,"color:#A23400;background:#FFF5C2")),this.seeking=!1,this.skipStatForSeek=!1,this.playTriggered=!0,!this.pausedByBrowser&&this.updateStatus(h),this.codecType=n;let l={video:t,width:e,height:i,canvas:r,codec:n};this.eventEmitter.trigger(a.VIDEO_PLAY,l),f.a.log("HlsPlayer.onPlayVideo playInfo",l),!this.isLive&&this.loadVodPcdnProxy(),this.playlist.fragHelper.isM4s()&&Pa.isCloseCore(this.info.curBitrate,ce())&&this.eventEmitter.trigger(a.H5_PLAYER_ERROR,{video:t,code:1e3,msg:"配置关闭av1"})}onVideoStop(t,e){f.a.log("HlsPlayer.onVideoStop hasVideo="+e),this.hasVideo=!1,e&&(this.updateStatus(d),this.eventEmitter.trigger(a.VIDEO_STOP,{video:t}))}onAnchorStop(){let t=this.mse?this.mse.getPlayVideo():null;this.eventEmitter.trigger(a.ANCHOR_STOP,{video:t})}onEnded(){this.started=!1,this.updateStatus(d),this.eventEmitter.trigger(a.M3U8_PLAY_ENDED),this.h265Proxy&&this.h265Proxy.onEnded&&this.h265Proxy.onEnded(),this.mse&&this.mse.onEnded&&this.mse.onEnded()}onLoadM3u8Error(t){const e=t&&t.currentTarget&&t.currentTarget.status;404!==e&&0!==e||this.isLive||this.videoLoadTimeSent||(!this.hasPicture&&this.addNoPictureReason&&this.addNoPictureReason(),this._sendVideoLoadTime()),this.eventEmitter.trigger(a.HLS_URL_UNAVAILABLE)}onLoadManifestTimeout(){this.eventEmitter.trigger(a.HLS_MAINFEST_LOAD_TIMEOUT)}onConnectManifestTimeout(){this.eventEmitter.trigger(a.HLS_URL_LOAD_TIMEOUT)}onPlayerError(t){this.videoElement}triggerH5PlayError(){if(this.info.type===Te)return;let t=this.getCurrentTime();f.a.log("HlsPlayer.triggerH5PlayError seekTime = "+t),this.info&&(this.eventEmitter.trigger(a.PAUSE_5S_RETRY),this.info.seekTime=t+1,this.start(this.info))}onErrorEvent(t){const e=this.playlist&&this.playlist.currFrag;e&&e.isFirstLoad&&wt.getFirstFragStatus()===vt&&wt.setFirstFragStatus(It);let i=this.mse?this.mse.getPlayVideo():null;this.eventEmitter.trigger(a.H5_PLAYER_ERROR,{video:i,code:t.type,msg:"播放错误"}),this.setLoadStatus(D.a.LoadVideoTimeoutReason.HLS_PLAY_ERROR)}decoderDecodeError(){f.a.log("HlsPlayer.decoderDecodeError")}onPlayPause(t,e,i){if(!e)return;if(this.pauseTs=t,this.updateStatus(l),this.blockHelper.checkVodBlock(),!this.playlist||this.isLive)return;let s=1e3*this.playlist.totalDuration,r=this.mse?this.mse.getCurrentTime()/1e3:0;s>0&&r>0&&Math.abs(s-r)<1e3&&this.isLive&&(f.a.warn("HlsPlayer detect anchor stop."),this.onAnchorStop(),this.stop()),this.startSendPauseTimer()}onPlayResume(t,e){if(this.pauseTs>0){let e=t-this.pauseTs,i=200;this.playBackRate<1&&this.playBackRate>0&&(i=Math.min(400,200*~~(1/this.playBackRate))),e>200&&!this.skipStatForSeek&&(localStorage[Z.AUTO_VIEW_LOG]=1,f.a.warn(`HlsPlayer.onPlayResume pauseTime=${e}, pauseDelta=${i}`),this.pauseCnt++,this.stat.addCore(L.a.CORE.VIDEO_BLOCK_COUNT,1),this.stat.addCore(L.a.CORE.VIDEO_BLOCK_DURATION,e),this.isLive||(this.statVod.addCore(L.a.VOD_CORE.VOD_BLOCK_COUNT,1),this.statVod.addCore(L.a.VOD_CORE.VOD_BLOCK_DURATION,e),Lt.addBadQualityVod(this.url)),this.eventEmitter.trigger(a.VIDEO_BAD_QUALITY)),this.pauseTs=0}this.skipStatForSeek=this.seeking,e&&(this.updateStatus(h),this.eventEmitter.trigger(a.VIDEO_PLAYING,{video:this.videoElement,event:event}))}onVideoSeek(t){if(!this.started)return;f.a.log("HlsPlayer.onVideoSeek",t),this.playerCoreType==D.a.PLAYER_CORE_TYPE.WEBCODECS&&(this.hlsSeek._seekTime=0),this.seeking=!1,this.seekTime=0;let e=this.mse?this.mse.getPlayVideo():null;this.eventEmitter.trigger(a.VIDEO_SEEK,{video:e,currentTime:t}),this.h265Proxy&&this.h265Proxy.onVideoSeek&&this.h265Proxy.onVideoSeek(t)}onPauseByBrowser(){window&&(f.a.warn("HlsPlayer.onPauseBrowser: video was paused by browser, define click listener"),window.removeEventListener("click",this._clickEventBind,!0),window.addEventListener("click",this._clickEventBind,!0),this.pausedByBrowser=!0)}_clickEvent(){if(document){f.a.log("HlsPlayer._clickEvent: click for play a temp video");let t=document.createElement("video").play();t&&t.catch(t=>{f.a.log("HlsPlayer._clickEvent err="+t.message)}),this.pausedByBrowser=!1,window&&window.removeEventListener("click",this._clickEventBind,!0)}}startSendPauseTimer(){this.stopSendPauseTimer(),this.sendPauseTimeout=setTimeout(this.sendPauseEvent.bind(this),200)}stopSendPauseTimer(){clearTimeout(this.sendPauseTimeout)}sendPauseEvent(){this.videoStatus!==h&&this.eventEmitter.trigger(a.PLAY_CARTON)}get isPlaying(){return this.videoStatus!==d&&this.videoStatus!==o&&this.videoStatus!==n}get hasPicture(){return this.videoLoadTime>0}getCostTimes(){if(!this.playlist)return[0,0,0,0,-1,0,0];let t=this.playlist.manifestLoadedTs>0?this.playlist.manifestLoadedTs-this.startTs:0,e=this.firstFragLoadedTs>0?this.firstFragLoadTs-this.playlist.manifestLoadedTs:0;return this.firstTsInfo&&(e=this.firstFragLoadedTs>0?this.firstFragLoadTs-this.startTs:0),[t,e,this.firstFragLoadedTs>0?this.firstFragLoadedTs-this.firstFragLoadTs:0,this.playTs&&this.firstFragLoadedTs>0?this.playTs-this.firstFragLoadedTs:0,this.playlist.loadM3u8HttpCode,this.firstTsHttpCode,this.startTs,this.playTs]}switchLevel(t){let e=this.playlist.levels,i=t.curBitRate;if(e.length>0&&this.playlist.isMasterPlayList){for(let t=0;t<e.length;t++)if(e[t].bitrate===i&&this.playlist.currLevel.bitrate!=i){this.playlist.currLevel.bitrate=i,this.playlist.currLevelId=t,this.playlist.currLevel.url=e[t].url,this.mse.parser.switchLevel(),this.play();break}}else this.playlist.currLevel.url=t.url,this.playlist.currLevel.bitrate=i,this.mse.parser.switchLevel(),this.play()}turnToH264(t){const e=this.getCurrentTime();this.stop(),this.eventEmitter.trigger(a.TURN_TO_H264,{seekTime:e,reason:t})}h265Retry(){const t=this.getCurrentTime();this.stop(),this.eventEmitter.trigger(a.H265_VIDEO_RETRY,{seekTime:t})}containerResize(t){this.h265Proxy&&this.h265Proxy.containerResize&&this.h265Proxy.containerResize(t)}_ptsJumpTest(){1===Number(localStorage.ptsJumpTest)&&(ni.ptsJumpTest=!0)}getCodecType(){return this.codecType}getVideoWidth(){return this.isAv1State?this.videoElement&&this.videoElement.videoWidth:this.mse.getMseAvcCfgWidth()}getVideoHeight(){return this.isAv1State?this.videoElement&&this.videoElement.videoHeight:this.mse.getMseAvcCfgHeight()}getFps(){if(this.isAv1State){if(this.mse&&this.mse.m4sPlayer&&this.mse.m4sPlayer.mp4){const t=this.mse.m4sPlayer.mp4.getVideoFps();return t>0?t:-100}return-100}return this.mse&&this.mse.parser&&this.mse.parser.getFps()}replaceProtocl(t){return t.replace(/^https?\:/,"https:")}setWebCodecsSuccess(){this.isWebcodecsPlaying=!0}setFrameRusume(){}setFramePause(){}renderFpsPause(){}getEnhanceStats(){return this.eventEmitter&&this.eventEmitter.getEnhanceStats&&this.eventEmitter.getEnhanceStats()}getDpi(){let t=0,e=0;return this.mse&&this.mse.getMseAvcCfgWidth&&(t=this.mse.getMseAvcCfgWidth()),this.mse&&this.mse.getMseAvcCfgHeight&&(e=this.mse.getMseAvcCfgHeight()),{width:t,height:e}}turnToWebcodecsSoft(){const t=this.getCurrentTime();this.stop(),R.b.isWebCodecsSupported()&&(f.a.log("HlsPlayer.turnToWebcodecsSoft"),this.eventEmitter.trigger(a.TURN_TO_WEBCODECS_SOFT,{seekTime:t}))}getRefreshRate(){return this.eventEmitter&&this.eventEmitter.getRefreshRate&&this.eventEmitter.getRefreshRate()}webcodecsRetry(){const t=this.getCurrentTime();this.stop(),this.eventEmitter.trigger(a.WEBCODECS_RETRY,{seekTime:t})}turntoH265Wasm(){const t=this.getCurrentTime();this.stop(),this.eventEmitter.trigger(a.TURN_TO_H265_WASM,{seekTime:t})}turnToMse(){const t=this.getCurrentTime();this.stop(),this.eventEmitter.trigger(a.TURN_TO_MSE,{seekTime:t})}setUseSoftAcceleration(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isLive||this.statVod.setComDim(L.a.VOD_DIM_COM.DECODE_HARDWARE_ACCELERATION,t?1:0),this.stat.setComDim(L.a.DIM_COM.DECODE_HARDWARE_ACCELERATION,t?1:0)}setEnhance(t){this.mse&&this.mse.setEnhance&&this.mse.setEnhance(t)}onVideoEnhanceSuccess(){this.eventEmitter&&this.eventEmitter.trigger(a.ON_VIDEO_ENHANCE_SUCCESS)}onVideoEnhanceError(t){this.eventEmitter&&this.eventEmitter.trigger(a.ON_VIDEO_ENHANCE_ERROR,t)}isNotSupportWebcodecsConfigure(){let t="avc1.42E01E",e="h264";this.isAv1State?(t="av01.0.08M.08",e="av1"):this.isH265&&(t="hvc1.1.6.L93",e="h265");const i=this.mse;"h265"!=e&&"h264"!=e&&"av1"!=e||"undefined"!=typeof VideoDecoder&&VideoDecoder.isConfigSupported({codec:t}).then(t=>{f.a.log("HlsPlayer.isConfigSupported",t,e),t.supported?"h265"==e?localStorage.isCloseWebcodecsH265=0:"h264"==e?localStorage.isCloseWebcodecsH264=0:"av1"==e&&(localStorage.isCloseWebcodecsAv1=0):("h265"==e?localStorage.isCloseWebcodecsH265=1:"h264"==e?localStorage.isCloseWebcodecsH264=1:"av1"==e&&(localStorage.isCloseWebcodecsAv1=1),i&&i.isNotSupportWebcodecsConfig&&i.isNotSupportWebcodecsConfig())}).catch(t=>{f.a.log("HlsPlayer.isConfigSupported.catch",t.message)})}setDisableHardAcc(){const t=this.mse;t&&t.setDisableHardAcc&&t.setDisableHardAcc()}win7PerfInsufficient(){const t=this.mse;t&&t.win7PerfInsufficient&&t.win7PerfInsufficient()}angelNullError(){const t=this.mse;t&&t.angelNullError&&t.angelNullError()}chromeH265RenderEmptyError(){const t=this.mse;t&&t.chromeH265RenderEmptyError&&t.chromeH265RenderEmptyError()}onMseHevcError(){this.info&&!this.info.h265Url&&(this.info.h265Url=this.info.url),f.a.log("HlsPlayer.onMseHevcError"),this.turntoH265Wasm&&this.turntoH265Wasm()}setPlaybackRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.playBackRate=t,f.a.log("HlsPlayer.setPlaybackRate",t),this.playerCoreType==D.a.PLAYER_CORE_TYPE.MSE&&this.mse&&this.mse.getPlayVideo){this.mse.getPlayVideo().playbackRate=Number(t)}else this.playerCoreType==D.a.PLAYER_CORE_TYPE.WEBCODECS&&this.mse.setPlaybackRate(t)}get isWebCodec(){return this.playerCoreType==D.a.PLAYER_CORE_TYPE.WEBCODECS}};let ho="loaded",lo="error",uo="timeout",co=new Map;class po extends qt{constructor(t){super(),this._libName=t,this._id=t.replace(".js","_script"),this._script=document.getElementById(this._id),this._loaded=!!this._script,this._onLoadBind=this._onLoad.bind(this),this._onErrorBind=this._onError.bind(this)}load(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6e4;if(this._loaded)this.trigger(ho,2);else{let i=this._script;i||(i=document.createElement("script"),i.id=this._id,i.async=!0,i.onload=i.onreadystatechange=this._onLoadBind,i.onerror=this._onErrorBind,i.src=t.endsWith("/")?t+this._libName:t+"/"+this._libName,document.getElementsByTagName("head")[0].appendChild(i),this._script=i,q.once(this._onTimeout,this,e))}}_onLoad(){let t=this._script,e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,this._loaded=!0,q.remove(this._onTimeout,this),this.trigger(ho,1))}_onTimeout(){this._clear(),this.trigger(uo)}_onError(){this._clear(),this.trigger(lo)}_clear(){let t=this._script;t&&(t.onload=t.onreadystatechange=t.onerror=null,t.src="",t.parentNode&&t.parentNode.removeChild(t),this._script=null)}}var mo=function(t,e,i){let{onLoaded:s=null,onError:r=null,onTimeout:a=null,thisObj:o=null,timeout:n=6e4}=i,h=co.get(e);return h||(h=new po(e),co.set(e,h)),s&&h.on(ho,s,o),r&&h.on(lo,r,o),a&&h.on(uo,a,o),h.load(t,n),h},fo=function(t,e){let{onLoaded:i=null,onError:s=null,onTimeout:r=null,thisObj:a=null}=e,o=co.get(t);o&&(i&&o.off(ho,i,a),s&&o.off(lo,s,a),r&&o.off(uo,r,a))};var _o=new class extends qt{constructor(){super(),this.libName="HYThree.js",this.loaded=!1,this.ON_LOAD="on_load",this.callbacks={onLoaded:this.onLoaded,thisObj:this}}loadLib(t){this.loaded?this.trigger(this.ON_LOAD):mo(t,this.libName,this.callbacks)}onLoaded(){this.loaded=!0,fo(this.libName,this.callbacks),window.HYThree&&window.HYThree.default.init({logger:f.a}),this.trigger(this.ON_LOAD)}createVr(t,e){return window.HYThree?window.HYThree.default.createVr(t,e):null}};var go=class{constructor(){this.video=null,this._startWaitingTs=0,this._badQualityCnt=0,this._badQualityTime=0,this._badQuality=!1,this._paused=!1,this.onWaitingBind=this.onWaiting.bind(this),this.onPlayingBind=this.onPlaying.bind(this),this.onPauseBind=this.onPause.bind(this),this.onCanplayThroughBind=this.onCanplayThrough.bind(this)}get paused(){return this._badQualityCnt>0}get waiting(){return this._startWaitingTs>0}reset20(){this._badQuality&&(this._startWaitingTs=y.a.now()),this._badQuality=!1,this.resetBadQuality()}reset(){this.delEventListener(this.video),this.resetBadQuality(),this.resetStat(),this._paused=!1,this.video=null}resetBadQuality(){this._badQualityCnt=0,this._badQualityTime=0}resetStat(){this._startWaitingTs=0,this._badQuality=!1}start(t){this.reset(),this.addEventListener(t),this.video=t,q.add(this.onCheckStat,this,50)}stop(){this.reset(),q.remove(this.onCheckStat,this)}addEventListener(t){t&&(t.addEventListener("waiting",this.onWaitingBind),t.addEventListener("playing",this.onPlayingBind),t.addEventListener("pause",this.onPauseBind),t.addEventListener("canplaythrough",this.onCanplayThroughBind))}delEventListener(t){t&&(t.removeEventListener("waiting",this.onWaitingBind),t.removeEventListener("playing",this.onPlayingBind),t.removeEventListener("pause",this.onPauseBind),t.removeEventListener("canplaythrough",this.onCanplayThroughBind))}onCheckStat(t,e){!this._paused&&this._startWaitingTs>0&&t-this._startWaitingTs>200&&(this._badQuality||(this._badQuality=!0,this._badQualityCnt++))}onWaiting(t){0===this._startWaitingTs&&(this._startWaitingTs=y.a.now())}onPlaying(t){this.checkBadQuality(),this.resetStat(),this._paused=!1}onPause(t){this.checkBadQuality(),this.resetStat(),this._paused=!0}onCanplayThrough(t){this._paused||(this.checkBadQuality(),this.resetStat())}checkBadQuality(){if(this._badQuality&&this._startWaitingTs>0){let t=y.a.now()-this._startWaitingTs;f.a.log(`PauseStat.checkBadQuality badQualityTime=${t}, this.video.paused=${this.video.paused}`),this._badQualityTime+=t}}};var So=class{static create(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e||(e={}),t||((t=document.createElement("video")).id="_video_"+Math.floor(1e3*Math.random())),t.autoplay="safari"!==(qe.a.name+"").toLowerCase(),t.setAttribute("playsinline",!0),t.setAttribute("webkit-playsinline",!0),t.setAttribute("webkit-inline",!0),t.setAttribute("x-webkit-airplay","allow"),t.setAttribute("x5-video-player-type","h5"),t.setAttribute("x5-autoplay","true"),t.muted=!1,e.hasOwnProperty("autoplay")&&(t.autoplay=e.autoplay,t.setAttribute("x5-autoplay",e.autoplay?"true":"false")),t}static getErrorMessage(t){let e="message:";return t&&(e+="networkState="+t.networkState,t.error&&(e+=` errorcode=${t.error.code} details=${t.error.message}`)),e}};let To=1;var yo=class{constructor(t,e){let{stat:i,statVod:s,tsdb:r,videoElement:a,h265Proxy:o}=e;this.eventEmitter=t,this._videoElm=a,this._stat=i,this.statVod=s,this._tsdb=r,this._id=To++,this.anticode=new Ea,this._pauseStat=new go,this.started=!1,this.startTs=0,this.videoStatus=d,this.videoLoadTimeSent=!1,this.sysPause=!1,this.pauseByUser=!1,this.waiting=!1,this.ended=!1,this.hasEvents=!1,this.videoInfo=null,this._tickTs=0,this.lineType=0,this.loadeddataTs=0,this.allowedAutoPlay=!0,this.seekTime=0,this.noPictureSent=!1,this.isLoadstart=!1,this.playTimeout=5e3,this.urlNetworkstate=0,this.startPlayTs=0,this.h265Proxy=o,this._isEnded=!1,this._videoEvts=["loadstart","pause","loadedmetadata","loadeddata","error","canplay","canplaythrough","play","playing","stalled","suspend","volumechange","waiting","progress","emptied","ended","durationchange"],this._videoEvtHandlerBind=this._videoEvtHandler.bind(this),this._startUrlBind=this._startUrl.bind(this),this._refreshAnticodeBind=this._refreshAnticode.bind(this),this.anticode.on(Ea.Events.REFRESH,this._refreshAnticodeBind),this.videoChecker=new fi(this._videoElm,!1,{renderCallback:this._onVideoRender.bind(this)}),this.videoChecker.start(),this.videoFrameRenderTs=0,this.videoTimerRenderTs=0}_onVideoRender(t){t===fi.Types.FRAME?this.videoFrameRenderTs=y.a.now():this.videoTimerRenderTs=y.a.now()}get isPlaying(){return this.videoStatus!==d}get hasPicture(){return this.isPlaying}get notAllowedAutoplay(){return!this.allowedAutoPlay}get networkState(){return this._videoElm&&this._videoElm.networkState}printBlackInfo(){this._videoElm&&f.a.log(`HlsTagPlayer(${this._id}).printNetworkState: ${this._videoElm.networkState}`),this._videoElm&&this._videoElm.error&&f.a.log(`HlsTagPlayer(${this._id}).printError: ${this._videoElm.error.code}, ${this._videoElm.error.message}`)}get networkStateCode(){return this.urlNetworkstate||0}get errorCode(){return this._videoElm&&this._videoElm.error&&this._videoElm.error.code}start(t){t&&(this.videoInfo=t),this.videoInfo&&this.videoInfo.playTimeout&&(this.playTimeout=this.videoInfo.playTimeout),this.isLive=t.isLive,this._checkParams(this.videoInfo,this._startUrlBind),q.once(this._playVideoFailed,this,this.playTimeout),q.once(this._checkUrlActive,this,3e3)}stop(){this.videoChecker.destroy(),this._videoElm.pause(),this._videoElm.src="",this._delEvents(),q.remove(this.onPlayTimeout,this),q.remove(this.onCheckTimer,this),q.remove(this.onCheckFastTimer,this),q.remove(this._playVideoFailed,this),q.remove(this._checkUrlActive,this),this.reset(),f.a.log(`HlsTagPlayer(${this._id}).stop: player is stopped`)}triggerPlayTimeStatus(){this.eventEmitter.trigger(a.PLAY_TIME_STATUS,{current:this.getCurrentTime(),total:this.getDurationTime()})}reset(){f.a.log(`HlsTagPlayer(${this._id}).reset: player is reset`),this.started=!1,this.startTs=0,this.videoStatus=d,this.sysPause=!1,this.pauseByUser=!1,this.waiting=!1,this.ended=!1,this.hasEvents=!1,this.videoInfo=null,this._tickTs=0,this.lineType=0,this.loadeddataTs=0,this.seekTime=0}destroy(){this._videoElm.pause(),f.a.log(`HlsTagPlayer(${this._id}).stop: player is destory`),this.isAutoplaying=!1,this.startPlayTs=0,this.seekTime=0}getBufferLen(){let t=0;if(this._videoElm){const e=this._videoElm.buffered;e.length>0&&(t=1e3*(e.end(e.length-1)-this._videoElm.currentTime)>>0)}return t}seek(t){this.setCurrentTime(t)}setCurrentTime(t,e){if(0===this._videoElm.duration)return;t!==Math.ceil(this._videoElm.duration)?(this.seekTime=t,this._videoElm.currentTime=t,f.a.log(`HlsTagPlayer(${this._id}).setCurrentTime seekTime=${t}, currentTime=${this._videoElm.currentTime}, duration=${this._videoElm.duration}`),q.remove(this.onPlayTimeout,this),q.once(this.onSeekTimeout,this,e||2e4)):this._setEnded(1)}getCurrentTime(){return this._videoElm.currentTime}getDurationTime(){return this._videoElm.duration}setVolume(t){this._videoElm&&(this._videoElm.volume=t)}play(){f.a.log(`HlsTagPlayer(${this._id}).play: call play.`),this.pauseByUser=!1,this.sysPause=!1,this._addEvents(),this.playing||(this.startTs=y.a.now());const t=this._videoElm.play();return t?t.then(()=>{f.a.log(`HlsTagPlayer(${this._id}).play: play successfully`)}).catch(t=>{f.a.error(`HlsTagPlayer(${this._id}).play: playing error=`,t.toString(),this._videoElm.paused)}):f.a.warn(`HlsTagPlayer(${this._id}).play: play result is not a promise`),t}pause(){this.pauseByUser=!0,this._delEvents(),this._videoElm.pause()}getAnticodeHandler(){return this.anticode}_checkParams(t,e){t.sHlsUrl&&t.sStreamName?(t.sHlsUrl=t.sHlsUrl.replace("http://","https://"),t.sHlsAntiCode?(this.anticode.init(t.sHlsUrl,t.sStreamName,t.sHlsAntiCode),this.anticode.valid().then(()=>{e(t)})):e(t)):t.url?e(t):f.a.error(`HlsTagPlayer(${this._id}).checkParams has no params(sHlsUrl, sStreamName, url)`)}_initInfo(t){t.sHlsUrl&&t.sStreamName&&(t.url=t.sHlsUrl+"/"+t.sStreamName+".m3u8");const e=[];this.anticode.hasAnticode()&&e.push(this.anticode.getAnticode()),t.iBitRate>0&&e.push("ratio="+t.iBitRate);const i=P.a.platform,s=D.a.PLATFORM_TYPE[i]||D.a.PLATFORM_TYPE.web;let r=`${i===D.a.PLATFORM_TYPE_NAME.wap?`uid=${M.a.uid}&uuid=${M.a.uuid}`:"u="+M.a.convertUid}&t=${s}`;r=R.b.urlInfoParams(r,t),e.push(r),e.length>0&&(t.url+=(-1!==t.url.indexOf("?")?"&":"?")+e.join("&")),this.lineType=t.lineType,this.url=t.url}_startUrl(t){this._initInfo(t),f.a.log(`HlsTagPlayer(${this._id}).startUrl url=`,this.url),this.startTs=y.a.now(),this._stat.setComDim(L.a.DIM_COM.STREAM_URL,t.url),this._stat.setComDim(L.a.DIM_COM.P2P,L.a.LIVE_TYPE.HLS),this._stat.setComDim(L.a.DIM_COM.STREAM_TYPE,mr),this._stat.setComDim(L.a.DIM_COM.HLS_TYPE,t.isLhls?gr:_r);let e=t.vid||R.b.getQueryString("vid",t.url);this.statVod.setComDim(L.a.DIM_COM.STREAM_URL,t.url),this.statVod.setComDim(L.a.DIM_COM.STREAM_TYPE,mr),this.statVod.setComDim(L.a.DIM_COM.P2P,L.a.LIVE_TYPE.HLS),this.statVod.setComDim(L.a.VOD_DIM_COM.VOD_DURATION,t.duration||0),this.statVod.setComDim(L.a.VOD_DIM_COM.VOD_VIDEOSOURCEID,e||""),this.statVod.setComDim(L.a.VOD_DIM_COM.VODANCHORID,t.presenterUid||0),q.add(this.onCheckTimer,this,1e3),this._videoElm=this._createVideo(this.url),t.seekTime&&(this.seekTime=t.seekTime,this.isSeek=!0),this._addEvents()}_checkUrlActive(){const t=new XMLHttpRequest;t.open("HEAD",this.url),t.onreadystatechange=()=>{t.readyState==t.DONE&&(this.urlNetworkstate=t.status,f.a.log(`HlsTagPlayer(${this._id}).checkUrlActive current status: `,this.urlNetworkstate,this.url))},t.send()}_createVideo(t){if(this._videoElm)return this._videoElm.src=this.url,this._videoElm.getAttribute("x5-autoplay")?this._videoElm.autoplay=!0:this._videoElm.autoplay&&this._videoElm.setAttribute("x5-autoplay","true"),this._videoElm;{const e=document.createElement("video");return e.src=t,e.autoplay=!0,e.setAttribute("playsinline",!0),e.setAttribute("webkit-playsinline",!0),e.setAttribute("webkit-inline",!0),e.setAttribute("x-webkit-airplay","allow"),e.setAttribute("x5-video-player-type","h5"),e.setAttribute("x5-autoplay","true"),e.preload="auto",e}}_refreshAnticode(){this.initInfo(this.videoInfo)}_addEvents(){this._videoElm&&!this.hasEvents&&(this.hasEvents=!0,this._videoEvts.forEach(t=>{this._videoElm.addEventListener(t,this._videoEvtHandlerBind)}))}_delEvents(){this._videoElm&&this.hasEvents&&(this.hasEvents=!1,this._videoEvts.forEach(t=>{this._videoElm.removeEventListener(t,this._videoEvtHandlerBind)}))}_videoEvtHandler(t){switch(f.a.log(`HlsTagPlayer(${this._id})._videoEvtHandler event: e.type=`,t?t.type:t),t.type){case"loadstart":this.onLoadStart();break;case"pause":this.onVideoPause();break;case"loadedmetadata":this.onLoadedmetadata();break;case"loadeddata":this.onPlayVideo();break;case"playing":this.onPlayingVideo();break;case"error":this.onVideoError(t);break;case"ended":this.onEnded();break;case"durationchange":this.onDurationChange()}}_updateTime(){if(!this.ended&&this._videoElm&&this._videoElm.buffered&&this._videoElm.currentTime>0){const t=this._videoElm.buffered;if("function"!=typeof t.start||"function"!=typeof t.end)return void f.a.warn(`HlsTagPlayer(${this._id})._updateTime video.buffered start&end not a function`);for(let e=0;e<t.length;e++)if(t.start(e)<=this._videoElm.currentTime&&t.end(e)>=this._videoElm.currentTime){let i=t.end(e)-this._videoElm.currentTime;i=i<0?0:i,this._videoElm.duration>0&&this._videoElm.currentTime>=this._videoElm.duration?this._setEnded(3):this.eventEmitter.onPlayTime&&this.eventEmitter.onPlayTime(Math.floor(this._videoElm.currentTime),Math.floor(this._videoElm.duration),Math.floor(i));break}}}_setEnded(t){this.ended||(f.a.log(`HlsTagPlayer(${this._id})._setEnded, type=${t}`),this._reportVideoQuality(!0),this.ended=!0,this._videoElm.currentTime=this._videoElm.duration,this._videoElm.pause(),this.triggerPlayTimeStatus(),this.eventEmitter.onPlayEnded&&this.eventEmitter.onPlayEnded())}_checkPause(t){!this.ended&&!this.sysPause&&!this.pauseByUser&&this._setWaiting(this._pauseStat.waiting)}_updateStatus(t){this.videoStatus!==t&&(f.a.log(`HlsTagPlayer(${this._id})._updateStatus: ${this.videoStatus} -> ${t}`),this.videoStatus=t,this.eventEmitter.trigger(a.PLAY_STATUS,{status:t}))}_playVideoFailed(){if(pe.a.matches.Wechat&&!this.isLoadstart)return void f.a.log(`HlsTagPlayer(${this._id})._playVideoFailed webchat not trigger loadstart`);let t=`HlsTagPlayer(${this._id})._playVideoFailed: `+So.getErrorMessage(this._videoElm);f.a.error(t),this.eventEmitter.trigger(a.H5_PLAYER_ERROR,{code:D.a.H5_ERROR_CODE.PLAY_TIMEOUT,error:"play failed"}),q.remove(this._playVideoFailed,this)}onPlayTimeout(){this._videoElm&&(f.a.warn(`HlsTagPlayer(${this._id}).onPlayTimeout: userAgent=%s, paused=%s, pauseByUser=%s`,navigator.userAgent,this._videoElm.paused,this.pauseByUser),this._videoElm.paused?!this.pauseByUser&&this.eventEmitter.trigger(a.VIDEO_PAUSE):pe.a.matches.XiaoMi||0!==this._videoElm.currentTime||this.eventEmitter.trigger(a.PLAY_TIMEOUT))}onSeekTimeout(){f.a.log(`HlsTagPlayer(${this._id}).onSeekTimeout: seekTime=${this.seekTime}, currentTime=${this._videoElm&&this._videoElm.currentTime}`),this.seekTime>0&&this.seekTime===this._videoElm.currentTime&&!this.pauseByUser&&(this.seekTime=0,this.eventEmitter.trigger(a.SEEK_TIMEOUT))}onCheckTimer(t,e){0===this._tickTs?this._tickTs=t:t-this._tickTs>=2e4&&(this._tickTs=t,!this.started||this.pauseByUser||this.sysPause||this.ended?f.a.log(`HlsTagPlayer(${this._id}).onCheckTimer: heartbeat fail!{started=${this.started}, pauseByUser=${this.pauseByUser}, sysPause=${this.sysPause}}`):(f.a.log(`HlsTagPlayer(${this._id}).onCheckTimer: heartbeat suc`),this._reportVideoQuality(!1))),this.ended||this.triggerPlayTimeStatus()}onCheckFastTimer(t,e){!this.playing||this.pauseByUser||this.sysPause||(this._checkPause(t),e%10==0&&this._updateTime())}onLoadStart(){this.eventEmitter.onLoadStart&&this.eventEmitter.onLoadStart(),this.isLoadstart=!0}onLoadedmetadata(){f.a.log(`HlsTagPlayer(${this._id}).onLoadedmetadata, paused=`,this._videoElm.paused,this._videoElm.getAttribute("x5-autoplay"))}onVideoPause(){this.sysPause=!0,this.eventEmitter.trigger(a.VIDEO_PAUSE),this._updateStatus(u)}onPlayVideo(){if(!this.started&&(this.started=!0,f.a.log(`HlsTagPlayer(${this._id}).onPlayVideo, paused=`,this._videoElm.paused,this._videoElm.getAttribute("x5-autoplay"),"currentTime="+this._videoElm.currentTime),this.eventEmitter.trigger(a.VIDEO_PLAY,{video:this._videoElm}),this.eventEmitter.onPlayVideo&&this.eventEmitter.onPlayVideo({video:this._videoElm}),this.loadeddataTs=y.a.now()-this.startTs,q.remove(this.onPlayTimeout,this),this._videoElm.autoplay||this._videoElm.getAttribute("x5-autoplay"))){const t=this._videoElm.play();t?t.then(()=>{f.a.log(`HlsTagPlayer(${this._id}) Auto play is ok`),this.allowedAutoPlay=!0,q.remove(this._playVideoFailed,this),q.remove(this._checkUrlActive,this);const t=this._videoElm.duration;this.isSeek&&0!=t&&(f.a.log(`HlsTagPlayer(${this._id}).onPlayVideo, seek, duration=${t}`),this.startSeek())}).catch(t=>{f.a.warn(`HlsTagPlayer(${this._id}) auto playing error: `,t.toString(),this._videoElm.paused),this.eventEmitter.trigger(a.BROWSER_PAUSE),this._videoElm.paused&&(this._updateStatus(u),this.allowedAutoPlay=!1,q.remove(this._playVideoFailed,this),q.remove(this._checkUrlActive,this),this.eventEmitter.trigger(a.BROWSER_PAUSE,{video:this._videoElm}))}):(f.a.warn(`HlsPlayer(${this._id}) video.play is not a promise`),pe.a.matches.UC&&this._videoElm.paused?(f.a.log(`HlsPlayer(${this._id}) UC Browser, this._videoElm.paused =`,this._videoElm.paused),this._updateStatus(u),this.eventEmitter.trigger(a.BROWSER_PAUSE),this.allowedAutoPlay=!1,q.remove(this._playVideoFailed,this),q.remove(this._checkUrlActive,this),this.eventEmitter.trigger(a.BROWSER_PAUSE,{video:this._videoElm}),!this.isLive&&this._videoElm&&this._videoElm.pause()):q.once(this.onPlayTimeout,this,this.playTimeout||2e3))}}onPlayingVideo(){if(f.a.log(`HlsTagPlayer(${this._id}).onPlayingVideo, paused=`,this._videoElm.paused,this._videoElm.getAttribute("x5-autoplay")),this.sysPause=!1,this.ended=!1,this._updateStatus(h),!this.playing){this.playing=!0,this._pauseStat.start(this._videoElm),q.add(this.onCheckFastTimer,this,100),this.playTs=y.a.now();const t=this.playTs-this.startTs;t<=1e4&&(this._sendVideoLoadMetrics(t,this.loadeddataTs),this._sendVideoVodLoad(t)),q.remove(this._playVideoFailed,this)}}onDurationChange(){const t=this._videoElm.duration;this.isSeek&&0!=t&&this.started&&(f.a.log(`HlsTagPlayer(${this._id}).onDurationChange seek, duration=${t}`),this.startSeek())}onVideoError(t){f.a.log(`HlsTagPlayer(${this._id}).onVideoError: `+So.getErrorMessage(this._videoElm),t),this._videoElm&&this._videoElm.error&&(this._checkUrlActive(this.url),this.isPlaying||this._sendVideoVodLoad(99999),this.eventEmitter.trigger(a.H5_PLAYER_ERROR,{code:D.a.H5_ERROR_CODE.VIDEO_ERROR,video:this._videoElm,error:t}),this.eventEmitter.onPlayerError&&this.eventEmitter.onPlayerError())}onEnded(t){f.a.log(`HlsTagPlayer(${this._id}).onEnded`,this.getCurrentTime()),this._setEnded(2)}startSeek(){this.setCurrentTime(this.seekTime),this.isSeek=!1}_sendVideoLoadMetrics(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._stat.setComDim(L.a.DIM_COM.ACT_LOAD_TYPE,D.a.HLS_LOAD_TYPE.XHR);const i=[this._stat.createAct(L.a.ACT.VIDEO_LOAD_TS,{value:[t,e]})];this._tsdb.sendMetrics(i)}sendNoPicture(){f.a.log(`HlsTagPlayer(${this._id}).sendNoPicture hasPicture=${this.hasPicture} isLive=${this.isLive}`),this.hasPicture||this.isLive||(this.statVod.setActDim(L.a.VOD_DIM_COM.CREATE_TIME,y.a.now()-this.statVod.create_time),this._tsdb.sendVodMP4Time({loadTime:99999,errorMessage:So.getErrorMessage(this._videoElm)}))}_sendVideoVodLoad(t){this.isLive||this.videoLoadTimeSent||(this.videoLoadTimeSent=!0,f.a.log(`HlsTagPlayer(${this._id})._sendVideoVodLoad`,t),this.statVod.setActDim(L.a.VOD_DIM_COM.CREATE_TIME,y.a.now()-this.statVod.create_time),this.hasPicture||(t=99999),this._tsdb.sendVodMP4Time({loadTime:t}))}_setWaiting(t){if(this.waiting!==t){this.waiting=t,this.eventEmitter.trigger(a.PLAY_CARTON,t);const e=t?l:h;this._updateStatus(e)}}_reportVideoQuality(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const e=[];this._stat.setCore(L.a.CORE.PLAY_DELAY,this.getBufferLen()),this._stat.setCore(L.a.CORE.VIDEO_BLOCK_COUNT,this._pauseStat._badQualityCnt),this._stat.setCore(L.a.CORE.VIDEO_BLOCK_DURATION,this._pauseStat._badQualityTime),this._stat.setCoreDim(L.a.DIM_CORE.VIDEO_BAD_QUALITY,this._pauseStat.paused?100:0),this.statVod.setCore(L.a.VOD_CORE.VOD_BAD_QUALITY,this._pauseStat.paused?100:0),this.statVod.setCore(L.a.VOD_CORE.VOD_BLOCK_COUNT,this._pauseStat._badQualityCnt),this.statVod.setCore(L.a.VOD_CORE.VOD_BLOCK_DURATION,this._pauseStat._badQualityTime),this.statVod.setComDim(L.a.VOD_DIM_COM.BACKUP_FIELD4,this.videoChecker.isSupportRVCB?1:2),this.statVod.setComDim(L.a.VOD_DIM_COM.BACKUP_FIELD1,y.a.now()-this.videoFrameRenderTs),this.statVod.setComDim(L.a.VOD_DIM_COM.BACKUP_FIELD3,y.a.now()-this.videoTimerRenderTs),this._stat.fill(e,t),this.isLive||this.statVod.fill(e,t),this._tsdb.sendMetrics(e),this._pauseStat.checkBadQuality(),this._pauseStat.reset20()}setMuted(t){this._videoElm&&(this._videoElm.muted=t)}getCodecType(){return ye}getVideoWidth(){return this._videoElm?this._videoElm.videoWidth:0}getVideoHeight(){return this._videoElm?this._videoElm.videoHeight:0}getFps(){return-100}setPlaybackRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._videoElm&&(this._videoElm.playbackRate=Number(t))}};let Eo=1;var vo=class{constructor(t,e){let{stat:i,statVod:s,tsdb:r,videoElement:a,options:o}=e;this.eventEmitter=t,this.stat=i,this.statVod=s,this.tsdb=r,this._id=Eo++,this.started=!1,this.videoElement=So.create(a,o),this.createVideoElmInner=!1,this.videoStatus=d,this.startTs=0,this.lastCheckPlayTs=0,this.lastPausePlayTs=0,this.lastPauseTs=0,this.resumeTs=0,this.videoIsBadQuality=!1,this.pauseDuration=0,this.pauseDurationReal=0,this.pauseTimes=0,this.pauseBuffer=[],this.pauseDownBuffer=[],this.pauseCurrentTime=[],this.seeking=!1,this.downTotalBufTs=0,this.videoDuration=0,this.videoLoadTime=0,this.videoLoadTimeSent=!1,this.playTimeout=5e3,this.retryCnt=1,this.lastInfo=null,this._onLoadedMetadataBind=this._onLoadedMetadata.bind(this),this._onLoadedDataBind=this._onLoadedData.bind(this),this._onVideoEndedBind=this._onVideoEnded.bind(this),this._onVideoPlayingBind=this._onVideoPlaying.bind(this),this._onVideoErrorBind=this._onVideoError.bind(this),this._onVideoSeekBind=this._onVideoSeek.bind(this),this._onVideoSeekingBind=this._onVideoSeeking.bind(this),this._isEnded=!1,this._seekCnt=0,this.vodBadReason=0,this.videoErrorTs=0,this.isTestPaused=!1,this.isLoopEnded=!1,this.isPlayVideo=!1,this._heartTs=0,this.videoChecker=new fi(this.videoElement,!1,{renderCallback:this._onVideoRender.bind(this)}),this.videoChecker.start(),this.videoFrameRenderTs=0,this.videoTimerRenderTs=0,this.url=""}_onVideoRender(t){t===fi.Types.FRAME?this.videoFrameRenderTs=y.a.now():this.videoTimerRenderTs=y.a.now()}setVolume(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.videoElement&&(this.videoElement.volume=t)}retryStart(){return this.retryCnt>0&&(this.retryCnt--,!0)}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isPlayVideo=!1,this.isLoopEnded=!1,this.lastInfo=t,this.resumeTs=0,this.videoErrorTs=0,q.remove(this._videoErrorRetry,this),this.started&&this.stop(),t.playTimeout&&(this.playTimeout=t.playTimeout),t.retryCnt&&(this.retryCnt=t.retryCnt),this.started=!0;let e=t.url;e=this._addUrlParams(e),this.url=e,this._addVideoListeners(),f.a.log(`MP4Player(${this._id}) is started! url=${e}`),this.videoElement.src=e,this.videoElement.load(),t.seekTime&&this.seek(t.seekTime),this.startTs=y.a.now(),wt.setMP4Status(Rt),this.stat.setComDim(L.a.DIM_COM.STREAM_URL,e),this.stat.setComDim(L.a.DIM_COM.STREAM_TYPE,fr),this.stat.setComDim(L.a.VOD_DIM_COM.VOD_MP4_SIZE,t.mp4Size||0),this.stat.setComDim(L.a.VOD_DIM_COM.VOD_DURATION,t.duration||0),this.stat.setComDim(L.a.DIM_COM.ANCHOR_UID,t.presenterUid||0);let i=t.vid||R.b.getQueryString("vid",this.url);this.stat.setComDim(L.a.VOD_DIM_COM.VOD_VIDEOSOURCEID,i||""),Ca.setVodCdnDomain(this.stat,e),this.statVod.setComDim(L.a.DIM_COM.STREAM_URL,e),this.statVod.setComDim(L.a.DIM_COM.STREAM_TYPE,fr),this.statVod.setComDim(L.a.VOD_DIM_COM.VOD_MP4_SIZE,t.mp4Size||0),this.statVod.setComDim(L.a.VOD_DIM_COM.VOD_DURATION,t.duration||0),this.statVod.setComDim(L.a.VOD_DIM_COM.VOD_VIDEOSOURCEID,i||""),this.statVod.setComDim(L.a.VOD_DIM_COM.VODANCHORID,t.presenterUid||0),Ca.setVodCdnDomain(this.statVod,e),q.once(this._playVideoFailed,this,this.playTimeout)}_playVideoFailed(){f.a.log(`MP4Player(${this._id}) _playVideoFailed`),this.retryStart()?(f.a.log(`MP4Player(${this._id}) _playVideoFailed retryPlay!`),q.remove(this._videoErrorRetry,this),this.start(this.lastInfo)):this.eventEmitter.trigger(m.H5_PLAYER_ERROR,{code:D.a.H5_ERROR_CODE.PLAY_TIMEOUT,error:"play failed"})}stop(){this.started=!1,this.videoStatus=d,this._heartTs=0,this.videoChecker.destroy(),this.videoElement.src="",this._removeVideoListeners(),this._removePlayTimer(),this._statReport(!0),q.remove(this._playVideoFailed,this),q.remove(this._videoErrorRetry,this),this.isTestPaused=!1,this.isLoopEnded=!1,f.a.log(`MP4Player(${this._id}) is stopped`)}pause(){f.a.log(`MP4Player(${this._id}) pause`),this.videoElement&&this.videoElement.pause()}play(){f.a.log(`MP4Player(${this._id}).play`),this.videoElement&&this.videoElement.play()}seek(t){f.a.log(`MP4Player(${this._id}) seek`,t),this.seeking=!0,this.videoElement.currentTime=t}getDurationTime(){return this.videoElement.duration}getCurrentTime(){return this.videoElement.currentTime}addNoPictureReason(){const t=wt.getMP4NoPictureReason();this.stat.setActDim(L.a.VOD_DIM_COM.VOD_NO_PICTURE_REASON,t),this.statVod.setActDim(L.a.VOD_DIM_COM.VOD_NO_PICTURE_REASON,t)}get isPlaying(){return this.videoStatus!==d}get hasPicture(){return this.isPlaying}get paused(){return this.isPlaying&&this.videoElement.paused}sendNoPicture(t){f.a.log(`MP4Player(${this._id}) sendNoPicture hasPicture=${this.hasPicture} videoLoadTimeSent=${this.videoLoadTimeSent}`),this.hasPicture||this.videoLoadTimeSent||(this.videoLoadTimeSent=!0,this.statVod.setActDim(L.a.VOD_DIM_COM.CREATE_TIME,y.a.now()-this.statVod.create_time),this.tsdb.sendVodMP4Time({loadTime:99999,errorMessage:this.getErrorMessage()}))}_sendVideoLoadTime(t){if(this.videoLoadTimeSent)return void f.a.log(`MP4Player(${this._id}) _sendVideoLoadTime, videoLoadTimeSent=true`);this.videoLoadTimeSent=!0,t=t||y.a.now()-this.startTs,this.statVod.setActDim(L.a.VOD_DIM_COM.CREATE_TIME,t);let e=this.videoLoadTime,i="";this.hasPicture||(e=99999,i=this.getErrorMessage()),99999===e?(Lt.addVodFail(this.url),this.tsdb.autoReport()):Lt.delVodFail(this.url);let s=0;0!=this.videoErrorTs&&(s=this.videoErrorTs-this.startTs),f.a.log(`MP4Player(${this._id}) _sendVideoLoadTime, loadTime=${e}, errorLoadTime=${s} errorMessage=${i}`),this.tsdb.sendVodMP4Time({loadTime:e,errorLoadTime:s,errorMessage:i})}_addUrlParams(t){const e=P.a.platform,i=D.a.PLATFORM_TYPE[e]||D.a.PLATFORM_TYPE.web;t+=-1===t.indexOf("?")?"?":"&";return t+=`${e===D.a.PLATFORM_TYPE_NAME.wap?`&uid=${M.a.uid}&uuid=${M.a.uuid}`:"&u="+M.a.convertUid}&t=${i}`,t=R.b.urlInfoParams(t,this.lastInfo)}_checkVideoFreeze(){if(!this.videoElement)return;if(this.paused)return;const t=this.getDurationTime(),e=this.videoElement.currentTime;this.videoElement.loop&&!this.isLoopEnded&&e>0&&t>0&&1e3*t-1e3*e<=200&&(f.a.log(`MP4Player(${this._id}).onCheckFastTimer.VIDEO_LOOP_ENDED`),this.eventEmitter.trigger(m.VIDEO_LOOP_ENDED),this.isLoopEnded=!0);const i=+Date.now(),s=+Date.now()-this.lastPauseTs;if(this.lastCheckPlayTs&&this.lastCheckPlayTs===this.videoElement.currentTime){const t=this.lastPausePlayTs,r=this.getBufferLen();return f.a.log(`MP4Player(${this._id})._checkVideoFreeze,buffer=${r},totalBuffer=${this.downTotalBufTs},pauseDuration=${s},curtime=${this.videoElement.currentTime},resumeTs=${this.resumeTs},delta=${i-this.resumeTs},seeking=${this.seeking}`),s>=200&&t!==this.videoElement.currentTime?(this.seeking||(this.videoIsBadQuality=!0,this.pauseDuration+=s,this.pauseTimes+=1,Lt.addBadQualityVod(this.url),s>=200&&(this.pauseBuffer.length<20&&this.pauseBuffer.push(r),this.pauseDownBuffer.length<20&&this.pauseDownBuffer.push(~~this.downTotalBufTs),this.pauseCurrentTime.length<20&&this.pauseCurrentTime.push(~~e)),this.vodBadReason=r<2e3?ti.CODE:ri.CODE),this.pauseDurationReal+=s,this.lastPauseTs=+Date.now(),this.lastPausePlayTs=this.videoElement.currentTime,this.videoStatus=l,this.isTestPaused=!0,this.eventEmitter.trigger(m.PLAY_CARTON,{video:this.videoElement,pauseDuration:this.pauseDurationReal})):s>=200&&(this.seeking||(this.pauseDuration+=s),this.pauseDurationReal+=s,this.lastPauseTs=+Date.now(),this.videoStatus=l,this.isTestPaused=!0,this.eventEmitter.trigger(m.PLAY_CARTON,{video:this.videoElement,pauseDuration:this.pauseDurationReal})),void(0!=this.resumeTs&&i-this.resumeTs>=5e3&&this.pause5sRestart(this.videoElement.currentTime))}this.isTestPaused&&(f.a.log(`Mp4Player(${this._id}).resume`),this.eventEmitter.trigger(m.VIDEO_PLAYING,{video:this.videoElement})),this.isTestPaused=!1,this.resumeTs=+Date.now(),this.lastCheckPlayTs=this.videoElement.currentTime,this.lastPauseTs=+Date.now()}_checkBuffer(){if(this.downTotalBufTs===this.videoDuration)return;const t=this.videoElement.buffered,e=t.length;let i=0;for(let s=0;s<e;s++){const e=t.start(s);i+=t.end(s)-e}this.downTotalBufTs=i}getBufferLen(){let t=0;if(this.videoElement){let e=this.videoElement.buffered;e.length>0&&(t=1e3*(e.end(e.length-1)-this.videoElement.currentTime)>>0)}return t}_addVideoListeners(){this.videoElement.addEventListener("loadedmetadata",this._onLoadedMetadataBind),this.videoElement.addEventListener("loadeddata",this._onLoadedDataBind),this.videoElement.addEventListener("ended",this._onVideoEndedBind),this.videoElement.addEventListener("playing",this._onVideoPlayingBind),this.videoElement.addEventListener("error",this._onVideoErrorBind),this.videoElement.addEventListener("seeking",this._onVideoSeekingBind),this.videoElement.addEventListener("seeked",this._onVideoSeekBind)}_removeVideoListeners(){this.videoElement.removeEventListener("loadedmetadata",this._onLoadedMetadataBind),this.videoElement.removeEventListener("loadeddata",this._onLoadedDataBind),this.videoElement.removeEventListener("ended",this._onVideoEndedBind),this.videoElement.removeEventListener("playing",this._onVideoPlayingBind),this.videoElement.removeEventListener("error",this._onVideoErrorBind),this.videoElement.removeEventListener("seeking",this._onVideoSeekingBind),this.videoElement.removeEventListener("seeked",this._onVideoSeekBind)}_initPlayTimer(){q.add(this._checkVideoFreeze,this,100),q.add(this._checkBuffer,this,100),q.add(this._onHeart20sMetric,this,1e3)}_removePlayTimer(){q.remove(this._checkVideoFreeze,this),q.remove(this._checkBuffer,this),q.remove(this._onHeart20sMetric,this)}_onLoadedMetadata(t){f.a.log(`MP4Player(${this._id})._onLoadedData`),this.eventEmitter.trigger(m.VIDEO_PLAY,{video:this.videoElement,width:this.videoElement.videoWidth,height:this.videoElement.videoHeight}),q.remove(this._playVideoFailed,this)}_onLoadedData(t){const e=y.a.now();this.videoStatus=h,this.videoDuration=this.videoElement.duration,f.a.log(`MP4Player(${this._id})._onLoadedData, currentTime=${this.videoElement.currentTime}, videoDuration=${this.videoDuration}`),this.triggerPlayTimeStatus(),this._initPlayTimer(),this.isPlayVideo=!0,0!==this.startTs&&(this.videoLoadTime=e-this.startTs,this.tsdb.sendMP4Time({loadTime:this.videoLoadTime}),!this.videoLoadTimeSent&&this.videoLoadTime<=1e4&&this._sendVideoLoadTime()),this.stat.setComDim(L.a.DIM_COM.STREAM_TOTAL_DURATION,this.videoDuration);let i=this.videoElement.play();i&&i.then(()=>{f.a.log(`MP4Player(${this._id}) autoplay success`)}).catch(t=>{f.a.warn(`MP4Player(${this._id}) autoplay fail, change volume to 0 try play again,  error: ${t.message}`),this.eventEmitter.trigger(m.BROWSER_PAUSE)})}_onVideoEnded(t){f.a.log(`MP4Player(${this._id})._onVideoEnded`),this.triggerPlayTimeStatus(),this.eventEmitter.trigger(m.VIDEO_ENDED,{video:this.videoElement}),this._isEnded=!0,this.started&&this._statReport(!0)}_onVideoPlaying(){f.a.log(`MP4Player(${this._id})._onVideoPlaying`),this.seeking=!1,this._isEnded=!1}getErrorMessage(){return So.getErrorMessage(this.videoElement)}_onVideoError(t){const e=100*Math.random();f.a.log(`MP4Player(${this._id})._onVideoError `,e,this.getErrorMessage(),this.videoElement.error),this.videoElement.error&&(this.videoErrorTs=y.a.now(),this.retryStart()?(f.a.log(`Mp4Player(${this._id})._onVideoError, retry!`),q.remove(this._playVideoFailed,this),q.once(this._videoErrorRetry,this,2e3)):(wt.setMP4Status(Ot),!this.isPlayVideo&&e<=P.a.mp4ErrorReportRandom&&(f.a.log(`Mp4Player(${this._id})._onVideoError, noPicture`),this._sendVideoLoadTime()),this.eventEmitter.trigger(m.VIDEO_MP4_ERROR)))}_videoErrorRetry(){Lt.addRetryStreamVod(this.url),this.start(this.lastInfo)}_onVideoSeeking(t){const e=this.videoElement?this.videoElement.currentTime:0;f.a.log(`MP4Player(${this._id})._onVideoSeeking, cur=${e}`,t),this.seeking=!0}_onVideoSeek(t){const e=this.videoElement?this.videoElement.currentTime:0;this.seeking=!1,f.a.log(`MP4Player(${this._id})._onVideoSeek, cur=${e}`,t),e>1&&this._seekCnt++,this.isLoopEnded=!1}_onHeart20sMetric(t,e){this.started&&(this._isEnded||(0===this._heartTs?this._heartTs=t:t-this._heartTs>=2e4&&(this._heartTs=t,this._statReport(!1))),this.triggerPlayTimeStatus())}_statReport(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.stat.setCoreDim(L.a.DIM_CORE.VIDEO_BAD_QUALITY,this.videoIsBadQuality?100:0),this.stat.setCore(L.a.CORE.VIDEO_BLOCK_COUNT,this.pauseTimes),this.stat.setCore(L.a.CORE.VIDEO_BLOCK_DURATION,this.pauseDuration),this.stat.setCore(L.a.CORE.STREAM_BUFFERED,this.downTotalBufTs),this.statVod.setCore(L.a.VOD_CORE.VOD_BAD_REASON,this.vodBadReason),this.statVod.setComDim(L.a.VOD_DIM_COM.BACKUP_FIELD6,this.getBufferLen()),this.statVod.setComDim(L.a.VOD_DIM_COM.BACKUP_FIELD5,Math.floor(this.downTotalBufTs));const e=this.pauseCurrentTime.join(",")+"|"+this.pauseBuffer.join(",")+"|"+this.pauseDownBuffer.join(",")+"|"+this._seekCnt;this.statVod.setComDim(L.a.VOD_DIM_COM.BACKUP_FIELD2,e),this.statVod.setComDim(L.a.VOD_DIM_COM.BACKUP_FIELD4,this.videoChecker.isSupportRVCB?1:2),this.statVod.setComDim(L.a.VOD_DIM_COM.BACKUP_FIELD1,y.a.now()-this.videoFrameRenderTs),this.statVod.setComDim(L.a.VOD_DIM_COM.BACKUP_FIELD3,y.a.now()-this.videoTimerRenderTs),this.statVod.setCore(L.a.VOD_CORE.VOD_BAD_QUALITY,this.videoIsBadQuality?100:0),this.statVod.setCore(L.a.VOD_CORE.VOD_BLOCK_COUNT,this.pauseTimes),this.statVod.setCore(L.a.VOD_CORE.VOD_BLOCK_DURATION,this.pauseDuration),this.statVod.setCore(L.a.CORE.STREAM_BUFFERED,this.downTotalBufTs),this.lastCheckPlayTs=0,this.lastPausePlayTs=0,this.lastPauseTs=0,this.videoIsBadQuality=!1,this.pauseDuration=0,this.pauseTimes=0,this.pauseBuffer.length=0,this.pauseDownBuffer.length=0,this.pauseCurrentTime.length=0,this._seekCnt=0,this.vodBadReason=0;let i=[];this.stat.fill(i,t),this.statVod.fill(i,t),this.tsdb.sendMetrics(i)}triggerPlayTimeStatus(){this.eventEmitter.trigger(m.PLAY_TIME_STATUS,{current:this.getCurrentTime(),total:this.getDurationTime()})}setVolume(t){f.a.log(`MP4Player(${this._id}).setVolume`,t),this.videoElement&&(this.videoElement.volume=t)}getCodecType(){return ye}getVideoWidth(){return this.videoElement&&this.videoElement.videoWidth}getVideoHeight(){return this.videoElement&&this.videoElement.videoHeight}getFps(){return-100}setPlaybackRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;f.a.log(`MP4Player(${this._id}).setPlaybackRate`,t),this.videoElement&&(this.videoElement.playbackRate=Number(t))}setLoop(t){f.a.log(`MP4Player(${this._id}).setLoop`,t),this.videoElement&&(this.videoElement.loop=!!t)}setMuted(t){f.a.log(`MP4Player(${this._id}).setMuted`,t),this.videoElement&&(this.videoElement.muted=!!t)}pause5sRestart(){if(f.a.log(`MP4Player(${this._id}).pause5sRestart!`),!this.videoElement)return;const t=this.videoElement.currentTime;this.start(this.lastInfo),this.seek(t)}};var Co=class{constructor(t,e){this._hyPlayer=t,this._observer=S(),this._player=null,this._stat=e.stat,this._tsdb=e.tsdb,this._videoElement=e.videoElement,this._onObserverBind=this._onObserver.bind(this),this._observer.on(m.VIDEO_PLAY,this._onObserverBind),this._observer.on(m.FLV_URL_UNAVAILABLE,this._onObserverBind),this._observer.on(m.H5_PLAYER_ERROR,this._onObserverBind),this._observer.on(m.NO_DATA_RECEIVED,this._onObserverBind),this._observer.on(m.P2P_TIMEOUT,this._onObserverBind),this._observer.on(m.FLV_TRY_TO_P2P,this._onObserverBind),this._info=null,this._data=null,this._vr=null,this._viewWidth=0,this._viewHeight=0,this._hyPlayer.setSize=this.setSize.bind(this),this._hyPlayer.addViewport=this.addViewport.bind(this),this._hyPlayer.getViewport=this.getViewport.bind(this),this._hyPlayer.setViewport=this.setViewport.bind(this)}_onObserver(t,e){switch(t){case m.VIDEO_PLAY:this.onPlayVideo(t,e);break;case m.FLV_URL_UNAVAILABLE:case m.H5_PLAYER_ERROR:case m.NO_DATA_RECEIVED:case m.P2P_TIMEOUT:this._hyPlayer.trigger(t);break;case m.FLV_TRY_TO_P2P:this._hyPlayer.lastP2PInfo&&(this._hyPlayer.lastP2PInfo.vr.playerType=1,this.start(this._hyPlayer.lastP2PInfo))}}destroy(){this.stop(),this._data=null}disposeVr(){this._vr&&(this._vr.dispose(),this._vr=null)}disposePlayer(){this._player&&(this._player.stop(),this._player=null)}start(t){this.disposeVr(),this.disposePlayer(),f.a.log("VrPlayer.play",t),this._info=t,this._stat.setComDim(L.a.DIM_COM.VR_MODE,t.vr&&t.vr.type?t.vr.type:0);let e=Object.assign({},t),i=null;i=t.streamType===hd.StreamType.MP4?vo:hd.isSupported()?no:yo,i?(this._player=new i(this._observer,{stat:this._stat,tsdb:this._tsdb,videoElement:this._videoElement}),this._player.start(e)):f.a.error("play error, streamType=",t.streamType)}stop(){_o.off(_o.ON_LOAD,this.onLoadVrLib,this),this._viewWidth=0,this._viewHeight=0,this.disposeVr(),this.disposePlayer()}setVolume(t){this._player&&this._player.setVolume(t)}setMuted(t){this._player&&this._player.setMuted(t)}getMuted(){return!!this._player&&this._player.getMuted()}getBufferLen(){return this._player?this._player.getBufferLen():0}getCurrentTime(){return this._player?this._player.getCurrentTime():0}getCurrentDts(){return this._player?this._player.getCurrentDts():0}getCurrentSeiOffsetDts(){return this._player?this._player.getCurrentSeiOffsetDts():0}getDurationTime(){return this._player?this._player.getDurationTime():0}get connected(){return!!this._player&&this._player.connected}get isPlaying(){return!!this._player&&this._player.isPlaying}get hasPicture(){return!!this._player&&this._player.hasPicture}play(){this._player&&this._player.play()}pause(){this._player&&this._player.pause()}updatePlayerStatus(t){this._info.streamType===hd.StreamType.HLS&&(this._player.started=t)}seek(t){this._player&&this._player.seek(t)}setSize(t,e){this._viewWidth=t,this._viewHeight=e,this._vr&&this._vr.setSize(t,e)}getViewport(){return this._vr?this._vr.getViewport():{x:0,y:0,z:0}}setViewport(t){this._vr&&this._vr.setViewport(t)}addViewport(t){this._vr&&this._vr.addViewport(t)}onPlayVideo(t,e){this._data=e,this._info.vr.videoWidth=e.width,this._info.vr.videoHeight=e.height,_o.on(_o.ON_LOAD,this.onLoadVrLib,this),_o.loadLib(this._info.h5Root)}onLoadVrLib(){_o.off(_o.ON_LOAD,this.onLoadVrLib,this),this._data.width=this._viewWidth||this._data.width,this._data.height=this._viewHeight||this._data.height,this._vr=_o.createVr(this._data.video,this._info.vr),this._vr.play(),this._hyPlayer.trigger(m.VIDEO_PLAY,{video:this._vr.getView(),width:this._data.width,height:this._data.height})}};var Po=class{constructor(){this._ignoreMap=new Map,this._ignoreDefault=!1,this.initLv()}addStreamUrl(t,e){let i=P.a.statLv;R.b.isOpen(P.a.statCfg,t,e,!1)&&i[2]>0&&this._ignoreMap.set(L.a.DIM_COM.STREAM_URL,1)}initLv(t,e){this._ignoreDefault=!1,this._ignoreMap.clear();let i=P.a.statLv,s=R.b.isOpen(P.a.statCfg,t,e,!1);if(f.a.log(`StatFilter.init isOpen=${s} statLv=${i}`),s){this._ignoreDefault=1===i[0];let t=this._ignoreMap;t.clear(),i[1]>0&&(t.set(L.a.DIM_CORE.VIDEO_BAD_QUALITY_OLD,1),t.set(L.a.DIM_COM.P2P_COOL_FLAG,1),t.set(L.a.DIM_COM.ACT_LOAD_TYPE,1)),i[2]>0&&(i[2]>1&&t.set(L.a.DIM_COM.STREAM,1),t.set(L.a.DIM_COM.CDP_ID,1)),i[3]>0&&(i[3]>1&&(t.set(L.a.DIM_COM.V_RECV_FRAMES,1),t.set(L.a.DIM_COM.V_RECV_FRAME,1),t.set(L.a.DIM_COM.V_PLAY_FRAME,1),t.set(L.a.DIM_COM.V_TO_PLAY_FRAME,1),t.set(L.a.DIM_COM.VISIBILITY_STATE,1)),t.set(L.a.DIM_COM.VIDEO_PAUSE_BUFFERS,1),t.set(L.a.DIM_COM.VIDEO_PAUSE_CONTINUE_BUFFERS,1),t.set(L.a.DIM_LINK_STA.name,1),t.set(L.a.DIM_LINK_SAM.name,1),t.set(L.a.FRAME_INFO.name,1)),i[4]>0&&t.set(L.a.AI_CONTROL_DATA.name,1),i[5]>0&&(i[5]>1&&(t.set(L.a.SUB_INFO.name,1),t.set(L.a.PUNCH_INFO.name,1)),t.set(L.a.CORE.FORWARD_REJECT_CNT,1),t.set(L.a.DIM_COM.SUB_CHANGE_STATE,1),t.set(L.a.UPDOWN_INFO.name,1),t.set(L.a.PUNCH_BACK_RET.name,1),t.set(L.a.SUBSTREAM_INFO.name,1),t.set(L.a.FORCESUB_REASON.name,1),t.set(L.a.SUB_RETURN.name,1),t.set(L.a.NONODE_RETURN.name,1),t.set(L.a.P2P_TCP_TYPE.name,1),t.set(L.a.P2P_TCP_STATE.name,1)),i[6]>0&&(t.set(L.a.DIM_COM.BROWSER_NAME,1),t.set(L.a.DIM_COM.BROWSER_VERSION,1),t.set(L.a.DIM_COM.BROWSER_KERNEL,1),t.set(L.a.DIM_COM.BROWSER_KERNEL_VERSION,1),t.set(L.a.DIM_COM.OS_NAME,1),t.set(L.a.DIM_COM.OS_VERSION,1),t.set(L.a.DIM_COM.RENDER_INFO,1)),i[7]>0&&(t.set(L.a.DIM_COM.STREAM_INDEX,1),t.set(L.a.DIM_COM.OBS_RENDER_MODE,1),t.set(L.a.CORE.OBS_FPS,1),t.set(L.a.CORE.OBS_UPLOAD_TS,1)),i[8]>0&&(t.set(L.a.DIM_COM.VR_ENABLE,1),t.set(L.a.DIM_COM.VR_MODE,1)),i[9]>0&&(t.set(L.a.DIM_COM.CDN_CIP,1),t.set(L.a.DIM_COM.CDN_SIP,1),t.set(L.a.DIM_COM.ALT_SVC,1),t.set(L.a.DIM_COM.QUIC,1)),i[10]>0&&(i[10]>3&&(t.set("pcdn_hot_degree_in",1),t.set("pcdn_hot_degree_kick",1),t.set("pcdn_hot_degree",1),t.set("get_pcdn_url_result",1),t.set(L.a.DIM_COM.CLI_ISP,1),t.set(L.a.DIM_COM.CLI_PROV,1),t.set(L.a.DIM_COM.PCDN_SVR_ISP,1),t.set(L.a.DIM_COM.PCDN_SVR_AREA,1)),i[10]>2&&(t.set(L.a.PCDN_DATA.GET_PCDN_URL_TOTAL_CNT,1),t.set(L.a.PCDN_DATA.GET_PCDN_URL_SUCCESS,1),t.set(L.a.PCDN_DATA.GET_PCDN_URL_SUC_FREETIME,1),t.set(L.a.PCDN_DATA.GET_PCDN_ERR_NOT_REACHED,1),t.set(L.a.PCDN_DATA.GET_PCDN_ERR_OVER_RUN,1),t.set(L.a.PCDN_DATA.GET_PCDN_ERR_OVER_RUN_FREETIME,1),t.set(L.a.PCDN_DATA.GET_PCDN_ERR_NOT_COVERD,1),t.set(L.a.PCDN_DATA.GET_PCDN_ERR_OTHER,1),t.set(L.a.PCDN_DATA.GET_PCDN_ERROR_REQ,1),t.set(L.a.PCDN_DATA.GET_SUBS_URL_ERROR_CNT,1),t.set(L.a.PCDN_DATA.GET_PCDN_DATA_TIME,1),t.set(L.a.PCDN_DATA.GET_PCDN_DATA_TIME_CNT,1),t.set(L.a.PCDN_DATA.GET_PCDN_SUBS_URL_TIME,1),t.set(L.a.PCDN_DATA.GET_PCDN_SUBS_URL_TIME_CNT,1),t.set(L.a.PCDN_DATA.GET_CDN_DATA_TIME,1),t.set(L.a.PCDN_DATA.GET_CDN_DATA_TIME_CNT,1)),i[10]>1&&(t.set(L.a.DIM_COM.SUB_PCDN_STATE,1),t.set(L.a.DIM_COM.FLV_PCDN_STATE,1)),t.set("pcdn_pull_stream_user_cnt",1),t.set("pcdn_get_proxy_user_cnt",1),t.set(L.a.PCDN_BW_DATA.name,1)),i[11]>0&&(i[11]>1&&(t.set(L.a.CORE.REAL_KBPS_SAMPLE,1),t.set(L.a.CORE.REAL_FLAC_KBPS_SAMPLE,1),t.set(L.a.CORE.RECV_TOTAL_SAMPLE,1),t.set(L.a.CORE.RECV_LAN_SAMPLE,1)),t.set(L.a.DIM_COM.AUTO_U_REASON,1),t.set(L.a.DIM_COM.AUTO_D_REASON,1),t.set(L.a.DIM_COM.AUTO_HEART_TYPE,1),t.set(L.a.DIM_COM.AUTO_CODEC_CHANGE_TYPE,1),t.set(L.a.DIM_COM.AUTO_BAD_REASON,1),t.set(L.a.DIM_COM.AUTO_BAD_MIN_REASON,1),t.set(L.a.CORE.AUTO_SWITCH_CNT,1),t.set(L.a.CORE.AUTO_SWITCH_SAME_CNT,1),t.set(L.a.CORE.AUTO_BAD_QUALITY,1),t.set(L.a.CORE.AUTO_BAD_QUALITY_UP,1),t.set(L.a.CORE.AUTO_BAD_DURATION,1),t.set(L.a.CORE.AUTO_BAD_DURATION_UP,1),t.set(L.a.CORE.AUTO_BAD_SWITCH,1),t.set(L.a.CORE.AUTO_BAD_SWITCH_SAME,1),t.set(L.a.CORE.AUTO_BAD_SWITCH_UP,1),t.set(L.a.CORE.AUTO_BAD_DONE,1),t.set(L.a.CORE.AUTO_BAD_BUFFER,1),t.set(L.a.CORE.AUTO_CONTINUE_BUFFER,1),t.set(L.a.AUTO_INFO.name,1)),1===i[12]&&(t.set(L.a.CORE.SVR_DELAY_INFOS,1),t.set(L.a.CORE.DELAY_NODE_INFO,1),t.set(L.a.CORE.SVR_LAST_P_DELAY,1)),1===i[13]&&t.set(L.a.HLS_INFO.name,1),i[14],1===i[16]&&(t.set(L.a.VIDEO_LINK.PVSSC,1),t.set(L.a.VIDEO_LINK.PVFSC,1),t.set(L.a.VIDEO_LINK.PVLSC,1),t.set(L.a.VIDEO_LINK.PVLFC,1),t.set(L.a.VIDEO_LINK.PVPFC,1),t.set(L.a.VIDEO_LINK.PVPTC,1),t.set(L.a.VIDEO_LINK.PVPAFC,1),t.set(L.a.VIDEO_LINK.PVRFC,1))}}checkFilter(t){t.forEach(t=>{this.filterObj(t.vField),this.filterObj(t.vDimension),this.filterObj(t.vExLog)})}filterObj(t){let e=[];for(let i in t)(0===t[i]||""===t[i]&&this._ignoreDefault||this._ignoreMap.has(i))&&e.push(i);for(let i=0;i<e.length;i++)delete t[e[i]]}};const Do=",",Io=";";var Ao=class{constructor(){this.comDim=new Map,this.coreDim=new Map,this.actDim=new Map,this.extDim=new Map,this.comFormatMap=new Map,this.coreMap=new Map,this.compMap=new Map,this.keyvalCoreDimMap=new Map,this.heart_type=L.a.HEART_TYPE.START,this.recordTs=this.create_time=y.a.now(),this.filter=new Po}startRecord(){this.recordTs=y.a.now()}checkFilter(t){this.filter.checkFilter(t)}setCreateTime(t){isNaN(t)||(this.create_time=t)}reset(){this.comDim.clear(),this.coreDim.clear(),this.actDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.keyvalCoreDimMap.clear(),this.heart_type=L.a.HEART_TYPE.START,this.create_time=y.a.now()}clearFill(){this.coreDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.keyvalCoreDimMap.clear()}createAct(t,e){return this._createAct(t,e)}createActs(t){let e=[];if(t)for(let i=0;i<t.length;i++){let s=t[i],r=this._createAct(s.type,s.params);e.push(r)}return e}_createAct(t,e){let i={sMetricName:L.a.ACT.name,vField:{},vDimension:{}};if(i.vDimension[L.a.ACT.field]=t,i.vDimension[L.a.DIM_CORE.CREATE_TIME]=y.a.now()-this.create_time,this._fillFromMap(i.vDimension,this.comDim),this._fillFromMap(i.vDimension,this.actDim),e){let t=0;if(e.hasOwnProperty(L.a.KEY_VALUE)){let s=e[L.a.KEY_VALUE];for(t=0;t<s.length;t++)i.vField[L.a.KEY_VALUE+(t+1)]=s[t]}if(e.hasOwnProperty(L.a.KEY_STR)){let s=e[L.a.KEY_STR];for(t=0;t<s.length;t++)i.vDimension[L.a.KEY_STR+(t+1)]=s[t]}e.hasOwnProperty(L.a.KEY_DIM)&&Object.assign(i.vDimension,e[L.a.KEY_DIM])}return i.vDimension.appid=M.a.appid,this.actDim.clear(),i}fill(t,e){e?(this.heart_type=L.a.HEART_TYPE.END,this._fill(t),this.heart_type=L.a.HEART_TYPE.START):this._fill(t)}fillAnticode(t){this.coreMap.set(L.a.CORE.HTD,y.a.now()-this.recordTs+1),this.heart_type=L.a.HEART_TYPE.START,this._fill(t)}_fill(t){if(0==this.coreMap.size&&0==this.compMap.size)return;let e={sMetricName:L.a.CORE.name,vField:{},vDimension:{},vExLog:{}},i=y.a.now();this.coreMap.set(L.a.CORE.HTD,i-this.recordTs),this.recordTs=i,this.coreDim.set(L.a.DIM_CORE.HEART_TYPE,this.heart_type),this._fillFromMap(e.vDimension,this.comDim),this._fillFromMap(e.vDimension,this.coreDim),this._fillFromMap(e.vExLog,this.extDim),this._fillFromMap(e.vField,this.coreMap),this._fillComp(e.vDimension),this.coreDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.heart_type==L.a.HEART_TYPE.START&&(this.heart_type=L.a.HEART_TYPE.CONTINUS),e.vDimension.appid=M.a.appid,t.push(e)}_fillComp(t){for(let e of this.compMap.keys()){const i=this._getCompMapFormat(e),s=i.get("ref")||Do,r=i.get("split")||Io;let a=this.compMap.get(e),o="";for(let t of a.keys())o.length>0&&(o+=r),o+=t+s+a.get(t);t[e]=o}}_fillFromMap(t,e){for(let i of e.keys())t[i]=e.get(i)}_fillFromKeyvalMap(t,e){for(let i of e.keys()){const s=e.get(i),r=s.entries();let a="";for(let t=0;t<s.size;t++){const e=r.next().value;a+=`${e[0]}:${e[1]}`,t<s.size-1&&(a+=",")}s.clear(),t[i]=a}}getComDim(t){return this.comDim.get(t)}setComDim(t,e){this.comDim.set(t,e)}setCoreDim(t,e){this.coreDim.set(t,e)}addCoreDim(t,e){this._addValue(this.coreDim,t,e)}addKeyvalCoreDim(t,e){this._addKeyvalValue(this.keyvalCoreDimMap,t,e)}setActDim(t,e){this.actDim.set(t,e)}setExtDim(t,e){this.extDim.set(t,e)}delDim(t){this.comDim.has(t)?this.comDim.delete(t):this.coreDim.has(t)?this.coreDim.delete(t):this.actDim.has(t)&&this.actDim.delete(t)}setCore(t,e){this.coreMap.set(t,e)}addCore(t,e){this._addValue(this.coreMap,t,e)}setComp(t,e,i){this._getCompMap(t).set(e,i)}addComp(t,e,i){let s=this._getCompMap(t);this._addValue(s,e,i)}setCompFormat(t,e,i){const s=this._getCompMapFormat(t);s.set("ref",e),s.set("split",i)}_getCompMapFormat(t){if(this.comFormatMap.has(t))return this.comFormatMap.get(t);const e=new Map;return this.comFormatMap.set(t,e),e}_getCompMap(t){if(this.compMap.has(t))return this.compMap.get(t);let e=new Map;return this.compMap.set(t,e),e}_addValue(t,e,i){if(t.has(e)){let s=t.get(e);t.set(e,s+i)}else t.set(e,i)}_addKeyvalValue(t,e,i){if(t.has(e)){let s=t.get(e);const r=i.split(":");if(r.length<2)return;const a=r[0],o=Number(r[1]);if(s.has(a)){const t=s.get(a);s.set(a,t+o)}else s.set(a,o)}else{const s=i.split(":");if(s.length<2)return;let r=new Map;const a=s[0],o=Number(s[1]);r.set(a,o),t.set(e,r)}}};var Ro=class{constructor(){this.speed=new bt(20),this.rtt=new bt(20),this.p2p=0}addSpeed(t){let e=parseInt(t.replace("KB",""));this.speed.add(e)}addRtt(t){this.rtt.add(t)}setP2p(t){this.p2p=t}getP2p(){return this.p2p}getResult(){return{speed:this.speed.getSamples(),rtt:this.rtt.getSamples(),p2p:this.p2p}}},Oo=i(12),wo=i(19),Lo=i.n(wo);var Mo=class{constructor(t,e){this.stat=t,this.tsdb=e,this.isP2PUseH265=!0,this.isFlvUseH265=!0,this.isHlsUseH265=!0,this.costUs=0,this.isCodecSupport=!1,this.codecSupportReason=-1e4,this.isBrowserSupport=!1,this.isCfgSupport=!1,this.serverSupported=!1,this.lastCurBitrate=0,this.lastLine=0,this.isUseH265Mse=!0}destroy(){}get isSupported(){let t=this.isCodecSupport&&this.isBrowserSupport&&this.isCfgSupport;return 1==Number(localStorage._localCloseHevc)&&(t=!1),1===Number(localStorage._enableForceH265)&&(t=!0),t}get canPreload(){return this.isBrowserSupport&&this.isCfgSupport}onTurntoH264(t){t===_e?this.isP2PUseH265=!1:t===fe?this.isFlvUseH265=!1:t==ge&&(this.isHlsUseH265=!1)}onTurntoH265Wasm(){this.isUseH265Mse=!1}init(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.resetProps(t),this._initCodec(t),this._initBrowser(),this._initRandom(t),this._initCfg(t),this.lastCurBitrate=Number(t.curBitrate),this.lastLine=Number(t.lineType),f.a.log(`H265Support.init isCodecSupport=${this.isCodecSupport} isBrowserSupport=${this.isBrowserSupport} isCfgSupport=${this.isCfgSupport}`)}mseHevcInit(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.resetMseHevcProps(t),this._initBrowserMseHevcSupport(t),this._initMseHevcCodec(t),this._initMseHevcCfg(t),this.lastCurBitrate=Number(t.curBitrate),this.lastLine=Number(t.lineType),f.a.log(`H265Support.mseHevcInit isCodecSupport=${this.isCodecSupport} isBrowserSupport=${this.isBrowserSupport} isCfgSupport=${this.isCfgSupport}`)}resetProps(t){this.isCodecSupport=!1,this.codecSupportReason=-1e4,this.isBrowserSupport=!1,this.isCfgSupport=!1;let e=Number(t.lineType),i=Number(t.curBitrate);(0!=this.lastCurBitrate&&this.lastCurBitrate!=i||0!=this.lastLine&&this.lastLine!=e)&&(this.isP2PUseH265=!0,this.isFlvUseH265=!0,this.isHlsUseH265=!0)}resetMseHevcProps(t){this.resetProps(t);let e=Number(t.lineType),i=Number(t.curBitrate);(0!=this.lastCurBitrate&&this.lastCurBitrate!=i||0!=this.lastLine&&this.lastLine!=e)&&(this.isUseH265Mse=!0)}_initCodec(t){if(1==localStorage.open265&&(localStorage.w265LastCost=0),this.isReport265||t.type===Se||(this.tsdb.sendMetrics([this.stat.createAct(L.a.ACT.H265_STATUS,{value:[10],str:[R.b.is64bitSoftware()?1:2,navigator.userAgent]})]),f.a.log("HYPlayer.initH265 support hardwareConcurrency hardwareConcurrency=",navigator.hardwareConcurrency),this.isReport265=!0),this._isSupported(t)&&Lo.a&&Lo.a.getInstance){let e={enableWebH265:1,baseCostUs:{2e3:32e3,4e3:3e4},loopCount:100,singleThreadBitKbps:[10],multiThreadBitKbps:[4e3,2e3,500],threadCount:2,degrade:0,statIntervalMs:1e3,fmt:11,share:0,wasmLoad:500,core:{2e3:3,4e3:4},x86:{4e3:1}},i={};e.x86={4e3:1},P.a.h265Config[0][0].forEach((t,e)=>{i[t]=P.a.h265Config[0][1][e]}),e.baseCostUs=i,e.multiThreadBitKbps=P.a.h265Config[1];let s={};P.a.h265Config[3][0].forEach((t,e)=>{s[t]=P.a.h265Config[3][1][e]}),e.core=s,Lo.a.getInstance().parseConfigs(e);let r=t.curBitrate,a=Lo.a.getInstance().isSupportH265(r);f.a.log("H265Support.initH265 bitRate",r,a),this.isCodecSupport=a.isSupport,0==P.a.vodH265Config[2]&&t.type===ge&&(this.isCodecSupport=!1),this.costUs=a.costUs,this.codecSupportReason=a.reason,this.tsdb.sendMetrics([this.stat.createAct(L.a.ACT.H265_STATUS,{value:[2],str:[a.reason]})]),Lo.a.getInstance().setLogCallback(()=>{let t=["H265 render setLogCallback"].concat(Array.apply(null,arguments));f.a.log.apply(f.a,t)})}}_initMseHevcCodec(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.isUseH265Mse){if(this._isSupported(t)){this.isCodecSupport=!1;let e=t.curBitrate;if(qe.a.version.major>=P.a.h265MseChromeConfig[0])navigator.hardwareConcurrency<P.a.h265MseChromeConfig[2]?this.isCodecSupport=!1:this.isCodecSupport=!0;else{if(P.a.h265MseConfig[4].length>0){const t={},i={},s={};if(P.a.h265MseConfig[4][0].forEach((e,r)=>{t[e]=P.a.h265MseConfig[4][1][r],i[e]=P.a.h265MseConfig[4][2][r],s[e]=P.a.h265MseConfig[4][3][r]}),navigator.hardwareConcurrency<=t[e]){if(!(i[e]&&navigator.hardwareConcurrency>i[e]))return void f.a.warn(`H265Support._initMseHevcCodec Mse Config: curThread=${navigator.hardwareConcurrency} isn't greater than thread=${t[e]}`);if(this.isBrowserSupport&&s[e]){const t=ce().toLowerCase();if(!(t.indexOf(s[e])>=0))return void f.a.warn(`H265Support._initMseHevcCodec Mse Render Config: curRender=${t} isn't suppored render=${s[e]}`);this.isCodecSupport=!0}}}this.isCodecSupport=!0}}0==P.a.vodH265Config[1]&&t.type===ge&&(this.isCodecSupport=!1)}else this.isCodecSupport=!1}_isSupported(t){let e=!1;if(t.type===ge){if(t.h265Url&&(this.serverSupported=!0),t.h265Url&&this.isHlsUseH265)return!0}else{if(e=t.iIsHEVCSupport>0&&t.iHEVCBitRate>=0||this._isH265(t.iCodecType)&&0===t.iBitRate,this.serverSupported=e,t.type===fe)return this.isFlvUseH265&&e||1==localStorage._enableServer265;if(t.type===_e)return this.isP2PUseH265&&e||1==localStorage._enableServer265}return!1}_isH265(t){return 1===t||4===t||6===t||8===t}_initBrowser(){let t=qe.a.version.major,e=!1;qe.a.chrome&&t>=P.a.h265Config[2]&&(e=!0),qe.a.chrome&&-1!==P.a.wasm265BlackBrowVers.indexOf(t)&&(f.a.log("H265Support._initBrowser wasm265BlackBrowVers",P.a.wasm265BlackBrowVers),e=!1),1===Number(localStorage._enableBrowser)&&(e=!0),"undefined"==typeof SharedArrayBuffer&&(e=!1),this.isBrowserSupport=e}_initBrowserMseHevcSupport(t){let e=ls.a.isMseSupportedHevc();if(e){const i=P.a.h265MseConfig[1];if(i.length>0){const t=qe.a.version.major;e=qe.a.chrome&&i.indexOf(t)>=0?e&&!0:e&&!1}qe.a.chrome&&qe.a.version.major>=P.a.h265MseChromeConfig[0]&&(e=!0,e=e&&this.getChromeHevcRenderSupport(t))}else f.a.warn("H265Support._initMseHevcCodec browser isn't supported mse h265");1==Number(localStorage._closeMseHevc)&&(e=!1),1===Number(localStorage._enableMseHevcBrowser)&&(e=!0),this.isBrowserSupport=e}_initRandom(t){let e=this._getRandomUse(t);this.isCodecSupport&&(e||(this.isCodecSupport=!1)),t.randomH265=e}_getRandomUse(t){let e=localStorage.h265PresentUid,i=t.presenterUid,s=!0,r=P.a.h265BlackUids;if(t.liveType==Oo.a.REPLAY&&(r=P.a.replayH265BlackUids),r.forEach(t=>{i&&t.toString()==i.toString()&&(s=!1)}),!s)return!1;if(t.liveType==Oo.a.REPLAY||t.liveType==Oo.a.VOD){let t=P.a.whiteH265Uids;if(0==t[1]){let e=!1;return t[0].forEach(t=>{i&&t.toString()==i.toString()&&(e=!0)}),e}}localStorage.randomH265Percent&&e==i||(localStorage.randomH265Percent=P.a.randomH265Percent),1==localStorage.open265?localStorage.randomH265Percent=3e3:2==localStorage.open265&&(localStorage.randomH265Percent=6e3);let a=Number(localStorage.randomH265Percent);return localStorage.h265PresentUid=t.presenterUid,a<P.a.h265PercentConfig}_initCfg(t){let e=1===Number(P.a.isConfigSupportH265);t.liveType!=Oo.a.VOD&&t.liveType!=Oo.a.REPLAY||(e=1===Number(P.a.isVodSupportH265)),(P.a.isCloseAllFuncs(t.uid)||-1!=P.a.wcsSoft264Uids.indexOf(Number(t.uid)))&&(e=!1,f.a.log("H265Support._initCfg closeAllFuncs!")),-1!==P.a.h265BlackBrows.indexOf(qe.a.version.major)&&(e=!1),P.a.wasmCloseCfg.length>0&&1==P.a.wasmCloseCfg[0]&&(f.a.log("H265Support._initCfg wasm close!"),e=!1),P.a.wasmCloseCfg.length>0&&P.a.wasmCloseCfg[1].length>0&&-1!=P.a.wasmCloseCfg[1].indexOf(Number(t.presenterUid))&&(f.a.log("H265Support._getConfigUse wasm black anchoruid"),e=!1),this.isCfgSupport=e}_initMseHevcCfg(t){let e=1===Number(P.a.h265MseConfig[0])&&1===Number(P.a.isConfigSupportH265);if(t.type==ge&&(e=1===Number(P.a.isVodSupportH265)),(P.a.isCloseAllFuncs(t.uid)||-1!==P.a.wcsSoft264Uids.indexOf(Number(t.uid)))&&(e=!1,f.a.log("H265Support._initCfg closeAllFuncs!")),-1!==P.a.h265BlackBrows.indexOf(qe.a.version.major)&&(e=!1),qe.a.version.major>=P.a.h265MseChromeConfig[0]&&t.curBitrate<=P.a.h265MseChromeConfig[1])this.isCfgSupport=e;else{const i=P.a.h265MseConfig[2];i.length>0&&i.indexOf(t.curBitrate)>=0?e=e&&!0:(f.a.warn(`H265Support._initMseHevcCodec Mse Config: bitrate ${t.curBitrate} isn't supported mse h265`),e=e&&!1);let s=P.a.h265MseConfig[3];s.length>0&&(s.indexOf(t.lineType)>=0?e=e&&!0:(f.a.warn(`H265Support._initMseHevcCodec Mse Config: line ${t.lineType} isn't supported mse h265`),e=e&&!1))}const i=P.a.h265MseWhiteBlackUids[0];i.length>0&&(t.presenterUid&&i.indexOf(Number(t.presenterUid))>=0?e=e&&!0:(e=e&&!1,f.a.warn(`H265Support._initMseHevcCodec uid ${t.presenterUid} isn't in white list`)));const s=P.a.h265MseWhiteBlackUids[1];s.length>0&&t.presenterUid&&s.indexOf(Number(t.presenterUid))>=0&&(e=e&&!1,f.a.warn(`H265Support._initMseHevcCodec uid ${t.presenterUid} is in black list`)),this.isCfgSupport=e}getChromeHevcRenderSupport(t){return 0!=P.a.h265MseChromeConfig[4]&&(-1===P.a.wcs265BlackUids.indexOf(Number(t.uid))&&(-1===P.a.mse265BlackUids.indexOf(Number(t.uid))&&(-1!=P.a.enableEdgeBroMseCfg.indexOf(qe.a.version.major)||-1===qe.a.name.indexOf("edg")||1!=t._isTurnTomse)))}},Vo=i(22),bo={NO_DATA:1,NO_DECODE:2,WORKER_ERROR:3,DECODE_ERROR:4,RENDER_ERROR:5,NO_RENDER:6,RECEIVE_LIST_OUT_LIMIT:7,YUV_OUT_LIMIT:8,WASM_TIMEOUT:9,CREATE_WEBGL_FAIL:10,CREATE_WORKER_ERROR:11,AUDIO_FAST:12,VIDEO_FAST:13,START_CODE_ERROR:14,WORKER_TIMEOUT:15,RETRY_MAX:16,dic:{1:"20s无数据",2:"10s无解码",3:"worker异常",4:"解码失败",5:"渲染失败",6:"10s无渲染",7:"解码前队列大于2000",8:"yuv队列大于300",9:"wasm timeout",10:"创建webgl失败",11:"web worker异常",12:"音频快，视频慢，切264",13:"音频慢，视频快，切264",14:"hevcFindNextStartCode failed",15:"worker超时",16:"重试超过最大次数"}};class No{constructor(t,e){this._stat=t,this._tsdb=e,this._onMessageBind=this._onMessage.bind(this),this._onErrorBind=this._onError.bind(this),this._startTs=0,this._readyTs=0,this._isReady=!1,this._isTimeout=!1,this._isError=!1,this._decoder=null,this._callbacks=null,this._onMessageCb=null}set onMessageCb(t){this._onMessageCb=t}get decoder(){return this._decoder}get isReady(){return this._isReady}terminate(){f.a.log("H265Decoder.terminate"),this._destroyDecoder(),q.remove(this._onTimeout,this),this._callbacks=null,this._onMessageCb=null,this._isReady=!1,this._startTs=0,this._readyTs=0}destroy(){f.a.log("H265Decoder.destroy"),this._stat=null,this._tsdb=null,this.stopDecoder(),this._decoder&&this._decoder.terminate(),q.remove(this._onTimeout,this)}_destroyDecoder(){if(this._decoder){this._decoder.onmessage=null,this._decoder.onerror=null,this.stopDecoder();try{this._decoder.terminate()}catch(t){f.a.log("H265Decoder._destroyDecoder",t)}this._decoder=null}}stopDecoder(){this._decoder&&this._decoder.postMessage({t:6})}load(t,e){if("undefined"==typeof SharedArrayBuffer)return;if(this._callbacks=e,this._decoder)return void(this._callbacks&&this._callbacks.ready());let i=qe.a.chrome&&qe.a.version.major>=91;1==Number(localStorage._unSupportSimd)&&(i=!1),f.a.log("H265Decoder.load"),this._startTs=y.a.now();let s=new Blob([`importScripts("${t+(i?"decoder.worker.simd.js":"decoder.worker.js")}")`],{type:"application/javascript"}),r=window.URL.createObjectURL(s),a=new Worker(r);a.onmessage=this._onMessageBind,a.onerror=this._onErrorBind,this._decoder=a,q.remove(this._onTimeout,this),q.once(this._onTimeout,this,1e3)}_onMessage(t){switch(t.data.t){case 0:this._decoder.postMessage({t:1});break;case 2:f.a.log("H265Decoder._onMessage worker isReady!"),q.remove(this._onTimeout,this),No.preloaded=!0,this._isReady=!0,this._readyTs=y.a.now();let t=this._readyTs-this._startTs;this._tsdb&&this._tsdb.sendMetrics([this._stat.createAct(L.a.ACT.H265_WORKER_LOAD_TS,{value:[t]})]),this._isError||this._isTimeout||this._callbacks&&this._callbacks.ready()}this._onMessageCb&&this._onMessageCb(t)}_onError(t){f.a.error("H265Decoder._onError",t),this._tsdb&&this._tsdb.sendMetrics([this._stat.createAct(L.a.ACT.H265_STATUS,{value:[1],str:[bo.CREATE_WORKER_ERROR]})]),this._destroyDecoder(),q.remove(this._onTimeout,this),this._readyTs=0,this._isReady=!1,this._isError=!0,localStorage.h265WorkerError=1,this._callbacks&&this._callbacks.error()}_onTimeout(){f.a.log("H265Decoder._onTimeout"),this._tsdb&&this._tsdb.sendMetrics([this._stat.createAct(L.a.ACT.H265_STATUS,{value:[1],str:[bo.WORKER_TIMEOUT]})]),this._destroyDecoder(),this._readyTs=0,this._isTimeout=!0,this._isReady=!1,this._callbacks&&this._callbacks.timeout()}}Object(Vo.a)(No,"preloaded",!1);var Fo=No;class Bo{constructor(){this.count=0,this.arr=[]}inc(t){this.count+=t}dec(t){this.count-=t,this.count<0&&(this.count=0)}collect(){this.arr.push(this.count),this.count=0}stat(){let t=this.arr;return this.arr=[],t}reset(){this.count=0,this.arr=[]}}const Uo={toDecode:0,decoded:1,render:2,throwFrame:3,throwRaw:4,rawList:5,frameList:6};var ko=class{static get TYPES(){return Uo}constructor(){this.toDecodeItem=new Bo,this.decodedItem=new Bo,this.renderItem=new Bo,this.throwFraItem=new Bo,this.throwRawItem=new Bo,this.rawItem=new Bo,this.frameItem=new Bo,this.rafItem=new Bo,this.items=[this.toDecodeItem,this.decodedItem,this.renderItem,this.throwFraItem,this.throwRawItem,this.rawItem,this.frameItem,this.rafItem],this.reset()}inc(t,e){for(let i=0;i<t.length;i++){let s=this.getItem(t[i]);s&&s.inc(e[i])}this.collect()}dec(t,e){for(let i=0;i<t.length;i++){let s=this.getItem(t[i]);s&&s.dec(e[i])}this.collect()}collect(){let t=Date.now();if(0==this.lastStatTime&&(this.lastStatTime=t),t-this.lastStatTime>=1e3){for(let t=0;t<this.items.length;t++)this.items[t].collect();this.lastStatTime=t}}getStat(){return{toDecode:this.toDecodeItem.stat(),decoded:this.decodedItem.stat(),render:this.renderItem.stat(),rawList:this.rawItem.stat(),frameList:this.frameItem.stat()}}getItem(t){return t>=this.items.length?null:this.items[t]}reset(){this.lastStatTime=0;for(let t=0;t<this.items.length;t++)this.items[t].reset()}};var xo=class{constructor(t,e){let{resumeFunc:i,pauseFunc:s}=e;this._player=t,this._playResume=i,this._playPause=s,this._paused=!1,this._playedPts=0,this._pausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}get paused(){return this._paused}get pausedTs(){return this._pausedTs}reset(){this._paused=!1,this._playedPts=0,this._pausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}check(){const t=y.a.now(),e=this._player.getVideoPts();if(0!==this._playedPts){e===this._playedPts?this._paused||this._setPaused(t):this._paused&&this._setResume(t);const i=t-this._lastCheck500Time,s=Math.round(e-this._lastCheck500CurrntTime);(0==this._lastCheck500Time||i>=500)&&(0!=this._lastCheck500Time&&i-s>=P.a.pause500Cfg[0]&&(1==Number(localStorage._printPauseCheck)&&f.a.log("H265Pause.check.500ms",i,s,i-s),this._player.check500Pause()),this._lastCheck500CurrntTime=e,this._lastCheck500Time=t)}this._playedPts=e}_setPaused(t){this._paused=!0,this._pausedTs=t,f.a.log("H265Pause._setPaused _pausedTs=",t),this._playPause(t)}_setResume(t){const e=t-this._pausedTs;f.a.log("H265Pause._setResume pausedTime=",e),this._playResume(t,e),this._paused=!1,this._pausedTs=0}},Ho="heart",Go="resume",Wo="stop";const $o=25,Yo=26,Ko=27,jo=28,qo=29,zo=30,Jo=18,Qo=0,Xo=1,Zo=2,tn=3,en=4,sn=5;var rn=class{static isSupported(){return"object"==typeof WebAssembly}constructor(t,e){this.stat=t,this.tsdb=e,this.fpsList=[],this.frameList=[],this.renderStat=[],this.decodedStat=[],this.toDecodeStat=[],this.frameListStat=[],this.avDeltaList=[],this.rafStat=[],this.rawListStat=[],this._videoTracks=[],this.resetProps(),this.stat=new ko,this.avgFrameGap=0,this.rafTime=0,this.isHidden=!1,this.retryFlvTimes=0,this.retryP2PTimes=0,this.retryHlsTimes=0,this.currentVideoDts=0,this.isH265Error=!1,this.rafFrameBind=this.rafFrame.bind(this),this.onVisibilityChangedBind=this.onVisibilityChanged.bind(this),this.pauseHanlder=new xo(this,{pauseFunc:this._playPause.bind(this),resumeFunc:this._playResume.bind(this)}),this.workerSharedArrayBuffer=null,this.isH265Played=!1,this.videoPlayerElement=null}addEvents(){this.mse&&this.mse.handler&&this.mse.handler.eventEmitter&&this.mse.handler.eventEmitter.on(m.VISIBILITY_CHANGE,this.onVisibilityChangedBind)}delEvents(){this.mse&&this.mse.handler&&this.mse.handler.eventEmitter&&this.mse.handler.eventEmitter.off(m.VISIBILITY_CHANGE,this.onVisibilityChangedBind)}addTimer(){q.add(this.timerHandler,this,1e3)}delTimer(){q.remove(this.timerHandler,this)}attachMse(t){f.a.log("H265Player.attachMse"),this.mse=t,this.resetProps(),this.isH265Played=!1;let e=y.a.now();this.onVideoFrameTime=e,this.pushVideoTime=0,this.workerHeartTime=e,this.updteFpsTime=0,this.rafId=null,this.rafFrame(),this._initGL(t),this.addEvents(),this.addTimer()}_initGL(t){let e=t.h265Proxy.decoder;if(e.onMessageCb=this._onMessage.bind(this),this.decoder=e.decoder,this.decoder.postMessage({t:8,d:P.a.h265Config}),this.isPlaying=!0,this.canvas=document.createElement("canvas"),this.canvas.width=t.getWidth(),this.canvas.height=t.getHeight(),f.a.log(`H265Player._initGL width=${t.getWidth()} height=${t.getHeight()}`),this.isSupportVideoTrack="undefined"!=typeof MediaStreamTrackGenerator&&"undefined"!=typeof VideoFrame,1==Number(localStorage._forceWasmWebgl)&&(this.isSupportVideoTrack=!1),this.isSupportVideoTrack)this.videoPlayerElement=document.createElement("video"),this.videoPlayerElement.muted=!0,this.agenerator=new MediaStreamTrackGenerator({kind:"video"}),this.processedStream=new MediaStream([this.agenerator]),this.videoPlayerElement.srcObject=this.processedStream,this.decoder.postMessage({t:10,agenerator:this.agenerator.writable,width:this.mse.getWidth(),height:this.mse.getHeight(),config:P.a.h265Config[6],isPostRenderCallback:P.a.renderStat[0],devicePixelRatio:window.devicePixelRatio},[this.agenerator.writable]);else{let t=this.canvas.transferControlToOffscreen();this.decoder.postMessage({t:10,canvas:t,width:this.mse.getWidth(),height:this.mse.getHeight(),config:P.a.h265Config[6],isPostRenderCallback:P.a.renderStat[0],devicePixelRatio:window.devicePixelRatio},[t])}this._initDecodeWorker()}updateSize(){}resetProps(){this.canvas=null,this.frameList.length=0,this.isPlaying=!1,this._audioErrorCnt=0,this.onVideoFrameTime=0,this.pushVideoTime=0,this.workerHeartTime=0,this.decodeNow=0,this.renderTime=0,this.curPic=null,this.pauseDecode=!1,this.avgFrameGap=33,this.updteFpsTime=0,this.rafTime=0,this.pauseCnt=0,this.videoPauseCnt=0,this.countHeart=0,this.rafNoRenderCount=0,this.isFirsrToDecode=!1,this.toDecodeStamp=0,this.isFirstDecoded=!1,this.decodedStamp=0,this.isFirstRender=!1,this.renderStamp=0,this.hlsStarted=!1,this.fpsList.length=0,this.frameList.length=0,this.renderStat.length=0,this.decodedStat.length=0,this.toDecodeStat.length=0,this.frameListStat.length=0,this.rafStat.length=0,this.rawListStat.length=0,this._videoTracks.length=0,this.avDeltaList.length=0,this.userPaused=!1,this.isH265Error=!1,this.pauseStartTs=0,this.pauseMobStartTs=0,this.isRenderFpsPaused=!1,this.isFramePaused=!1,this.pauseMobCnt=0,this.rafLastNow=0,this.hiddenStartTs=0,this.pause500Cnt=0,this.isWasmPlay=!1,this.currentVideoDts=0,this.isSupportVideoTrack=!1}timerHandler(){let t=y.a.now();this.checkTimer(t),this.timerTime=t}checkTimer(){if(!this.mse||!this.mse.handler)return;if(this.userPaused)return;if(this.mse.handler.playerType==ge&&!this.hlsStarted)return;if(this.isH265Error)return;let t=y.a.now();0!=this.workerHeartTime&&t-this.workerHeartTime>5e3&&this.mse.h265Proxy&&(f.a.log("H265Player.checkTimer worker error"),this.mse.h265Proxy.terminate(),setTimeout(()=>{this.handlerError(bo.WORKER_ERROR),this.turnToH264(bo.WORKER_ERROR)},200));const e=this.getPts()-this.getVideoPts();this.avDeltaList.push(Math.floor(e))}onVisibilityChanged(){document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?(this.hiddenStartTs=y.a.now(),f.a.log("H265Player.onVisibilityChanged isHidden true",this.hiddenStartTs),this.isHidden=!0,this.decoder&&this.decoder.postMessage({t:12})):(f.a.log("H265Player.onVisibilityChanged isHidden false"),this.renderTime=0,this.isHidden=!1,this.hiddenStartTs=0,this.decoder&&this.decoder.postMessage({t:13}))}_onMessage(t){if(!this.mse||!this.mse.handler)return;if(this.mse.handler.playerType==ge&&!this.hlsStarted)return;let e=t.data;if(this.isH265Error)return;const i=y.a.now();switch(e.t){case 5:break;case 7:if(!this.isPlaying)return;e.d.logList&&e.d.logList.length>0&&(f.a.log("H265Player.onmessage.worker.log",e.d.logList.join(",")),e.d.logList=[]),this.onDecodeError(e.d.data);break;case 9:if(0==e.d.length)return;f.a.log("H265Player.onmessage.worker.log",e.d.join(",")),e.d=[];break;case 10:this.workerHeartTime=i,this.countHeart++,this.countHeart%20==0&&f.a.log("H265Player.onmessage.webWorker.heart");break;case 11:case 12:break;case 13:this.onRenderError(e.d);break;case 14:let t=e.d.renderNow,s=e.d.decodedNow,r=Date.now()-t;f.a.log("H265Player.onmessage render play postMessage cost",r),this.isFirstDecoded||(this.decodedStamp=s,this.isFirstDecoded=!0),this.isFirstRender||(this.renderStamp=t,this.isFirstRender=!0,f.a.log("H265Player.onmessage 送帧到解码，解码到渲染耗时",this.decodedStamp-this.toDecodeStamp,this.renderStamp-this.decodedStamp)),this.mse&&this.mse.handler&&(this.mse.handler.setWasmPlaying&&this.mse.handler.setWasmPlaying(),this.isH265Played=!0,this.mse.triggerH265Play(this.decodedStamp-this.toDecodeStamp,this.renderStamp-this.decodedStamp),this.triggerWasmPlay());break;case 15:this.pauseCnt++,f.a.log("H265Player.onmessage pauseCnt",this.pauseCnt);break;case 16:f.a.log("H265Player.onmessage worker noRender 10s",this.isHidden),this.handlerError(bo.NO_RENDER),this.autoReport();break;case 17:this.handlerError(bo.NO_DECODE);break;case 18:e.d.render.length>0&&(this.renderStat=this.renderStat.concat(e.d.render)),e.d.decoded.length>0&&(this.decodedStat=this.decodedStat.concat(e.d.decoded)),e.d.toDecode.length>0&&(this.toDecodeStat=this.decodedStat.concat(e.d.toDecode)),e.d.frameList.length>0&&(this.frameListStat=this.frameListStat.concat(e.d.frameList)),e.d.raf.length>0&&(this.rafStat=this.rafStat.concat(e.d.raf)),e.d.rawList.length>0&&(this.rawListStat=this.rawListStat.concat(e.d.rawList));break;case 19:this.handlerError(bo.YUV_OUT_LIMIT);break;case 20:this.reportError(bo.CREATE_WEBGL_FAIL),this.turnToH264(bo.CREATE_WEBGL_FAIL);break;case 21:if(this.reportError(bo.AUDIO_FAST),1==localStorage._closeTurnTo264)return;this.turnToH264(bo.AUDIO_FAST);break;case 22:if(this.reportError(bo.VIDEO_FAST),1==localStorage._closeTurnTo264)return;this.turnToH264(bo.VIDEO_FAST);break;case 23:let a=e.data.width,o=e.data.height;f.a.log(`H265Player.onMessage 23 width=${a} height = ${o}`),this.mse.setResolution&&this.mse.setResolution(a,o);break;case 24:if(this.mse&&e&&e.d){this.mse.setVideoCurrentTimeHand(e.d.minusBuffer,e.d.bufLen,e.d.type,e.d.timeNow);let t=this.getPts();0!=t&&this.storeAudioDts(t)}break;case $o:this.isHidden&&this.rafTimer();break;case Yo:this.workerSharedArrayBuffer=e.d.workerSharedArrayBuffer;break;case Ko:if(this.mse.isLive&&this.mse.onWasmRenderCallback&&this.mse.onWasmRenderCallback(),this.mse.isLive&&P.a.renderStat[0]){const t=this.getVideoPts();this.mse.videoPlayConsuming.addRenderFrameData(t,y.a.now()),this.mse.audioPlayConsuming.addRenderFrameData(t,y.a.now()),this.mse.renderFps.addRender()}break;case jo:this.setFramePause(i);break;case qo:this.setFrameRusume(i);break;case zo:1==P.a.mobVBlockCfg&&(this.isRenderFpsPaused=!0)}}setFramePause(t){this.isFramePaused||(this._playMobPause(t),this.isFramePaused=!0)}setFrameRusume(t){this.isFramePaused&&(this._playMobResume(t),this.isFramePaused=!1)}triggerWasmPlay(){!this.isWasmPlay&&this.videoPlayerElement&&(this.videoPlayerElement.play(),this.isWasmPlay=!0)}getRenderElement(){return this.isSupportVideoTrack?this.videoPlayerElement:null}_initDecodeWorker(t){let e=new SharedArrayBuffer(1024);this.mainSharedArrayBuffer=new Uint32Array(e),this.decoder.postMessage({t:16,d:this.mainSharedArrayBuffer})}rafFrame(){1==Number(localStorage._print265RenderInterval)&&!this.isRenderInterval&&this.decoder&&(this.isRenderInterval=!0,this.isNotRenderInterval=!1,this.decoder.postMessage({t:14,d:0})),0==Number(localStorage._print265RenderInterval)&&!this.isNotRenderInterval&&this.decoder&&(this.isNotRenderInterval=!0,this.isRenderInterval=!1,this.decoder.postMessage({t:14,d:1})),this.rafFrameBind&&(this.rafId=ji(this.rafFrameBind)),this.rafTimer()}rafTimer(){let t=y.a.now();(0==this.rafLastNow||t-this.rafLastNow>=100)&&!this.userPaused&&this.isH265Played&&(this.pauseHanlder.check(t),this.rafLastNow=t),this.storeMainBuffer(),this.getFps()}getFps(){if(!this.mse.parser.fps)return;let t=y.a.now();if(t-this.updteFpsTime>=1e3){if(this.fpsList.length>=5){let t=0;this.fpsList.forEach(e=>{t+=e});let e=Math.floor(1e3/(t/5));this.avgFrameGap=e>this.avgFrameGap?this.avgFrameGap:e,this.decoder.postMessage({t:9,d:this.avgFrameGap}),this.fpsList.length=0}else this.fpsList.push(this.mse.parser.fps.getFps());this.updteFpsTime=t}}check500Pause(){1!=P.a.pause500Cfg&&this.pause500Cnt++}getStats(t){let e=y.a.now();t?(this._checkPaused(e,Wo),this._checkMobPaused(e,Wo)):(this._checkPaused(e,Ho),this._checkMobPaused(e,Ho));let i=this.stat.getStat();i.decoded=[].slice.call(this.decodedStat),i.render=[].slice.call(this.renderStat),i.toDecode=[].slice.call(this.toDecodeStat),i.frameList=[].slice.call(this.rafStat),i.deltaList=[...this.avDeltaList],i.rawListWorker=[].slice.call(this.rawListStat);let s="H265Player.getStats\n";for(let t in i)s+=`${t}: ${i[t].toString()}\n`;f.a.log(s),this.avDeltaList.length=0;let r={frameListLen:this.frameList.length,statProps:i,h265PauseCnt:this.pauseCnt,videoPauseCnt:this.videoPauseCnt,videoPauseTime:this.pauseTime,isVideoPaused:this.pauseStartTs>0,hiddenTime:0==this.hiddenStartTs?0:e-this.hiddenStartTs,pause500CntH265:this.pause500Cnt,isFramePaused:this.pauseMobCnt>0||this.pauseMobStartTs>0||this.isRenderFpsPaused};return this.isRenderFpsPaused=!1,this.pauseMobCnt=0,this.resetStats(),r}resetStats(){this.pauseCnt=0,this.videoPauseCnt=0,this.pauseTime=0,this.renderStat.length=0,this.decodedStat.length=0,this.toDecodeStat.length=0,this.frameListStat.length=0,this.rafStat.length=0,this.rawListStat.length=0,this.pause500Cnt=0}pushVideoFrame(t){if(!this.isPlaying)return;if(this.isH265Error)return;let e,i=y.a.now();for(this.stat.inc([ko.TYPES.rawList],[t.samples.length]);t&&t.samples&&t.samples.length;){e=t.samples.shift();let i={units:e.units,dtsInMs:e.dts/90,ptsInMs:e.pts/90,key:e.key?1:0};this.currentVideoDts=e.dts/90,this.isFirsrToDecode||(this.toDecodeStamp=Date.now(),this.isFirsrToDecode=!0),1==Number(localStorage._printH265VideoFrame)&&f.a.log("H265Player.pushVideoFrame objData",i),this.decoder.postMessage({t:4,d:i})}this.mse.isLive&&this.mse.videoPlayConsuming.pushRemuxedVideoFrameData(i),this.pushVideoTime=i}toHexString(t){return Array.prototype.map.call(t,(function(t){return("0"+(255&t).toString(16)).slice(-2)})).join(" ")}getPts(){if(P.a.dtsJumpOpen){if(this.mse&&this.mse.getCorrentCurrentDts)return this.mse.getCorrentCurrentDts()}else if(this.mse&&this.mse.getCurrentDts)return this.mse.getCurrentDts();return 0}getCurrentTime(){return this.mse&&this.mse.getCurrentTime?this.mse.getCurrentTime():0}getInitDts(){return this.mse&&this.mse.getInitDts?this.mse.getInitDts():0}autoReport(){1==P.a.isAutoH265&&this.mse&&this.mse.handler&&this.mse.handler.eventEmitter&&(f.a.log("H265Player.autoReport"),this.mse.handler.eventEmitter.trigger(m.P2P_REPORT))}destroy(){this.delTimer(),this.delEvents(),this.resetStats(),f.a.log("H265Player.destroy, rafid=",this.rafId),qi(this.rafId),this.rafId=null,clearInterval(this.timerHandler),this.decoder&&this.decoder.postMessage({t:6}),this.isH265Played=!1,this.resetProps(),this.mse=null,this.pauseDecode=!1,this.stat.reset(),this.mainSharedArrayBuffer&&Atomics.store(this.mainSharedArrayBuffer,Qo,0)}onDecodeError(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.code,i=t.desc;f.a.error("H265Player.onDecodeError desc",i,e),7==e?(this.reportError(bo.WASM_TIMEOUT),this.turnToH264(bo.WASM_TIMEOUT)):(this.autoReport(),this.handlerError(bo.DECODE_ERROR,e))}onRenderError(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.code,i=t.desc;f.a.error("H265Player.onRenderError desc",i,e),this.handlerError(bo.RENDER_ERROR)}turnToH264(t){this.mse&&this.mse.turnToH264(t)}retry(){if(this.mse&&this.mse.handler){let t=this.mse.handler.playerType;t==fe?this.retryFlvTimes++:t==_e?this.retryP2PTimes++:t==ge&&this.retryHlsTimes++}this.mse&&this.mse.h265Retry()}handlerError(t,e){if(this.isPlaying&&(f.a.log("H265Player.handlerError",t),this.reportError(t,e),this.mse&&this.mse.handler)){let t=this.mse.handler.playerType;t==fe?this.retryFlvTimes>=10?this.turnToH264(bo.RETRY_MAX):this.retry():t==_e?this.retryP2PTimes>=10?this.turnToH264(bo.RETRY_MAX):this.retry():t==ge&&(this.retryHlsTimes>=10?this.turnToH264(bo.RETRY_MAX):this.retry())}}reportError(t,e){if(this.isPlaying&&(this.isH265Error=!0,f.a.log("H265Player.reportError",t,bo.dic[t]),this.mse&&this.mse.handler)){let i={value:[1],str:[t,null!=e?e:1e4]};this.mse.handler.tsdb.sendMetrics([this.mse.handler.stat.createAct(L.a.ACT.H265_STATUS,i)])}}reportDecodeRenderTime(t,e){if(f.a.log("H265Player.reportDecodeRenderTime",t,e),this.mse&&this.mse.handler){let i={value:[t,e]};this.mse.handler.tsdb.sendMetrics([this.mse.handler.stat.createAct("pcdn_video_load_ts",i)])}}containerResize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.canvas)return;const e=this.canvas.clientWidth,i=this.canvas.clientHeight;t.width=e,t.height=i,this.decoder&&this.decoder.postMessage({t:15,d:t})}storeMainBuffer(){let t=this.getPts(),e=this.getCurrentTime();this.mainSharedArrayBuffer&&this.isPlaying&&(Atomics.store(this.mainSharedArrayBuffer,Qo,t),this.canvas&&(Atomics.store(this.mainSharedArrayBuffer,Xo,this.canvas.clientWidth),Atomics.store(this.mainSharedArrayBuffer,Zo,this.canvas.clientHeight)),Atomics.store(this.mainSharedArrayBuffer,en,e))}storeAudioDts(t){this.mainSharedArrayBuffer&&this.isPlaying&&Atomics.store(this.mainSharedArrayBuffer,0,t)}jumpBuffer(t,e,i,s){this.decoder&&this.decoder.postMessage({t:17,d:{minusBuffer:t,bufLen:e,type:i,timeNow:s}})}onVideoPause(){f.a.log("H265Player.onVideoPause"),this.userPaused=!0,this.mainSharedArrayBuffer&&Atomics.store(this.mainSharedArrayBuffer,tn,1)}onVideoPlay(){this.pushVideoTime=0,f.a.log("H265Player.onVideoPlay"),this.userPaused=!1,this.mainSharedArrayBuffer&&Atomics.store(this.mainSharedArrayBuffer,tn,0)}getVideoPts(){return this.workerSharedArrayBuffer?Atomics.load(this.workerSharedArrayBuffer,sn):0}_playPause(t){this.pauseStartTs=t}_playResume(t,e){this._checkPaused(t,Go)}_playMobPause(t){this.pauseMobStartTs=t,this.pauseMobCnt++,f.a.log("H265Player._playMobPause,pauseMobStartTs=",this.pauseMobStartTs)}_playMobResume(t,e){f.a.log("H265Player._playMobResume"),this._checkMobPaused(t,Go)}_checkMobPaused(t,e){this.pauseMobStartTs>0&&(this.pauseMobStartTs=e===Ho?t:0)}_checkPaused(t,e){if(this.pauseStartTs>0){let i=t-this.pauseStartTs;i>=200&&(f.a.warn(`H265Player._checkPaused type=${e} pauseTime=${i}`),this.videoPauseCnt++,this.pauseTime+=i),this.pauseStartTs=e===Ho?t:0}}onVideoSeek(t){f.a.log("H265Player.onVideoSeek",this.getPts())}seek(t){const e=this.getCurrentTime();t*=1e3;const i=this.getInitDts();f.a.log(`H265Player.seek curTime=${e}, time=${t}, initDts=${i}`),this.decoder&&this.decoder.postMessage({t:Jo,d:{curTime:e,time:t,initDts:i}}),this.storeAudioDts(e+i)}onEnded(){this.hlsStarted=!1}onStarted(){this.hlsStarted=!0}_getPlayerType(){if(this.mse&&this.mse.handler){let t=this.mse.handler.playerType;t==fe?this.retryFlvTimes++:t==_e?this.retryP2PTimes++:t==ge&&this.retryHlsTimes++}}on265StartCodeError(){this.isH265Error||(this.isH265Error=!0,this.handlerError(bo.START_CODE_ERROR),this.turnToH264(bo.START_CODE_ERROR))}getCurrentVideoTime(){return this.getVideoPts()-this.getInitDts()}getVideoBufferLen(){return 0==this.currentVideoDts?0:(this.currentVideoDts-this.getVideoPts())/1e3}};const an=0,on=1,nn=3,hn=4,dn=5,ln=6,un=1,cn=2,pn=3,mn=4,fn=5,_n=6,gn=7,Sn=8,Tn=9,yn=10,En=11,vn=12,Cn=13,Pn=14,Dn=15,In=16,An=17,Rn=2,On=3,wn=5,Ln=6,Mn=7;var Vn=class{constructor(t,e){this.stat=t.stat,this.tsdb=t.tsdb,this.vodStat=t.vodStat,this.handler=e,this.reset()}destroy(){}addH265Support(t,e){let i=t;if(-1e4==i){const t=this.handler.h265Support,e=t.serverSupported,s=t.isCodecSupport,r=t.isBrowserSupport,a=t.isCfgSupport;e?a?r?s?a&&r&&s&&(i=an):i=ln:i=dn:i=hn:i=on}this.stat.setComDim(L.a.DIM_COM.H265_SUPPORT_REASON,i),!e.isLive&&this.vodStat&&this.vodStat.setComDim(L.a.DIM_COM.H265_SUPPORT_REASON,i)}addTurnTo264Support(t,e){let i=0;switch(t){case bo.WORKER_TIMEOUT:i=fn;break;case bo.WORKER_ERROR:case bo.CREATE_WORKER_ERROR:i=_n;break;case bo.START_CODE_ERROR:i=vn;break;case bo.WASM_TIMEOUT:i=Cn;break;case bo.VIDEO_FAST:i=Pn;break;case bo.AUDIO_FAST:i=Dn;break;case bo.CREATE_WEBGL_FAIL:i=In;break;case bo.RETRY_MAX:i=An}this.stat.setComDim(L.a.DIM_COM.H265_SUPPORT_REASON,i),!e.isLive&&this.vodStat&&this.vodStat.setComDim(L.a.DIM_COM.H265_SUPPORT_REASON,i)}addH265SupportNew(t){let e;const i=this.handler.h265Support,s=i.serverSupported,r=i.isCodecSupport,a=i.isBrowserSupport,o=i.isCfgSupport,n=i.codecSupportReason;if(s)if(o)if(a){if(r)o&&a&&r&&(e=un);else if(-1e4!=n)switch(n){case Rn:e=gn;break;case On:e=Sn;break;case wn:e=Tn;break;case Ln:e=yn;break;case Mn:e=En}}else e=pn;else e=mn;else e=cn;this.stat.setComDim(L.a.DIM_COM.H265_SUPPORT_REASON,e),!t.isLive&&this.vodStat&&this.vodStat.setComDim(L.a.DIM_COM.H265_SUPPORT_REASON,e)}reset(){}};var bn=class{constructor(t,e,i){this._stat=t,this._vodStat=i,this._tsdb=e,this._support=new Mo(t,e),this._decoder=new Fo(t,e),this._render=new rn(t,e),this._h265StatReport=new Vn({stat:t,tsdb:e,vodStat:i},this),this._renderInited=!1,this._rendering=!1,this._isH265WasmCodec=!0,this._isH265Stream=!1,this._isLive=!0,this.decodeType="wasm"}set isLive(t){this._isLive=t}set isH265Stream(t){this._isH265Stream=t}stop(){f.a.log("H265Proxy.stop"),this._isH265Stream=!1,this._rendering=!1,this._renderInited=!1,this._decoder&&this._decoder.stopDecoder(),this._render&&this._render.destroy&&this._render.destroy()}destroy(){this._render&&(this._render.destroy(),this._support.destroy(),this._decoder.destroy(),this._h265StatReport.destroy(),this._stat=null,this._tsdb=null,this._vodStat=null,this._render=null,this._support=null,this._decoder=null,this._h265StatReport=null,this._isH265Stream=!1)}initSupport(t){this._support&&(this._isH265Stream=!1,this._support.init(t))}loadDecoder(t,e){this._decoder.load(t,e)}initRender(t){this.isSupported&&(this._isLive||this._isH265Stream)&&(f.a.log(`H265Proxy.initRender isSupported=${this._support.isSupported} isReady=${this._decoder.isReady}`),this._rendering=!1,this._renderInited=!1,this._render.destroy(),this.isReady&&(this._renderInited=!0,this._render.attachMse(t)))}terminate(){this._decoder.terminate()}containerResize(t){this.rendering&&this._render.containerResize(t)}pushVideoFrame(t,e){this._rendering=!0,this._render&&this._render.pushVideoFrame(t,e)}onTurnToH264(t){this._rendering=!1,this._renderInited=!1,this._support.onTurntoH264(t)}checkUrl(t){this.isReady&&-1===t.url.indexOf("codec=265")&&(t.url+="&codec=265")}on265StartCodeError(){this._render&&this._render.on265StartCodeError()}reportDecodeRenderTime(t,e){this._render&&this._render.reportDecodeRenderTime(t,e)}getStats(){return this._render&&this._render.getStats()}jumpBuffer(t,e,i,s){this._rendering&&this._render.jumpBuffer(t,e,i,s)}seek(t){this._render&&this._render.seek&&this._render.seek(t)}onVideoPause(){this._render.onVideoPause()}onVideoPlay(){this._render.onVideoPlay()}onVideoSeek(t){this._render&&this._render.onVideoSeek&&this._render.onVideoSeek(t)}onStarted(){this._render&&this._render.onStarted()}onEnded(){this._render&&this._render.onEnded()}getCurrentVideoTime(){return this._render&&this._render.getCurrentVideoTime?this._render.getCurrentVideoTime():0}getVideoBufferLen(){return this._render&&this._render.getVideoBufferLen?this._render.getVideoBufferLen():0}getRenderElement(){return this._render&&this._render.getRenderElement?this._render.getRenderElement():null}get render(){return this._render}get canvas(){return this._render.videoPlayerElement?this._render.videoPlayerElement:this._render.canvas}get isVideoTrack(){return this._render.isSupportVideoTrack}get decoder(){return this._decoder}get isSupported(){return this._support&&this._support.isSupported}get isReady(){return this._support&&this._support.isSupported&&this._decoder.isReady}get needPreload(){return!Fo.preloaded&&this._support.canPreload&&!this._decoder.isReady}get renderInited(){return this._renderInited}get rendering(){return this._rendering}get h265StatReport(){return this._h265StatReport}get h265Support(){return this._support}get isServerSupported(){return this._support&&this._support.serverSupported}};var Nn=class{constructor(t,e,i){this._stat=t,this._vodStat=i,this._tsdb=e,this._support=new Mo(t,e),this._h265StatReport=new Vn({stat:t,tsdb:e,vodStat:i},this),this._isH265MseCodec=!0,this._mse=null,this.decodeType="mse_hevc"}stop(){f.a.log("H265MseProxy.stop")}destroy(){this._support.destroy(),this._h265StatReport.destroy(),this._stat=null,this._tsdb=null,this._vodStat=null,this._support=null,this._h265StatReport=null,this._mse=null}initSupport(t){this._support.mseHevcInit(t)}initRender(t){this._mse=t}checkUrl(t){-1===t.url.indexOf("codec=265")&&(t.url+="&codec=265")}turnToH264(t){this._mse&&this._mse.turnToH264(t)}reportError(t,e){f.a.log("H265MseProxy.reportError",t,bo.dic[t]),this._tsdb.sendMetrics([this._stat.createAct(L.a.ACT.H265_STATUS,{value:[1],str:[t,null!=e?e:1e4]})])}onTurntoH265Wasm(t){this._support.onTurntoH265Wasm(t)}onTurnToH264(t){this._support.onTurntoH264(t)}on265StartCodeError(){this.reportError(bo.START_CODE_ERROR),this.turnToH264(bo.START_CODE_ERROR)}get isSupported(){return this._support&&this._support.isSupported}get h265StatReport(){return this._h265StatReport}get h265Support(){return this._support}get isH265MseCodec(){return this._support&&this._support.isSupported}get isServerSupported(){return this._support&&this._support.serverSupported}},Fn=i(23);var Bn=class extends Ao{constructor(){super()}_createAct(t,e){let i={sMetricName:L.a.VOD_ACT.name,vField:{},vDimension:{}};if(i.vDimension[L.a.ACT.field]=t,this._fillFromMap(i.vDimension,this.comDim),this._fillFromMap(i.vDimension,this.actDim),e){let t=0;if(e.hasOwnProperty(L.a.KEY_VALUE)){let s=e[L.a.KEY_VALUE];for(t=0;t<s.length;t++)0===t?i.vField[L.a.KEY_VALUE]=s[t]:i.vField[L.a.KEY_VALUE+t]=s[t]}if(e.hasOwnProperty(L.a.KEY_STR)){let s=e[L.a.KEY_STR];for(t=0;t<s.length;t++)i.vDimension[L.a.KEY_STR+(t+1)]=s[t]}e.hasOwnProperty(L.a.KEY_DIM)&&Object.assign(i.vDimension,e[L.a.KEY_DIM])}return i.vDimension.appid=M.a.appid,this.actDim.clear(),i}_fill(t){if(0==this.coreMap.size&&0==this.compMap.size)return;let e={sMetricName:L.a.VOD_CORE.name,vField:{},vDimension:{},vExLog:{}};this.coreDim.set(L.a.DIM_CORE.HEART_TYPE,this.heart_type),this._fillFromMap(e.vDimension,this.comDim),this._fillFromMap(e.vDimension,this.coreDim),this._fillFromKeyvalMap(e.vDimension,this.keyvalCoreDimMap),this._fillFromMap(e.vExLog,this.extDim),this._fillFromMap(e.vField,this.coreMap),this._fillComp(e.vDimension),this.coreDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.keyvalCoreDimMap.clear(),this.heart_type==L.a.HEART_TYPE.START&&(this.heart_type=L.a.HEART_TYPE.CONTINUS),e.vDimension.appid=M.a.appid,t.push(e)}};var Un=class{constructor(t){this.eventEmitter=t,this.hasEvent=!1,this.isSupported=void 0!==document.addEventListener&&void 0!==document.hidden,this.onVisibilitychangeBind=this.onVisibilitychange.bind(this),this.stat=null,this.vodStat=null,this.hiddenTs=0,this.visibleTs=y.a.now(),this.lastStatHiddenTs=0}setStat(t,e){this.stat=t,this.vodStat=e,this.onVisibilitychange(),this.addVisibilitychange()}addVisibilitychange(){!this.hasEvent&&this.isSupported&&(this.hasEvent=!0,document.addEventListener("visibilitychange",this.onVisibilitychangeBind))}delVisibilitychange(){this.hasEvent&&(this.hasEvent=!1,document.removeEventListener("visibilitychange",this.onVisibilitychangeBind))}onVisibilitychange(){this.isSupported&&(f.a.log("Visibility.onVisibilitychange visibilityState="+document.visibilityState),this.stat&&this.stat.setComDim(L.a.DIM_COM.VISIBILITY_STATE,document.visibilityState),this.vodStat&&this.vodStat.setComDim(L.a.DIM_COM.VISIBILITY_STATE,document.visibilityState),this.eventEmitter.trigger(a.VISIBILITY_CHANGE,document.visibilityState),document.visibilityState===D.a.VISIBILITY_STATE.VISIBLE?(this.visibleTs=y.a.now(),this.eventEmitter.onVisibilitychange&&this.eventEmitter.onVisibilitychange(!0)):document.visibilityState===D.a.VISIBILITY_STATE.HIDDEN&&(this.hiddenTs=y.a.now(),this.eventEmitter.onVisibilitychange&&this.eventEmitter.onVisibilitychange(!1)))}setHiddenTimeStat(){if(this.isSupported){let t=y.a.now(),e=0;0!=this.hiddenTs&&(document.visibilityState===D.a.VISIBILITY_STATE.HIDDEN&&this.hiddenTs>=this.visibleTs?e=t-this.hiddenTs:document.visibilityState===D.a.VISIBILITY_STATE.VISIBLE&&t-this.visibleTs<t-this.lastStatHiddenTs&&0!=this.lastStatHiddenTs&&(e=this.visibleTs-this.hiddenTs)),this.stat&&this.stat.setCore(L.a.CORE.VISIBILITY_HIDDEN_TIME,e),this.lastStatHiddenTs=t}}};const kn=0,xn=1,Hn=2;var Gn=class{constructor(){this.player=null,this.eventEmitter=null,this.backCd=P.a.vodAv1Cd,this.backCntMax=P.a.vodAv1CdCnt,this.backCnt=0,this.backTs=0,this.switchTs=-1,this.state=kn,this.pauseTs=0}isTimeToBack(){return this.state===Hn}start(t){this.backCnt>=this.backCntMax||(this.player=t,this.eventEmitter=t.eventEmitter,this.state===kn&&(this.backCnt<this.backCntMax&&this.backCnt++,this.backTs=y.a.now()+this.backCd*this.backCnt,q.add(this.onCheckTimer,this,1e3),this.state=xn,f.a.log("BackToAV1.start")))}stop(){this.state=kn,q.remove(this.onCheckTimer,this)}onCheckTimer(t){if(this.state===xn)t>this.backTs&&(f.a.log("BackToAV1.onCheckTimer time to back"),this.state=Hn,this.player.setStopLoadFragment());else if(this.state===Hn){let t=this.player.getBufferLen();if(t<1e3){let e=this.player.getCurrentTime();f.a.log("BackToAV1.onCheckTimer time to switch curTime="+e),this.stop(),this.state=kn;let i=e+t/1e3;this.eventEmitter.trigger(a.TRY_TO_AV1,i)}}}};const Wn=["4090","4080","4070","4060","3090","3080","3070","3060","3050","2080","2070","2060","1660","1650","1080","1070","1060","1050","titan rtx","titan xp","titan x"],$n=1,Yn=2,Kn=3,jn=4,qn=5,zn=6,Jn=7,Qn=8,Xn=9,Zn=10,th=11,eh=12,ih=13,sh=14,rh=15,ah=17,oh=18,nh=19,hh=20,dh=21,lh=22,uh=23,ch=1,ph=2,mh=3,fh=4,_h=5,gh=6,Sh=7,Th=8,yh=9,Eh=10,vh=11,Ch=12,Ph=13,Dh=14;var Ih=class{constructor(t,e,i){this.handler=t,this.stat=e,this.statVod=i,this.h5Root="",this.modelRes="live",this.isConfigSupport=!1,this.isHardSupport=!1,this.isPlayTypeSupport=!1,this._isGameIdSupport=!1,this._isSupport=!1,this.enhanceErrorCnt=0,this.vEnhanceType=0,this.vSupport=0,this.vGameId=0,this.vErrorCode=0,this.vFrames=0,this.vEnhanceDelay=-1,this.lastBitrate=-1,this.lastLine=-1,this.isCloseEnhance=!1,this.isLive=!0}isGpuSupport(){return!!navigator.gpu}resetProps(){this.isConfigSupport=!1,this.isHardSupport=!1,this.isPlayTypeSupport=!1,this._isGameIdSupport=!1,this._isSupport=!1,this.enhanceErrorCnt=0,this.vEnhanceType=0,this.vSupport=0,this.vGameId=0,this.vErrorCode=0,this.isCloseEnhance=!1}setInfo(t){t&&(-1!=this.lastBitrate&&this.lastBitrate!=t.curBitrate&&this.resetProps(),this.lastBitrate=t.curBitrate,-1!=this.lastLine&&this.lastLine!=t.lineType&&this.resetProps(),this.lastLine=t.lineType,this.h5Root=t.h5Root,t.liveType!=Oo.a.VOD&&t.liveType!=Oo.a.REPLAY||(this.h5Root="https://a.msstatic.com/huya/h5player/sdk_static/vod/1.0.1/",this.modelRes="vod"),localStorage._h5Root&&(this.h5Root=localStorage._h5Root),this._isGameIdSupport=!1,this.vGameId=t.gameId||0)}getConfigSupport(t){if(this.isCloseEnhance=!1,t.liveType==Oo.a.LIVE){let e=1==P.a.enhanceVCfg[0],i=t.curBitrate<=P.a.enhanceVCfg[1];if(this.isConfigSupport=e&&i,this.handler&&this.handler.player&&this.handler.player.mse&&this.handler.player.mse.getMseAvcCfgHeight){const t=this.handler.player.mse.getMseAvcCfgHeight();if(t>P.a.enhanceVCfg[3]&&(this.isConfigSupport=!1,f.a.log("VideoEnhance.getConfigSupport height unsupport!",t)),this._isGameIdSupport=-1!==P.a.enhanceGameIds.indexOf(this.vGameId),this._isGameIdSupport&&P.a.enhanceGameIdRatioMap&&P.a.enhanceGameIdRatioMap[this.vGameId]){-1===P.a.enhanceGameIdRatioMap[this.vGameId].indexOf(t)&&(this.isConfigSupport=!1,f.a.log("VideoEnhance.getConfigSupport game height unsupport!",t))}}1==P.a.ehWhiteAnchoruids[0]&&-1===P.a.ehWhiteAnchoruids[1].indexOf(Number(t.presenterUid))&&(this.isConfigSupport=!1,f.a.log("VideoEnhance.getConfigSupport anchorUid white not support!")),-1!==P.a.eHBlackUids.indexOf(Number(t.uid))&&(this.isConfigSupport=!1,f.a.log("VideoEnhance.getConfigSupport uid black")),-1!==P.a.eHBlackAnchoruids.indexOf(Number(t.presenterUid))&&(this.isConfigSupport=!1,f.a.log("VideoEnhance.getConfigSupport anchorUid black")),-1!=P.a.eHBlackBrowVerList.indexOf(qe.a.version.major)&&(f.a.log("VideoEnhance.getConfigSupport anchorUid black"),this.isConfigSupport=!1)}else if(t.liveType==Oo.a.REPLAY||t.liveType==Oo.a.VOD){this.isLive=!1;let e=1==P.a.enhanceVodVCfg[0],i=t.curBitrate<=P.a.enhanceVodVCfg[1];if(this.isConfigSupport=e&&i,this.handler&&this.handler.player&&this.handler.player.mse&&this.handler.player.mse.getMseAvcCfgHeight){this.handler.player.mse.getMseAvcCfgHeight()>P.a.enhanceVodVCfg[3]&&(this.isConfigSupport=!1,f.a.log("VideoEnhance.getConfigSupport height unsupport!"))}1==P.a.ehVodWhiteAnchoruids[0]&&-1===P.a.ehVodWhiteAnchoruids[1].indexOf(Number(t.presenterUid))&&(this.isConfigSupport=!1,f.a.log("VideoEnhance.getConfigSupport anchorUid white not support!")),1==P.a.ehVodWhiteVids[0]&&-1===P.a.ehVodWhiteVids[1].indexOf(Number(t.vid))&&(this.isConfigSupport=!1,f.a.log("VideoEnhance.getConfigSupport vid white not support!")),-1!==P.a.eHVodBlackUids.indexOf(Number(t.uid))&&(this.isConfigSupport=!1,f.a.log("VideoEnhance.getConfigSupport uid black")),-1!==P.a.eHVodBlackAnchoruids.indexOf(Number(t.presenterUid))&&(this.isConfigSupport=!1,f.a.log("VideoEnhance.getConfigSupport anchorUid black")),-1!==P.a.eHVodBlackVids.indexOf(Number(t.vid))&&(this.isConfigSupport=!1,f.a.log("VideoEnhance.getConfigSupport vid black")),-1!=P.a.eHVodBlackBrowVers.indexOf(qe.a.version.major)&&(f.a.log("VideoEnhance.getConfigSupport anchorUid black"),this.isConfigSupport=!1)}}getHardSupport(t){let e=this.isGpuSupport(),i=ce().toLowerCase(),s=-1!=i.indexOf("nvidia"),r=!1;Wn.map(t=>{-1!=i.indexOf(t)&&(r=!0)}),t.liveType==Oo.a.LIVE?P.a.eHBlackRenderList.forEach(t=>{-1!=i.indexOf(t)&&(r=!1,f.a.log("VideoEnhance.getHardSupport renderList black"))}):P.a.eHVodBlackRenderList.forEach(t=>{-1!=i.indexOf(t)&&(r=!1,f.a.log("VideoEnhance.getHardSupport renderList black"))});let a=r,o=navigator.hardwareConcurrency>=P.a.enhanceVCfg[2];f.a.log(`VideoEnhance.getHardSupport gpu=${e},gType=${s},gList=${a},hardWare=${o}`),this.isHardSupport=e&&s&&a&&o}getPlayTypeSupport(t){let e=this.handler.playerCoreType==D.a.PLAYER_CORE_TYPE.WEBCODECS;this.isPlayTypeSupport=e}getSupport(t){return!!t&&(1!=localStorage._enableEnhance?(t.liveType==Oo.a.LIVE?(f.a.log("Config.enhanceGameIds",P.a.enhanceGameIds),this._isGameIdSupport=-1!==P.a.enhanceGameIds.indexOf(this.vGameId)):this._isGameIdSupport=-1!==P.a.enhanceVodGameIds.indexOf(this.vGameId),this.getConfigSupport(t),this.getHardSupport(t),this.getPlayTypeSupport(t),f.a.log(`VideoEnhance.getSupport game=${this._isGameIdSupport},cfg=${this.isConfigSupport},hard=${this.isHardSupport},playType=${this.isPlayTypeSupport},errCnt=${this.enhanceErrorCnt}`),this.isHardSupport?(this.stat.setComDim(L.a.DIM_COM.V_ENHANCE_ENTRY,1),this.vSupport=1,!this.isLive&&this.statVod&&this.statVod.setComDim(L.a.VOD_DIM_COM.V_ENHANCE_ENTRY,1)):(this.stat.setComDim(L.a.DIM_COM.V_ENHANCE_ENTRY,"0"),!this.isLive&&this.statVod&&this.statVod.setComDim(L.a.VOD_DIM_COM.V_ENHANCE_ENTRY,"0"),this.vSupport=0),this.isConfigSupport?this.isHardSupport?1!=this._isGameIdSupport?(this._isSupport=!1,this.onVideoEhanceError(Zn),void this.setUnSupportReport()):R.b.isWebcodecsBrowserSupported()?this.handler&&(this.handler.h265Proxy.isSupported&&1==localStorage.isCloseWebcodecsH265||1==localStorage.isCloseWebcodecsH264)?(this.onVideoEhanceError(sh),this.setUnSupportReport(),void(this._isSupport=!1)):this.isPlayTypeSupport?this.enhanceErrorCnt>=3?(this._isSupport=!1,void this.onVideoEhanceError(Qn)):void(1!=localStorage._closeLocalEnhance?this._isSupport=!0:this._isSupport=!1):(this.onVideoEhanceError(Yn),1==P.a.enhanceSupportMode&&this.setUnSupportReport(),void(this._isSupport=!1)):(this.onVideoEhanceError(rh),this.setUnSupportReport(),void(this._isSupport=!1)):(this.onVideoEhanceError($n),this._isSupport=!1,void this.setUnSupportReport()):(this.onVideoEhanceError(th),this.setUnSupportReport(),void(this._isSupport=!1))):void(this._isSupport=!0))}setUnSupportReport(){this.stat.setComDim(L.a.DIM_COM.V_ENHANCE_TYPE,"0"),!this.isLive&&this.statVod&&this.statVod.setComDim(L.a.VOD_DIM_COM.V_ENHANCE_TYPE,"0"),this.vEnhanceType=0}getModelRes(){const t=this.h5Root,e={lol_web:[7185,5485,5699,7,6203,9521,393],lol_web2:[1],kog_web:[2336],xingxiu_web:[1663,2168,2633],fps_web:[2793,3203,5937,862,4,2413,1964,1997,6219,7579,2,4921,9961,802,7601,1732]};let i=null;for(let t in e){-1!==e[t].indexOf(this.vGameId)&&(i=t)}if(!i)return null;if(this.res={"360p":t+`models/${this.modelRes}/${i}/360p.bin`,"450p":t+`models/${this.modelRes}/${i}/450p.bin`,"720p":t+`models/${this.modelRes}/${i}/720p.bin`,"1080p":t+`models/${this.modelRes}/${i}/1080p.bin`},localStorage._enhanceModelRes){const t=JSON.parse(localStorage._enhanceModelRes);t["360p"]&&(this.res["360p"]=t["360p"]),t["450p"]&&(this.res["450p"]=t["450p"]),t["720p"]&&(this.res["720p"]=t["720p"]),t["1080p"]&&(this.res["1080p"]=t["1080p"])}return this.res}getH5Root(){return this.h5Root}onVideoEhanceErrorCb(t){let e=0;t==ch?e=Kn:t==ph?e=jn:t==mh?e=qn:t==fh?e=Jn:t==_h?e=zn:t==gh?e=Xn:t==Sh?e=eh:t==Th?e=ih:t==yh?e=oh:t==Eh?e=nh:t==vh?e=hh:t==Ch?e=dh:t==Ph?e=lh:t==Dh&&(e=uh),this.enhanceErrorCnt++,this.onVideoEhanceError(e)}onVideoEhanceError(t){this.isCloseEnhance=!0,t!=Kn&&t!=jn&&t!=qn&&t!=Jn&&t!=zn&&t!=Xn&&t!=eh&&t!=ih&&t!=Qn&&t!=Yn&&t!=oh&&t!=nh&&t!=hh&&t!=dh||(this.stat.setComDim(L.a.DIM_COM.V_ENHANCE_TYPE,1),!this.isLive&&this.statVod&&this.statVod.setComDim(L.a.VOD_DIM_COM.V_ENHANCE_TYPE,1),this.vEnhanceType=1),this.stat.setComDim(L.a.DIM_COM.ENHANCE_BACK_REASON,t),this.vErrorCode=t}onVideoEhanceSuccess(){this.stat.setComDim(L.a.DIM_COM.V_ENHANCE_TYPE,2),this.stat.setComDim(L.a.DIM_COM.ENHANCE_BACK_REASON,0),!this.isLive&&this.statVod&&(this.statVod.setComDim(L.a.VOD_DIM_COM.V_ENHANCE_TYPE,2),this.statVod.setComDim(L.a.VOD_DIM_COM.ENHANCE_BACK_REASON,0)),this.vEnhanceType=2,this.vErrorCode=0}getEnhanceStats(){return{vEnhanceType:this.vEnhanceType,vSupport:this.vSupport,vGameId:this.vGameId,vErrorCode:this.vErrorCode}}onCheckTimer(){let t=0;this.isLive?this.handler&&this.handler.player&&this.handler.player.mse&&this.handler.player.mse.getRealFps&&(t=this.handler.player.mse.getRealFps()):this.handler&&this.handler.player&&this.handler.player.getFps&&(t=this.handler.player.getFps()),t>=40&&!this.isCloseEnhance&&(this.onVideoEhanceError(ah),this.stat.setComDim(L.a.DIM_COM.V_ENHANCE_TYPE,"0"),!this.isLive&&this.statVod&&this.statVod.setComDim(L.a.VOD_DIM_COM.V_ENHANCE_TYPE,"0"),this.vEnhanceType=0,f.a.log("VideoEnhance.RealFps Error"),this.handler.player.setEnhance(!1))}destroy(){this.handler=null,this.stat=null,this.statVod=null,this.h5Root="",this.isConfigSupport=!1,this.isHardSupport=!1,this.isPlayTypeSupport=!1,this._isGameIdSupport=!1,this._isSupport=!1,this.enhanceErrorCnt=0,this.vEnhanceType=0,this.vSupport=0,this.vGameId=0,this.vErrorCode=0,this.vFrames=0,this.vEnhanceDelay=-1,this.lastBitrate=-1,this.lastLine=-1,this.isCloseEnhance=!1,this.isLive=!0}get isSupport(){return this._isSupport}},Ah={play:2,zhixu_web:3,editor:4,diy:5,material:6,anchor_room_play:7,"m-video":8,header_youliao_play:10,kj_youliao_play:11,ai_clip:12,endGameChallenge:13,ymzx_game_challenge:14,bainian:15,new_year:16,vodadv:20,anchor_slap_face:21,endGameChallenge_share:22,pc_anchor_shequ:23,act_photo_h5:24,other:99,getPlace:function(t){return this.hasOwnProperty(t)?this[t]:this.other},isZhiXu:function(t){return this[t]===this.zhixu_web}},Rh={LOADSTART:"loadstart",PAUSE:"pause",LOADEDMETADATA:"loadedmetadata",LOADEDDATA:"loadeddata",ERROR:"error",CANPLAY:"canplay",CANPLAYTHROUGH:"canplaythrough",PLAY:"play",PLAYING:"playing",STALLED:"stalled",SUSPEND:"suspend",VOLUMECHANGE:"volumechange",WAITING:"waiting",PROGRESS:"progress",ENDED:"ended",DURATIONCHANGE:"durationchange",RATECHANGE:"ratechange",SEEKED:"seeked",SEEKING:"seeking",getEvents:function(){return[this.LOADSTART,this.PAUSE,this.LOADEDMETADATA,this.LOADEDDATA,this.ERROR,this.CANPLAY,this.CANPLAYTHROUGH,this.PLAY,this.PLAYING,this.STALLED,this.SUSPEND,this.VOLUMECHANGE,this.WAITING,this.PROGRESS,this.ENDED,this.DURATIONCHANGE,this.RATECHANGE,this.SEEKED,this.SEEKING]}};var Oh=class{constructor(t){this._interval=t,this._curTime=0}reset(){this._curTime=0}isDone(t){if(0===this._curTime)this._curTime=t;else if(t-this._curTime>=this._interval)return this._curTime=t,!0;return!1}};let wh=[];var Lh=function(t){f.a.log(t),wh.push(`${y.a.getTimeStr()} ${t}`),wh.length>200&&wh.shift()};let Mh=1;var Vh=class{constructor(t,e){this.id=Mh++,this.eventEmitter=t,this.tsdb=e.tsdb,this.videoElement=So.create(e.videoElement,e.options),this._triggerPlayTimeInterval=new Oh(1e3),this._checkBufferInterval=new Oh(200),this._heartInterval=new Oh(2e4),this.downTotalBufTs=0,this.started=!1,this.videoStatus=o,this.videoLoadTimeSent=!1,this.allowedAutoPlay=!0,this.isLoadstart=!1,this._isPlaying=!1,this.urlNetworkstate=0,this.seekTime=0,this.played=!1,this.isSeek=!1,this.pauseByUser=!1,this.sysPause=!1,this.ended=!1,this.playTimeout=2e3,this.hasEvents=!1,this.waiting=!1,this.seeking=!1,this.firstStartTs=0,this.startTs=0,this.loadedmetadataTs=0,this.loadeddataTs=0,this.progressTs=0,this.stalledTs=0,this.videoDuration=0,this.retryCnt=3,this.autoplay=!e.options||!e.options.hasOwnProperty("autoplay")||e.options.autoplay,this.info=null,this.url="",this.videoChecker=new fi(this.videoElement,!1,{renderCallback:this._onVideoRender.bind(this)}),this.videoFrameRenderTs=0,this.videoTimerRenderTs=0,this._videoEvtHandlerBind=this._videoEvtHandler.bind(this),this._onWaitPlayTimeoutBind=this._onWaitPlayTimeout.bind(this),this._waitPlayTimeoutInt=0}play(){this.clearWaitPlayTimeout(),this.pauseByUser=!1,this.sysPause=!1,this.autoplay=!0,this._updateStatus(n),this._addEvents(),Lh(`VideoTagPlayer(${this.id}).play ${this.getCost()} currentTime=${this.videoElement.currentTime} ${R.b.getBufferedLog(this.videoElement)} duration=${this.videoElement.duration}`),this._resetTs();let t=this.videoElement.play();return t?t.then(()=>{Lh(`VideoTagPlayer(${this.id}).play success ${this.getCost()} currentTime=${this.videoElement.currentTime} ${R.b.getBufferedLog(this.videoElement)}`),this._playSuc()}).catch(t=>{f.a.log(`VideoTagPlayer(${this.id}).play error`,t.message,this.videoElement.paused)}):f.a.warn(`VideoTagPlayer(${this.id}).play promise is null`),t}_resetTs(){this.startTs=y.a.now()}_playSuc(){}pause(){f.a.log(`VideoTagPlayer(${this.id}).pause currentTime=${this.videoElement.currentTime} ${R.b.getBufferedLog(this.videoElement)}`),this.pauseByUser=!0,this._delEvents(),this.videoElement.pause()}seek(t){f.a.log(`VideoTagPlayer(${this.id}).seek time=${t} ${R.b.getBufferedLog(this.videoElement)}`),this.ended=!1,this.seeking=!0,this._seek(t,this.playTimeout)}setVolume(t){this.videoElement&&(this.videoElement.volume=t),f.a.log(`VideoTagPlayer(${this.id}).setVolume val=${t} video=${!!this.videoElement} volume=${this.videoElement&&this.videoElement.volume}`)}setMuted(t){f.a.log(`VideoTagPlayer(${this.id}).setMuted val=${t} video=${!!this.videoElement}`),this.videoElement&&(this.videoElement.muted=t)}setPlaybackRate(t){f.a.log(`VideoTagPlayer(${this.id}).setPlaybackRate val=${t} video=${!!this.videoElement}`),this.videoElement&&(this.videoElement.playbackRate=t)}retryStart(){return!!(this.info&&this.retryCnt>0)&&(this.retryCnt--,!0)}stop(){q.remove(this.onCheckFastTimer,this),q.remove(this._playFailed,this),q.remove(this._onAutoPlayTimeout,this),q.remove(this._onSeekTimeout,this),q.remove(this._videoErrorRetry,this),this.clearWaitPlayTimeout(),this.startTs=0,this.loadedmetadataTs=0,this.loadeddataTs=0,this.progressTs=0,this.stalledTs=0,this.started=!1,this.pauseByUser=!1,this.ended=!1,this.played=!1,this.videoStatus=o,this._heartInterval.reset(),this._checkBufferInterval.reset(),this._triggerPlayTimeInterval.reset(),this.videoChecker.stop(),this._delEvents(),this.videoElement.pause(),this.videoElement.src=""}start(t){0===this.firstStartTs&&(this.firstStartTs=y.a.now()),this.stop(),f.a.log(`VideoTagPlayer(${this.id}).start info=${t&&JSON.stringify(t)}`),this.info=t,t&&(this.playTimeout=t.playTimeout||this.playTimeout),q.once(this._playFailed,this,this.playTimeout),q.once(this._checkUrlActive,this,3e3),q.add(this.onCheckFastTimer,this,50)}_start(t){""!==this.url?(this._addEvents(),t.seekTime>0&&(this.seekTime=t.seekTime,this.isSeek=!0),this.ended=!1,this.startTs=y.a.now(),Lh(`VideoTagPlayer(${this.id})._start ${this.getCost()} url=${this.url}`),this.videoElement.src=this.url,this.videoElement.load(),this._updateStatus(n)):Lh(`VideoTagPlayer(${this.id})._start url is empty!${this.getCost()}`)}_checkUrlActive(){try{if(this.url){const t=this.url,e=new XMLHttpRequest;e.open("HEAD",t),e.onreadystatechange=()=>{e.readyState===e.DONE&&(this.urlNetworkstate=e.status,f.a.log(`VideoTagPlayer(${this.id})._checkUrlActive current status: `,this.urlNetworkstate))},e.send()}}catch(t){f.a.log(`VideoTagPlayer(${this.id})._checkUrlActive error`,t.message)}}onCheckFastTimer(t){this.ended||(this._checkHeartbeat(t),this._triggerPlayTime(t))}_updateStatus(t){this.videoStatus!==t&&(f.a.log(`VideoTagPlayer(${this.id})._updateStatus status=${this.videoStatus} => ${t}`),this.videoStatus=t,this.eventEmitter.trigger(a.PLAY_STATUS,{status:t}))}_onVideoRender(t){t===fi.Types.FRAME?this.videoFrameRenderTs=y.a.now():this.videoTimerRenderTs=y.a.now()}_addEvents(){if(!this.hasEvents&&this.videoElement){f.a.log(`VideoTagPlayer(${this.id})._addEvents`),this.hasEvents=!0,Rh.getEvents().forEach(t=>{this.videoElement.addEventListener(t,this._videoEvtHandlerBind)})}}_delEvents(){if(this.hasEvents&&(f.a.log(`VideoTagPlayer(${this.id})._delEvents`),this.hasEvents=!1,this.videoElement)){Rh.getEvents().forEach(t=>{this.videoElement.removeEventListener(t,this._videoEvtHandlerBind)})}}_videoEvtHandler(t){if(t){f.a.log(`VideoTagPlayer(${this.id})._videoEvtHandler type=${t.type} currentTime=${this.videoElement.currentTime} ${R.b.getBufferedLog(this.videoElement)}`);let e="on"+t.type;this[e]&&this[e](t)}else f.a.error(`VideoTagPlayer(${this.id})._videoEvtHandler e is null`)}getRecvInfo(){return[this.loadedmetadataTs>0?this.loadedmetadataTs-this.startTs:0,this.progressTs>0?this.progressTs-this.startTs:0,this.stalledTs>0?this.stalledTs-this.startTs:0]}onloadstart(){this.isLoadstart=!0}onpause(){this.videoElement.currentTime<this.videoElement.duration&&(this.sysPause=!0,this._updateStatus(c),this.eventEmitter.trigger(a.BROWSER_PAUSE))}onloadedmetadata(){1!=localStorage._testNoMeta&&(this.loadedmetadataTs=y.a.now(),Lh(`VideoTagPlayer(${this.id}).onloadedmetadata ${this.getCost()} ${R.b.getBufferedLog(this.videoElement)} paused=${this.videoElement.paused}`))}onprogress(){1!=localStorage._testNoProgress&&0===this.progressTs&&(this.progressTs=y.a.now(),Lh(`VideoTagPlayer(${this.id}).onprogress ${this.getCost()} ${R.b.getBufferedLog(this.videoElement)} paused=${this.videoElement.paused}`))}onstalled(){1!=localStorage._testNoStalled&&0===this.stalledTs&&(this.stalledTs=y.a.now(),Lh(`VideoTagPlayer(${this.id}).onstalled ${this.getCost()} ${R.b.getBufferedLog(this.videoElement)} paused=${this.videoElement.paused}`))}onloadeddata(){1!=localStorage._testNoData&&(q.remove(this._playFailed,this),q.remove(this._onAutoPlayTimeout,this),q.remove(this._checkUrlActive,this),this.played||(this.played=!0,this.loadeddataTs=y.a.now(),this.videoDuration=this.videoElement.duration,Lh(`VideoTagPlayer(${this.id}).onloadeddata play, ${this.getCost()}, paused=${this.videoElement.paused} x5-autoplay=${this.videoElement.getAttribute("x5-autoplay")} ${R.b.getBufferedLog(this.videoElement)}`),this.videoChecker.start(),this._startPauseStat(),this.sendVideoLoadTime(),this._updateStatus(h),this.eventEmitter.trigger(a.VIDEO_PLAY,{video:this.videoElement}),this._triggerPlayTime(y.a.now(),!0),this._checkPlay(),!this.autoplay&&this.videoElement.paused&&this.eventEmitter.trigger(a.VIDEO_PAUSE,{video:this.videoElement})))}_startPauseStat(){}_playFailed(){!pe.a.matches.Wechat||this.isLoadstart?this.retryStart()?(Lh(`VideoTagPlayer(${this.id})._playFailed retry start! ${this.getCost()} ${So.getErrorMessage(this.videoElement)}`),0===this.retryCnt&&(this.info.seekTime=this.getCurrentTime()+.1),this.start(this.info)):(Lh(`VideoTagPlayer(${this.id})._playFailed retry end! ${this.getCost()} ${So.getErrorMessage(this.videoElement)}`),this._updateStatus(d),this.eventEmitter.trigger(a.H5_PLAY_FAIL),this.eventEmitter.trigger(a.H5_PLAYER_ERROR,{code:D.a.H5_ERROR_CODE.PLAY_TIMEOUT,error:"play failed"})):Lh(`VideoTagPlayer(${this.id})._playFailed Wechat not loadstart! ${this.getCost()}`)}_checkPlay(){if(this.videoElement.autoplay||"true"===this.videoElement.getAttribute("x5-autoplay")){const t=this.videoElement.play();t?t.then(()=>{f.a.log(`VideoTagPlayer(${this.id})._checkPlay play success currentTime=${this.videoElement.currentTime} ${R.b.getBufferedLog(this.videoElement)} duration=${this.videoElement.duration}`),this.allowedAutoPlay=!0,this.isSeek&&this.videoElement.duration>0&&this._startSeek()}).catch(t=>{f.a.warn(`VideoTagPlayer(${this.id})._checkPlay play error`,t.message),this._autoPlayFail()}):(f.a.log(`VideoTagPlayer(${this.id})._checkPlay play result is not a promise!`),pe.a.matches.UC&&this.videoElement.paused?(f.a.log(`VideoTagPlayer(${this.id})._checkPlay UC browser paused`),this._autoPlayFail()):q.once(this._onAutoPlayTimeout,this,this.playTimeout))}}_autoPlayFail(){1===P.a.h5FirstPlay&&(this.clearWaitPlayTimeout(),this._waitPlayTimeoutInt=setTimeout(this._onWaitPlayTimeoutBind,P.a.h5WaitTime)),this.allowedAutoPlay=!1,this.videoElement.pause(),this._updateStatus(u),this.eventEmitter.trigger(a.BROWSER_PAUSE)}_onWaitPlayTimeout(){this._updateStatus(d),this.eventEmitter.trigger(a.VIDEO_STOP)}clearWaitPlayTimeout(){this._waitPlayTimeoutInt>0&&(clearTimeout(this._waitPlayTimeoutInt),this._waitPlayTimeoutInt=0)}_onAutoPlayTimeout(){this.videoElement&&(f.a.warn(`VideoTagPlayer(${this.id})._onAutoPlayTimeout paused=${this.videoElement.paused} pauseByUser=${this.pauseByUser} ${R.b.getBufferedLog(this.videoElement)}`,navigator.userAgent),this.videoElement.paused?this.pauseByUser||(this._updateStatus(u),this.eventEmitter.trigger(a.BROWSER_PAUSE)):pe.a.matches.XiaoMi||0!==this.videoElement.currentTime||this.eventEmitter.trigger(a.PLAY_TIMEOUT))}_startSeek(){this.isSeek=!1,this.seekTime>0&&this._seek(this.seekTime)}_seek(t,e){if(this.videoElement.duration>0){t===Math.ceil(this.videoElement.duration)?this._end("seek"):(f.a.log(`VideoTagPlayer(${this.id})._seek time=${t} ${R.b.getBufferedLog(this.videoElement)} duration=${this.videoElement.duration}`),this.seekTime=t,this.videoElement.currentTime=t,q.once(this._onSeekTimeout,this,e||2e4))}}_onSeekTimeout(){f.a.log(`VideoTagPlayer(${this.id})._onSeekTimeout seekTime=${this.seekTime} currentTime=${this.videoElement.currentTime} ${R.b.getBufferedLog(this.videoElement)} duration=${this.videoElement.duration}`),this.seekTime>0&&this.seekTime===this.videoElement.currentTime&&!this.pauseByUser&&(this.seekTime=0,this.eventEmitter.trigger(a.SEEK_TIMEOUT))}_end(t){f.a.log(`VideoTagPlayer(${this.id})._end type=${t}`),this.ended||(this.ended=!0,this._delEvents(),this._onheartbeat(!0),this.videoElement.currentTime=this.videoElement.duration,this.videoElement.pause(),this._triggerPlayTime(y.a.now(),!0),this.eventEmitter.trigger(a.VIDEO_TAG_ENDED))}_triggerPlayTime(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(this._triggerPlayTimeInterval.isDone(t)||e)&&this.eventEmitter.trigger(a.PLAY_TIME_STATUS,{current:this.getCurrentTime(),total:this.getDurationTime()})}onerror(t){this.videoElement&&this.videoElement.error&&(this.retryStart()?(Lh(`VideoTagPlayer(${this.id}).onerror retry start! ${this.getCost()} ${So.getErrorMessage(this.videoElement)}`),q.remove(this._playFailed,this),q.once(this._videoErrorRetry,this,2e3)):(Lh(`VideoTagPlayer(${this.id}).onerror retry end! ${this.getCost()} ${So.getErrorMessage(this.videoElement)}`),this._onVodError(),this._updateStatus(d),this.eventEmitter.trigger(a.H5_PLAY_FAIL),this.eventEmitter.trigger(a.H5_PLAYER_ERROR,{video:this.videoElement,code:D.a.H5_ERROR_CODE.VIDEO_ERROR,error:t})))}_videoErrorRetry(){Lh(`VideoTagPlayer(${this.id})._videoErrorRetry ${this.getCost()}`),this.start(this.info)}_onVodError(){}oncanplay(t){this.ended||this.eventEmitter.trigger(_.VIDEO_CANPLAY,{video:this.videoElement,event:t})}onplay(t){this.ended||this.eventEmitter.trigger(a.VIDEO_NATIVE_PLAY,{video:this.videoElement,event:t})}onplaying(t){f.a.log(`VideoTagPlayer(${this.id}).onplaying status=${this.videoStatus} currentTime=${this.videoElement.currentTime} ${R.b.getBufferedLog(this.videoElement)} duration=${this.videoElement.duration}`),this._isPlaying=!0,this.seeking=!1,this.ended||this.videoStatus===h||this.videoStatus===u||(this._updateStatus(h),this.eventEmitter.trigger(a.VIDEO_PLAYING,{video:this.videoElement,event:t}))}onprogress(t){this.ended||this.eventEmitter.trigger(_.VIDEO_PROGRESS,{video:this.videoElement,event:t})}onended(t){}ondurationchange(){this.isSeek&&this.videoElement.duration>0&&(f.a.log(`VideoTagPlayer(${this.id}).ondurationchange seekTime=${this.seekTime} currentTime=${this.videoElement.currentTime} ${R.b.getBufferedLog(this.videoElement)} duration=${this.videoElement.duration}`),this._startSeek())}onseeked(t){}_checkBuffer(t){if(this.downTotalBufTs!==this.videoDuration&&this._checkBufferInterval.isDone(t)){const t=this.videoElement.buffered,e=t.length;let i=0;for(let s=0;s<e;s++){const e=t.start(s);i+=t.end(s)-e}this.downTotalBufTs=i}}getBufferLen(){let t=0;if(this.videoElement){let e=this.videoElement.buffered;e.length>0&&(t=1e3*(e.end(e.length-1)-this.videoElement.currentTime)>>0)}return t}getCurrentTime(){return this.videoElement.currentTime}getDurationTime(){return this.videoElement.duration}_checkHeartbeat(t){this._heartInterval.isDone(t)&&this._onheartbeat(!1)}_onheartbeat(){}sendVideoLoadTime(){if(!this.videoLoadTimeSent){this.videoLoadTimeSent=!0;let t=this.loadeddataTs-this.startTs,e=this.loadedmetadataTs-this.startTs,i=this.loadeddataTs-this.firstStartTs;t>0&&t<1e4&&this._sendVideoLoadTime(t,e,i)}}_sendVideoLoadTime(t,e,i){}sendNoPicture(){}addNoPictureReason(){}get isPlaying(){return this.videoStatus!==d&&this.videoStatus!==o&&this.videoStatus!==n}get hasPicture(){return this.isPlaying}get paused(){return this.isPlaying&&this.videoElement.paused}get notAllowedAutoplay(){return!this.allowedAutoPlay}get networkState(){return this.videoElement&&this.videoElement.networkState}get networkStateCode(){return this.urlNetworkstate||0}get errorCode(){return this.videoElement&&this.videoElement.error&&this.videoElement.error.code}getErrorMessage(){return So.getErrorMessage(this.videoElement)}getCost(){let t=y.a.now();return`totalCost=${t-this.firstStartTs}ms curCost=${t-this.startTs}ms`}printBlackInfo(){f.a.log(`HlsTagPlayer(${this.id}).printBlackInfo: ${So.getErrorMessage(this.videoElement)}`)}};var bh=class extends Vh{constructor(t,e){super(t,e),this.stat=e.statVod,this._checkVideoFreezeInterval=new Oh(50),this.lastPauseTs=0,this.lastCheckPlayTs=0,this.pauseBuffer=[],this.pauseDownBuffer=[],this.pauseCurrentTime=[],this.pauseTimes=0,this.pauseDuration=0,this.pauseDurationNow=0,this.pauseDurationReal=0,this.videoIsBadQuality=!1,this.downTotalBufTs=0,this.vodBadReason=0}stop(){this.sendNoPicture(),this._checkVideoFreezeInterval.reset(),super.stop()}start(t){super.start(t);let e=t.vid||R.b.getQueryString("vid",t.url);this.url=t.url+(-1!==t.url.indexOf("?")?"&":"?")+"timeStamp="+y.a.getDateTimeStr().replace(" ","_"),this.stat.setComDim(L.a.DIM_COM.STREAM_URL,this.url),this.stat.setComDim(L.a.VOD_DIM_COM.VOD_DURATION,t.duration||0),this.stat.setComDim(L.a.VOD_DIM_COM.VOD_VIDEOSOURCEID,e||""),this.stat.setComDim(L.a.VOD_DIM_COM.VODANCHORID,t.presenterUid||0),t.type===rd.MP4?(this.stat.setComDim(L.a.DIM_COM.STREAM_TYPE,fr),this.stat.setComDim(L.a.VOD_DIM_COM.VOD_MP4_SIZE,t.mp4Size||0),Ca.setVodCdnDomain(this.stat,this.url)):this.stat.setComDim(L.a.DIM_COM.STREAM_TYPE,mr),this._start(t)}onCheckFastTimer(t){this.ended||(this._checkEnded(t),this._checkBuffer(t),this._checkVideoFreeze(t)),super.onCheckFastTimer(t)}_checkVideoFreeze(t){if(!this.paused&&this._checkVideoFreezeInterval.isDone(t)&&this._isPlaying){const e=this.videoElement.currentTime;if(this.lastCheckPlayTs>0){let i=this.lastPauseTs>0?t-this.lastPauseTs:0;this.lastCheckPlayTs===e?0===this.lastPauseTs?(f.a.log(`VideoTagVodPlayer(${this.id})._checkVideoFreeze startPaused, buffer=${this.getBufferLen()},totalBuffer=${this.downTotalBufTs},pauseDuration=${i},curtime=${e},seeking=${this.seeking}`),this.lastPauseTs=this.lastCheckTs):i>200&&(this._addPauseDuration(i),this.lastPauseTs=t,this.videoStatus!==l&&(f.a.log(`VideoTagVodPlayer(${this.id})._checkVideoFreeze setPaused, buffer=${this.getBufferLen()},totalBuffer=${this.downTotalBufTs},pauseDuration=${i},curtime=${e},seeking=${this.seeking}`),this.videoStatus=l,this.eventEmitter.trigger(m.PLAY_CARTON,{video:this.videoElement,pauseDuration:this.pauseDurationReal}))):((i>200||this.pauseDurationNow>0)&&(this.pauseTimes++,this._addPauseDuration(i),f.a.log(`VideoTagVodPlayer(${this.id})._checkVideoFreeze setResume, buffer=${this.getBufferLen()},totalBuffer=${this.downTotalBufTs},pauseDuration=${this.pauseDurationNow},curtime=${e},seeking=${this.seeking}`)),this.lastPauseTs>0&&this.pauseDurationNow>0&&(this.videoStatus=h,this.eventEmitter.trigger(m.VIDEO_PLAYING,{video:this.videoElement})),this.lastPauseTs=0,this.pauseDurationNow=0)}this.lastCheckTs=t,this.lastCheckPlayTs=e,this.pauseDurationNow>=5e3&&this._pause5sRestart()}}_addPauseDuration(t){if(this.pauseDurationReal+=t,!this.seeking){this.pauseDuration+=t,this.pauseDurationNow+=t,this.videoIsBadQuality=!0;const e=this.getBufferLen();this.pauseBuffer.length<20&&this.pauseBuffer.push(e),this.pauseDownBuffer.length<20&&this.pauseDownBuffer.push(~~this.downTotalBufTs),this.pauseCurrentTime.length<20&&this.pauseCurrentTime.push(~~this.videoElement.currentTime),this.vodBadReason=e<2e3?ti.CODE:ri.CODE}}_pause5sRestart(){if(f.a.log(`VideoTagVodPlayer${this.id}).pause5sRestart!`),!this.videoElement)return;const t=this.videoElement.currentTime;this.info&&(this.start(this.info),this.seek(t))}_calcPausedByHeart(){this.pauseDurationNow>0&&this.pauseTimes++}_onheartbeat(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._calcPausedByHeart(),this.stat.setCore(L.a.VOD_CORE.VOD_BAD_QUALITY,this.videoIsBadQuality?100:0),this.stat.setCore(L.a.VOD_CORE.VOD_BLOCK_COUNT,this.pauseTimes),this.stat.setCore(L.a.VOD_CORE.VOD_BLOCK_DURATION,this.pauseDuration),this.stat.setCore(L.a.VOD_CORE.VOD_BAD_REASON,this.vodBadReason),this.stat.setCore(L.a.CORE.STREAM_BUFFERED,this.downTotalBufTs),this.stat.setComDim(L.a.VOD_DIM_COM.BACKUP_FIELD1,y.a.now()-this.videoFrameRenderTs);const e=this.pauseCurrentTime.join(",")+"|"+this.pauseBuffer.join(",")+"|"+this.pauseDownBuffer.join(",")+"|"+this._seekCnt;this.stat.setComDim(L.a.VOD_DIM_COM.BACKUP_FIELD2,e),this.stat.setComDim(L.a.VOD_DIM_COM.BACKUP_FIELD3,y.a.now()-this.videoTimerRenderTs),this.stat.setComDim(L.a.VOD_DIM_COM.BACKUP_FIELD4,this.videoChecker.isSupportRVCB?1:2),this.stat.setComDim(L.a.VOD_DIM_COM.BACKUP_FIELD6,this.getBufferLen());let i=[];this.stat.fill(i,t),this.tsdb.sendMetrics(i),this.videoIsBadQuality=!1,this.pauseTimes=0,this.pauseDuration=0,this.pauseDurationNow=0,this.pauseDurationReal=0,this.lastCheckPlayTs=0,this.lastPauseTs=0,this.pauseBuffer.length=0,this.pauseDownBuffer.length=0,this.pauseCurrentTime.length=0,this.vodBadReason=0}_sendVideoLoadTime(t,e){this.stat.setActDim(L.a.VOD_DIM_COM.CREATE_TIME,y.a.now()-this.stat.create_time),this.tsdb.sendVodMP4Time({loadTime:t})}sendNoPicture(){this.hasPicture||(this.stat.setActDim(L.a.VOD_DIM_COM.CREATE_TIME,y.a.now()-this.stat.create_time),this.tsdb.sendVodMP4Time({loadTime:99999,errorMessage:So.getErrorMessage(this.videoElement)}))}_onVodError(){this.info.type===rd.MP4&&wt.setMP4Status(Ot),this.sendNoPicture()}addNoPictureReason(){if(this.info.type===rd.MP4){const t=wt.getMP4NoPictureReason();this.stat.setActDim(L.a.VOD_DIM_COM.VOD_NO_PICTURE_REASON,t)}}onplaying(t){this.lastPauseTs=0,super.onplaying(t)}onended(t){this._end("onended")}_checkEnded(t){this.videoElement.duration>0&&this.videoElement.currentTime>=this.videoElement.duration&&this._end("checkEnded")}onseeked(t){this.info.type===rd.MP4&&this.eventEmitter.trigger(m.VIDEO_TAG_SEEKED,t)}},Nh={FLV:1,HLS:3,VR:7,MP4:11};class Fh extends qt{constructor(t,e){super(),this.type=t,this.config=e,this.link=null,this._onOpenBind=this._onOpen.bind(this),this._onDataBind=this._onData.bind(this),this._onSucBind=this._onSuc.bind(this),this._onErrorBind=this._onError.bind(this),this._onTimeoutBind=this._onTimeout.bind(this),this.openTs=0,this.completeTs=0,this.byteSize=0}_createLoader(t,e){let i=null;return i=rr.isSupported()&&this.type===Fh.Types.FETCH?new rr({}):new T({}),i.fromByte=t,i.toByte=e,i}load(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.stop(),this.link=this._createLoader(e,i),this.link.loadBuffer(t,this._onOpenBind,this._onDataBind,this._onSucBind,this._onErrorBind,this._onTimeoutBind,this.config.timeout||3e3,this.config.retry||3,this.config.retryDelay||1e3)}stop(){this.link&&(this.link.destroy(),this.link=null),this.openTs=0,this.completeTs=0,this.byteSize=0}_onOpen(){this.openTs=y.a.now()}_onData(t){this.byteSize+=t.byteLength,this.trigger(Fh.Events.DATA,t)}_onSuc(){this.completeTs=y.a.now(),this.trigger(Fh.Events.COMPLETE)}_onError(){this.trigger(Fh.Events.ERROR)}_onTimeout(){this.trigger(Fh.Events.TIMEOUT)}}Fh.Events={DATA:"data",COMPLETE:"complete",ERROR:"error",TIMEOUT:"timeout"},Fh.Types={FETCH:"fetch",XHR:"xhr"};var Bh=Fh,Uh=12,kh=13,xh="Hvcc",Hh="AnnexB",Gh="Avcc",Wh=32,$h=33,Yh=34;var Kh=class{constructor(t,e){this.isReady=!1,this.isHevc=!1,this.isAV01=!1,this.VPS=[],this.SPS=[],this.PPS=[],this.sps=null,this.pps=null,this.vps=null,this.codec="",this.width=t,this.height=e,this.codecID=0,this.streamFormat="",this.lengthSizeMinusOne=0,this.spsUnit=null,this.ppsUnit=null,this.vpsUnit=null,this.hevcSpsParser=new re}parse(t,e,i){if(i<5)return void f.a.warn("FlvParser.parseVideo avc videotag not enough dataLen="+i);let s=t[e]>>4;this.codecID=15&t[e++];let r=t[e++];5!==i?0===r&&(e+=3,this.codecID===Uh?this.parseVideoConfigH265(t,e,i):this.codecID===kh?this.parseVideoConfigAV1(t,e):(this.streamFormat=Gh,this.parseVideoConfigH264(t,e)),this.isReady=!0):f.a.log("FlvParser.parseVideo avc_empty frameType="+s+" avcPacketType="+r)}parseVideoConfigH265(t,e,i){let s=this.hevcFindNextStartCode(t,e);s.found?(this.streamFormat=Hh,this.parseVideoConfigH265AnnexB(t,e+s.startCodeSize,i)):(this.streamFormat=xh,this.parseVideoConfigH265Hvcc(t,e,i))}parseVideoConfigH265AnnexB(t,e,i){let s=e+i-5,r=(126&t[e])>>1,a=e,o=[],n=[],h=[],d=[],l=[],u=[];for(;e<s;){let i=this.hevcFindNextStartCode(t,e);if(i.found||e+1===s){switch(r){case Wh:let i=null;i=e+1===s?{data:t.subarray(a,e+1),type:r}:{data:t.subarray(a,e),type:r},this.vpsUnit=i,o.push(i.data),d.push({length:i.data.length,nalu:i.data});break;case $h:let c=null;c=e+1===s?{data:t.subarray(a,e+1),type:r}:{data:t.subarray(a,e),type:r},this.spsUnit=c,n.push(c.data),l.push({length:c.data.length,nalu:c.data});break;case Yh:let p=null;p=e+1===s?{data:t.subarray(a,e+1),type:r}:{data:t.subarray(a,e),type:r},this.ppsUnit=p,h.push(p.data),u.push({length:p.data.length,nalu:p.data})}if(e+i.startCodeSize<s){r=(126&t[e+=i.startCodeSize])>>1,a=e;continue}}e++}this.VPS=d,this.SPS=l,this.PPS=u,this.vps=o,this.sps=n,this.pps=h}parseVideoConfigH265Hvcc(t,e,i){e+=21;let s=[],r=[],a=[],o=[],n=[],h=[];this.lengthSizeMinusOne=3&t[e++];const d=t[e++];f.a.log("FlvParser.parseVideoConfig Hvcc nNaluArrayCount="+d);for(let i=0;i<d;i++){let i=99&t[e++];if(i===Wh){let i=(t[e++]<<8)+t[e++],r=0;for(let a=0;a<i;++a){r=(t[e++]<<8)+t[e++];let i={data:t.subarray(e,e+r),type:Wh};this.vpsUnit=i,e+=r,s.push(i.data),o.push({length:i.data.length,nalu:i.data})}}else if(i===$h){let i=(t[e++]<<8)+t[e++],s=0;for(let a=0;a<i;++a){s=(t[e++]<<8)+t[e++];let i={data:t.subarray(e,e+s),type:$h};this.spsUnit=i,e+=s,r.push(i.data),n.push({length:i.data.length,nalu:i.data})}}else if(i===Yh){let i=0,s=(t[e++]<<8)+t[e++];for(let r=0;r<s;++r){i=(t[e++]<<8)+t[e++];let s={data:t.subarray(e,e+i),type:Yh};this.ppsUnit=s,e+=i,a.push(s.data),h.push({length:s.data.length,nalu:s.data})}}}this.VPS=o,this.SPS=n,this.PPS=h,this.vps=s,this.sps=r,this.pps=a}parseVideoConfigAV1(t,e){}parseVideoConfigH264(t,e){e+=4,this.lengthSizeMinusOne=3&t[e++],this.streamFormat=Gh;let i=[],s=[],r=0,a=31&t[e++];for(let o=0;o<a;++o){r=(t[e++]<<8)+t[e++];let a={data:t.subarray(e,e+r),type:7};this.spsUnit=a,e+=r,i.push(a.data),s.push({length:r,nalu:a.data})}let o=[],n=[],h=0,d=t[e++];for(let i=0;i<d;++i){h=(t[e++]<<8)+t[e++];let i={data:t.subarray(e,e+h),type:8};this.ppsUnit=i,e+=h,o.push(i.data),n.push({length:h,nalu:i.data})}this.SPS=s,this.PPS=n,this.sps=i,this.pps=o,this.parseSPS(this.spsUnit)}parseSPS(t){if(this.codecID===Uh){this.isHevc=!0;let e={};this.hevcSpsParser.parseSequenceParameterSet(t.data,t.data.length,e);let i=e.profile_space,s=e.profile_idc,r=e.profile_compatibility_flags;r=r>>1&1431655765|(1431655765&r)<<1,r=r>>2&858993459|(858993459&r)<<2,r=r>>4&252645135|(252645135&r)<<4,r=r>>8&16711935|(16711935&r)<<8,r=r>>16|r<<16;let a=e.tier_flag,o=e.level_idc;this.codec="hvc1."+["","A","B","C"][i%4]+s.toString()+"."+r.toString(16).toLowerCase()+"."+["L","H"][a%2]+o.toString(),this.width=e.width||this.width,this.height=e.height||this.height}else{try{let e=new Nt(t.data);config=e.readSPS(),this.width=config.width,this.height=config.height}catch(t){f.a.log("FlvParser.parseSPS error, msg="+t.message)}let e=t.data.subarray(1,4),i="avc1.";for(let t=0;t<3;t++){let s=e[t].toString(16);s.length<2&&(s="0"+s),i+=s}this.codec=i}}hevcFindNextStartCode(t,e){return 0===t[e]&&0===t[e+1]?1===t[e+2]?{found:!0,startCodeSize:3}:0===t[e+2]&&1===t[e+3]?{found:!0,startCodeSize:4}:{found:!1}:{found:!1}}};var jh=class{constructor(){this.isReady=!1,this.audioConfig=null,this.audioObjectType=0,this.audioChannelCount=0,this.audioSampleRate=0,this.aacTimeLen=0}parse(t,e,i){let s=t[e++]>>>4;if(10!=s&&f.a.warn("FlvParser.parseAudio Unsupported audio codec, soundFormat="+s),0===t[e++])if(i>=4){this.audioObjectType=t[e]>>3;let i=((7&t[e])<<1)+((128&t[e+1])>>7);if(i>=We.AdtsSampleingRates.length)return void f.a.warn("FlvParser.parseAudio SampleingRate out of bounds. samplingIndex="+i);this.audioChannelCount=(120&t[e+1])>>3,this.audioConfig=this.getAdtsConfig(this.audioObjectType,i,this.audioChannelCount),this.isReady=!0}else f.a.warn("FlvParser.parseAudio adts error dataLen="+i+" ts="+timeStamp)}getAdtsConfig(t,e,i){let s=0,r=null,a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("firefox")?e>=6?(t=5,r=new Array(4),s=e-3):(t=2,r=new Array(2),s=e):-1!==a.indexOf("android")?-1!==a.indexOf("mqqbrowser")?(t=2,r=new Array(2),s=e):(t=5,r=new Array(4),s=e):(t=5,r=new Array(4),s=e,e>=6?s=e-3:1===i&&(t=2,r=new Array(2),s=e)),this.audioSampleRate=We.AdtsSampleingRates[e],this.aacTimeLen=1024e3/this.audioSampleRate,f.a.log("FlvParser.getAdtsConfig audioSampleRate="+this.audioSampleRate+" aacTimeLen="+this.aacTimeLen),r[0]=t<<3,r[0]|=(14&e)>>1,r[1]=(1&e)<<7,r[1]|=i<<3,5===t&&(r[1]|=(14&s)>>1,r[2]=(1&s)<<7,r[2]|=8,r[3]=0),f.a.log("FlvParser.getAdtsConfig type="+t+" index="+e+" channel="+i+" exIndex="+s+" config="+r),r}};var qh=class{constructor(t){this.index=t,this.fromByte=0,this.endByte=0,this.duration=0,this.start=0,this.prevFrag=null,this.nextFrag=null}isInRange(t){return t>=this.start&&t<this.start+this.duration}};var zh=class{constructor(){this.isReady=!1,this.fragList=[],this.totalDuration=0}parse(t){this.totalDuration=t.duration;let e=t.filepositions,i=t.times;if(e&&i){let s=e.length,r=null;for(let a=0;a<s;a++){let o=new qh(a);o.fromByte=e[a],o.start=i[a],a+1<s?(o.endByte=e[a+1]-1,o.duration=i[a+1]-i[a]):t.duration&&(o.duration=t.duration-i[a]),r&&(r.nextFrag=o,o.prevFrag=r),this.fragList.push(o),r=o}this.isReady=!0}}seek(t){let e=this.fragList[0];for(;e;){if(e.isInRange(t))return e;e=e.nextFrag}return null}};var Jh=class{constructor(){this.isReady=!1,this.metadata={}}parse(t,e,i){if(e+We.SCRIPT_AMF1_HEAD_LEN>i)return void f.a.log("script too small");t[e++];let s=(t[e++]<<8)+t[e++],r=kt.getStr(t,e,s);e+=s,"onMetaData"===r&&(this.metadata=kt.parseScript(t,e,t.length).data,this.isReady=!0)}};class Qh extends qt{constructor(){super(),this.loader=new Bh(Bh.Types.FETCH,{}),this.loader.on(Bh.Events.DATA,this._onData,this),this.loader.on(Bh.Events.ERROR,this._onError,this),this.loader.on(Bh.Events.TIMEOUT,this._onTimeout,this),this.headerBuffer=null,this.parseHeader=!1,this.buffer=new Ft,this.metadata=new Jh,this.videoConfig=new Kh(this.metadata.metadata.width||1280,this.metadata.metadata.height||720),this.audioConfig=new jh,this.fileList=new zh,this.isReady=!1}stop(){this.loader.stop()}load(t){this.loader.load(t)}_onData(t){if(t instanceof Uint8Array||(t=new Uint8Array(t)),this.headerBuffer){let e=new Uint8Array(this.headerBuffer.length+t.length);e.set(this.headerBuffer,0),e.set(t,this.headerBuffer.length),t=e}let e,i=t.length,s=0;if(!this.parseHeader){let e=We.FLV_HEADER_LEN+We.PREV_TAG_SIZE_LEN;if(i<e)return void(this.headerBuffer=t.slice());if(this.headerBuffer=null,s+=e,!We.probe(t))return;this.parseHeader=!0}for(this.buffer.append(0===s?t:t.slice(s));null!==(e=this.buffer.popFrame());)if(this.parseTag(e),this.videoConfig.isReady&&this.audioConfig.isReady&&this.metadata.isReady){this.isReady=!0;break}this.isReady&&(this.loader.stop(),this.trigger(Qh.Events.READY))}parseTag(t){let e=t.length;if(e<We.TAG_HEADER_LEN+We.PREV_TAG_SIZE_LEN)return void f.a.warn("FlvParser.parseTag flv has no whole tag len="+e+" data="+t);let i=0,s=t[i++],r=(t[i++]<<16)+(t[i++]<<8)+t[i++];e-(We.TAG_HEADER_LEN+We.PREV_TAG_SIZE_LEN)<r?f.a.warn("FlvParser.parseTag flv has no enough data dataLen="+r+" len="+e):0!==r?(i+=4,i+=3,s===We.VIDEO_TYPE?this.videoConfig.parse(t,11,r):s===We.AUDIO_TYPE?this.audioConfig.parse(t,11,r):s===We.SCRIPT_TYPE&&(this.metadata.parse(t,11,r),this.fileList.parse(this.metadata.metadata))):f.a.warn("FlvParser.parseTag flvtag empty type="+s)}_onError(){this.trigger(Qh.Events.ERROR)}_onTimeout(){this.trigger(Qh.Events.TIMEOUT)}}Qh.Events={READY:"READY",ERROR:"ERROR",TIMEOUT:"TIMEOUT"};var Xh=Qh;class Zh extends qt{constructor(){super(),this.type=Bh.Types.XHR,this.seeking=!1,this.frag=null,this.loading=!1,this.url="",this.loader=new Bh(this.type,{}),this.loader.on(Bh.Events.DATA,this._onData,this),this.loader.on(Bh.Events.ERROR,this._onError,this),this.loader.on(Bh.Events.TIMEOUT,this._onTimeout,this),this.loader.on(Bh.Events.COMPLETE,this._onComplete,this)}_onData(t){this.trigger(Zh.Events.DATA,t)}_onError(){}_onTimeout(){}_onComplete(){this.loading=!1,this.seeking&&(this.seeking=!1,this.trigger(Zh.Events.SEEKED)),this.trigger(Zh.Events.COMPLETE)}hasNext(){return this.frag&&this.frag.nextFrag}load(t){this.loading=!0,this.frag=t,this.loader.load(this.url,t.fromByte,t.endByte)}loadNext(){this.loading||(this.frag&&this.frag.nextFrag?this.load(this.frag.nextFrag):this.frag=null)}seek(t){f.a.log(`VodFlvFragLoader.seek idx=${t.index} start=${t.start} dur=${t.duration}`),this.loader.stop(),this.load(t),this.seeking=!0,this.trigger(Zh.Events.SEEKING)}}Zh.Events={DATA:"data",SEEKING:"seeking",SEEKED:"seeked",COMPLETE:"complete"};var td=Zh;var ed=class{constructor(t,e){this.eventEmitter=t,this.stat=e.statVod,this.tsdb=e.tsdb,this.videoElement=e.videoElement,this.h265Proxy=e.h265Proxy,this.isPureAudio=!!e.isPureAudio,this.isPureVideo=!!e.isPureVideo,this.videoStatus=o,this.info=null,this.url="",this.seekTime=0,this.lastPlayTime=0,this.lastTimerTs=0,this.isMuted=!1,this.volume=1,this.playBackRate=1,this.nowEndTs=0,this.userPaused=!1,this.mse=this._createMse(),this.playList=new Xh,this.playList.on(Xh.Events.READY,this.onPlayListReady,this),this.playList.on(Xh.Events.ERROR,this.onPlayListError,this),this.playList.on(Xh.Events.TIMEOUT,this.onPlayListTimeout,this),this.fragLoader=new td,this.fragLoader.on(td.Events.DATA,this._onData,this),this.fragLoader.on(td.Events.COMPLETE,this._onFragComplete,this),this.fragLoader.on(td.Events.SEEKING,this._onFragSeeking,this),this.fragLoader.on(td.Events.SEEKED,this._onFragSeeked,this)}get started(){return this.videoStatus!==o&&this.videoStatus!==d}updateStatus(t){this.videoStatus!==t&&(this.videoStatus=t,this.eventEmitter.trigger(a.PLAY_STATUS,{status:t}))}_createMse(){let t=new sr(this,{videoType:"flv",isPureAudio:this.isPureAudio,isPureVideo:this.isPureVideo,h265Proxy:this.h265Proxy,isLive:!1,videoElement:this.videoElement});return t.setPushGop(P.a.pushGop),t.setMuted(this.isMuted),t.setPlaybackRate(this.playBackRate),t.setVolume(this.volume),t}start(t){if(this.stop(),this.info=t,this.initInfo(t),!this.url)return void f.a.warn("VodFlvPlayer.start invalid argument, pls check the url.");this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec;this.h265Proxy.isLive=!1,this.h265Proxy.isH265Stream=!1,this.stat.setComDim(L.a.VOD_DIM_COM.MSE_PLAYER,1),this.seekTime=t.seekTime||0,this.playList.load(this.url),this.updateStatus(n)}initInfo(t){let e=t.url,i=[];t.iBitRate>0&&i.push("ratio="+t.iBitRate),i.length>0&&(e+=(-1!==e.indexOf("?")?"&":"?")+i.join("&")),this.url=e,this.fragLoader.url=e}onPlayListReady(){this.eventEmitter.trigger(a.PLAYBACK_M3U8_UPDATED,{totalDuration:this.playList.fileList.totalDuration}),this.updateMseInfo(),this.fragLoader.load(this.playList.fileList.seek(this.seekTime)),q.add(this._onTimer,this,100)}updateMseInfo(){let t=this.mse.parser;t.parseFlvHead=!0,Object.assign(t.metadata,this.playList.metadata.metadata);let e=this.playList.videoConfig;t.streamFormat=e.streamFormat,t.lengthSizeMinusOne=e.lengthSizeMinusOne,t.codec=e.codecID,t.videoCodec=e.codec,t.VPS=e.VPS,t.SPS=e.SPS,t.PPS=e.PPS,t.videoWidth=e.width,t.videoHeight=e.height,this.mse.setAvcCfg(e.width,e.height),this.mse.updateVideoConfig({isHevc:e.isHevc,isAV01:e.isAV01,vps:e.vps,sps:e.sps,pps:e.pps,codec:e.codec,width:e.width,height:e.height},!0),t.remuxer.switchLevel(!1,!1);let i=this.playList.audioConfig;t.recvAudioConfig=!0,t.audioConfig=i.audioConfig.slice(),t.audioSampleRate=i.audioSampleRate,t.aacTimeLen=i.aacTimeLen,t.audioObjectType=i.audioObjectType,t.audioChannelCount=i.audioChannelCount,this.mse.updateAudioConfig({audioConfig:t.audioConfig,codec:"mp4a.40.5",audioSampleRate:t.audioSampleRate,aacTimeLen:t.aacTimeLen,audioObjectType:t.audioObjectType,audioChannelCount:t.audioChannelCount},!1,ae)}_onTimer(t){if(this._loadNextFrag(),0===this.lastTimerTs?this.lastTimerTs=t:t-this.lastTimerTs>1e3&&(this._playTimeUpdate(),this.lastTimerTs=t),this._isEnded()){if(f.a.log(`VodFlvPlayer.check onEnded, curTime=${this.getCurrentTime()}, duration=${this.getDurationTime()}`),this.mse){let t=this.mse.getPlayVideo();t&&(t.currentTime=this.playList.fileList.totalDuration)}this.onEnded()}}onEnded(){this.updateStatus(d),this.eventEmitter.trigger(a.M3U8_PLAY_ENDED),this.h265Proxy&&this.h265Proxy.onEnded&&this.h265Proxy.onEnded(),this.mse&&this.mse.onEnded&&this.mse.onEnded()}_isEnded(){if(this.videoStatus===d)return!1;const t=this.playList.fileList.totalDuration,e=this.getCurrentTime(),i=t-e,s=y.a.now();if(i<3){if(0===this.nowEndTs)this.nowEndTs=s+1e3*(t-e)+300;else if(s>=this.nowEndTs)return f.a.log(`HlsPlayer._isEnded,duration=${t},currentTime=${e},delta=${i}`),this.nowEndTs=0,!0}else this.nowEndTs=0;return!1}_playTimeUpdate(){this.eventEmitter.trigger(a.PLAY_TIME_STATUS,{current:this.getCurrentTime(),total:this.getDurationTime()})}_loadNextFrag(){this.getBufferLen()<2e4&&!this.userPaused&&this.fragLoader.loadNext()}seek(t){f.a.log("VodFlvPlayer.seek time="+t),this.seekTime=t,this.fragLoader.seek(this.playList.fileList.seek(t))}setMuted(t){this.isMuted=t,this.mse&&this.mse.setMuted(t)}getMuted(){return this.isMuted}setVolume(t){this.volume=t,this.mse&&this.mse.setVolume(t)}getVolume(){return this.volume}setPlaybackRate(t){if(this.playBackRate=t,this.mse&&this.mse.getPlayVideo){this.mse.getPlayVideo().playbackRate=Number(t)}}onPlayPause(t,e,i){e&&(this.pauseTs=t,this.updateStatus(l),this.startSendPauseTimer())}onPlayResume(t,e){if(this.pauseTs>0){let e=t-this.pauseTs,i=200;this.playBackRate<1&&this.playBackRate>0&&(i=Math.min(400,200*~~(1/this.playBackRate))),e>i&&(f.a.warn(`HlsPlayer.onPlayResume pauseTime=${e}, pauseDelta=${i}`),this.stat.addCore(L.a.CORE.VIDEO_BLOCK_COUNT,1),this.stat.addCore(L.a.CORE.VIDEO_BLOCK_DURATION,e),this.eventEmitter.trigger(a.VIDEO_BAD_QUALITY)),this.pauseTs=0}e&&(this.updateStatus(h),this.eventEmitter.trigger(a.VIDEO_PLAYING,{video:this.videoElement,event:event}))}startSendPauseTimer(){this.stopSendPauseTimer(),q.add(this.sendPauseEvent,this,200)}stopSendPauseTimer(){q.remove(this.sendPauseEvent,this)}sendPauseEvent(){this.videoStatus!==h&&this.eventEmitter.trigger(a.PLAY_CARTON)}onPlayVideo(t,e,i,s,r,o,n){let d={video:t,width:e,height:i,canvas:r,codec:n};this.updateStatus(h),this.eventEmitter.trigger(a.VIDEO_PLAY,d)}onVideoStop(t,e){e&&(this.updateStatus(d),this.eventEmitter.trigger(a.VIDEO_STOP,{video:t}))}onPlayListError(){this.eventEmitter.trigger(a.HLS_URL_UNAVAILABLE)}onPlayListTimeout(){this.eventEmitter.trigger(a.HLS_MAINFEST_LOAD_TIMEOUT)}onErrorEvent(t){let e=this.mse?this.mse.getPlayVideo():null;this.eventEmitter.trigger(a.H5_PLAYER_ERROR,{video:e,code:t.type,msg:"播放错误"})}_onData(t){t instanceof Uint8Array||(t=new Uint8Array(t)),this.mse&&this.mse.appendFlv(t)}_onFragComplete(){!this.fragLoader.hasNext()&&this.mse&&this.mse.ctrlBuffer&&this.mse.ctrlBuffer._popAllBuffer()}_onFragSeeking(){let t=this.mse.remuxer,e=t._initDTS,i=t._initPTS;this.mse.destroy(),this.mse=this._createMse(),this.mse.remuxer._initDTS=e,this.mse.remuxer._initPTS=i,this.updateMseInfo()}_onFragSeeked(){f.a.log("VodFlvPlayer._onFragSeeked"),this.seekTime>0&&(this.mse.seek(this.seekTime),this.seekTime=0)}stop(){this.videoStatus=d,q.remove(this._onTimer,this),this.playList.stop(),this.destroyMse()}destroyMse(){this.mse&&(this.mse.destroy(),this.mse=null),this.mse=this._createMse()}getBufferLen(){return this.mse?this.mse.getBufferLen():0}getCurrentTime(){return this.seekTime>0?this.seekTime:(this.mse&&(this.lastPlayTime=this.mse.getCurrentTime()/1e3),this.lastPlayTime>this.getDurationTime()?this.getDurationTime():this.lastPlayTime)}getCurrentRealTime(){return this.mse&&this.mse.video&&this.mse.video.getCurrentTime()||0}getCurrentDts(){return this.mse?this.mse.getCurrentDts():0}getDurationTime(){return this.playList.fileList.totalDuration}pause(){this.started&&(f.a.info("VodFlvPlayer.pause"),this.userPaused=!0,this.mse&&this.mse.pause())}play(){this.started&&(f.a.info("VodFlvPlayer.play"),this.userPaused=!1,this.mse&&this.mse.play())}};let id=1;class sd{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._id=id++,this.player=null,this.playInfo=null,this.started=!1,this.ended=!1,this.playerType="",this._loop=!1,this._volume=0,this._muteVal=!1,this._paused=!1,this._playbackRate=1,this._duration=0,this._coderate="1000",this.videoElement=e.videoElement,this.eventEmitter=t,this.createVideoElmInner=!1,this.busiSource=e.source,this.busiPlace=e.place,this.vrElement=null,this.streamType="",this.isRetrying=!1,this.hadPlayVideo=!1,this._type=0,this.h264StreamBitrate=0,this.h265StreamBitrate=0,this.av1StreamBitrate=0,this.av1State=0,this.anchorUid=e.anchorUid,this.sdkInRoomTs=Date.now(),this.hlsNoPictureStartTs=0,this.isSendNoPicture=!1,this.visibility=new Un(this.eventEmitter),this.stat=new Ao,this.statVod=new Bn,this.metrics=new Ro,this.tsdbUtil=new hr({stat:this.stat,statVod:this.statVod,eventEmiter:this.eventEmitter}),this.videoEnhance=new Ih(this,this.stat,this.statVod),this.h265WasmProxy=new bn(this.stat,this.tsdbUtil,this.statVod),this.h265MseProxy=new Nn(this.stat,this.tsdbUtil,this.statVod),this.statVod.setComDim(L.a.DIM_COM.SESSION_ID,this.sdkInRoomTs),this.statVod.setComDim(L.a.VOD_DIM_COM.VOD_PLACE,this.busiSource||"other"),this.statVod.setComDim(L.a.DIM_COM.PLACE,this.busiPlace||Ah.getPlace(this.busiSource)),this.tsdbUtil.setBusiSource(e.source),this._onStartPlayBind=this._onStartPlay.bind(this),this._onWorkerTimeoutBind=this._onWorkerTimeout.bind(this),this.eventsMap=new Map,this.eventsMap.set(m.TURN_TO_H264,this.onTurntoH264.bind(this)),this.eventsMap.set(m.H265_VIDEO_RETRY,this.onH265Retry.bind(this)),this.eventsMap.set(m.TURN_TO_MSE,this.onTurnToMse.bind(this)),this.eventsMap.set(m.TURN_TO_WEBCODECS_SOFT,this.onTurnToWebcodecsSoft.bind(this)),this.eventsMap.set(m.WEBCODECS_RETRY,this.onWebcodecsRetry.bind(this)),this.eventsMap.set(m.ON_VIDEO_ENHANCE_ERROR,this.onVideoEhanceError.bind(this)),this.eventsMap.set(m.ON_VIDEO_ENHANCE_SUCCESS,this.onVideoEhanceSuccess.bind(this)),this.eventsMap.set(m.VIDEO_PLAY,this.onPlayVideo.bind(this)),this.eventsMap.set(m.PLAY_TIME_STATUS,this._onVideoTimeupdate.bind(this)),this.eventsMap.set(m.VIDEO_SEEK,this._onVideoHlsSeek.bind(this)),this.eventsMap.set(m.H5_PLAYER_ERROR,this._onH5PlayerError.bind(this)),this.eventsMap.set(m.PAUSE_5S_RETRY,this._onVideoPause5sRetry.bind(this)),this.eventsMap.set(m.M3U8_PLAY_ENDED,this._onM3u8PlayEnded.bind(this)),this.eventsMap.set(m.TRY_TO_AV1,this._onBackToAV1.bind(this)),this.eventsMap.set(m.TURN_TO_H265_WASM,this.onTurntoH265Wasm.bind(this)),this.eventsMap.set(m.VIDEO_TAG_ENDED,this._onVideoEnded.bind(this)),this.eventsMap.set(m.VIDEO_TAG_SEEKED,this._onVideoSeek.bind(this)),this.eventsMap.set(m.VIDEO_TAG_LOADSTART,this._onVideoLoadStart.bind(this)),this._backToAv1=new Gn,this.isTurnToMse=!1,this.isTurnToWebcodecsSoft=!1,this.isUseEnhance=!1,this.h264StreamInfo=null,this.h265StreamInfo=null,this.av1StreamInfo=null,this.hasPlayed=!1,this.isUseHlsTag=!1,this.errorReplayCnt=0}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Lt.bindEvent(this.tsdbUtil,t._sessionId,t.lineType||0,"",t.bitrate||"1000"),this.errorReplayCnt=0,t._started_||(t._started_=!0,this.isSendNoPicture=!1),this._start(t)}_start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.started&&this.stop(sd.StopType.INNER),t=Object.assign({isLive:!1},t),f.a.log(`VodMgr(${this._id}).palyer info: `,t),this._addVideoListeners(),Ca.recordComDim(this.stat,t),Ca.recordComDim(this.statVod,t),t.isCloseVodPcdn&&(P.a.isCloseVodPcdn=1),t.hasOwnProperty("isVodTurnTo264")&&(P.a.isVodTurnTo264=t.isVodTurnTo264),t.hasOwnProperty("isVodSupportH265")&&(P.a.isVodSupportH265=t.isVodSupportH265),t.uid&&(M.a.uid=t.uid),t.presenterUid||(t.presenterUid=this.anchorUid),0===M.a.convertUid&&M.a.uid>0&&(M.a.convertUid=R.b.rotUid(M.a.uid,t.presenterUid)),this.visibility.setStat(this.stat,this.statVod),this.started=!0,this._coderate=t.coderate||"1000",t.coderate=this._coderate,this.stat.setComDim(L.a.DIM_COM.PLAYER_TYPE,t.type),this.stat.setComDim(L.a.DIM_COM.LIVE_TYPE,t.liveType||Oo.a.VOD),this.stat.setComDim(L.a.DIM_COM.PLAYBACK_RATE,this._playbackRate),this.stat.setComDim(L.a.VOD_DIM_COM.LINE,t.lineType||0),this.stat.setComDim(L.a.VOD_DIM_COM.PULLSTREAM_REASOM,t.pullStreamFrom||0),this.stat.setComDim(L.a.VOD_DIM_COM.IS_MEMORY_GEAR,t.isMemoryGear?1:0),this.statVod.setComDim(L.a.DIM_COM.PLAYER_TYPE,t.type),this.statVod.setComDim(L.a.DIM_COM.LIVE_TYPE,t.liveType||Oo.a.VOD),this.statVod.setComDim(L.a.DIM_COM.PLAYBACK_RATE,this._playbackRate),this.statVod.setComDim(L.a.VOD_DIM_COM.LINE,t.lineType||0),this.statVod.setComDim(L.a.VOD_DIM_COM.PULLSTREAM_REASOM,t.pullStreamFrom||0),this.statVod.setComDim(L.a.VOD_DIM_COM.IS_MEMORY_GEAR,t.isMemoryGear?1:0),this.stat.setComDim(L.a.DIM_COM.GAMEID,t.gameId),this.statVod.setComDim(L.a.VOD_DIM_COM.GAMEID,t.gameId),this.playerType=t.type,this.streamType=t.streamType||this.playerType,!this.videoElement&&this._createVideoElm(),this.videoElement.setAttribute("crossOrigin","anonymous"),this.videoElement&&(this.videoElement.volume=this._volume),this.h265Info=t,this.playInfo=t,this._type=t.type,this.startByCodec(t)}startByCodec(t){this._hasHttpPrefix(t.url)||(t.url="https:"+t.url),t.tsInfo&&!this._hasHttpPrefix(t.tsInfo.tsUrl)&&(t.tsInfo.tsUrl="https:"+t.tsInfo.tsUrl),this.startTs=y.a.now(),f.a.log(`VodMgr(${this._id}).startNow`,this.startTs),this.h265Info=t,this.getVStreamInfo(t),this.h265WasmProxy.initSupport(t);let e=this.getMseHevcSupport(t);if(q.add(this.onCheckTimer,this,1e3),e&&P.a.useNextWcsTime&&localStorage.hasOwnProperty("nextWcsTime")){let i=Number(localStorage.nextWcsTime)||0,s=Date.now();-1===P.a.noNextWcsTimeUids.indexOf(Number(t.uid))&&i>s&&-1!==qe.a.name.indexOf("edg")&&(e=!1)}this.h265Proxy=e?this.h265MseProxy:this.h265WasmProxy,this.av1StreamInfo&&1==t._av1State?(t.iBitRate=this.av1StreamInfo.iBitRate,this.statVStreamExtInfo(this.av1StreamInfo,t)):this.h265StreamInfo&&(this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec)?(t.iBitRate=this.h265StreamInfo.iBitRate,this.statVStreamExtInfo(this.h265StreamInfo,t)):this.h264StreamInfo&&this.statVStreamExtInfo(this.h264StreamInfo,t),this.videoEnhance.setInfo(t),t._sMod=R.b.getSupportMod(this.h265WasmProxy.isSupported,this.h265Proxy.isServerSupported,!!t._vodStates&&t._vodStates.av1SvrOpen,!!t._vodStates&&t._vodStates.av1Support),e||1==t._av1State?(f.a.log(`VodMgr(${this._id}).startByCodec Play MSE H265`),this.stat.setComDim(L.a.DIM_COM.HARDDECODE,1),this.statVod.setComDim(L.a.VOD_DIM_COM.HARDDECODE,1),this.startPlayer(t)):this.h265Proxy.isSupported?(this.stat.setComDim(L.a.DIM_COM.HARDDECODE,2),this.statVod.setComDim(L.a.VOD_DIM_COM.HARDDECODE,2),this.h265Proxy.loadDecoder(t.h5Root,{ready:this._onStartPlayBind,error:this._onWorkerTimeoutBind,timeout:this._onWorkerTimeoutBind}),this.h265StreamBitrate&&(this.stat.setComDim(L.a.VOD_EXT_COM.BITRATE,this.h265StreamBitrate),this.statVod.setComDim(L.a.VOD_EXT_COM.BITRATE,this.h265StreamBitrate))):(this.h264StreamBitrate&&(this.stat.setComDim(L.a.VOD_EXT_COM.BITRATE,this.h264StreamBitrate),this.statVod.setComDim(L.a.VOD_EXT_COM.BITRATE,this.h264StreamBitrate)),this.startPlayer(t))}getMseHevcSupport(t){return this.h265MseProxy.initSupport(t),1==Number(localStorage._forceMseHevc)?(f.a.warn(`VodMgr(${this._id}).getMseHevcSupport force mse h265`),!0):!!this.h265MseProxy.isSupported}_onWorkerTimeout(){this.startPlayer(this.h265Info,!0)}startPlayer(t,e){let i=R.b.checkWebCodec(t,this.stat,this.h265Proxy.isSupported);this.checkWebCodecSoft(t),this.isTurnToMse?(i=!1,this.stat.setComDim(L.a.DIM_COM.WEBCODECS_BACK_REASON,this.eventEmitter.turnMseType),this.statVod.setComDim(L.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,this.eventEmitter.turnMseType)):t.isPureAudio?(i=!1,this.stat.setComDim(L.a.DIM_COM.WEBCODECS_BACK_REASON,Ws.a.IS_PUREAUDIO),this.statVod.setComDim(L.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,Ws.a.IS_PUREAUDIO)):1==localStorage.isAngelNull?(i=!1,this.stat.setComDim(L.a.DIM_COM.WEBCODECS_BACK_REASON,Ws.a.ANGLE_NULL),this.statVod.setComDim(L.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,Ws.a.ANGLE_NULL)):R.b.isWebcodecsBrowserSupported()?1==localStorage.isChromeH265RenderInfoEmpty?(i=!1,this.stat.setComDim(L.a.DIM_COM.WEBCODECS_BACK_REASON,Ws.a.CHROME_H265_RENDER_INFO_EMPTY),this.statVod.setComDim(L.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,Ws.a.CHROME_H265_RENDER_INFO_EMPTY)):this.h265Proxy.isSupported&&1==localStorage.isCloseWebcodecsH265||1==localStorage.isCloseWebcodecsH264||1==t._av1State&&1==localStorage.isCloseWebcodecsAv1?(i=!1,this.stat.setComDim(L.a.DIM_COM.WEBCODECS_BACK_REASON,Ws.a.IS_NOT_SUPPORT_CONFIGURE),this.statVod.setComDim(L.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,Ws.a.IS_NOT_SUPPORT_CONFIGURE)):-1!=pe.a.os.toLowerCase().indexOf("mac")?(i=!1,this.stat.setComDim(L.a.DIM_COM.WEBCODECS_BACK_REASON,Ws.a.IS_NOT_SUPPORT_OS),this.statVod.setComDim(L.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,Ws.a.IS_NOT_SUPPORT_OS)):1==t._av1State&&0==P.a.av1Webcodecs&&(i=!1,this.stat.setComDim(L.a.DIM_COM.WEBCODECS_BACK_REASON,Ws.a.VOD_AV1_CLOSE_CFg),this.statVod.setComDim(L.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,Ws.a.VOD_AV1_CLOSE_CFg)):(i=!1,this.stat.setComDim(L.a.DIM_COM.WEBCODECS_BACK_REASON,Ws.a.BROWSER_NOT_SUPPORTED),this.statVod.setComDim(L.a.VOD_DIM_COM.WEBCODECS_BACK_REASON,Ws.a.BROWSER_NOT_SUPPORTED)),this.h265Proxy&&this.h265Proxy.h265StatReport&&(this.isTurnTo264?this.h265Proxy.h265StatReport.addTurnTo264Support(this.turnTo264Reason,t):e&&this.h265Proxy.isSupported?this.h265Proxy.h265StatReport.addTurnTo264Support(nn,t):this.h265Proxy.h265StatReport.addH265SupportNew(t)),f.a.log(`VodMgr(${this._id}).useWebCodecs`,i);let s=i?D.a.PLAYER_CORE_TYPE.WEBCODECS:D.a.PLAYER_CORE_TYPE.MSE;this.playerCoreType=s,t._dMod=R.b.getDecodeMod(i,this.h265Proxy.isReady,!1),this.h265Proxy.isSupported&&(this.isTurnToWebcodecsSoft=!1);const r={options:t.options,stat:this.stat,statVod:this.statVod,tsdb:this.tsdbUtil,videoElement:this.videoElement,h265Proxy:this.h265Proxy,playerCoreType:s,isSoftSolution:this.isTurnToWebcodecsSoft,isPureAudio:!!t.isPureAudio,isPureVideo:!!t.isPureVideo};switch(this._type=t.type,t.type){case sd.MP4:this.player=new bh(this.eventEmitter,r);break;case sd.FLV:this.player=new ed(this.eventEmitter,r);break;case sd.HLS:let e=null;t.isForceHlsTagPlayer||!hd.isSupported()?(e=bh,this.isUseHlsTag=!0):e=no,this.player=new e(this.eventEmitter,r),2===this.av1State&&this._backToAv1.start(this.player);break;case sd.VR:this.player=new Co(this.eventEmitter,r)}q.has(this.onNoPicture,this)||(this.hlsNoPictureStartTs=y.a.now(),q.once(this.onNoPicture,this,1e4)),t.options&&t.options.hasOwnProperty("volume")?this.setVolume(t.options.volume):this.setVolume(this._volume),t.options&&t.options.hasOwnProperty("muted")?this.setMuted(t.options.muted):this.setMuted(this._muteVal),this.player.start(t)}getVStreamInfo(t){localStorage.hlsVStreamInfo&&(t.vStreamInfo=JSON.parse(localStorage.hlsVStreamInfo));let e=R.b.isOpen(P.a.vodAv1Cfg,this.anchorUid,t.lineType,!1);this.statVod.setComDim("experiment",e?1:2);let i=!1,s=ls.a.isMseSupportedAV01(),r=!1;s&&localStorage._renderInfo&&(r=Pa.isClose(t.curBitrate,localStorage._renderInfo));let a=2===this.av1State;2!==this.av1State&&(this.av1State=0);let o=null,n=null,h=null,d=!1;if(t.vStreamInfo&&t.vStreamInfo.length>0){if(t.sWidth=t.vStreamInfo[0].sWidth||0,t.sHeight=t.vStreamInfo[0].sHeight||0,t.vStreamInfo.map(t=>{"h265"==t.sCodec?(n=t,this.h265StreamInfo=t,d=!0):"av1"==t.sCodec?(o=t,this.av1StreamInfo=t,i=!0):"h264"==t.sCodec&&(this.h264StreamInfo=t,h=t)}),"av1"==localStorage._vDecodec?n=null:"h265"==localStorage._vDecodec?o=null:"h264"==localStorage._vDecodec&&(n=null,o=null),o&&(t.av1Url=o.sM3u8,this._hasHttpPrefix(t.av1Url)||(t.av1Url="https:"+t.av1Url),1==P.a.vodAv1UseFirst)){let e=this.changeOffset(o.sTs1Offset);o.sTs1Url&&(t.tsAv1Info={initUrl:o.sM3u8.replace(".m3u8","/init.mp4"),tsUrl:o.sTs1Url,byteRangeStartOffset:e.byteRangeStartOffset,byteRangeEndOffset:e.byteRangeEndOffset})}if(n){t.h265Url=n.sM3u8,this._hasHttpPrefix(t.h265Url)||(t.h265Url="https:"+t.h265Url);let e=this.changeOffset(n.sTs1Offset);n.sTs1Url&&t.duration&&(t.tsH265Info={tsUrl:n.sTs1Url,byteRangeStartOffset:e.byteRangeStartOffset,byteRangeEndOffset:e.byteRangeEndOffset,totalDuration:t.duration},t.tsH265Info&&!this._hasHttpPrefix(t.tsH265Info.tsUrl)&&(t.tsH265Info.tsUrl="https:"+t.tsH265Info.tsUrl))}o&&i&&!a&&e&&s&&!r&&(this.av1State=1),t._av1State=this.av1State}let l=R.b.getAv1Support(s,e,r,a);this.statVod.setComDim(L.a.VOD_CORE.AV1_SVR,i?o?1:2:3),this.statVod.setComDim(L.a.VOD_CORE.AV1_SPT,l),this.statVod.setComDim(L.a.VOD_CORE.AV1_USE,1===this.av1State?1:2),t._vodStates={av1SvrOpen:i,av1Support:l}}statVStreamExtInfo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;const i=t.extParam||t.mpExtraParam,s=t.sCodec,r=i.value;r&&(r.channel&&P.a.vodEnhanceChannelMap.map(t=>{t[r.channel]&&(e.gameId=t[r.channel],this.stat.setComDim(L.a.DIM_COM.GAMEID,e.gameId),this.statVod.setComDim(L.a.VOD_DIM_COM.GAMEID,e.gameId))}),r.vid&&(e.vid=r.vid),r.pid&&(e.presenterUid=r.pid),this.stat.setComDim(L.a.VOD_EXT_COM.VID,r.vid),this.stat.setComDim(L.a.VOD_EXT_COM.CLIENT,r.client),this.stat.setComDim(L.a.VOD_EXT_COM.PID,r.pid),this.stat.setComDim(L.a.VOD_EXT_COM.BITRATE,r.bitrate),this.stat.setComDim(L.a.VOD_EXT_COM.DEFINITION,r.definition),this.stat.setComDim(L.a.VOD_EXT_COM.SCENE,r.scene),this.statVod.setComDim(L.a.VOD_EXT_COM.VID,r.vid),this.statVod.setComDim(L.a.VOD_EXT_COM.CLIENT,r.client),this.statVod.setComDim(L.a.VOD_EXT_COM.PID,r.pid),this.statVod.setComDim(L.a.VOD_EXT_COM.BITRATE,r.bitrate),this.statVod.setComDim(L.a.VOD_EXT_COM.DEFINITION,r.definition),this.statVod.setComDim(L.a.VOD_EXT_COM.SCENE,r.scene),"h265"===s&&(this.h265StreamBitrate=r.bitrate),"h264"===s&&(this.h264StreamBitrate=r.bitrate),"av1"===s&&(this.av1StreamBitrate=r.bitrate))}changeOffset(t){var e=0,i=0,s=t.split("@");if(s.length>1){var r=parseInt(s[0],10),a=parseInt(s[1],10);e=a,i=a+r}return{byteRangeStartOffset:e,byteRangeEndOffset:i}}_onStartPlay(){this.startPlayer(this.h265Info)}stop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sd.StopType.OUTER;f.a.log(`VodMgr(${this._id}) stop! type=${t}`),q.remove(this.onCheckTimer,this),this.visibility.delVisibilitychange(),this.started&&this.destory(t),this.isUseEnhance=!1,this.isUseHlsTag=!1}reset(t){this.started=!1,this.ended=!1,this.playerType="",this._loop=!1,this._volume=1,this._paused=!1,this._playbackRate=1}destory(t){this.reset(),this._removeVideoListeners(),this.player&&(this.player.stop(),this.player=null),this.createVideoElmInner&&(this.videoElement=null,this.createVideoElmInner=!1),t===sd.StopType.OUTER&&q.remove(this.onNoPicture,this),this.stat.clearFill(),this.statVod.clearFill(),this._backToAv1.stop(),f.a.log(`VodMgr(${this._id}) destoryed`)}setTafHandler(t){f.a.log(`VodMgr(${this._id}).setTafHandler success`),Fn.default.setTafHandler(t)}getDurationTime(){let t=0;return this.player?(t=this.player.getDurationTime(),this._duration=t,t):t}getDurationRealTime(){let t=0;return this.player?(t=this.player.getFixedDurationTime?this.player.getFixedDurationTime():this.player.getDurationTime(),this._duration=t,t):t}getCurrentTime(){let t=0;return this.player?(t=this.player.getCurrentTime(),t):t}getCurrentRealTime(){let t=0;return this.player?(t=this.player.getCurrentRealTime?this.player.getCurrentRealTime()/1e3:this.player.getCurrentTime(),t):t}seekTime(t){if(f.a.log(`VodMgr(${this._id}) seekTime, time=${t}`),!this.player)return;t=Math.floor(t),this.streamType===sd.StreamType.HLS&&(this.playerType===sd.VR?this.player.updatePlayerStatus(!0):this.player.started=!0);const e=this.getDurationTime();t>e&&(t=e),this.ended=!1,this._backToAv1.isTimeToBack()?this._onBackToAV1("seek",t):this.player.seek(t)}play(){f.a.log(`VodMgr(${this._id}) play ended=${this.ended}`),this.videoElement&&(this.streamType===sd.StreamType.HLS&&this.ended&&(hd.isSupported()?this.restart():this.seekTime(0)),this.ended=!1,this._paused=!1,this.player&&this.player.play())}replay(){f.a.log(`VodMgr(${this._id}) replay`),this.videoElement&&(this.streamType===sd.StreamType.HLS&&this.ended&&hd.isSupported()&&(this.videoElement.currentTime=0),this.seekTime(0),clearTimeout(this.replayTimeout),this.replayTimeout=setTimeout(()=>{this.ended=!1,this._paused=!1,this.videoElement.play()},200))}get paused(){return this._paused}get readyState(){return this.videoElement&&this.videoElement.readyState}pause(){f.a.log(`VodMgr(${this._id}) pause`),this._paused||(this.player&&this.player.isWebCodec?this.player.pause():(this._paused=!0,this.streamType===sd.StreamType.HLS&&(this.playerType===sd.VR?this.player.updatePlayerStatus(!0):this.player.started=!0),this.player&&this.player.pause()))}setLoop(t){this._loop=t}getLoop(){return this._loop}setVolume(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;f.a.log(`VodMgr(${this._id}).setVolume val=${t} player=${!!this.player}`),this._volume=t,this.videoElement&&(this.videoElement.volume=t)}getVolume(){return this.videoElement?this.videoElement.volume:this._volume}setPlaybackRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;f.a.log(`VodMgr(${this._id}).setPlaybackRate`,t),this._playbackRate=Number(t),this.player&&this.player.setPlaybackRate&&this.player.setPlaybackRate(this._playbackRate),this.stat.setComDim(L.a.DIM_COM.PLAYBACK_RATE,this._playbackRate),this.statVod.setComDim(L.a.DIM_COM.PLAYBACK_RATE,this._playbackRate)}getPlaybackRate(){return this._playbackRate}setCodeRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1000";this._coderate=t,this.stat.setComDim(L.a.DIM_COM.VOD_CODERATE,this._coderate)}getCodeRate(){return this._coderate}getBuffered(){return this.videoElement&&this.videoElement.buffered}onNoPicture(){if(f.a.log(`VodMgr(${this._id}).onNoPicture isSendNoPicture=${this.isSendNoPicture}`),this.isSendNoPicture)return;this.isSendNoPicture=!0;const t=this.getCurrentTime(),e=this.player.getCostTimes?this.player.getCostTimes():[];let i=[this.player.hasPicture||this.hadPlayVideo?0:100];i=i.concat(e),this.player.hasPicture||this.hadPlayVideo||!this.player.addNoPictureReason||this.player.addNoPictureReason();const s=y.a.now()-this.hlsNoPictureStartTs;this.player.sendNoPicture&&this.player.sendNoPicture(s);const r=[this.stat.createAct(L.a.ACT.NO_PICTURE,{value:i,str:[qe.a.platform,this.busiSource,0==t?0:1]})];let a=0;this.player&&this.player.mse&&(a=this.player.mse.isMediaSourceOpen?1:2);const o=R.b.getBrowserHidden();o&&2==a?f.a.log(`VodMgr(${this._id}).onNoPicture browserHidden=${o}, isMediaSourceOpen=${a}`):this.eventEmitter.trigger(m.DATA_METRIC2,r)}getLog(){return f.a.getLog()}getNewLog(){return f.a.getNewLog()}pushMuffedData(t){this.player&&this.playerType===sd.HLS&&(this.player.voiceEliminationData||(this.player.voiceEliminationData=[]),this.player.voiceEliminationData.push(t))}getMuted(){return this.player&&this.player.isWebCodec?this._muteVal:this.videoElement&&this.videoElement.muted}getVideoWidth(){return this.videoElement&&this.videoElement.videoWidth}getVideoHeight(){return this.videoElement&&this.videoElement.videoHeight}getVideoElement(){return this.playerType===sd.VR?this.vrElement:this.videoElement}showControls(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.videoElement&&(this.videoElement.controls=t)}_hasHttpPrefix(t){return/^http(s)?/.test(t)}_createVideoElm(){let t=So.create(this.videoElement,{});this.playerType===sd.VR&&t.setAttribute("crossOrigin","anonymous"),this.videoElement=t,this.createVideoElmInner=!0,f.a.log(`VodMgr(${this._id})._craeteVideoElm id=${t.id}`)}_isEnded(){const t=this.getDurationRealTime(),e=this.getCurrentRealTime();return t>0&&t-e<.1}onPlayEnded(){f.a.log(`VodMgr(${this._id}) onPlayEnded`)}_videoPlayEnded(){f.a.log(`VodMgr(${this._id}) end`),this.streamType===sd.StreamType.HLS&&(this.playerType===sd.VR?this.player.updatePlayerStatus(!1):this.player.started=!1),this._loop?(this.ended=!1,this.seekTime(0),this.player instanceof Vh&&this.player&&this.player.play()):(this.ended=!0,this.eventEmitter.trigger(sd.Event.VIDEO_ENDED,{video:this.videoElement}))}_addVideoListeners(){f.a.log(`VodMgr(${this._id})._addVideoListeners`),this.eventsMap.forEach((t,e)=>{this.eventEmitter.on(e,t)})}_removeVideoListeners(){f.a.log(`VodMgr(${this._id})._removeVideoListeners`),this.eventsMap.forEach((t,e)=>{this.eventEmitter.off(e,t)})}_onVideoSeek(t){this.ended=!1;const e=this.videoElement.currentTime;this.eventEmitter.trigger(m.VIDEO_SEEK,{video:this.videoElement,currentTime:1*e}),this._isEnded()||this._paused||this.ended||this.play()}_onVideoHlsSeek(t,e){this.ended=!1,this._isEnded()&&this._onVideoTimeupdate()}_onVideoEnded(t){this._videoPlayEnded()}_onM3u8PlayEnded(){this._videoPlayEnded()}_onVideoTimeupdate(t,e){if(this.ended||this.isRetrying)return;!this._duration&&this.getDurationTime();const i=this._duration;let s=this.getCurrentTime();this.eventEmitter.trigger(sd.Event.VIDEO_TIMEUPDATE,{duration:i,currentTime:s})}_onVideoError(t){f.a.log(`VodMgr(${this._id})._onVideoError id=${t.currentTarget.id}`),1!==this.av1State&&this.eventEmitter.trigger(sd.Event.VIDEO_ERROR,{error:t})}_onVideoLoadStart(t){this.isRetrying||this.eventEmitter.trigger(sd.Event.VIDEO_LOAD_START,{video:this.videoElement,event:t})}_onVideoStartPlay(t,e){e&&(this.vrElement=e.video),this.isRetrying=!1,this.hadPlayVideo=!0}_onH5PlayerError(t,e){if(e&&(e.code===li||e.code===D.a.H5_ERROR_CODE.PLAY_TIMEOUT||e.code===D.a.H5_ERROR_CODE.VIDEO_ERROR))return;const i=this.getCurrentTime();this.playInfo.seekTime=i+1,this.isRetrying=!0,1===this.av1State&&(this.av1State=2);let s=this._volume;this.errorReplayCnt>=3||(this._start(this.playInfo),this.setVolume(s),this.setPlaybackRate(this._playbackRate),this.errorReplayCnt++)}_onBackToAV1(t,e){if(2===this.av1State){f.a.log(`VodMgr(${this._id})._onBackToAV1, seekTime=${e}`),this.av1State=0,this.isRetrying=!0,this.playInfo.seekTime=e;let t=this._volume;this.start(this.playInfo),this.setVolume(t),this.setPlaybackRate(this._playbackRate)}}_onVideoPause5sRetry(){this.isRetrying=!0}onTurntoH264(t,e){f.a.log(`VodMgr.onTurntoH264${this._id}, turn to h264, isVodTurnTo264=${P.a.isVodTurnTo264} localStorage.isVodTurnTo264=${localStorage.isVodTurnTo264}`,t,e),1!==P.a.isVodTurnTo264&&1!=localStorage.isVodTurnTo264||this.h265Proxy.onTurnToH264(this._type),this.playInfo&&(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.playInfo.seekTime=e.seekTime),this.start(this.playInfo),this.setVolume(this._volume),this.setPlaybackRate(this._playbackRate))}onH265Retry(t,e){f.a.log(`VodMgr(${this._id}).onH265Retry, H265 retry!`,t),this.playInfo&&(e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.playInfo.seekTime=e.seekTime),this.start(this.playInfo),this.setVolume(this._volume),this.setPlaybackRate(this._playbackRate))}onTurnToMse(t,e){f.a.log(`VodMgr(${this._id}).onTurnToMse, turn to MSE`),this.isTurnToMse=!0,this.isTurnToWebcodecsSoft=!1,e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.playInfo.seekTime=e.seekTime),this.start(this.playInfo),this.setVolume(this._volume),this.setPlaybackRate(this._playbackRate)}onTurnToWebcodecsSoft(t,e){f.a.log(`VodMgr(${this._id}).onTurnToWebcodecsSoft`,e),localStorage._webcodecSoftNums||(localStorage._webcodecSoftNums=0,localStorage._webcodecSoftDate=Date.now());let i=Number(localStorage._webcodecSoftNums)+1;localStorage._webcodecSoftNums=i,this.isTurnToMse=!1,this.isTurnToWebcodecsSoft=!0,e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.playInfo.seekTime=e.seekTime),this.start(this.playInfo),this.setVolume(this._volume),this.setPlaybackRate(this._playbackRate)}onTurntoH265Wasm(t,e){f.a.log(`VodMgr(${this._id}).onTurntoH265Wasm, turn to h265 wasm`,t),1===Number(localStorage._forceMseHevc)&&localStorage.setItem&&localStorage.setItem("_forceMseHevc",0),this.h265MseProxy.onTurntoH265Wasm(this.type),e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.playInfo.seekTime=e.seekTime),this.start(this.playInfo),this.setVolume(this._volume),this.setPlaybackRate(this._playbackRate)}onWebcodecsRetry(t,e){e&&"number"==typeof e.seekTime&&e.seekTime>0&&(this.playInfo.seekTime=e.seekTime),f.a.log(`VodMgr(${this._id}).onWebcodecsRetry`),this.start(this.playInfo),this.setVolume(this._volume),this.setPlaybackRate(this._playbackRate)}restart(){f.a.log(`VodMgr(${this._id}).restart, volume=${this._volume}, mute=${this._muteVal}`),this.playInfo.seekTime=0,this.start(this.playInfo),this.setVolume(this._volume),this.setMuted(this._muteVal),this.setPlaybackRate(this._playbackRate)}containerResize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.player&&this.player.containerResize&&this.player.containerResize(t)}getVideoExtractData(){let t={};return t.codec=this.player.getCodecType().toUpperCase(),t.videoWidth=this.getVideoWidth()||this.playInfo.sWidth,t.videoHeight=this.getVideoHeight()||this.playInfo.sHeight,t.frameRate=this.player.getFps(),t.bitrate=this.playInfo.curBitrate||0,f.a.log(`VodMgr(${this._id}).getVideoExtractData`,JSON.stringify(t)),t}checkWebCodecSoft(t){if(localStorage._webcodecSoftDate){const t=864e5;Date.now()-Number(localStorage._webcodecSoftDate)>=t?(delete localStorage._webcodecSoftDate,delete localStorage._webcodecSoftNums):Number(localStorage._webcodecSoftNums)>=3&&(this.isTurnToWebcodecsSoft=!0)}1==P.a.isQQSoft&&94==qe.a.version.major&&-1!=navigator.userAgent.toLowerCase().indexOf("qq")&&"7"==pe.a.osVersion&&(this.isTurnToWebcodecsSoft=!0),1!=P.a.isWin7WcsSoft||"7"!=pe.a.osVersion&&(109!=qe.a.version.major||R.b.isMseSupportedHevc()||-1===qe.a.name.indexOf("chrome"))||(this.isTurnToWebcodecsSoft=!0),-1!=P.a.wcsSoftBrows.indexOf(qe.a.version.major)&&-1!==qe.a.name.indexOf("chrome")&&(this.isTurnToWebcodecsSoft=!0),-1!=P.a.wcsSoft264Uids.indexOf(Number(t.uid))&&(this.isTurnToWebcodecsSoft=!0),1==localStorage._forceWebcodecsSoft&&(this.isTurnToWebcodecsSoft=!0)}setMuted(t){this._muteVal=!!t,f.a.log(`VodMgr(${this._id}).setMuted`,t),this.videoElement&&(this.videoElement.muted=t)}setSegmenttion(t){f.a.log(`VodMgr(${this._id}).setSegmenttion`,t),this.player&&this.player.setSegmenttion(t)}getModelRes(){return this.videoEnhance.getModelRes()}onVideoEhanceError(t,e){this.player.setEnhance(!1),this.videoEnhance&&this.videoEnhance.onVideoEhanceErrorCb&&this.videoEnhance.onVideoEhanceErrorCb(e.type)}onVideoEhanceSuccess(){this.videoEnhance&&this.videoEnhance.onVideoEhanceSuccess&&this.videoEnhance.onVideoEhanceSuccess()}getEnhanceStats(){return this.videoEnhance.getEnhanceStats()}onPlayVideo(t,e){f.a.log(`VodMgr(${this._id}).onPlayVideo`),e&&(this.vrElement=e.video),this.isRetrying=!1,this.hadPlayVideo=!0,this.setEnhance(!0);let i=ce().toLowerCase();this.stat.setComDim(L.a.DIM_COM.RENDER_INFO,i),this.statVod.setComDim(L.a.VOD_DIM_COM.RENDER_INFO,i),-1==i.toLocaleLowerCase().indexOf("swiftshader device")&&""!=i||this.player&&this.player.setDisableHardAcc&&this.player.setDisableHardAcc();let s=pe.a.os||"",r=pe.a.osVersion||"",a="windows"==s.toLocaleLowerCase()&&7==Number(r),o=-1!=i.toLocaleLowerCase().indexOf("intel"),n=-1!=i.toLocaleLowerCase().indexOf("angle (null"),h=""==i.toLocaleLowerCase(),d=navigator.hardwareConcurrency;a&&o&&d<=4&&this.player&&this.player.win7PerfInsufficient&&this.player.win7PerfInsufficient(),n?(localStorage.isAngelNull=1,this.player&&this.player.angelNullError&&this.player.angelNullError()):localStorage.isAngelNull=0,h?this.player&&this.player.chromeH265RenderEmptyError&&this.player.chromeH265RenderEmptyError():localStorage.isChromeH265RenderInfoEmpty=0,this.playerCoreType==D.a.PLAYER_CORE_TYPE.MSE&&this.mse&&this.mse.h265Proxy.isH265MseCodec&&-1!=i.indexOf("amd")&&-1!=i.indexOf("radeon")&&(f.a.log(`VodMgr(${this._id}).onPlayVideo.amd.hevError`),this.player.onMseHevcError())}onCheckTimer(t,e){this.videoEnhance&&this.videoEnhance.onCheckTimer&&this.videoEnhance.onCheckTimer(t,e)}setEnhance(t){this._type===sd.HLS&&(f.a.log(`VodMgr(${this._id}).setEnhance`,t),this.isUseEnhance=!!t,this.videoEnhance.getSupport(this.playInfo,ce()),this.isUseEnhance&&(this.videoEnhance.isSupport||this.eventEmitter.trigger(m.ON_VIDEO_ENHANCE_UNSUPPORT),this.isUseEnhance=this.videoEnhance.isSupport),this.player&&this.player.setEnhance&&this.player.setEnhance(this.isUseEnhance))}}sd.FLV=Nh.FLV,sd.HLS=Nh.HLS,sd.MP4=Nh.MP4,sd.VR=Nh.VR,sd.StreamType=Nh,sd.Event=_,sd.StopType={INNER:1,OUTER:2};var rd=sd;"undefined"==typeof localStorage&&(window.localStorage={}),P.a.isForceUseWorker=1;const ad=66,od=67;class nd{static isSupported(){return ls.a.isMseSupportedH264()}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Number(localStorage.sdkLogLevel);isNaN(e)||this._setLogLevel(e),Object(V.setLogger)(f.a);let i=S();this.on=i.on.bind(i),this.off=i.off.bind(i),this.trigger=i.trigger.bind(i),this.videoElm=t.videoElement||null,this.appId=t.appId||ad,this.uid=t.uid||"0",this.guid=t.guid||"",this.ua=t.ua||"",this.anchorUid=t.anchorUid||"",this.source=t.source||"",this.isMute=t.isMute||0,this.gameid=t.gameid||0;let s=`${pe.a.os}/${pe.a.osVersion} ${pe.a.browser}/${pe.a.version.full}`;f.a.warn(`VOD SDK MAIN 2412111629 | 2024-12-11 16:29:45 | RELEASE | ${s} | ${this.uid} | ${this.guid}`),this.config=P.a,P.a.setMute(this.isMute),localStorage.appid=Number(this.appId)===od?this.appId:"",M.a.initUUId(),this.uid&&(M.a.uid=this.uid),this.appId&&(M.a.appid=this.appId),this.guid&&(M.a.sGuid=this.guid),this.videoElmIncome=!!t.videoElement,this.mediaMuffedData=[],this.playerMgr=new rd(this,t),this.started=!1,1==localStorage._showVodSdk&&(window.sdkPlayer=this),this.webcodecsErrCount=0,this.turnMseType=0}_setLogLevel(t){f.a.setLevel(t)}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.started&&this.stop();try{f.a.log("HYVodPlayer.start "+JSON.stringify(t))}catch(t){f.a.log("HYVodPlayer.start")}t.guid=this.guid,0==this.gameid||t.hasOwnProperty("gameId")||(t.gameId=this.gameid),this.started=!0,t.hasOwnProperty("curBitrate")||(t.curBitrate=t.coderate),t.url&&(-1!==t.url.indexOf(".flv")&&t.type!==Nh.FLV?t.type=Nh.FLV:-1!==t.url.indexOf(".m3u8")&&t.type!==Nh.HLS?t.type=Nh.HLS:-1!==t.url.indexOf(".mp4")&&t.type!==Nh.MP4&&(t.type=Nh.MP4)),wt.reset(),this.playerMgr.start(t)}setExtendConfig(t){let e={};t.p2pConfig&&(Object.assign(e,t.p2pConfig),delete t.p2pConfig),t.sdk&&(t.sdk.p2pConfig&&(Object.assign(e,t.sdk.p2pConfig),delete t.sdk.p2pConfig),Object.assign(e,t.sdk),delete t.sdk),Object.assign(e,t),this.config.init(e)}stop(){this.started&&this.reset()}reset(){this.started=!1,this.videoElmIncome||(this.videoElm=null),this.playerMgr&&this.playerMgr.stop()}destroy(){this.reset()}getVideoElement(){return this.playerMgr.getVideoElement()}setVolume(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.playerMgr&&this.playerMgr.setVolume(t)}getVolume(){return this.playerMgr&&this.playerMgr.getVolume()}setMuted(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.playerMgr&&this.playerMgr.setMuted(t)}getMuted(){return this.playerMgr&&this.playerMgr.getMuted()}showControls(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.playerMgr&&this.playerMgr.showControls(t)}getCurrentTime(){return this.playerMgr&&this.playerMgr.getCurrentTime()}getDuration(){return this.playerMgr&&this.playerMgr.getDurationTime()}seek(t){Ah.isZhiXu(this.playerMgr.busiSource)||this.playerMgr.streamType!==rd.StreamType.HLS||!this.playerMgr.ended?this.playerMgr&&this.playerMgr.seekTime(t):f.a.log("HYVodPlayer.seek end!")}getBuffered(){return this.playerMgr&&this.playerMgr.getBuffered()}fullScreen(){this.videoElm=this.getVideoElement(),this.videoElm&&(this.videoElm.requestFullscreen?this.videoElm.requestFullscreen():this.videoElm.mozRequestFullScreen?this.videoElm.mozRequestFullScreen():this.videoElm.webkitRequestFullScreen&&this.videoElm.webkitRequestFullScreen())}exitFullscreen(){this.videoElm.exitFullscreen?this.videoElm.exitFullscreen():this.videoElm.mozCancelFullScreen?this.videoElm.mozCancelFullScreen():this.videoElm.webkitCancelFullScreen&&this.videoElm.webkitCancelFullScreen()}play(){return this.playerMgr&&this.playerMgr.play()}pause(){this.playerMgr&&this.playerMgr.pause()}getPaused(){return this.playerMgr&&this.playerMgr.paused}getEnded(){return this.playerMgr&&this.playerMgr.ended}getReadyState(){return this.playerMgr&&this.playerMgr.readyState}setPlaybackRate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.playerMgr&&this.playerMgr.setPlaybackRate(t)}getPlaybackRate(){return this.playerMgr&&this.playerMgr.getPlaybackRate()}getVideoWidth(){return this.playerMgr&&this.playerMgr.getVideoWidth()}getVideoHeight(){return this.playerMgr&&this.playerMgr.getVideoHeight()}setLoop(t){this.playerMgr&&this.playerMgr.setLoop(t)}getLoop(){return this.playerMgr&&this.playerMgr.getLoop()}setCodeRate(t){this.playerMgr&&this.playerMgr.setCodeRate(t)}getCodeRate(){return this.playerMgr&&this.playerMgr.getCodeRate()}getLog(){return this.playerMgr&&this.playerMgr.getLog()}getNewLog(){return this.playerMgr&&this.playerMgr.getNewLog()}pushMuffedData(t){(t=t||{}).begin&&t.end?this.playerMgr.pushMuffedData(t):f.a.warn(`muffed data error, beginDts=${t.begin}, endDts=${t.end}`)}setTafHandler(t){this.playerMgr.setTafHandler(t)}containerResize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.playerMgr&&this.playerMgr.containerResize&&this.playerMgr.containerResize(t)}getVideoExtractData(){return this.playerMgr.getVideoExtractData()}getEnhanceStats(){return this.playerMgr&&this.playerMgr.getEnhanceStats&&this.playerMgr.getEnhanceStats()}replay(){this.playerMgr&&this.playerMgr.replay&&this.playerMgr.replay()}onPlayEnded(){this.playerMgr&&this.playerMgr.onPlayEnded&&this.playerMgr.onPlayEnded()}get videoEnhance(){return this.playerMgr.videoEnhance}}nd.FLV=Nh.FLV,nd.HLS=Nh.HLS,nd.MP4=Nh.MP4,nd.VR=Nh.VR,nd.StreamType=Nh,nd.Event={DATA_METRIC2:m.DATA_METRIC2,VIDEO_PLAY:m.VIDEO_PLAY,VIDEO_NATIVE_PLAY:m.VIDEO_NATIVE_PLAY,PLAY_CARTON:m.PLAY_CARTON,VIDEO_PLAYING:m.VIDEO_PLAYING,VIDEO_SEEK:m.VIDEO_SEEK,VIDEO_PAUSE:m.VIDEO_PAUSE,BROWSER_PAUSE:m.BROWSER_PAUSE,VIDEO_CANPLAY:_.VIDEO_CANPLAY,VIDEO_TIMEUPDATE:_.VIDEO_TIMEUPDATE,VIDEO_PROGRESS:_.VIDEO_PROGRESS,VIDEO_ERROR:_.VIDEO_ERROR,VIDEO_ENDED:_.VIDEO_ENDED,VIDEO_LOOP_ENDED:m.VIDEO_LOOP_ENDED,VIDEO_STOP:m.VIDEO_STOP,VIDEO_LOAD_START:_.VIDEO_LOAD_START},window.HYVodPlayer=nd;var hd=e.default=nd},function(t,e,i){"use strict";i.r(e);var s=class{constructor(t){this.data=new Uint8Array(t),this.idx=0,this.size=t}getData(){if(this.idx!=this.size)throw"Mismatch between size reserved and sized used";return this.data.slice(0,this.idx)}writeUint8(t){this.data.set([t],this.idx),this.idx++}writeUint16(t){var e=new Uint16Array(1);e[0]=t;var i=new Uint8Array(e.buffer);this.data.set([i[1],i[0]],this.idx),this.idx+=2}writeUint8Array(t){this.data.set(t,this.idx),this.idx+=t.length}};class r{constructor(t,e,i){this.timeStamp=e,this.frame=i,this.type=t,this.isEmptyAudioFrame=!1}setIsEmptyAudioFrame(t){this.isEmptyAudioFrame=t}}r.VIDEO=0,r.AUIDO=1;var a=r,o=i(4);class n{constructor(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.data=i,this.timeStamp=e,this.type=t,this.startDecodeTime=0,this.decodedTime=0,this.discardAllow=s,this.isKeyFrame=r}}n.VIDEO=0,n.AUIDO=1;var h=n,d=i(9),l=i(15);class u{constructor(t){this.samples=[],this.decodedFrames=[],this.decoder=null,this.decodingTimeStamp=0,this.decodingType=0,this.decodeState=u.DECODE_STATE_PENDDING,this.decodeNums=0,this.toDecodeNums=0,this.lastToDecodeNums=0,this.lastDecodedNums=0,this.player=t,this.decodeDatas=[],this.decodIngAudioFrameTimeStamps=[],this.decodIngAudioFrameIsEmptyTypes=[],this.count=0,this.closed=!1,this.toDecodeFrameLocalTimeMap=new Map,this.frameDecodeDelays=[],this.smoothFrameDecodeDelay=0,this.decodedFrameStamp=0,this.printTodecodeCnt=0,this.printDecodedCnt=0,this.lastToDecodePts=0,this.lastDecodedPts=0,this.lastTodecodeDts=0}get configured(){return this.decoder&&"configured"==this.decoder.state}close(){this.closed=!0,this.decodeDatas.length=0,this.decodeNums=0,this.toDecodeNums=0,this.lastToDecodeNums=0,this.lastDecodedNums=0,"closed"!=this.decoder.state&&(this.decoder.reset(),this.decoder.close()),this.decoder=null,this.player=null,this.decodedFrameStamp=0}appendSamples(t,e){for(;t.length>0;)this.samples.push(t.shift());this.decodeState==u.DECODE_STATE_PENDDING&&this.decodeChunk(e)}getUnDecodeBuffer(){return this.lastToDecodePts>0&&this.lastDecodedPts>0?this.lastToDecodePts-this.lastDecodedPts:0}decodeFrame(t){this.toDecodeNums++,this.lastToDecodePts=t.timeStamp+(t.compositionTime||0),t.type==h.AUIDO?this.player.storeWorkerShared(d.StoreWorkerType.AUDIO_TODECODE_NUMS,this.toDecodeNums):t.type==h.VIDEO&&this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_TODECODE_NUMS,this.toDecodeNums),this.toDecodeFrameLocalTimeMap.set(t.timeStamp,o.default.getNow()),l.a.printTodecodeVideo&&t.type===h.VIDEO&&o.default.log(`WebCodecsDecoder.decodeFrame isKey=${t.isKeyFrame} dts=${t.timeStamp} cts=${t.compositionTime} pts=${t.timeStamp+t.compositionTime} gap=${t.timeStamp-this.lastTodecodeDts} lastDecodedPts=${this.lastDecodedPts}  samples=${this.player.decodeJitter.videoSamples.length} decodedNum=${this.player.videoRender.framelist.length}`),l.a.printToDecodeAudio&&t.type===h.AUIDO&&o.default.log(`WebCodecsDecoder.decodeFrame dts=${t.timeStamp} gap=${t.timeStamp-this.lastTodecodeDts} lastDecodedPts=${this.lastDecodedPts} samples=${this.player.decodeJitter.audioSamples.length} decodedNum=${this.player.audioRender.framelist.length}`),this.lastTodecodeDts=t.timeStamp;try{this.decoder.decode(t.data)}catch(e){console.error(e,t,t.naluType,t.isKeyFrame,t.timeStamp,this.toDecodeNums,"webCodecsDecoder"),this.onDecoderError(e)}}onFrame(t){let e=o.default.getNow();if(this.decodedFrameStamp=e,this.lastDecodedPts=t.timestamp,this.closed)return;this.decodeNums++;let i=0,s=!1;if(this.decodingType==h.AUIDO?(i=this.decodIngAudioFrameTimeStamps.shift(),s=this.decodIngAudioFrameIsEmptyTypes.shift(),this.player.storeWorkerShared(d.StoreWorkerType.AUDIO_DECODE_NUMS,this.decodeNums)):this.decodingType==h.VIDEO&&(this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_DECODE_NUMS,this.decodeNums),i=t.timestamp),this.toDecodeFrameLocalTimeMap.has(i)){let t=Math.floor(100*(o.default.getNow()-this.toDecodeFrameLocalTimeMap.get(i)))/100;l.a.printDecodedVideo&&this.decodingType===h.VIDEO&&o.default.log(`WebcodecsDecoder.decode timeStamp=${i} delay=${t} samples=${this.player.decodeJitter.videoSamples.length} frames=${this.player.videoRender.framelist.length}`),l.a.printDecodedAudio&&this.decodingType===h.AUIDO&&o.default.log(`WebcodecsDecoder.decode timeStamp=${i} delay=${t} samples=${this.player.decodeJitter.audioSamples.length} frames=${this.player.audioRender.framelist.length}`),this.frameDecodeDelays.push(t),this.toDecodeFrameLocalTimeMap.delete(i),0===this.smoothFrameDecodeDelay?this.smoothFrameDecodeDelay=t:this.smoothFrameDecodeDelay=(7*this.smoothFrameDecodeDelay+t)/8}let r=i,n=new a(this.decodingType,r,t);n.setIsEmptyAudioFrame(s),this.player.onFrameDecoded(n)}getDecodeDelay(){let[...t]=this.frameDecodeDelays;return this.frameDecodeDelays.length=0,t}onDecoderError(t){o.default.log("WebCodecsDecoder.onDecoderError, decodingType="+this.decodingType);let e=d.ToMainMessageType.VIDEODECODEERROR;this.decodingType==h.VIDEO?e=d.ToMainMessageType.VIDEODECODEERROR:this.decodingType==h.AUIDO&&(e=d.ToMainMessageType.AUDIODECODEERROR),this.player.handlerError(e,{msg:t&&t.message})}getDecodeFps(){let t={toDecodeFps:this.toDecodeNums-this.lastToDecodeNums,decodeFps:this.decodeNums-this.lastDecodedNums};return this.lastDecodedNums=this.decodeNums,this.lastToDecodeNums=this.toDecodeNums,t}resetDecoder(){}}u.DECODE_STATE_PENDDING=0,u.DECODE_STATE_DECODEDING=1,u.DECODE_STATE_DECODEFINISH=2,u.DECODER_ERROR="video_deocde_error",u.DECODER_TYPE_VIDEO=0,u.DECODER_TYPE_AUDIO=1;var c=u;var p=class extends c{constructor(t){super(t),this.decodingType=h.VIDEO,this.avcHeader=null,this.avcHeaderChanged=!1,this.lastToDecodeFrameTimeStamp=0,this.createDecoder(),this._isUseSoftAcceleration=!1,this.checkDecodedOutputFrameTypeTimes=0,this.lastDecodedFrameTimeStamp=0,this.outputFrameByPts=!1,this.outputFrameMode=-1,this.checkFrameCnt=0,this.hasCts=!1,this.codecType="",this._lastDecodedTs=-1e4,this.decodedNum=0,this.firstToDecodeTs=0,this.firstDecodedTs=0}resetDecoder(){this.decodeDatas.length=0,this.decodeNums=0,this.toDecodeNums=0,this.lastToDecodeNums=0,this.lastDecodedNums=0,"closed"!=this.decoder.state&&(this.decoder.reset(),this.decoder.close()),this.decoder=null,this.decodedFrameStamp=0,this.lastToDecodePts=0,this.lastDecodedPts=0,this.createDecoder(),this.setAVCConfig()}createDecoder(){this.decoder=new VideoDecoder({output:this.onFrame.bind(this),error:this.onDecoderError.bind(this)})}close(){super.close(),this.codecType=""}decodeFrame(t){t.isKeyFrame&&"av01"!=this.codecType&&!this.player.isVodAv1&&this.updateAVCConfig(t.sps,t.pps,t.vps,t.codec,t.width,t.height),this.lastToDecodeFrameTimeStamp=t.timeStamp,t.compositionTime>0&&(this.hasCts=!0),0==this.firstToDecodeTs&&(this.firstToDecodeTs=o.default.getNow()),super.decodeFrame(t)}onFrame(t){const e=o.default.getNow();this.decodedNum+=1,-1e4!=this._lastDecodedTs&&e-this._lastDecodedTs>=200&&o.default.log(`WebCodecsVideoDecoder.onFrame ts delta=${e-this._lastDecodedTs}, num=${this.decodedNum}`);let i=0;0==this.firstDecodedTs&&0!=this.firstToDecodeTs&&(this.firstDecodedTs=e,i=this.firstDecodedTs-this.firstToDecodeTs,this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_FIRST_FRAME_DECODEC_COST,i)),this._lastDecodedTs=e,this.checkOutputMode(t.timestamp),this.checkFrameOutputByPts(t.timestamp),this.lastDecodedFrameTimeStamp=t.timestamp,super.onFrame(t)}checkFrameOutputByPts(t){!this.outputFrameByPts&&this.checkDecodedOutputFrameTypeTimes<100&&t<this.lastDecodedFrameTimeStamp&&(this.checkDecodedOutputFrameTypeTimes++,this.outputFrameByPts=!0,this.player.setVideoOutputByPts(this.outputFrameByPts))}checkOutputMode(t){-1===this.outputFrameMode&&this.checkFrameCnt<100&&(this.checkFrameCnt++,t<this.lastDecodedFrameTimeStamp?this.outputFrameMode=2:100===this.checkFrameCnt&&-1===this.outputFrameMode&&(this.hasCts?this.outputFrameMode=1:this.outputFrameMode=2))}isOutputFrameByDts(){return 1===this.outputFrameMode}updateAVCConfig(t,e,i,s,r,a){this.avcHeaderChanged=this.checkAVCConfigChanged(e,t,i),this.avcHeader={sps:t,pps:e,vps:i,codec:s,width:r,height:a},this.avcHeaderChanged&&(o.default.log(`WebCodecsDecoder.updateVideoConfig codec=${s} width=${r} height=${a}`),this.setAVCConfig())}checkAVCConfigChanged(t,e,i){if(!this.avcHeader)return!0;if(this.avcHeader&&-1!==this.avcHeader.codec.indexOf("hvc")){if(this.avcHeader.pps[0].nalu.toLocaleString()==t[0].nalu.toLocaleString()&&this.avcHeader.sps[0].nalu.toLocaleString()==e[0].nalu.toLocaleString()&&this.avcHeader.vps[0].nalu.toLocaleString()==i[0].nalu.toLocaleString())return!1}else if(this.avcHeader&&-1!==this.avcHeader.codec.indexOf("avc")&&this.avcHeader.pps[0].nalu.toLocaleString()==t[0].nalu.toLocaleString()&&this.avcHeader.sps[0].nalu.toLocaleString()==e[0].nalu.toLocaleString())return!1;return!0}setAVCConfig(){o.default.log("WebCodecsDecoder.setAVCConfig"),this.setDecoderConfig(),this.avcHeaderChanged=!1}setDecoderConfig(){var t=this.getExtradata();if(!t)return void o.default.log("WebCodecsDecoder.setDecoderConfig extradata is null!");let e={codec:this.avcHeader.codec,codedWidth:this.avcHeader.width,codedHeight:this.avcHeader.height,description:t,optimizeForLatency:!1};this._isUseSoftAcceleration&&(e.hardwareAcceleration="prefer-software"),this.videoConfig=e,o.default.log("WebCodecsDecoder.setDecoderConfig",e.hardwareAcceleration,this._isUseSoftAcceleration),this.decoder.configure(e)}initAv1Seg(t){this.codecType="av01",this.setAv1DecoderConfig(t)}setAv1DecoderConfig(t){let e={codec:t.codec,codedWidth:t.width,codedHeight:t.height,description:t.configOBUs};this._isUseSoftAcceleration&&(e.hardwareAcceleration="prefer-software"),this.videoConfig=e,o.default.log("WebCodecsDecoder.setAv1DecoderConfig,codec="+t.codec),this.decoder.configure(e),this.isConfig=!0}seek(){this.decoder.reset(),this.decoder.configure(this.videoConfig)}getExtradata(){return-1!==this.avcHeader.codec.indexOf("hvc")?(this.codecType="265",this.getExtradata265()):-1!==this.avcHeader.codec.indexOf("avc")?this.getExtradata264():null}getExtradata265(){let t=this._getNumOfArrays(this.avcHeader.vps,32),e=this._getNumOfArrays(this.avcHeader.sps,33),i=this._getNumOfArrays(this.avcHeader.pps,34),s=this._getSPSOri(e),r=[1,s[8],s[9],s[10],s[11],s[12],s[13],s[14],s[15],s[16],s[17],s[18],s[19],240,0,252,253,248,248,0,0,15];return r.push(3),r=r.concat(t).concat(e).concat(i),new Uint8Array(r)}_getNumOfArrays(t,e){let i=[];i.push(128|e),i.push((65280&t.length)>>8),i.push(255&t.length);for(let e=0;e<t.length;e++){let s=t[e].nalu;i.push((65280&s.length)>>8),i.push(255&s.length),i=i.concat(Array.prototype.slice.call(s))}return i}_getSPSOri(t){let e=[],i=0;for(let s=0;s<t.length;){let r=t[s];2!==i||3!==r?(0===r?i++:i=0,e.push(r),++s):(++s,i=0)}return e}getExtradata264(){var t,e=7;for(t=0;t<this.avcHeader.sps.length;t++)e+=2+this.avcHeader.sps[t].length;for(t=0;t<this.avcHeader.pps.length;t++)e+=2+this.avcHeader.pps[t].length;var i=new s(e);let r=this.avcHeader.sps[0].nalu[1],a=this.avcHeader.sps[0].nalu[2],o=this.avcHeader.sps[0].nalu[3];for(i.writeUint8(1),i.writeUint8(r),i.writeUint8(a),i.writeUint8(o),i.writeUint8(255),i.writeUint8(this.avcHeader.sps.length+224),t=0;t<this.avcHeader.sps.length;t++)i.writeUint16(this.avcHeader.sps[t].length),i.writeUint8Array(this.avcHeader.sps[t].nalu);for(i.writeUint8(this.avcHeader.pps.length),t=0;t<this.avcHeader.pps.length;t++)i.writeUint16(this.avcHeader.pps[t].length),i.writeUint8Array(this.avcHeader.pps[t].nalu);return i.getData()}setUseSoftAcceleration(){this._isUseSoftAcceleration=!0}getDecodingBuffer(){return this.lastToDecodeFrameTimeStamp-this.lastDecodedFrameTimeStamp}};var m=class extends c{constructor(t){super(t),this.decodingType=h.AUIDO,this.aacConfig=null,this.aacConfigChanged=!1,this.aacConfigInited=!1,this.decoder=new AudioDecoder({output:this.onFrame.bind(this),error:this.onDecoderError.bind(this)}),this._lastDecodedTs=-1e4,this.decodedNum=-1,this.aacTimeLen=1024e3/44100,this.firstToDecodeTs=0,this.firstDecodedTs=0}updateAudioConfig(t,e,i,s){this.aacConfig&&this.aacConfig.codec==t&&this.aacConfig.sampleRate==e&&this.aacConfig.numberOfChannels==i||(this.aacConfig={codec:t,sampleRate:e,numberOfChannels:i,timestamp:s},this.aacConfigChanged=!0),this.aacConfigInited||this.setAACConfig(this.aacConfig.codec,this.aacConfig.sampleRate,this.aacConfig.numberOfChannels)}setAACConfig(t,e,i){let s={codec:t,sampleRate:e,numberOfChannels:i};this.aacTimeLen=1024e3/e,this.audioConfig=s,o.default.log(`WebCodecsAudioDecoder.setAACConfig,c=${t},sr=${e},nc=${i},aacT=${this.aacTimeLen}`),this.decoder.configure(s),this.aacConfigInited=!0}seek(){this.decoder.reset(),this.decoder.configure(this.audioConfig)}decodeFrame(t){this.aacConfigChanged&&this.aacConfig.timestamp<=t.timeStamp&&(this.setAACConfig(this.aacConfig.codec,this.aacConfig.sampleRate,this.aacConfig.numberOfChannels),this.aacConfigChanged=!1),0==this.firstToDecodeTs&&(this.firstToDecodeTs=o.default.getNow()),super.decodeFrame(t),this.decodIngAudioFrameTimeStamps.push(t.timeStamp),this.decodIngAudioFrameIsEmptyTypes.push(t.isEmptyAudioFrame)}onFrame(t){this.decodedNum+=1;const e=o.default.getNow();-1e4!=this._lastDecodedTs&&e-this._lastDecodedTs>=200&&o.default.log(`WebCodecsVideoDecoder.onFrame ts delta=${e-this._lastDecodedTs}, num=${this.decodedNum}`);let i=0;0==this.firstDecodedTs&&0!=this.firstToDecodeTs&&(this.firstDecodedTs=e,i=this.firstDecodedTs-this.firstToDecodeTs,this.player.storeWorkerShared(d.StoreWorkerType.AUDIO_FIRST_FRAME_DECODEC_COST,i)),super.onFrame(t)}getAacTimeLen(){return this.aacTimeLen}};var f=class{constructor(t){this._name=t,this._startTs=0,this._startDts=0,this._lastDts=0,this._jumpTime=0,this._lastDts=0,this._lastTs=0}setLast(t,e){this._lastDts=t,this._lastTs=e}getDtsSlowTime(t,e){if(this._lastDts>0){let i=t-this._lastDts;return e-this._lastTs-i}return 0}get lastDts(){return this._lastDts}setJumpTime(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._jumpTime+=t,e&&o.default.log(`Timeline.setJumpTime name=${this._name} jumpTime=${t} totalJumpTime=${this._jumpTime}`)}reset(){this._startTs=0,this._startDts=0,this._lastDts=0}start(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];0===this._startTs&&(i&&o.default.log(`Timeline.start name=${this._name} dts=${e}`),this._startTs=t,this._startDts=e)}getTsTime(t){return Math.floor(t-this._startTs+this._jumpTime)}getDtsNow(t){return this._startDts+this.getTsTime(t)}isDtsLess(t,e){return e<this.getDtsNow(t)}},_=i(5);const g=eval,S=1,T=2,y=3,E=0,v=1,C=2,P=3,D=0,I=1,A=2,R=3,O=1,w=2,L=3,M=4,V=5,b=6,N=8,F=9,B=10,U=11,k=12,x=13,H=14,G=0,W=1,$=2,Y=3,K=4,j=5;var q=class{constructor(t){this.isUseEnhance=!1,this.aiEnhanceCfg=null,this.modelRes=null,this.isError=!1,this.isSuccess=!1,this.isInitSuccess=!1,this.segmentation=0,this.width=0,this.height=0,this.enhanceNums=0,this.lastEnhanceSecNums=0,this.videoRender=t,this.enhanceState=G,this.isUpdateVideoCfg=!1,this.costLargeCnt=0,this.enhanceCostList=[],this.enhanceLess30Nums=0,this.enhanceLess150Nums=0,this.enhanceLess200Nums=0,this.enhanceLarge200Nums=0,this.enhanceTotal=0,this.realFps=24,this.enhanceSecTs=0,this.modelHeight=0,this.playbackRate=1}resetState(){this.modelHeight=0,this.enhanceState=$,this.m_cEnhance&&this.m_cEnhance.release(),this.m_cEnhance=null}setRealFps(t){}initConfig(t){t&&(this.aiEnhanceCfg=t)}loadHatSdk(){if(!this.aiEnhanceCfg)return;if(this.enhanceState!=j&&this.enhanceState!=G)return;const t=this.aiEnhanceCfg,{modelRes:e,h5Root:i}=t;this.modelRes=e;const s=i+"hatsdk.min.js";o.default.log("VideoEnhance.initConfig",JSON.stringify(t),s),this.enhanceState=W,fetch(s).then(t=>t.text()).then(t=>{this.enhanceState=$,g(t),o.default.log("VideoEnhance.loadSuccess"),this.isUpdateVideoCfg&&this.init(this.width,this.height),self.hatsdk.setLogLevel(self.hatsdk.LoggerLevel.info),self.hatsdk.setLogCallback((function(t){o.default.log("hatSDKMsg",t)}))}).catch(t=>{console.error("VideoEnhance.loadError",t),this.handError(O)})}setEnhance(t){o.default.log("VideoEnhance.setEnhance",JSON.stringify(t));let e=t.data;this.isUseEnhance=!!e,this.isUseEnhance||(this.enhanceSecTs=0,this.isSuccess=!1,this.isError=!1),this.isUseEnhance&&(this.loadHatSdk(),this.enhanceState==K?this.handSuccess():this.enhanceState==j&&this.handError(L))}setSegmenttion(t){o.default.log("VideoEnhance.setSegmenttion",JSON.stringify(t));let e=t.data;this.segmentation=e}setPlaybackRate(t){o.default.log("VideoEnhance.setPlaybackRate,rate="+t),this.playbackRate=t}initCfg(t,e){this.width=t,this.height=e,this.isUpdateVideoCfg=!0,this.enhanceState==$&&this.init(this.width,this.height)}init(t,e){this.isUpdateVideoCfg&&this.enhanceState==$&&this.initMEnhance(e)}initMEnhance(t){if(!this.modelRes)return;let e=this.modelRes[t+"p"];e?(this.modelHeight=t,o.default.log("VideoEnhance.initMEnhance,modelHeight="+this.modelHeight),this.enhanceState!=Y&&(self.hatsdk&&self.hatsdk.CEnhance?(this.enhanceState=Y,this.m_cEnhance=new hatsdk.CEnhance,this.m_cEnhance.setEventCallback(this.enhanceEventHandle.bind(this)),this.m_cEnhance.init({modelUrl:e,isEncrypt:!0})):this.handError(L))):this.handError(w)}enhanceEventHandle(t,e){const i=e.status;switch(t){case S:o.default.log("VideoEnhance callback MODEL_INIT_STATUS: "+i),i==E?this.enhanceState=K:i==v?(this.enhanceState=j,this.isUseEnhance&&this.handError(L)):i==C?this.isUseEnhance&&this.handError(x):i==P&&this.isUseEnhance&&this.handError(H);break;case T:o.default.log("VideoEnhance callback WARMUP_STATUS: "+e.status);break;case y:o.default.log("VideoEnhance callback UNKNOWN_ERROR: "+e.status);let t=F;i==D?t=F:i==I?t=B:i==A?t=U:i==R&&(t=k),this.isUseEnhance&&this.handError(t)}}async enhance(t){if(this.enhanceTotal++,this.videoRender.setEnhanceTotal(this.enhanceTotal),this.playbackRate>1)return t;if(!this.m_cEnhance)return t;if(!this.isUseEnhance||this.enhanceState!==K)return t;if(this.videoRender.isBrowserHidden&&this.isUseEnhance)return this.enhanceCostList.push(0),this.enhanceLess30Nums++,this.videoRender.setEnhanceLess30Nums(this.enhanceLess30Nums),this.enhanceFrame(),t;const e=o.default.getNow();let i=t.displayHeight;if(0!=this.modelHeight&&i!=this.modelHeight)return o.default.log(`VideoEnhance.displayHeightChange, displayHeight=${codedHeight}, modelHeight=${this.modelHeight}`),this.resetState(),this.initMEnhance(i),t;const s=await this.m_cEnhance.run({videoFrame:t,segMode:2,segmentation:this.segmentation}),r=o.default.getNow()-e;return r>=50&&this.costLargeCnt++,this.costLargeCnt>=3&&this.handError(V),0==s.result?(this.enhanceCostList.push(r),r<=30?(this.enhanceLess30Nums++,this.videoRender.setEnhanceLess30Nums(this.enhanceLess30Nums)):r<=150?(this.enhanceLess150Nums++,this.videoRender.setEnhanceLess150Nums(this.enhanceLess150Nums)):r<=200?(this.enhanceLess200Nums++,this.videoRender.setEnhanceLess200Nums(this.enhanceLess200Nums)):(this.enhanceLarge200Nums++,this.videoRender.setEnhanceLarge200Nums(this.enhanceLarge200Nums)),this.enhanceFrame(),t.close(),s.videoFrame):(this.handError(M),t)}handError(t){if(this.isSuccess=!1,this.isError)return;const e={type:t};this.isError=!0,o.default.log("VideoEnhance enhance fail"),o.default.postMessage(d.ToMainMessageType.VIDEO_ENHANCE_ERROR,e),this.m_cEnhance&&(this.m_cEnhance&&this.m_cEnhance.release(),this.m_cEnhance=null)}enhanceFrame(){0==this.enhanceSecTs&&(this.enhanceSecTs=o.default.getNow()),this.enhanceNums++,this.videoRender.setEnhanceNums(this.enhanceNums),this.handSuccess()}handSuccess(){this.isSuccess||(this.isSuccess=!0,o.default.log("VideoEnhance enhance success",this.isUseEnhance),o.default.postMessage(d.ToMainMessageType.VIDEO_ENHANCE_SUCCESS))}onCheckTimer(t){if(!this.isError&&this.videoRender&&this.videoRender.player&&this.isSuccess){const t=this.videoRender.player.pageFps;if(0==t)return;t<40?this.lowFpsCnt++:t>=55&&(this.lowFpsCnt=0),this.lowFpsCnt>=5&&(this.handError(b),this.lowFpsCnt=0)}}rafHandler(t){this.isError}handleEnhanceError(){this.handError(N)}getEnhanceCostList(){let[...t]=this.enhanceCostList;return this.enhanceCostList.length=0,t}getEnhanceSuccess(){return this.isSuccess}close(){this.isError=!1,this.isSuccess=!1,this.enhanceNums=0,this.isUpdateVideoCfg=!1,this.costLargeCnt=0,this.enhanceCostList.length=0,this.lowFpsCnt=0,this.enhanceLess30Nums=0,this.enhanceLess150Nums=0,this.enhanceLess200Nums=0,this.enhanceLarge200Nums=0,this.enhanceTotal=0,this.m_cEnhance&&(this.m_cEnhance.release(),this.m_cEnhance=null)}};var z=class{constructor(t){this.player=t,this.videoGlWrap=null,this.framelist=[],this.currentDts=0,this.lastCurrentAudioDts=0,this.lastPic=null,this.lastRenderRafTime=0,this.lastRafNow=0,this.renderFps=0,this.videoCurrentDts=0,this.noVideoRender=!1,this.throwFps=0,this.curBitrate=0,this.ageneratorWriter=null,this.isTriggerPlay=!1,this.renderedFrameTs=0,this.printCnt=0,this.fastPlayEndDts=0,this.fastPlay=!1,this.checkLatencyTs=0,this.latencyRenderCnt=0,this.lastRenderTs=0,this.lastRenderPts=0,this.renderSecFps=0,this.videoRender5SecFpsList=[],this.timeline=new f("video_render"),this.isBrowserHidden=!1,this.isPaused=!1,this.videoEnhance=new q(this),this.isSync=!0}setNotSync(){this.isSync=!1,this.lastPic&&(this.startRenderTs=o.default.getNow()-30,this.firstTimeStamp=this.lastPic.timeStamp-30)}start(t,e,i,s){this.ageneratorWriter=i.getWriter()}seek(t){this.renderedFrameTs=0,this.framelist.map(t=>{this.closeVideoFrameInfo(t),this.setVieoCurrentDts(t.timeStamp)}),this.setVieoCurrentDts(t),this.framelist.length=0,this.isSeek=!0}setPlaybackRate(t){this.videoEnhance.setPlaybackRate(t)}onVideoSeek(){this.isSeek=!1}updateAVCConfig(t,e){this.videoEnhance.initCfg(t,e)}setEnhance(t){this.videoEnhance.setEnhance(t)}setSegmenttion(t){this.videoEnhance.setSegmenttion(t)}setRealFps(t){this.videoEnhance.setRealFps(t)}async renderVideo(t,e){if(this.checkSkipFrame(e),0==this.framelist.length)return;let i=this.framelist[0],s=this.getAudioDts(t);if(this.getIsRender(s,i)){this.lastPic=i,this.renderFps++,this.setVieoCurrentDts(i.timeStamp);const t=i.timeStamp-this.renderedFrameTs;0!=this.renderedFrameTs&&t>500&&o.default.log("VideoRender.renderVideo dis large, dis="+t),this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_RENDER_NUMS,this.renderFps),this.lastRenderRafTime=e,this.framelist.shift();let s=i.frame;this.renderedFrameTs=i.timeStamp,this.player.avRenderSync.setRenderVideoTs(e),this.timeline.setLast(i.timeStamp,e),this.noVideoRender?s.close():(l.a.printTorenderVideo&&o.default.log(`VideoRender.renderVideo timeStamp=${i.timeStamp} ptsNow=${this.timeline.getDtsNow(e)} frames=${this.framelist.length}`),s=await this.videoEnhance.enhance(s),this.latencyRenderCnt++,this.ageneratorWriter.write(s).then(()=>{s.close()}).catch(t=>{o.default.postMessage(d.ToMainMessageType.VIDEORENDERERROR),s.close()}),o.default.postMessage(d.ToMainMessageType.WebGLPLAY),this.checkPause(),this.isTriggerPlay||(this.startRenderTs=e,this.firstTimeStamp=i.timeStamp,this.isTriggerPlay=!0)),this.renderedFrameTs=i.timeStamp}}onCheckTimer(t){if(0!=this.renderSecFps){const t=this.renderFps-this.renderSecFps;this.videoRender5SecFpsList.length>=5&&this.videoRender5SecFpsList.shift(),this.videoRender5SecFpsList.push(t)}this.renderSecFps=this.renderFps,this.videoEnhance.onCheckTimer(t)}checkPause(){if(this.player.userPaused)return;const t=this.getCurrentDts(),e=o.default.getNow();if(this.isBrowserHidden)this.isPaused&&(o.default.postMessage(d.ToMainMessageType.SET_FRMAE_RESUME),this.isPaused=!1);else if(0!=this.lastRenderPts&&0!=this.lastRenderTs){let i=t-this.lastRenderPts,s=e-this.lastRenderTs;const r=s-i,a=this.videoRender5SecFpsList.length;let n=!1;if(a>=5){n=this.videoRender5SecFpsList.reduce((t,e)=>t+e,0)/a<=10}s-i>200||i>300&&s>200?(o.default.log(`VideoRender.mobPaused tsDelta:${s} ptsDelta:${i} delta:${r}`),o.default.postMessage(d.ToMainMessageType.SET_FRAME_PAUSE),this.isPaused=!0):this.isPaused&&(o.default.postMessage(d.ToMainMessageType.SET_FRMAE_RESUME),this.isPaused=!1),n&&o.default.postMessage(d.ToMainMessageType.RENDER_FPS_PAUSE)}this.lastRenderTs=e,this.lastRenderPts=t}getBufferLen(){return this.player.getBufferLen()}checkSkipFrame(t){let e=this.player.latencyCfg;if(e.latencyMode){let i=this.player.getBufferLen(),s=this.framelist.length;if(i>=e.latencyBuf&&s>0){if(0===this.checkLatencyTs)this.checkLatencyTs=t;else if(t-this.checkLatencyTs>2e3&&this.latencyRenderCnt%e.skipFrameGap==0){let i=this.framelist[0];this.timeline.isDtsLess(t,i.timeStamp)&&(l.a.printRenderSkipFrame&&o.default.log(`VideoRender.checkLatencySkip skipFrameGap=${e.skipFrameGap} renderCnt=${this.latencyRenderCnt} frames=${s} skipDts=${i.timeStamp}`),this.framelist.shift(),this.timeline.setJumpTime(i.timeStamp-this.timeline.lastDts+1,!1),i.frame.close())}}else this.checkLatencyTs=0}}setVieoCurrentDts(t){this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_PTS,t),this.videoCurrentDts=t,this.player.decodeJitter.onRenderVideo(t)}getAudioCurrentDts(){return self.mainSharedArrayBuffer?Atomics.load(self.mainSharedArrayBuffer,_.e.AUDIO_DTS):0}rafHandler(t){let e=this.getAudioCurrentDts();this.curBitrate>=4e3&&this.throwFrame(e),this.renderVideo(e,t),this.lastRafNow=t,this.videoEnhance.rafHandler(t)}getRealFps(){return self.mainSharedArrayBuffer?Atomics.load(self.mainSharedArrayBuffer,_.a.VIDEO_REAL_FPS):0}getDecodedBuffer(){let t=this.getRenderBuffer();return this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_NOT_RENDERD_BUFFER,t),t}getRenderBuffer(){let t=0;return this.framelist.length>0&&(t=null==this.lastPic?0:this.framelist[this.framelist.length-1].timeStamp-this.lastPic.timeStamp),t}throwFrame(t,e){let i=!1;if(0!=this.framelist.length)for(;!i&&this.framelist.length>=2;){if(!(t-this.framelist[0].timeStamp>=200)){i=!0;break}{let t=this.framelist.shift();this.throwFps++,this.setVieoCurrentDts(t),this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_THROW_FRAME_FPS,this.throwFps),t.frame.close()}}}getAudioDts(t){if(!this.isSync)return 0;let e=o.default.getNow(),i=0;return 0!=this.lastRafNow&&(i=e-this.lastRafNow),0==t?this.currentDts=0:t!=this.lastCurrentAudioDts?this.currentDts=t:this.currentDts+=i,this.lastCurrentAudioDts=t,this.currentDts}setJump(t){this.timeline.setJumpTime(t)}getIsRender(t,e){let i=o.default.getNow(),s=!1;if(null==this.lastPic)s=!0,this.timeline.start(i,e.timeStamp);else if(this.player.latencyCfg.latencyMode)this.timeline.isDtsLess(i,e.timeStamp)&&(s=!0);else if(null!=this.lastPic&&0==t){let t=this.lastPic.timeStamp,r=e.timeStamp,a=i-this.startRenderTs,o=e.timeStamp-this.firstTimeStamp;a>=o?(s=!0,a-o>100&&(this.startRenderTs=i,this.firstTimeStamp=e.timeStamp)):r-t>100&&(s=!0,this.startRenderTs=i,this.firstTimeStamp=e.timeStamp)}else 0!=t&&t>=e.timeStamp?s=!0:0!=t&&e.timeStamp;return s}appendFrame(t){return this.isSeek?(this.closeVideoFrameInfo(t),this.setVieoCurrentDts(t.timeStamp),void(this.lastPic=null)):t.timeStamp<this.renderedFrameTs?(o.default.log("VideoRender.appendFrame, frame timeStamp too small and  drop frame,rendered frame ts="+this.renderedFrameTs+",now ts="+t.timeStamp),void this.closeVideoFrameInfo(t)):(this.framelist.push(t),void this.framelist.sort((t,e)=>t.timeStamp>e.timeStamp?1:-1))}updateCanvasRect(t,e){this.videoGlWrap.updateCanvasRect(t,e)}updateRect(t,e){this.videoGlWrap.updateRect(t,e)}getCurrentDts(){return this.videoCurrentDts}setNoRender(){o.default.log("VideoRender.setNoRender"),this.noVideoRender=!0}updateCurBitrate(t){this.curBitrate=t}closeVideoFrameInfo(t){t.frame.close(),t=null}setBrowserHidden(t){this.isBrowserHidden=t}initConfig(t){this.videoEnhance.initConfig(t)}setEnhanceNums(t){this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_ENHANCE_NUMS,t)}setEnhanceLess30Nums(t){this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_ENHANCE_LESS30_NUMS,t)}setEnhanceLess150Nums(t){this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_ENHANCE_LESS150_NUMS,t)}setEnhanceLess200Nums(t){this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_ENHANCE_LESS200_NUMS,t)}setEnhanceLarge200Nums(t){this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_ENHANCE_LARGE200_NUMS,t)}setEnhanceTotal(t){this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_ENHANCE_TOTAL,t)}getEnhanceCostList(){return this.videoEnhance.getEnhanceCostList()}getEnhanceSuccess(){return this.videoEnhance.getEnhanceSuccess()}handleEnhanceError(){this.videoEnhance.handleEnhanceError()}getVideoRenderPts(){return this.renderedFrameTs}setLastPic(t){this.lastPic=t}close(){this.currentDts=0,this.lastCurrentAudioDts=0,this.framelist.map(t=>{this.closeVideoFrameInfo(t)}),this.lastPic=null,this.lastRafNow=0,this.renderFps=0,this.throwFps=0,this.videoCurrentDts=0,this.noVideoRender=!1,this.curBitrate=0,this.isTriggerPlay=!1,this.isBrowserHidden=!1,this.isPaused=!1,this.videoEnhance.close()}};var J=class{constructor(t){this.player=t,this.audioDuration=0,this.framelist=[],this.ageneratorWriter=null,this.frameDuration=23,this.audioSampleRate=44100,this.isTriggerPlay=!1,this.lastRenderStamp=0,this.lastRenderNow=0,this.audioCurrentDts=0,this.renderNums=0,this.lastFrame=null,this.firstFrameRenderWriting=!1,this.firstFinshed=!1,this.startRenderTs=0,this.firstTimeStamp=0,this.totalLocalTime=0,this.decodeTotolTime=0,this.decodeTimeStamp=0,this.timeline=new f("audio_render")}setJump(t){this.timeline.setJumpTime(t)}start(t){this.ageneratorWriter=t.getWriter()}updateAACSampleRate(t){this.audioSampleRate=t,this.frameDuration=Math.floor(1024e3/t),o.default.log("AudioRender.updateAACSampleRate, frameDuration=",this.frameDuration)}onQuickCheckTimer(t){if(this.player.latencyCfg.latencyMode&&this.player.latencyCfg.latencyMode.latencyBuf>0){if(this.framelist.length>0){let e=this.framelist[0];this.timeline.start(t,e.timeStamp),this.player.setRenderAudioTs(t,this.timeline),l.a.printTorenderAudio&&o.default.log(`AudioRender.toRender timeline dts=${e.timeStamp} dtsNow=${this.timeline.getDtsNow(t)}`),this.timeline.isDtsLess(t,e.timeStamp)&&(this.timeline.setLast(e.timeStamp,t),this.framelist.shift(),o.default.postMessage(d.ToMainMessageType.AUDIO_FRAME_DECODED,e))}}if(this.ageneratorWriter&&this.framelist.length>0){let e=this.framelist[0],i=e.frame;this.getIsRender(e,t)&&(this.render(i,t,e),this.framelist.shift(),this.renderNums++,this.setAudioRenderNums(),this.lastRenderStamp=e.timeStamp,this.lastRenderNow=t,this.lastFrame=e,this.setAudioCurrentDts(e.timeStamp))}}getIsRender(t){let e=o.default.getNow();if(null==this.lastFrame)return!0;{let i=e-this.lastRenderNow,s=t.timeStamp-this.lastFrame.timeStamp;if(e-this.startRenderTs>=t.timeStamp-this.firstTimeStamp)return!0;if(i>2*this.frameDuration&&s>2*this.frameDuration)return this.startRenderTs=e,this.firstTimeStamp=t.timeStamp,!0}}render(t,e,i){return this.audioDuration+=t.duration/1e3,this.ageneratorWriter.ready.then(()=>this.ageneratorWriter.write(t)).then(()=>{t.close(),this.isTriggerPlay||(this.isTriggerPlay=!0,o.default.postMessage(d.ToMainMessageType.AUDIO_PLAY),this.startRenderTs=e,this.firstTimeStamp=i.timeStamp)}).catch(e=>{console.error(e),t.close(),o.default.postMessage(d.ToMainMessageType.AUDIORENDERERROR)}),!0}setAudioCurrentDts(t){this.audioCurrentDts=t,this.player.storeWorkerShared(d.StoreWorkerType.AUDIO_DTS,this.audioCurrentDts)}getDecodedBuffer(){return 0!=this.decodeTimeStamp&&0!=this.audioCurrentDts?this.decodeTimeStamp-this.audioCurrentDts:0}setAudioRenderNums(){this.player.storeWorkerShared(d.StoreWorkerType.AUDIO_RENDER_NUMS,this.renderNums)}getAudioCurrentDts(){let t=self.mainSharedArrayBuffer?Atomics.load(self.mainSharedArrayBuffer,d.StoreWorkerType.AUDIO_DTS):0;return this.audioCurrentDts=t,this.audioCurrentDts}setLastAudioData(t){this.setAudioCurrentDts(t.timeStamp)}onFrameDecoded(t){this.decodeTimeStamp=t.timeStamp,this.ageneratorWriter?this.appendFrame(t):this.sentAudioFrameData(t)}sentAudioFrameData(t){if(-1==t.frame.format.indexOf("32"))return void o.default.postMessage(d.ToMainMessageType.AUDIO_FORMAT_ERROR);let e=t.frame.numberOfChannels,i=[];for(let s=0;s<e;s++){let e=t.frame.allocationSize({planeIndex:s});const r=new ArrayBuffer(e);t.frame.copyTo(r,{planeIndex:s}),i.push(r)}let s=t.frame.allocationSize({planeIndex:0});const r=new ArrayBuffer(s);t.frame.copyTo(r,{planeIndex:0});let a={timeStamp:t.timeStamp,frameBuffer:r,frameBuffers:i,isEmptyAudioFrame:t.isEmptyAudioFrame,format:t.frame.format};this.player.latencyCfg.latencyMode&&this.player.latencyCfg.latencyMode.latencyBuf>0?this.framelist.push(a):(l.a.printTorenderAudio&&o.default.log("AudioRender.toRender rightnow dts="+a.timeStamp),o.default.postMessage(d.ToMainMessageType.AUDIO_FRAME_DECODED,a))}appendFrame(t){this.framelist.push(t)}appendFrames(t){for(;t.length>0;)this.framelist.push(t.shift())}seek(t){this.audioCurrentDts=0,this.decodeTimeStamp=0,this.setAudioCurrentDts(t)}close(){this.framelist.length=0,this.isTriggerPlay=!1,this.audioCurrentDts=0,this.renderNums=0,this.lastFrame=null,this.firstFrameRenderWriting=!1,this.firstFinshed=!1,this.startRenderTs=0,this.firstTimeStamp=0,this.decodeTimeStamp=0}};class Q{constructor(t){this._decodeHelper=t,this._decodeJitter=t.getDecodeJitter(),this._type="",this._initType(),this._timeline=new f(this._type+"_decode"),this._timelineSlow=new f(this._type+"_decode_slow"),this._state=X.FAST_DOING,this._fastBuf=0,this._waitKeyFrameTs=0,this._waitKeyFramePostTs=0}get jitBuf(){return this._decodeJitter.player.latencyCfg.latencyBuf}get jitMin(){return this._decodeJitter.player.latencyCfg.latencyMin}get jitMax(){return this._decodeJitter.player.latencyCfg.latencyMax}get isNoGop(){return this._decodeJitter.player.latencyCfg.isNoGop}_initType(){}setFastEnding(){o.default.log("MediaDecodeHelper.setFastEnding type="+this._type),this._state=X.FAST_ENDING}setNormal(){o.default.log("MediaDecodeHelper.setNormal type="+this._type),this._timelineSlow.reset(),this._state=X.NORMAL}setSlow(){o.default.log("MediaDecodeHelper.setSlow type="+this._type),this._state=X.SLOW}setWaitKeyFrame(){o.default.log("MediaDecodeHelper.setWaitKeyFrame type="+this._type),this._state=X.WAIT_KEY_FRAME,this._waitKeyFrameTs=o.default.getNow()}isWaitForKeyFrame(){return this._state===X.WAIT_KEY_FRAME}checkDecode(t){let e=this._getSamples();if(e.length>0){let i=e[0];this._timeline.start(t,i.timeStamp),this._state===X.FAST_DOING?this._decodeInFastDoing(t,i):this._state===X.FAST_ENDING?this._decodeInFastEnding(t,i):this._state===X.NORMAL?this._decodeInNormal(t,i):this._state===X.SLOW?this._decodeInSlow(t,i):this._state===X.WAIT_KEY_FRAME&&this._decodeInWaitKeyFrame(t,i)}}_decodeInFastDoing(t,e){this._todecode(t,e)}_decodeInFastEnding(t,e){}_getWillDecodeBuffer(){let t=this._getSamples(),e=t.length,i=0,s=0;return e>0&&(i=t[e-1].timeStamp,s=this._timeline.lastDts),i-s}_decodeInNormal(t,e){if(0===this.jitBuf)this._decode(t,e);else{let i=this._timeline.getDtsSlowTime(e.timeStamp,t);i>=500?(o.default.log(`MediaDecodeHelper._decodeInNormal type=${this._type} sample slow dtsSlowTime=${i} dts=${e.timeStamp} samples=${this._getSamples().length}`),this.setSlow(),this._timelineSlow.start(t,e.timeStamp),this._todecodeSlow(t,e)):0===this.jitBuf?this._decode(t,e):this._todecode(t,e)}}_decodeInSlow(t,e){let i=this._getSamples(),s=this._findNextSample(t,i);if(-1!==s){let e=i[s],r=i[0],a=i[i.length-1];e.timeStamp-r.timeStamp<1e3&&this._decodeAllSlowSamples(t,i,s),o.default.log(`MedisDecodeHelper._decodeInSlow type=${this._type} done cur=${e.timeStamp} first=${r.timeStamp} last=${a.timeStamp} lateBuf=${e.timeStamp-r.timeStamp} buffer=${a.timeStamp-e.timeStamp}`),this._setSamples(i.slice(s)),this.setNormal()}else this._todecodeSlow(t,e)}_decodeAllSlowSamples(t,e,i){}_findNextSample(t,e){let i=e.length;if(i>0)for(let s=0;s<i;s++){let i=e[s];if((this._type!==Q.Types.VIDEO||i.isKeyFrame)&&!this._timeline.isDtsLess(t,i.timeStamp))return s}return-1}_findLastSample(t,e,i,s){let r=e.length;if(r>0){let a=e[r-1];for(let o=r-1;o>=0;o--){let r=e[o];if(this._type!==Q.Types.VIDEO||r.isKeyFrame){let e=a.timeStamp-r.timeStamp;if(i<=e&&e<=s&&!this._timeline.isDtsLess(t,r.timeStamp))return o}}}return-1}_decodeInWaitKeyFrame(t,e){(0===this._waitKeyFramePostTs||t-this._waitKeyFramePostTs>500)&&(this._waitKeyFramePostTs=t,o.default.postMessage(d.ToMainMessageType.WAIT_KEY_FRAME,t-this._waitKeyFrameTs))}_todecode(t,e){this._timeline.isDtsLess(t,e.timeStamp)&&this._decode(t,e)}_todecodeSlow(t,e){this._timelineSlow.isDtsLess(t,e.timeStamp)&&this._decode(t,e)}_decode(t,e){}_getSamples(){return[]}_setSamples(t){}}const X={FAST_DOING:1,FAST_ENDING:2,NORMAL:3,SLOW:4,WAIT_KEY_FRAME:5};Q.Types={VIDEO:"video",AUDIO:"audio"};var Z=Q;var tt=class extends Z{constructor(t){super(t)}_initType(){this._type=Z.Types.VIDEO}_getSamples(){return this._decodeJitter.videoSamples}_setSamples(t){this._decodeJitter.videoSamples=t}_decodeInFastEnding(t,e){let i=this._getWillDecodeBuffer();i<=this.jitBuf?(this._todecode(t,e),this.setNormal(),o.default.log(`MediaDecodeHelper._decodeInFastEnding type=${this._type} fastEnding to normal buffer=${i}`)):this._lookupBuffer(t,e,i)}_lookupBuffer(t,e,i){let s=this._getSamples(),r=this._findLastSample(t,s,this.jitMin,this.jitMax,!0);if(-1!==r){let e=s[r],a=s[s.length-1].timeStamp-e.timeStamp;if(a===this.jitBuf){let n=s[0];o.default.log(`VideoDecodeHelper._lookupBuffer done firstDts=${n.timeStamp} buffer=${a}`),this._setSamples(s.slice(r)),this._updateJump(t,n.timeStamp,e.timeStamp,i),this._decode(t,e)}else this._fixToJitBuf(t,s,r,i);this.setNormal()}else this._todecode(t,e)}_fixToJitBuf(t,e,i,s){let r=e.length,a=e[0],n=e[i],h=e[r-1],d=h.timeStamp,l=r-1;for(let s=i;s<r;s++){let i=e[s];if(0===this.jitBuf)this._decodeJitter._decodeVideoSample(i,t);else{if(h.timeStamp-i.timeStamp<=this.jitBuf){d=i.timeStamp,l=s;break}this._decodeJitter._decodeVideoSample(i,t)}}o.default.log("VideoDecoderHelper._fixToJitBuf fitBuf="+(d-n.timeStamp)),this._setSamples(0===this.jitBuf?[]:e.slice(l)),this._updateJump(t,a.timeStamp,d,s)}_updateJump(t,e,i,s){let r=i-e;this._timeline.setJumpTime(r),this._timeline.setLast(i,t),this._decodeHelper.onVideoJump(t,{jumpTime:r}),this._fastBuf=this._getWillDecodeBuffer(),o.default.log(`VideoDecodeHelper._updateJump jumpTime=${r} jumpStartDts=${e} endDts=${i} before=${s} after=${this._fastBuf}`)}_decodeAllSlowSamples(t,e,i){for(let s=0;s<i;s++){let i=e[s];this._decodeJitter._decodeVideoSample(i,t)}}_decodeInWaitKeyFrame(t,e){super._decodeInWaitKeyFrame(t,e);let i=this._getSamples();if(e.isKeyFrame)this.setNormal();else{let t=i.length,s=-1;for(let r=0;r<t;r++){let t=i[r];if(t.isKeyFrame){e=t,s=r;break}}-1!==s?(i=i.slice(s),this.setNormal()):(e=null,i=[]),this._setSamples(i)}}_decode(t,e){this._timeline.setLast(e.timeStamp,t),this._decodeJitter._decodeVideoSample(e,t),this._decodeJitter.videoSamples.shift()}};var et=class extends Z{constructor(t){super(t),this._jumpEndDts=0}_initType(){this._type=Z.Types.AUDIO}_getSamples(){return this._decodeJitter.audioSamples}_setSamples(t){this._decodeJitter.audioSamples=t}setJump(t){this._timeline.setJumpTime(t),this._jumpEndDts=this._timeline.lastDts+t}_decodeInFastEnding(t,e){if(this._jumpEndDts>0){let t=this._getSamples(),e=t.length;if(e>0){let i=t[0],s=t[e-1],r=-1,a=null;for(let i=0;i<e;i++){let e=t[i];if(e.timeStamp>=this._jumpEndDts){r=i,a=e;break}}-1!==r&&(this._jumpEndDts=0,t=t.slice(r),o.default.log(`AudioDecodeHelper._decodeInFastEnding done firstDts=${i.timeStamp} endDts=${a.timeStamp}  lastDts=${s.timeStamp} before=${s.timeStamp-i.timeStamp} after=${s.timeStamp-a.timeStamp} dropBuffer=${a.timeStamp-i.timeStamp}`),this._setSamples(t),this.setNormal())}}else this._todecode(t,e)}_decodeAllSlowSamples(t,e,i){for(let s=0;s<i;s++){let i=e[s];this._decodeJitter._decodeAudioSample(i,t)}}_decode(t,e){this._timeline.setLast(e.timeStamp,t),this._decodeJitter._decodeAudioSample(e,t),this._decodeJitter.audioSamples.shift()}};var it=class{constructor(t){this._decodeJitter=t,this._lastTodecodeDts=0,this._lastTodecodeTs=0,this._waitKeyFrameTs=0,this._waitKeyFramePostTs=0}checkDecode(t,e,i){let s=this._decodeJitter.videoSamples;if(this._waitKeyFrameTs>0)this._waitForKeyFrame(t,s);else if(s.length>0){let r=s[0];(i<2||t-this._lastTodecodeTs>=r.timeStamp-this._lastTodecodeDts)&&(s.shift(),this._lastTodecodeDts=r.timeStamp,this._lastTodecodeTs=t,l.a.printVideoDecodeFast&&o.default.log(`VideoDecodeFastHelper.checkDecode dts=${r.timeStamp} samples=${s.length} videoDecodedFrames=${e} queueSize=${i}`),this._decodeJitter._decodeVideoSample(r,o.default.getNow()))}}_waitForKeyFrame(t,e){if((0===this._waitKeyFramePostTs||t-this._waitKeyFramePostTs>500)&&(this._waitKeyFramePostTs=t,o.default.postMessage(d.ToMainMessageType.WAIT_KEY_FRAME,t-this._waitKeyFrameTs)),e.length>0){let t=e.length,i=-1;for(let s=0;s<t;s++){if(e[s].isKeyFrame){i=s;break}}-1!==i?(e=e.slice(i),this._waitKeyFrameTs=0):e=[],this._decodeJitter.videoSamples=e}}setWaitKeyFrame(){o.default.log("VideoDecodeFastHelper.setWaitKeyFrame"),this._waitKeyFrameTs=o.default.getNow()}isWaitForKeyFrame(){return this._waitKeyFrameTs>0}};var st=class{constructor(t){this._decodeJitter=t}checkDecode(t){let e=this._decodeJitter.audioSamples;if(e.length>0){let t=e.shift();this._decodeJitter._decodeAudioSample(t)}}};var rt=class{constructor(t){this._decodeJitter=t,this._videoHelper=new tt(this),this._audioHelper=new et(this),this._videoFastHelper=new it(t),this._audioFastHelper=new st(t)}getDecodeJitter(){return this._decodeJitter}decodeLowlatency(t,e){let i=o.default.getNow();this._decodeJitter.player.latencyCfg.fastMode?(this._videoFastHelper.checkDecode(i,t,e),this._audioFastHelper.checkDecode(i)):(this._videoHelper.checkDecode(i),this._audioHelper.checkDecode(i))}onVideoJump(t,e){let{jumpTime:i}=e;this._audioHelper.setJump(i),this._decodeJitter.player.audioRender.setJump(i),this._decodeJitter.player.videoRender.setJump(i)}fastAccessOver(){o.default.log("DecodeHelper.fastAccessOver"),this._videoHelper.setFastEnding(),this._audioHelper.setFastEnding()}setNormal(){this._videoHelper.setNormal(),this._audioHelper.setNormal()}updateSoftAcceleration(){this._videoHelper.setWaitKeyFrame(),this._videoFastHelper.setWaitKeyFrame()}isWaitForKeyFrame(){return this._decodeJitter.player.latencyCfg.fastMode?this._videoFastHelper.isWaitForKeyFrame():this._videoHelper.isWaitForKeyFrame()}};const at=1,ot=2;var nt=class{constructor(t){this.player=t,this.videoSamples=[],this.audioSamples=[],this.audioFrameDecodedQueueLimit=10,this.lastDecodedVideoTimeStamp=0,this.lastToDecodAudioTimeStamp=0,this.lastJumpBufferAudioTimeStamp=0,this.videoFPS=0,this.noReferFps=0,this.discardVideoTSGap=60,this.decodeAudioQueueTime=1e3,this.decodeVideoQueueTime=100,this.discardFrameDecodeDelay=200,this.lastToDecodeTimeStamp=0,this.minBuffer=2e3,this.videoToDecodedLocalTime=0,this.firstVideoTs=0,this.videoToDecodedTime=0,this.isFirstAudioStamp=0,this.discardNums=0,this.lastVideoDiscardNums=0,this.JITTER_BUFLEN=0,this.JITTER_BUFMIN=0,this.JITTER_BUFMAX=0,this.jumpBufferCfg=[120,1e3,1e4,5e3,120,25],this.JUMP_BUFFER=0,this.startPlayTime=0,this.isStartBuffer=!0,this.setVideoCurrentTime=0,this.startMoreBufferTime=0,this.bufferMoreContinueTime=1e3,this.isPauseVideoDecode=!1,this.isPauseAudioDecode=!1,this.isEnableDiscard=!1,this.isSoftWebcodecs=!1,this.decode10SecCostList=[],this.videoMaxCts=0,this.decodeVideoQueueTimeToCtsMaxGap=100,this.decodeVideoQueueTimeMax=350,this.outputFrameByPts=!1,this.decodeVideoQueueTimeDefault=100,this.lastVideoStamp=0,this.lastAudioStamp=0,this.recvMap=new Map,this.lastAppendVideoPts=0,this.firstVideoDts=0,this.fastDecodeTime=500,this.realFps=0,this.shieldAudioCfgBufLen=3e3,this.isRemuxBuf=!1,this.isRevFastOver=!1,this._helper=new rt(this),this.isLive=!0,this.seekVideoDts=0,this.isVideoSeek=!1,this.isAudioSeek=!1}fastOver(){this.player.latencyCfg.latencyMode&&this._helper.fastAccessOver()}onRevFastOver(){this.isRevFastOver=!0}seek(t,e){o.default.log("DecodeJitter.seek",t),this.isVideoSeek=!0,this.isAudioSeek=!0,this.seekVideoDts=e,this.audioSamples.length=0,this.videoSamples.length=0,this.firstVideoDts=0,this.isFirstAudioStamp=0,this.lastAppendVideoPts=0}onVideoSeek(){}onAudioSeek(){}setJitter(t){this.JITTER_BUFLEN=t.bufLen,this.JITTER_BUFMIN=t.bufMin,this.JITTER_BUFMAX=t.bufMax,this.jumpBufferCfg=t.jumpBufferCfg,this.shieldAudioCfgBufLen=t.shieldAudioCfgBufLen,this.isRemuxBuf=t.isRemuxBuf,o.default.log(`WebCodecsWorkerPlayer.setJitter bufMin=${t.bufMin} bufLen=${t.bufLen} bufMax=${t.bufMax} jumpBufferCfg=${this.jumpBufferCfg.toString()} shieldAudioCfgBufLen=${this.shieldAudioCfgBufLen} isRemuxBuf=${this.isRemuxBuf}`)}setLive(t){this.isLive=t}setVideoOutputByPts(t){this.outputFrameByPts=t,this.outputFrameByPts&&(this.decodeVideoQueueTime=this.decodeVideoQueueTimeDefault)}updateVideoCts(t){!this.outputFrameByPts&&t>this.videoMaxCts&&(this.videoMaxCts=t,this.decodeVideoQueueTime=Math.max(this.decodeVideoQueueTime,this.videoMaxCts+this.decodeVideoQueueTimeToCtsMaxGap),this.decodeVideoQueueTime=Math.min(this.decodeVideoQueueTime,this.decodeVideoQueueTimeMax),o.default.log(`WebCodecsWorkerPlayer.updateVideoCts videoMaxCts=${this.videoMaxCts} decodeAudioQueueTime=${this.decodeVideoQueueTime} `))}setStartPlayTime(t){this.startPlayTime=t}setPlayMinBuffer(t){this.minBuffer=t}decodeThread(t,e,i,s){if(this.player.latencyCfg.latencyMode)return void this._helper.decodeLowlatency(this.player.videoRender.framelist.length,s);let r=o.default.getNow(),a=this.player.audioDecoderReadyed&&!this.isAudioSeek,n=this.audioSamples.length>0,h=!this.isPauseAudioDecode,l=t<this.decodeAudioQueueTime;const u=Atomics.load(self.mainSharedArrayBuffer,d.StoreWorkerType.AUDIO_RENDER_NUMS),c=~~(Atomics.load(self.mainSharedArrayBuffer,d.StoreWorkerType.AUDIO_WORKER_UN_RENDER_AUDIO_FRAMES)*this.player.getAacTimeLen());u>0&&!this.isLive&&(l=l||c<this.decodeAudioQueueTime);this.player.getAudioCurrentDts();a&&l&&n&&h&&this.decodeAudioSamples(),this.isVideoSeek||(this.newDiscardVideoFrame(),this.player.videoDecoderReadyed&&this.videoSamples.length>0&&!this.isPauseVideoDecode&&(this.decodeVideoSamples(e,r,i,s),this.jumpBuffers(r)))}onCheckTimer(){this.checkTurnToSoft()}checkTurnToSoft(){if(this._helper.isWaitForKeyFrame())return;let t=5;this.isLive||(t=20);let e=this.player.delayDecode;if(this.decode10SecCostList.length>=t&&this.decode10SecCostList.shift(),this.decode10SecCostList.push(e),this.decode10SecCostList.length<t)return;let i=!0;this.decode10SecCostList.forEach(t=>{t<2e3&&(i=!1)}),this.player.getEnhanceSuccess()?i&&(this.player.handleEnhanceError(),this.decode10SecCostList.length=0):this.isSoftWebcodecs?i&&this.player.turnToMse():i&&this.player.turnToWebcodecsSoft()}decodeAudioSamples(){let t=this.audioSamples.shift();t.timeStamp&&(this.lastToDecodAudioTimeStamp=t.timeStamp,this._decodeAudioSample(t))}_decodeAudioSample(t){this.player.toDecodeFrame(t)}decodeVideoSamples(t,e,i,s){const r=this.decodeVideoQueueTime,a=(this.lastToDecodAudioTimeStamp,this.player.getVideoCurrentDts());this.player.getAudioCurrentDts();let o=0;if(this.realFps>0&&(o=Math.floor(1e3/this.realFps)),t<r&&(s<2||(0!=o&&e-this.videoToDecodedTime)>=o)){let t=this.videoSamples.shift();this._decodeVideoSample(t,e)}}_decodeVideoSample(t,e){this.lastToDecodeTimeStamp=t.timeStamp,this.player.toDecodeFrame(t),0==this.videoToDecodedLocalTime&&(this.videoToDecodedLocalTime=e),this.videoToDecodedTime=e}updateAACSampleRate(t){this.audioSampleRate=t,this.frameDuration=1024e3/t,this.audioFrameDecodedQueueLimit=Math.ceil(this.decodeAudioQueueTime/this.frameDuration)}getBufferLength(t){if(this.isRemuxBuf&&self.mainSharedArrayBuffer){return Atomics.load(self.mainSharedArrayBuffer,d.MainSharedBufferType.LAST_VIDEO_RCV_TS)-t}if(this.isLive){if(this.lastAppendVideoPts>0&&t>0)return this.lastAppendVideoPts-t}else if(this.lastAppendVideoPts>0)return this.lastAppendVideoPts-t;return 0}getWillDecodeVBuf(){return 0==this.videoSamples.length?0:1==this.videoSamples.length?33:this.videoSamples.length>1?this.videoSamples[this.videoSamples.length-1].timeStamp-this.videoSamples[0].timeStamp:0}getAudioBufferLength(t){return 0==t?this.audioSamples.length>1?this.videoSamples[this.audioSamples.length-1].timeStamp-this.audioSamples[0].timeStamp:0:this.audioSamples.length>0?this.audioSamples[this.audioSamples.length-1].timeStamp-t:0}jumpBuffers(t){if(!this.isLive)return;const e=this.player.getVideoCurrentDts();let i=t,s=this.getBufferLength(e),r=s-this.JITTER_BUFLEN,a=!1;self.mainSharedArrayBuffer&&(a=1==Atomics.load(self.mainSharedArrayBuffer,d.MainSharedBufferType.IS_SHIELD_AUDIO));const o=this.jumpBufferCfg[1],n=this.jumpBufferCfg[3],h=1e3*this.jumpBufferCfg[4],l=1e3*this.jumpBufferCfg[5];if(a){let t=(self.mainSharedArrayBuffer?Atomics.load(self.mainSharedArrayBuffer,d.MainSharedBufferType.FRAME_BUFFER_LEN):0)+s;const e=this.JITTER_BUFLEN+this.shieldAudioCfgBufLen,i=this.JITTER_BUFLEN;if(r=t-e,r<=0)return;if(s-r<i&&(r=s-i),r<0)return}if(!(i-this.startPlayTime<n))if(this.isStartBuffer){if(r>=o&&(this.isRevFastOver||i-this.startPlayTime>=l)){this.setJumpBuffer(r,s,at,e,t,a)&&(this.isStartBuffer=!1)}}else if(i-this.setVideoCurrentTime>=h||0==this.setVideoCurrentTime){if(i-this.startMoreBufferTime>=this.bufferMoreContinueTime&&0!=this.startMoreBufferTime){if(this.setJumpBuffer(r,s,ot,e,t,a))return void(this.startMoreBufferTime=0)}r>=o?0==this.startMoreBufferTime&&(this.startMoreBufferTime=i):this.startMoreBufferTime=0}}setJumpBuffer(t,e,i,s,r,a){let n=!1;if(self.mainSharedArrayBuffer&&(n=1==Atomics.load(self.mainSharedArrayBuffer,d.MainSharedBufferType.BROWSER_PAUSE_STATUS)),0==this.videoSamples.length)return!1;if(0==this.audioSamples.length&&!n)return;const h=this.videoSamples.length,l=this.player.getVideoDecodedBuffer(),u=this.player.getVideoDecodingBuffer();let c=0,p=0,m=0,f=0,_=this.videoSamples[0].timeStamp;if(n)m=0;else if(this.videoSamples[0].timeStamp<this.audioSamples[0].timeStamp){for(let t=0;t<h;t++)if(this.videoSamples[t].timeStamp>=this.audioSamples[0].timeStamp){_=this.videoSamples[t].timeStamp,m=t;break}}else m=0;let g=_+t,S=0,T=0;for(let e=h-1;e>=0;e--){let i=this.videoSamples[e].timeStamp;if(this.videoSamples[e].isKeyFrame){const s=i-_;if(s-t<100&&s-t>=-100){f=e;break}}}if(-1==m)return;if(m>=0&&f>m&&(_=this.videoSamples[m].timeStamp,g=this.videoSamples[f].timeStamp),n){if(f-m<1)return!1;this.videoSamples.splice(m,f-m)}else{for(let t=0;t<this.audioSamples.length;t++)if(-1==c&&this.audioSamples[t].timeStamp>=_&&(0==t||this.audioSamples[t-1].timeStamp<_)&&(c=t),this.audioSamples[t].timeStamp>g){p=t;break}if(c>=0&&p>c&&(S=this.audioSamples[c].timeStamp,T=this.audioSamples[p].timeStamp),p-c<1||f-m<1)return!1;this.videoSamples.splice(m,f-m),this.audioSamples.splice(c,p-c)}let y=`WebCodecs.DecodeJitter.setJumpBuffer,type=${i},isRemuxBuf=${this.isRemuxBuf},`;return y+=`bufLen=${e},decodedBuf=${l},decodingBuf=${u},`,y+=`aStartI=${c},aEndI=${p},vStartI=${m},vEndI=${f},`,y+=`currentTime=${s},aDrop=${p-c},vDrop=${f-m},'jumpABuflen'=${T-S},'jumpVbufLen'=${g-_},isShieldAudio=${a}`,o.default.log(y),this.setVideoCurrentTime=o.default.getNow(),!0}discardDeltaVideoFrame(){if(!this.isEnableDiscard)return;if(0==this.videoSamples.length)return;let t=this.player.getVideoCurrentDts(),e=this.player.getAudioCurrentDts(),i=this.getBufferLength(t),s=e-t;if(i<=1e3)return!1;let r=this.videoSamples[0],a=this.player.toDecodeVideoFps>=60?60:this.player.toDecodeVideoFps;if(0==a)return!1;let n=~~(1e3/a*3);n<=50&&(n=50);let h=0;return!(s<=100)&&(s<=200?(h=1,this.discardVideoTSGap=6*n):s<=500?(h=2,this.discardVideoTSGap=4*n):s<=1e3?(h=3,this.discardVideoTSGap=2*n):(h=4,this.discardVideoTSGap=n),!(!r.discardAllow||r.timeStamp-this.lastDiscardFrameTimeStamp<this.discardVideoTSGap)&&(this.lastDiscardFrameTimeStamp=r.timeStamp,this.videoSamples.shift(),this.discardNums++,this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_DECODE_DISCARD_NUMS,this.discardNums),o.default.log(`WebCodecs.DecodeJitter.discardDeltaVideoFrame discardNums=${this.discardNums} dropLevel=${h}, bufLen=${i}, delta=${s}`),!0))}newDiscardVideoFrame(){return!!this.isEnableDiscard&&(0!=this.videoSamples.length&&void(this.discardFrameByPending()||this.discardDeltaVideoFrame()||this.discardFrameByDecodeRate()))}discardFrameByPending(){const t=o.default.getNow();if(0!=this.setVideoCurrentTime&&t-this.setVideoCurrentTime<1e3*this.jumpBufferCfg[0])return!1;const e=this.player.toDecodeVideoFps>=60?60:this.player.toDecodeVideoFps,i=this.player.delayDecode,s=Number(e)*Number(i);if(0===e||0===i)return!1;const r=this.videoSamples[0],a=this.player.getVideoCurrentDts(),n=this.getWillDecodeVBuf(a),h=this.player.webcodecCfg;let l=2e3,u=1e4,c=2e4;h&&h[5]&&h[5].length>=3&&(l=h[5][0],u=h[5][1],c=h[5][2]);let p=this.player.getAudioCurrentDts()-a;if(p<100)return;const m=this.player.webcodecCfg[4]||1500;let f=!1,_=0;if(n>=l&&n<=u)n-l>=Math.random()*l&&r.discardAllow&&s>=m&&(f=!0,_=1);else if(n>u&&n<=c)s>=m&&r.discardAllow&&(f=!0,_=2);else if(n>c&&s>=m)return _=3,this.discardPendingIframe(_,n,p),!0;let g=~~(1e3/e*3);return g<=50&&(g=50),!(r.timeStamp-this.lastDiscardFrameTimeStamp<g)&&(f&&(this.lastDiscardFrameTimeStamp=r.timeStamp,this.videoSamples.shift(),this.discardNums++,this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_DECODE_DISCARD_NUMS,this.discardNums),o.default.log(`WebCodecs.DecodeJitter.discardFrameByPending discardNums=${this.discardNums} dropLevel=${_}, bufLen=${n}`)),f)}discardFrameByDecodeRate(){let t=this.player.getVideoCurrentDts(),e=!1;if(this.player.getAudioCurrentDts()-t<100)return;const i=this.videoSamples[0];if(!i.discardAllow)return e;const s=this.player.toDecodeVideoFps>=60?60:this.player.toDecodeVideoFps,r=this.player.delayDecode;if(this.noReferFps<=0||s<=0||r<=0)return e;const a=Number(s)*Number(r),n=Number(this.noReferFps)*Number(r),h=(this.videoFPS-1e3/r)/this.noReferFps,l=this.player.webcodecCfg[4]||1500;let u=0;a>=l&&(a<n+l?100*h>=100*Math.random()&&(e=!0,u=1):(e=!0,u=2));let c=~~(1e3/s*3);return c<=50&&(c=50),!(i.timeStamp-this.lastDiscardFrameTimeStamp<c)&&(e&&(this.lastDiscardFrameTimeStamp=i.timeStamp,this.videoSamples.shift(),this.discardNums++,this.player.storeWorkerShared(d.StoreWorkerType.VIDEO_DECODE_DISCARD_NUMS,this.discardNums),o.default.log(`WebCodecs.DecodeJitter.discardFrameByDecodeRate discardNums=${this.discardNums} dropLevel=${u}`)),e)}discardPendingIframe(t,e,i){if(i<3e3)return;let s=this.videoSamples,r=s.length;if(r<=0)return;let a=-1,n=-1;for(let t=0;t<r;t++){const e=s[t];if(-1!=a&&e.isKeyFrame){n=t-1;break}e.isKeyFrame&&(a=t+1)}a>=0&&n>=0&&a<n&&(this.videoSamples.splice(a,n-a),this.discardNums+=n-a,o.default.log(`WebCodecs.DecodeJitter.discardFrameByPending discard=${n-a},start=${a},end=${n},dropLevel=${t},bufLen=${e}}`))}addRecv(t,e){let i=t+e;i>this.lastAppendVideoPts&&(this.lastAppendVideoPts=i)}onRenderVideo(t){}appendAudioFrame(t){for(;t.length>0;){let e=t.shift();0==this.isFirstAudioStamp&&(this.isFirstAudioStamp=e.timeStamp),this.isAudioSeek&&e.timeStamp>=this.seekVideoDts&&(o.default.log("DecodeJitter.audioSeek recover!"),this.isAudioSeek=!1),this.checkAvDiff(this.lastVideoStamp,e.timeStamp),l.a.printAppendAudio&&o.default.log(`DecodeJitter.appendAudioFrame dts=${e.timeStamp} samples=${this.audioSamples.length}`),this.audioSamples.push(e),this.player.latencyCfg.latencyMode||this.player.audioDecoderReadyed&&(0!=this.isFirstAudioStamp&&e.timeStamp-this.isFirstAudioStamp<=500||this.isAudioSeek)&&this.decodeAudioSamples()}}appendVideoFrame(t){for(;t.length>0;){let e=t.shift();0===this.firstVideoDts&&(this.firstVideoDts=e.timeStamp),this.checkAvDiff(e.timeStamp,this.lastAudioStamp),this.addRecv(e.timeStamp,e.compositionTime),l.a.printAppendVideo&&o.default.log(`DecodeJitter.appendVideoFrame dts=${e.timeStamp} samples=${this.videoSamples.length}`),this.isVideoSeek&&e.timeStamp>=this.seekVideoDts&&(o.default.log("DecodeJitter.videoSeek recover!"),this.isVideoSeek=!1),this.videoSamples.push(e),this.player.latencyCfg.latencyMode||(this.player.isVodAv1?this.player.videoDecoderReadyed&&(e.timeStamp-this.firstVideoDts<this.fastDecodeTime||this.isVideoSeek)&&this.decodeVideoSamples(0,o.default.getNow(),0,0):(e.timeStamp-this.firstVideoDts<this.fastDecodeTime||this.isVideoSeek)&&this.decodeVideoSamples(0,o.default.getNow(),0,0))}}checkAvDiff(t,e){if(this.isLive&&this.player.dtsJumpOpen){if(this.player.videoRender.isSync&&t>0&&e>0){let i=t>e?t-e:e-t;i>this.player.dtsJumpThreshold&&(this.player.videoRender.setNotSync(),o.default.log("DecodeJitter.checkAvDiff diff="+i))}this.lastVideoStamp=t,this.lastAudioStamp=e}}updateVideoDecodedTimeStamp(t){this.lastDecodedVideoTimeStamp=t}updateVideoFPS(t,e){this.videoFPS=t,this.noReferFps=e}close(){this.player=null,this.videoSamples.length=0,this.videoSamples=null,this.audioSamples.length=0,this.lastAppendVideoPts=0,this.recvMap.clear(),this.videoToDecodedTime=0,this.isFirstAudioStamp=0,this.firstVideoDts=0,this.discardNums=0,this.startPlayTime=0,this.isStartBuffer=!0,this.setVideoCurrentTime=0,this.startMoreBufferTime=0,this.isPauseVideoDecode=!1,this.isPauseAudioDecode=!1,this.isEnableDiscard=!1,this.isSoftWebcodecs=!1,this.decode10SecCostList.length=0,this.isRevFastOver=!1}checkAVSync(){if(o.default.getNow()-this.startPlayTime<startCD)return;let t=this.player.getVideoCurrentDts(),e=this.player.getAudioCurrentDts();if(t<=0||e<=0)return;let i=e-t;i>=1e3&&i>=0||i<0&&i<=-1e3&&this.checkDiscardAudio(e,t)}checkDiscardAudio(t,e){let i=this.getAudioBufferLength(t),s=i-this.JITTER_BUFLEN;if(o.default.log(`DecodeJitter.checkDiscardAudio, bufLen=${i}, audioCurrentDts=${t}, videoCurrentDts=${e}, minusBuffer=${s}, delta=${t-e}`),i<=this.JITTER_BUFLEN)return;if(this.audioSamples.length<=1)return;let r=this.audioSamples[0].timeStamp;if(0==e||e<r)return;let a=r,n=0;for(;this.audioSamples.length>0;){let t=this.audioSamples[0];if(!(t.timeStamp<e&&t.timeStamp-a<=s))break;this.audioSamples.shift(),n=t.timeStamp}n>0&&o.default.log(`DecodeJitter.checkDiscardAudio, startTs=${a}, endTs=${n}, discardBuffer=${n-a}`)}checkDiscardVideo(t,e){let i=this.getBufferLength(e),s=i-this.JITTER_BUFLEN;if(o.default.log(`DecodeJitter.checkDiscardVideo, bufLen=${i}, audioCurrentDts=${t}, videoCurrentDts=${e}, minusBuffer=${s}, delta=${t-e}`),i<=this.JITTER_BUFLEN)return;let r=this.videoSamples.length;if(r<=1)return;let a=this.videoSamples[0].timeStamp;if(0==t||t<a)return;let n=a,h=0;for(let e=0;e<r;e++){let i=this.videoSamples[e];if(!(i.timeStamp<t&&i.timeStamp-n<=s))break;i.discardAllow&&(this.videoSamples.shift(),h=i.timeStamp,r--)}h>0&&o.default.log(`DecodeJitter.checkDiscardVideo, startTs=${n}, endTs=${h}, discardBuffer=${h-n}`)}setPauseVideoDecode(t){this.isPauseVideoDecode=t.isPause}setPauseAudioDecode(t){this.isPauseAudioDecode=t.isPause}setEnableDiscard(t){this.isEnableDiscard=t.enableDiscard}setUseSoftAcceleration(){this.isSoftWebcodecs=!0}updateSoftAcceleration(){this.decode10SecCostList=[],this._helper.updateSoftAcceleration()}getVideoDiscardNums(){let t=this.discardNums-this.lastVideoDiscardNums;return this.lastVideoDiscardNums=this.discardNums,t}setRealFps(t){this.realFps=t}};var ht=class{constructor(){this._firstVideoRenderTs=0,this._firstVideoPts=0,this._firstAudioRenderTs=0,this._firstAudioPts=0,this._syncDone=!1,this._openSync=!1}reset(){this._firstVideoRenderTs=0,this._firstVideoPts=0,this._firstAudioRenderTs=0,this._firstAudioPts=0,this._syncDone=!1}set openSync(t){this._openSync=t}setRenderVideoTs(t){0===this._firstVideoRenderTs&&(this._firstVideoRenderTs=t)}setRenderAudioTs(t,e,i){if(0===this._firstAudioRenderTs&&(this._firstAudioRenderTs=t),this._openSync&&!this._syncDone&&this._firstAudioRenderTs>0&&this._firstVideoRenderTs>0&&this._firstVideoPts>0&&this._firstAudioPts>0){this._syncDone=!0;let t=this._firstVideoPts-this._firstAudioPts;o.default.log("AVRenderSync.syncAudio render done delta="+t),e.setJumpTime(t),i.setJumpTime(t)}}setVideoPts(t){0===this._firstVideoPts&&(this._firstVideoPts=t)}setAudioPts(t){0===this._firstAudioPts&&(this._firstAudioPts=t)}};var dt=class{constructor(){this.openRenderSync=!1,this.latencyBuf=2500,this.latencyMin=3e3,this.latencyMax=3500,this.skipFrameGap=5,this.isNoGop=!1,this.fastMode=!1,this.latencyMode=!1}initConfig(t){this.latencyMode=!1,t&&(t.hasOwnProperty("openRenderSync")&&(this.openRenderSync=t.openRenderSync),t.hasOwnProperty("lowlatencyBuf")&&(this.latencyBuf=t.lowlatencyBuf,this.latencyMode=-1!==this.latencyBuf),t.hasOwnProperty("lowlatencyMin")&&(this.latencyMin=t.lowlatencyMin),t.hasOwnProperty("lowlatencyMax")&&(this.latencyMax=t.lowlatencyMax),t.hasOwnProperty("isNoGop")&&(this.isNoGop=t.isNoGop),t.hasOwnProperty("fastMode")&&(this.fastMode=t.fastMode),t.hasOwnProperty("skipFrameGap")&&(this.skipFrameGap=t.skipFrameGap))}};e.default=class{constructor(){this.videoDecoder=new p(this),this.audioDecoder=new m(this),this.videoRender=new z(this),this.audioRender=new J(this),this.decodeJitter=new nt(this),this.audioDecodedFrames=[],this.audioRenderStarted=!1,this.audioStartRenderFrameTimeLen=500,this.oneSecNow=0,this.fastCheckNow=0,this.frameDuration=0,this.startAppendAudioTime=0,this.isFirstPostAudio=!1,this.quickTimerInterval=null,this.onQuickCheckTimerBind=this.onQuickCheckTimer.bind(this),this.videoFrameStampMap=new Map,this.delayDecode=0,this.toDecodeVideoFps=0,this.userPaused=!1,this.webcodecCfg={},this.latencyCfg=new dt,this.videoDecodeCostErrCnt=0,this.printCnt=0,this.avRenderSync=new ht,this.isBrowserHidden=!1,this.renderNum=0,this.lastTs=0,this.pageFps=0,this.lowFpsCnt=0,this.dtsJumpOpen=!1,this.dtsJumpThreshold=1e4,this.seekTime=0,this.seekVideoDts=0,this.isSeek=!1,this.isAudioSeek=!1,this.firstVideoTs=-1e4,this.firstAudioTs=-1e4,this.seekAudioSamples=[],this.isVodAv1=!1}get audioDecoderReadyed(){return this.audioDecoder&&this.audioDecoder.configured}get videoDecoderReadyed(){return this.videoDecoder&&this.videoDecoder.configured}setVideoOutputByPts(t){this.decodeJitter.setVideoOutputByPts(t)}initWebcodecCfg(t){const{webcodecCfg:e,lowlatencyCfg:i,aiEnhanceCfg:s,isLive:r}=t;e&&(this.webcodecCfg=e),this.decodeJitter.setLive(r),this.latencyCfg.initConfig(i),this.avRenderSync.openSync=this.latencyCfg.openRenderSync,0===this.latencyCfg.latencyBuf&&this.decodeJitter._helper.setNormal(),this.dtsJumpOpen=!!t.dtsJumpOpen,this.dtsJumpThreshold=t.dtsJumpThreshold||1e4,this.videoRender.initConfig(s)}startVideoRender(t,e){const{width:i,height:s,agenerator:r}=t;let a=o.default.getNow();this.videoRender.start(i,s,r,e),clearInterval(this.quickTimerInterval),this.quickTimerInterval=setInterval(this.onQuickCheckTimerBind,4),this.decodeJitter.setStartPlayTime(a)}startAudioRender(t){this.audioRender.start(t)}onQuickCheckTimer(){o.default.postMessage(d.ToMainMessageType.INTERVAL);let t=!1;self.mainSharedArrayBuffer&&(t=1==Atomics.load(self.mainSharedArrayBuffer,_.a.PAUSE_STATUS),this.userPaused=t);let e=o.default.getNow();if(!this.userPaused){let t=this.getAudioDecodedBuffer(),i=this.videoRender.getDecodedBuffer(),s=this.getVideoCurrentDts();this.decodeJitter.decodeThread(t,i,s,this.videoDecoder.decoder.decodeQueueSize),this.audioRender.onQuickCheckTimer(e),this.videoRender.rafHandler(e)}0===this.oneSecNow?this.oneSecNow=e:e-this.oneSecNow>=1e3&&(this.onCheckTimer(e),this.oneSecNow=e),0===this.fastCheckNow?this.fastCheckNow=e:e-this.fastCheckNow>=100&&(this.onCheckFastTimer(e),this.fastCheckNow=e),this.storeWorkerShared(d.StoreWorkerType.VIDEO_BUFFER_LEN,this.getBufferLen())}rafHandler(t){if(this.renderNum++,0===this.lastTs)this.lastTs=t;else{let e=t-this.lastTs;if(e>=1e3){this.lastTs=t;let i=Math.floor(this.renderNum/(e/1e3));this.pageFps=i,this.renderNum=0}}}onCheckTimer(t){if(this.decodeJitter.onCheckTimer(t),o.default.logArr.length>0&&(o.default.postMessage(d.ToMainMessageType.LOG,o.default.logArr),o.default.logArr.length=0),this.statEverySec(t),self.mainSharedArrayBuffer){let t=Atomics.load(self.mainSharedArrayBuffer,_.a.VIDEO_REAL_FPS);this.decodeJitter.setRealFps(t),Atomics.store(self.mainSharedArrayBuffer,_.e.VIDEO_DECODED_DELAY_SMOOTH,this.videoDecoder.smoothFrameDecodeDelay)}this.videoRender.onCheckTimer(t)}onCheckFastTimer(t){this.decodeJitter&&this.decodeJitter.onCheckFastTimer&&this.decodeJitter.onCheckFastTimer(t)}getAudioDecodedBuffer(){return this.audioRender.getDecodedBuffer()}getVideoDecodedBuffer(){return this.videoRender.getDecodedBuffer()}getVideoDecodingBuffer(){return this.videoDecoder.getDecodingBuffer()}statEverySec(){let t=this.videoDecoder.getDecodeDelay(),e=0,i=0,s=-1;t.map(t=>{e+=t}),e>0&&(i=~~(e/t.length),s=i),this.delayDecode=i,s>-1&&s<15?this.videoDecodeCostErrCnt++:this.videoDecodeCostErrCnt=0;let r=this.videoDecoder.getDecodeFps();this.toDecodeVideoFps=r.toDecodeFps,this.storeWorkerShared(d.StoreWorkerType.VIDEO_DECODED_DELAY,i),this.storeWorkerShared(d.StoreWorkerType.VIDEO_READY_TO_RENDER_LIST_LEN,this.videoRender.framelist.length),this.videoDecodeCostErrCnt,this.videoDecoder.isOutputFrameByDts()&&"265"==this.videoDecoder.codecType&&this.handlerError(d.ToMainMessageType.DECODE_DTS);let a=this.videoRender.getEnhanceCostList(),o=0,n=0;a.map(t=>{o+=t}),o>0&&(n=~~(o/a.length)),this.storeWorkerShared(d.StoreWorkerType.VIDEO_ENAHNCE_COST,n)}storeWorkerShared(t,e){self.mainSharedArrayBuffer&&Atomics.store(self.mainSharedArrayBuffer,t,e)}updateRect(t,e){this.videoRender.updateRect(t,e)}updateAVCConfig(t){this.videoRender.updateAVCConfig(t.width,t.height)}updateAudioConfig(t,e,i,s){this.audioDecoder.updateAudioConfig(t,e,i,s),this.decodeJitter.updateAACSampleRate(e),this.audioRender.updateAACSampleRate(e),this.updateAACSampleRate(e)}updateAVCPPS(t,e){}updateAVCSPS(t,e){}updateAVCVPS(t,e){}toDecodeFrame(t){t.type==h.AUIDO?(this.avRenderSync.setAudioPts(t.timeStamp),this.lastToDecodeAudioTs=t.timeStamp,this.audioDecoder.decodeFrame(t)):t.type==h.VIDEO&&(this.avRenderSync.setVideoPts(t.timeStamp+t.compositionTime||0),this.lastToDecodeVideoTs=t.timeStamp,this.toDecodeVideoFrameNums++,this.videoDecoder.decodeFrame(t))}onFrameDecoded(t){const e=this.seekVideoDts;if(t.type==a.VIDEO){this.decodedVideoFrameNums++,this.decodeJitter.updateVideoDecodedTimeStamp(t.frame.timestamp),0==this.firstPerformentTime&&(this.firstPerformentTime=o.default.getNow()),t.noRenderCount=0;let i=t.timeStamp,s=this.videoFrameStampMap.get(i);void 0!==s&&(t.timeStamp+=s,this.videoFrameStampMap.delete(i)),this.isSeek?t.timeStamp-e>=0?(this.onVideoSeek(),this.videoRender.appendFrame(t)):(this.videoRender.setLastPic(t),t.frame.close()):this.videoRender.appendFrame(t)}else t.type==a.AUIDO&&(this.isAudioSeek?t.timeStamp-e>=0?(this.onAudioSeek(),this.seekAudioSamples.push(t)):(t.frame.close(),this.audioRender.setLastAudioData(t),t=null):this.isSeek?this.seekAudioSamples.push(t):this.audioRender.onFrameDecoded(t))}setRenderAudioTs(t,e){this.avRenderSync.setRenderAudioTs(t,e,this.decodeJitter._helper._audioHelper._timeline)}appendAudioFrame(t){0==this.startAppendAudioTime&&(this.startAppendAudioTime=o.default.getNow()),-1e4==this.firstAudioTs&&t.length>0&&(this.firstAudioTs=t[0].timeStamp),this.decodeJitter.appendAudioFrame(t)}appendVideoFrame(t){-1e4==this.firstVideoTs&&t.length>0&&(this.firstVideoTs=t[0].timeStamp),t.map(t=>{this.videoFrameStampMap.set(t.timeStamp,t.compositionTime),this.decodeJitter.updateVideoCts(t.compositionTime)}),this.decodeJitter.appendVideoFrame(t)}fastOver(){this.decodeJitter.fastOver()}updateAACSampleRate(t){this.frameDuration=1024e3/t}updateVideoFPS(t,e){this.decodeJitter.updateVideoFPS(t,e)}setPlayMinBuffer(t){this.decodeJitter.updateVideoFPS(t)}setJitter(t){this.decodeJitter.setJitter(t)}handlerError(t,e){o.default.postMessage(t,e)}getBufferLen(){return this.decodeJitter?this.decodeJitter.getBufferLength(this.videoRender.getCurrentDts()):0}getAudioCurrentDts(){return this.audioRender.getAudioCurrentDts()}getVideoCurrentDts(){return this.videoRender.getCurrentDts()}setUseSoftAcceleration(){o.default.log("WebCodecsWorkerPlayer.setUseSoftAcceleration"),this.videoDecoder.setUseSoftAcceleration(),this.decodeJitter.setUseSoftAcceleration()}updateSoftAcceleration(){o.default.log("WebCodecsWorkerPlayer.updateSoftAcceleration"),this.setUseSoftAcceleration(),this.videoDecoder.resetDecoder(),this.decodeJitter.updateSoftAcceleration()}setLocalConfig(t){1==t._webcodecsNoRenderVideo&&this.videoRender.setNoRender(),1==t._useSoftAcceleration&&this.setUseSoftAcceleration()}setPauseVideoDecode(t){this.decodeJitter.setPauseVideoDecode(t)}setPauseAudioDecode(t){this.decodeJitter.setPauseAudioDecode(t)}setEnableDiscard(t){this.decodeJitter.setEnableDiscard(t)}turnToWebcodecsSoft(){this.videoRender&&this.videoRender.videoEnhance.isSuccess||("265"==this.videoDecoder.codecType?o.default.postMessage(d.ToMainMessageType.SOFT_TURN_TO_MSE):o.default.postMessage(d.ToMainMessageType.TURN_TO_WEBCODECS_SOFT))}turnToMse(){this.videoRender&&this.videoRender.videoEnhance.isSuccess||o.default.postMessage(d.ToMainMessageType.SOFT_TURN_TO_MSE)}updateCurBitrate(t){this.videoRender.updateCurBitrate(t)}setRealFps(t){this.decodeJitter.setRealFps(t),this.videoRender.setRealFps(t)}setBrowserHidden(t){this.isBrowserHidden=t,this.videoRender.setBrowserHidden(t)}setEnhance(t){this.videoRender.setEnhance(t)}setSegmenttion(t){this.videoRender.setSegmenttion(t)}getEnhanceSuccess(){return this.videoRender.getEnhanceSuccess()}handleEnhanceError(){this.videoRender.handleEnhanceError()}onRevFastOver(){this.decodeJitter.onRevFastOver()}initAv1Seg(t){this.videoDecoder.initAv1Seg(t)}seek(t){this.isSeek=!0,this.isAudioSeek=!0,this.seekTime=t.seekTime,this.seekVideoDts=1e3*t.seekTime+t.initDts;const e=this.videoRender.getVideoRenderPts();e>this.seekVideoDts&&(this.isSeekBack=!0),0!=e&&(this.videoDecoder.seek(),this.audioDecoder.seek()),o.default.log("WebCodecsWorkerPlayer.seek",this.seekTime,this.seekVideoDts,this.isSeekBack),this.decodeJitter.seek(this.seekTime,this.seekVideoDts),this.videoRender.seek(this.seekVideoDts),this.audioRender.seek(this.seekVideoDts)}setPlaybackRate(t){this.videoRender.setPlaybackRate(t)}setVodAv1(){this.isVodAv1=!0}onVideoSeek(){o.default.log("WebCodecsWorkerPlayer.onVideoSeek, aLen="+this.seekAudioSamples.length),o.default.postMessage(d.ToMainMessageType.ON_WCS_VIDEO_SEEK,this.seekTime),this.seekTime=0,this.seekAudioSamples.forEach(t=>{this.audioRender.onFrameDecoded(t)}),this.seekAudioSamples.length=0,this.decodeJitter.onVideoSeek(),this.videoRender.onVideoSeek(),this.isSeek=!1,this.seekVideoDts=0,this.isSeekBack=!1,this.seekTime=0}onAudioSeek(){o.default.log("WebCodecsWorkerPlayer.onAudioSeek"),this.isAudioSeek=!1,this.decodeJitter.onAudioSeek()}getAacTimeLen(){return this.audioDecoder.getAacTimeLen()}destroy(){o.default.log("WebCodecsWorkerPlayer.destroy"),this.destroyed=!0,this.videoDecoder.close(),this.videoDecoder=null,this.audioDecoder.close(),this.audioDecoder=null,this.decodeJitter.close(),this.decodeJitter=null,this.videoRender.close(),this.videoRender=null,this.startAudioFastTs=0,this.startVideoFastTs=0,this.oneSecNow=0,this.startAppendAudioTime=0,this.isFirstPostAudio=!1,clearInterval(this.quickTimerInterval),this.quickTimerInterval=null,this.videoFrameStampMap=null,this.delayDecode=0,this.toDecodeVideoFps=0,this.userPaused=!1,this.isBrowserHidden=!1,this.pageFps=0,this.renderNum=0,this.lastTs=0}}}]).default}));